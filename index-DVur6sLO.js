(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(a){if(a.ep)return;a.ep=!0;const l=o(a);fetch(a.href,l)}})();/**
* @vue/shared v3.5.26
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ha(t){const s=Object.create(null);for(const o of t.split(","))s[o]=1;return o=>o in s}const At={},vo=[],hs=()=>{},Hl=()=>!1,Cn=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),ya=t=>t.startsWith("onUpdate:"),Ot=Object.assign,ba=(t,s)=>{const o=t.indexOf(s);o>-1&&t.splice(o,1)},$r=Object.prototype.hasOwnProperty,kt=(t,s)=>$r.call(t,s),Qe=Array.isArray,po=t=>Ko(t)==="[object Map]",wo=t=>Ko(t)==="[object Set]",Va=t=>Ko(t)==="[object Date]",lt=t=>typeof t=="function",Vt=t=>typeof t=="string",_s=t=>typeof t=="symbol",_t=t=>t!==null&&typeof t=="object",Fl=t=>(_t(t)||lt(t))&&lt(t.then)&&lt(t.catch),Ul=Object.prototype.toString,Ko=t=>Ul.call(t),_r=t=>Ko(t).slice(8,-1),Rl=t=>Ko(t)==="[object Object]",wa=t=>Vt(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Io=ha(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),$n=t=>{const s=Object.create(null);return o=>s[o]||(s[o]=t(o))},Mr=/-\w/g,fs=$n(t=>t.replace(Mr,s=>s.slice(1).toUpperCase())),Sr=/\B([A-Z])/g,Zs=$n(t=>t.replace(Sr,"-$1").toLowerCase()),_n=$n(t=>t.charAt(0).toUpperCase()+t.slice(1)),Nn=$n(t=>t?`on${_n(t)}`:""),Ws=(t,s)=>!Object.is(t,s),sn=(t,...s)=>{for(let o=0;o<t.length;o++)t[o](...s)},Nl=(t,s,o,n=!1)=>{Object.defineProperty(t,s,{configurable:!0,enumerable:!1,writable:n,value:o})},Mn=t=>{const s=parseFloat(t);return isNaN(s)?t:s},Ar=t=>{const s=Vt(t)?Number(t):NaN;return isNaN(s)?t:s};let Da;const Sn=()=>Da||(Da=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Oe(t){if(Qe(t)){const s={};for(let o=0;o<t.length;o++){const n=t[o],a=Vt(n)?jr(n):Oe(n);if(a)for(const l in a)s[l]=a[l]}return s}else if(Vt(t)||_t(t))return t}const Ir=/;(?![^(]*\))/g,Lr=/:([^]+)/,Tr=/\/\*[^]*?\*\//g;function jr(t){const s={};return t.replace(Tr,"").split(Ir).forEach(o=>{if(o){const n=o.split(Lr);n.length>1&&(s[n[0].trim()]=n[1].trim())}}),s}function Se(t){let s="";if(Vt(t))s=t;else if(Qe(t))for(let o=0;o<t.length;o++){const n=Se(t[o]);n&&(s+=n+" ")}else if(_t(t))for(const o in t)t[o]&&(s+=o+" ");return s.trim()}const Pr="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Er=ha(Pr);function Ol(t){return!!t||t===""}function Br(t,s){if(t.length!==s.length)return!1;let o=!0;for(let n=0;o&&n<t.length;n++)o=ao(t[n],s[n]);return o}function ao(t,s){if(t===s)return!0;let o=Va(t),n=Va(s);if(o||n)return o&&n?t.getTime()===s.getTime():!1;if(o=_s(t),n=_s(s),o||n)return t===s;if(o=Qe(t),n=Qe(s),o||n)return o&&n?Br(t,s):!1;if(o=_t(t),n=_t(s),o||n){if(!o||!n)return!1;const a=Object.keys(t).length,l=Object.keys(s).length;if(a!==l)return!1;for(const i in t){const r=t.hasOwnProperty(i),c=s.hasOwnProperty(i);if(r&&!c||!r&&c||!ao(t[i],s[i]))return!1}}return String(t)===String(s)}function ka(t,s){return t.findIndex(o=>ao(o,s))}const zl=t=>!!(t&&t.__v_isRef===!0),_=t=>Vt(t)?t:t==null?"":Qe(t)||_t(t)&&(t.toString===Ul||!lt(t.toString))?zl(t)?_(t.value):JSON.stringify(t,Kl,2):String(t),Kl=(t,s)=>zl(s)?Kl(t,s.value):po(s)?{[`Map(${s.size})`]:[...s.entries()].reduce((o,[n,a],l)=>(o[On(n,l)+" =>"]=a,o),{})}:wo(s)?{[`Set(${s.size})`]:[...s.values()].map(o=>On(o))}:_s(s)?On(s):_t(s)&&!Qe(s)&&!Rl(s)?String(s):s,On=(t,s="")=>{var o;return _s(t)?`Symbol(${(o=t.description)!=null?o:s})`:t};function Vr(t){return t==null?"initial":typeof t=="string"?t===""?" ":t:String(t)}/**
* @vue/reactivity v3.5.26
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let ss;class Dr{constructor(s=!1){this.detached=s,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=ss,!s&&ss&&(this.index=(ss.scopes||(ss.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let s,o;if(this.scopes)for(s=0,o=this.scopes.length;s<o;s++)this.scopes[s].pause();for(s=0,o=this.effects.length;s<o;s++)this.effects[s].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let s,o;if(this.scopes)for(s=0,o=this.scopes.length;s<o;s++)this.scopes[s].resume();for(s=0,o=this.effects.length;s<o;s++)this.effects[s].resume()}}run(s){if(this._active){const o=ss;try{return ss=this,s()}finally{ss=o}}}on(){++this._on===1&&(this.prevScope=ss,ss=this)}off(){this._on>0&&--this._on===0&&(ss=this.prevScope,this.prevScope=void 0)}stop(s){if(this._active){this._active=!1;let o,n;for(o=0,n=this.effects.length;o<n;o++)this.effects[o].stop();for(this.effects.length=0,o=0,n=this.cleanups.length;o<n;o++)this.cleanups[o]();if(this.cleanups.length=0,this.scopes){for(o=0,n=this.scopes.length;o<n;o++)this.scopes[o].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!s){const a=this.parent.scopes.pop();a&&a!==this&&(this.parent.scopes[this.index]=a,a.index=this.index)}this.parent=void 0}}}function Hr(){return ss}let jt;const zn=new WeakSet;class Wl{constructor(s){this.fn=s,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,ss&&ss.active&&ss.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,zn.has(this)&&(zn.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||ql(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Ha(this),Zl(this);const s=jt,o=ys;jt=this,ys=!0;try{return this.fn()}finally{Jl(this),jt=s,ys=o,this.flags&=-3}}stop(){if(this.flags&1){for(let s=this.deps;s;s=s.nextDep)$a(s);this.deps=this.depsTail=void 0,Ha(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?zn.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){ta(this)&&this.run()}get dirty(){return ta(this)}}let Gl=0,Lo,To;function ql(t,s=!1){if(t.flags|=8,s){t.next=To,To=t;return}t.next=Lo,Lo=t}function xa(){Gl++}function Ca(){if(--Gl>0)return;if(To){let s=To;for(To=void 0;s;){const o=s.next;s.next=void 0,s.flags&=-9,s=o}}let t;for(;Lo;){let s=Lo;for(Lo=void 0;s;){const o=s.next;if(s.next=void 0,s.flags&=-9,s.flags&1)try{s.trigger()}catch(n){t||(t=n)}s=o}}if(t)throw t}function Zl(t){for(let s=t.deps;s;s=s.nextDep)s.version=-1,s.prevActiveLink=s.dep.activeLink,s.dep.activeLink=s}function Jl(t){let s,o=t.depsTail,n=o;for(;n;){const a=n.prevDep;n.version===-1?(n===o&&(o=a),$a(n),Fr(n)):s=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=a}t.deps=s,t.depsTail=o}function ta(t){for(let s=t.deps;s;s=s.nextDep)if(s.dep.version!==s.version||s.dep.computed&&(Yl(s.dep.computed)||s.dep.version!==s.version))return!0;return!!t._dirty}function Yl(t){if(t.flags&4&&!(t.flags&16)||(t.flags&=-17,t.globalVersion===Ho)||(t.globalVersion=Ho,!t.isSSR&&t.flags&128&&(!t.deps&&!t._dirty||!ta(t))))return;t.flags|=2;const s=t.dep,o=jt,n=ys;jt=t,ys=!0;try{Zl(t);const a=t.fn(t._value);(s.version===0||Ws(a,t._value))&&(t.flags|=128,t._value=a,s.version++)}catch(a){throw s.version++,a}finally{jt=o,ys=n,Jl(t),t.flags&=-3}}function $a(t,s=!1){const{dep:o,prevSub:n,nextSub:a}=t;if(n&&(n.nextSub=a,t.prevSub=void 0),a&&(a.prevSub=n,t.nextSub=void 0),o.subs===t&&(o.subs=n,!n&&o.computed)){o.computed.flags&=-5;for(let l=o.computed.deps;l;l=l.nextDep)$a(l,!0)}!s&&!--o.sc&&o.map&&o.map.delete(o.key)}function Fr(t){const{prevDep:s,nextDep:o}=t;s&&(s.nextDep=o,t.prevDep=void 0),o&&(o.prevDep=s,t.nextDep=void 0)}let ys=!0;const Xl=[];function Bs(){Xl.push(ys),ys=!1}function Vs(){const t=Xl.pop();ys=t===void 0?!0:t}function Ha(t){const{cleanup:s}=t;if(t.cleanup=void 0,s){const o=jt;jt=void 0;try{s()}finally{jt=o}}}let Ho=0;class Ur{constructor(s,o){this.sub=s,this.dep=o,this.version=o.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class _a{constructor(s){this.computed=s,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(s){if(!jt||!ys||jt===this.computed)return;let o=this.activeLink;if(o===void 0||o.sub!==jt)o=this.activeLink=new Ur(jt,this),jt.deps?(o.prevDep=jt.depsTail,jt.depsTail.nextDep=o,jt.depsTail=o):jt.deps=jt.depsTail=o,Ql(o);else if(o.version===-1&&(o.version=this.version,o.nextDep)){const n=o.nextDep;n.prevDep=o.prevDep,o.prevDep&&(o.prevDep.nextDep=n),o.prevDep=jt.depsTail,o.nextDep=void 0,jt.depsTail.nextDep=o,jt.depsTail=o,jt.deps===o&&(jt.deps=n)}return o}trigger(s){this.version++,Ho++,this.notify(s)}notify(s){xa();try{for(let o=this.subs;o;o=o.prevSub)o.sub.notify()&&o.sub.dep.notify()}finally{Ca()}}}function Ql(t){if(t.dep.sc++,t.sub.flags&4){const s=t.dep.computed;if(s&&!t.dep.subs){s.flags|=20;for(let n=s.deps;n;n=n.nextDep)Ql(n)}const o=t.dep.subs;o!==t&&(t.prevSub=o,o&&(o.nextSub=t)),t.dep.subs=t}}const sa=new WeakMap,oo=Symbol(""),oa=Symbol(""),Fo=Symbol("");function qt(t,s,o){if(ys&&jt){let n=sa.get(t);n||sa.set(t,n=new Map);let a=n.get(o);a||(n.set(o,a=new _a),a.map=n,a.key=o),a.track()}}function js(t,s,o,n,a,l){const i=sa.get(t);if(!i){Ho++;return}const r=c=>{c&&c.trigger()};if(xa(),s==="clear")i.forEach(r);else{const c=Qe(t),d=c&&wa(o);if(c&&o==="length"){const u=Number(n);i.forEach((v,b)=>{(b==="length"||b===Fo||!_s(b)&&b>=u)&&r(v)})}else switch((o!==void 0||i.has(void 0))&&r(i.get(o)),d&&r(i.get(Fo)),s){case"add":c?d&&r(i.get("length")):(r(i.get(oo)),po(t)&&r(i.get(oa)));break;case"delete":c||(r(i.get(oo)),po(t)&&r(i.get(oa)));break;case"set":po(t)&&r(i.get(oo));break}}Ca()}function io(t){const s=ht(t);return s===t?s:(qt(s,"iterate",Fo),vs(t)?s:s.map(bs))}function An(t){return qt(t=ht(t),"iterate",Fo),t}function Os(t,s){return Ds(t)?no(t)?ho(bs(s)):ho(s):bs(s)}const Rr={__proto__:null,[Symbol.iterator](){return Kn(this,Symbol.iterator,t=>Os(this,t))},concat(...t){return io(this).concat(...t.map(s=>Qe(s)?io(s):s))},entries(){return Kn(this,"entries",t=>(t[1]=Os(this,t[1]),t))},every(t,s){return As(this,"every",t,s,void 0,arguments)},filter(t,s){return As(this,"filter",t,s,o=>o.map(n=>Os(this,n)),arguments)},find(t,s){return As(this,"find",t,s,o=>Os(this,o),arguments)},findIndex(t,s){return As(this,"findIndex",t,s,void 0,arguments)},findLast(t,s){return As(this,"findLast",t,s,o=>Os(this,o),arguments)},findLastIndex(t,s){return As(this,"findLastIndex",t,s,void 0,arguments)},forEach(t,s){return As(this,"forEach",t,s,void 0,arguments)},includes(...t){return Wn(this,"includes",t)},indexOf(...t){return Wn(this,"indexOf",t)},join(t){return io(this).join(t)},lastIndexOf(...t){return Wn(this,"lastIndexOf",t)},map(t,s){return As(this,"map",t,s,void 0,arguments)},pop(){return xo(this,"pop")},push(...t){return xo(this,"push",t)},reduce(t,...s){return Fa(this,"reduce",t,s)},reduceRight(t,...s){return Fa(this,"reduceRight",t,s)},shift(){return xo(this,"shift")},some(t,s){return As(this,"some",t,s,void 0,arguments)},splice(...t){return xo(this,"splice",t)},toReversed(){return io(this).toReversed()},toSorted(t){return io(this).toSorted(t)},toSpliced(...t){return io(this).toSpliced(...t)},unshift(...t){return xo(this,"unshift",t)},values(){return Kn(this,"values",t=>Os(this,t))}};function Kn(t,s,o){const n=An(t),a=n[s]();return n!==t&&!vs(t)&&(a._next=a.next,a.next=()=>{const l=a._next();return l.done||(l.value=o(l.value)),l}),a}const Nr=Array.prototype;function As(t,s,o,n,a,l){const i=An(t),r=i!==t&&!vs(t),c=i[s];if(c!==Nr[s]){const v=c.apply(t,l);return r?bs(v):v}let d=o;i!==t&&(r?d=function(v,b){return o.call(this,Os(t,v),b,t)}:o.length>2&&(d=function(v,b){return o.call(this,v,b,t)}));const u=c.call(i,d,n);return r&&a?a(u):u}function Fa(t,s,o,n){const a=An(t);let l=o;return a!==t&&(vs(t)?o.length>3&&(l=function(i,r,c){return o.call(this,i,r,c,t)}):l=function(i,r,c){return o.call(this,i,Os(t,r),c,t)}),a[s](l,...n)}function Wn(t,s,o){const n=ht(t);qt(n,"iterate",Fo);const a=n[s](...o);return(a===-1||a===!1)&&Aa(o[0])?(o[0]=ht(o[0]),n[s](...o)):a}function xo(t,s,o=[]){Bs(),xa();const n=ht(t)[s].apply(t,o);return Ca(),Vs(),n}const Or=ha("__proto__,__v_isRef,__isVue"),ei=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(_s));function zr(t){_s(t)||(t=String(t));const s=ht(this);return qt(s,"has",t),s.hasOwnProperty(t)}class ti{constructor(s=!1,o=!1){this._isReadonly=s,this._isShallow=o}get(s,o,n){if(o==="__v_skip")return s.__v_skip;const a=this._isReadonly,l=this._isShallow;if(o==="__v_isReactive")return!a;if(o==="__v_isReadonly")return a;if(o==="__v_isShallow")return l;if(o==="__v_raw")return n===(a?l?ec:ai:l?ni:oi).get(s)||Object.getPrototypeOf(s)===Object.getPrototypeOf(n)?s:void 0;const i=Qe(s);if(!a){let c;if(i&&(c=Rr[o]))return c;if(o==="hasOwnProperty")return zr}const r=Reflect.get(s,o,Jt(s)?s:n);if((_s(o)?ei.has(o):Or(o))||(a||qt(s,"get",o),l))return r;if(Jt(r)){const c=i&&wa(o)?r:r.value;return a&&_t(c)?dn(c):c}return _t(r)?a?dn(r):In(r):r}}class si extends ti{constructor(s=!1){super(!1,s)}set(s,o,n,a){let l=s[o];const i=Qe(s)&&wa(o);if(!this._isShallow){const d=Ds(l);if(!vs(n)&&!Ds(n)&&(l=ht(l),n=ht(n)),!i&&Jt(l)&&!Jt(n))return d||(l.value=n),!0}const r=i?Number(o)<s.length:kt(s,o),c=Reflect.set(s,o,n,Jt(s)?s:a);return s===ht(a)&&(r?Ws(n,l)&&js(s,"set",o,n):js(s,"add",o,n)),c}deleteProperty(s,o){const n=kt(s,o);s[o];const a=Reflect.deleteProperty(s,o);return a&&n&&js(s,"delete",o,void 0),a}has(s,o){const n=Reflect.has(s,o);return(!_s(o)||!ei.has(o))&&qt(s,"has",o),n}ownKeys(s){return qt(s,"iterate",Qe(s)?"length":oo),Reflect.ownKeys(s)}}class Kr extends ti{constructor(s=!1){super(!0,s)}set(s,o){return!0}deleteProperty(s,o){return!0}}const Wr=new si,Gr=new Kr,qr=new si(!0);const na=t=>t,Jo=t=>Reflect.getPrototypeOf(t);function Zr(t,s,o){return function(...n){const a=this.__v_raw,l=ht(a),i=po(l),r=t==="entries"||t===Symbol.iterator&&i,c=t==="keys"&&i,d=a[t](...n),u=o?na:s?ho:bs;return!s&&qt(l,"iterate",c?oa:oo),{next(){const{value:v,done:b}=d.next();return b?{value:v,done:b}:{value:r?[u(v[0]),u(v[1])]:u(v),done:b}},[Symbol.iterator](){return this}}}}function Yo(t){return function(...s){return t==="delete"?!1:t==="clear"?void 0:this}}function Jr(t,s){const o={get(a){const l=this.__v_raw,i=ht(l),r=ht(a);t||(Ws(a,r)&&qt(i,"get",a),qt(i,"get",r));const{has:c}=Jo(i),d=s?na:t?ho:bs;if(c.call(i,a))return d(l.get(a));if(c.call(i,r))return d(l.get(r));l!==i&&l.get(a)},get size(){const a=this.__v_raw;return!t&&qt(ht(a),"iterate",oo),a.size},has(a){const l=this.__v_raw,i=ht(l),r=ht(a);return t||(Ws(a,r)&&qt(i,"has",a),qt(i,"has",r)),a===r?l.has(a):l.has(a)||l.has(r)},forEach(a,l){const i=this,r=i.__v_raw,c=ht(r),d=s?na:t?ho:bs;return!t&&qt(c,"iterate",oo),r.forEach((u,v)=>a.call(l,d(u),d(v),i))}};return Ot(o,t?{add:Yo("add"),set:Yo("set"),delete:Yo("delete"),clear:Yo("clear")}:{add(a){!s&&!vs(a)&&!Ds(a)&&(a=ht(a));const l=ht(this);return Jo(l).has.call(l,a)||(l.add(a),js(l,"add",a,a)),this},set(a,l){!s&&!vs(l)&&!Ds(l)&&(l=ht(l));const i=ht(this),{has:r,get:c}=Jo(i);let d=r.call(i,a);d||(a=ht(a),d=r.call(i,a));const u=c.call(i,a);return i.set(a,l),d?Ws(l,u)&&js(i,"set",a,l):js(i,"add",a,l),this},delete(a){const l=ht(this),{has:i,get:r}=Jo(l);let c=i.call(l,a);c||(a=ht(a),c=i.call(l,a)),r&&r.call(l,a);const d=l.delete(a);return c&&js(l,"delete",a,void 0),d},clear(){const a=ht(this),l=a.size!==0,i=a.clear();return l&&js(a,"clear",void 0,void 0),i}}),["keys","values","entries",Symbol.iterator].forEach(a=>{o[a]=Zr(a,t,s)}),o}function Ma(t,s){const o=Jr(t,s);return(n,a,l)=>a==="__v_isReactive"?!t:a==="__v_isReadonly"?t:a==="__v_raw"?n:Reflect.get(kt(o,a)&&a in n?o:n,a,l)}const Yr={get:Ma(!1,!1)},Xr={get:Ma(!1,!0)},Qr={get:Ma(!0,!1)};const oi=new WeakMap,ni=new WeakMap,ai=new WeakMap,ec=new WeakMap;function tc(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function sc(t){return t.__v_skip||!Object.isExtensible(t)?0:tc(_r(t))}function In(t){return Ds(t)?t:Sa(t,!1,Wr,Yr,oi)}function oc(t){return Sa(t,!1,qr,Xr,ni)}function dn(t){return Sa(t,!0,Gr,Qr,ai)}function Sa(t,s,o,n,a){if(!_t(t)||t.__v_raw&&!(s&&t.__v_isReactive))return t;const l=sc(t);if(l===0)return t;const i=a.get(t);if(i)return i;const r=new Proxy(t,l===2?n:o);return a.set(t,r),r}function no(t){return Ds(t)?no(t.__v_raw):!!(t&&t.__v_isReactive)}function Ds(t){return!!(t&&t.__v_isReadonly)}function vs(t){return!!(t&&t.__v_isShallow)}function Aa(t){return t?!!t.__v_raw:!1}function ht(t){const s=t&&t.__v_raw;return s?ht(s):t}function nc(t){return!kt(t,"__v_skip")&&Object.isExtensible(t)&&Nl(t,"__v_skip",!0),t}const bs=t=>_t(t)?In(t):t,ho=t=>_t(t)?dn(t):t;function Jt(t){return t?t.__v_isRef===!0:!1}function h(t){return ac(t,!1)}function ac(t,s){return Jt(t)?t:new lc(t,s)}class lc{constructor(s,o){this.dep=new _a,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=o?s:ht(s),this._value=o?s:bs(s),this.__v_isShallow=o}get value(){return this.dep.track(),this._value}set value(s){const o=this._rawValue,n=this.__v_isShallow||vs(s)||Ds(s);s=n?s:ht(s),Ws(s,o)&&(this._rawValue=s,this._value=n?s:bs(s),this.dep.trigger())}}function Ke(t){return Jt(t)?t.value:t}const ic={get:(t,s,o)=>s==="__v_raw"?t:Ke(Reflect.get(t,s,o)),set:(t,s,o,n)=>{const a=t[s];return Jt(a)&&!Jt(o)?(a.value=o,!0):Reflect.set(t,s,o,n)}};function li(t){return no(t)?t:new Proxy(t,ic)}class rc{constructor(s,o,n){this.fn=s,this.setter=o,this._value=void 0,this.dep=new _a(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Ho-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!o,this.isSSR=n}notify(){if(this.flags|=16,!(this.flags&8)&&jt!==this)return ql(this,!0),!0}get value(){const s=this.dep.track();return Yl(this),s&&(s.version=this.dep.version),this._value}set value(s){this.setter&&this.setter(s)}}function cc(t,s,o=!1){let n,a;return lt(t)?n=t:(n=t.get,a=t.set),new rc(n,a,o)}const Xo={},un=new WeakMap;let eo;function dc(t,s=!1,o=eo){if(o){let n=un.get(o);n||un.set(o,n=[]),n.push(t)}}function uc(t,s,o=At){const{immediate:n,deep:a,once:l,scheduler:i,augmentJob:r,call:c}=o,d=A=>a?A:vs(A)||a===!1||a===0?Ps(A,1):Ps(A);let u,v,b,w,I=!1,j=!1;if(Jt(t)?(v=()=>t.value,I=vs(t)):no(t)?(v=()=>d(t),I=!0):Qe(t)?(j=!0,I=t.some(A=>no(A)||vs(A)),v=()=>t.map(A=>{if(Jt(A))return A.value;if(no(A))return d(A);if(lt(A))return c?c(A,2):A()})):lt(t)?s?v=c?()=>c(t,2):t:v=()=>{if(b){Bs();try{b()}finally{Vs()}}const A=eo;eo=u;try{return c?c(t,3,[w]):t(w)}finally{eo=A}}:v=hs,s&&a){const A=v,T=a===!0?1/0:a;v=()=>Ps(A(),T)}const $=Hr(),x=()=>{u.stop(),$&&$.active&&ba($.effects,u)};if(l&&s){const A=s;s=(...T)=>{A(...T),x()}}let S=j?new Array(t.length).fill(Xo):Xo;const M=A=>{if(!(!(u.flags&1)||!u.dirty&&!A))if(s){const T=u.run();if(a||I||(j?T.some((G,K)=>Ws(G,S[K])):Ws(T,S))){b&&b();const G=eo;eo=u;try{const K=[T,S===Xo?void 0:j&&S[0]===Xo?[]:S,w];S=T,c?c(s,3,K):s(...K)}finally{eo=G}}}else u.run()};return r&&r(M),u=new Wl(v),u.scheduler=i?()=>i(M,!1):M,w=A=>dc(A,!1,u),b=u.onStop=()=>{const A=un.get(u);if(A){if(c)c(A,4);else for(const T of A)T();un.delete(u)}},s?n?M(!0):S=u.run():i?i(M.bind(null,!0),!0):u.run(),x.pause=u.pause.bind(u),x.resume=u.resume.bind(u),x.stop=x,x}function Ps(t,s=1/0,o){if(s<=0||!_t(t)||t.__v_skip||(o=o||new Map,(o.get(t)||0)>=s))return t;if(o.set(t,s),s--,Jt(t))Ps(t.value,s,o);else if(Qe(t))for(let n=0;n<t.length;n++)Ps(t[n],s,o);else if(wo(t)||po(t))t.forEach(n=>{Ps(n,s,o)});else if(Rl(t)){for(const n in t)Ps(t[n],s,o);for(const n of Object.getOwnPropertySymbols(t))Object.prototype.propertyIsEnumerable.call(t,n)&&Ps(t[n],s,o)}return t}/**
* @vue/runtime-core v3.5.26
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Wo(t,s,o,n){try{return n?t(...n):t()}catch(a){Ln(a,s,o)}}function ws(t,s,o,n){if(lt(t)){const a=Wo(t,s,o,n);return a&&Fl(a)&&a.catch(l=>{Ln(l,s,o)}),a}if(Qe(t)){const a=[];for(let l=0;l<t.length;l++)a.push(ws(t[l],s,o,n));return a}}function Ln(t,s,o,n=!0){const a=s?s.vnode:null,{errorHandler:l,throwUnhandledErrorInProduction:i}=s&&s.appContext.config||At;if(s){let r=s.parent;const c=s.proxy,d=`https://vuejs.org/error-reference/#runtime-${o}`;for(;r;){const u=r.ec;if(u){for(let v=0;v<u.length;v++)if(u[v](t,c,d)===!1)return}r=r.parent}if(l){Bs(),Wo(l,null,10,[t,c,d]),Vs();return}}vc(t,o,a,n,i)}function vc(t,s,o,n=!0,a=!1){if(a)throw t;console.error(t)}const es=[];let Cs=-1;const fo=[];let zs=null,co=0;const ii=Promise.resolve();let vn=null;function Yt(t){const s=vn||ii;return t?s.then(this?t.bind(this):t):s}function pc(t){let s=Cs+1,o=es.length;for(;s<o;){const n=s+o>>>1,a=es[n],l=Uo(a);l<t||l===t&&a.flags&2?s=n+1:o=n}return s}function Ia(t){if(!(t.flags&1)){const s=Uo(t),o=es[es.length-1];!o||!(t.flags&2)&&s>=Uo(o)?es.push(t):es.splice(pc(s),0,t),t.flags|=1,ri()}}function ri(){vn||(vn=ii.then(ui))}function ci(t){Qe(t)?fo.push(...t):zs&&t.id===-1?zs.splice(co+1,0,t):t.flags&1||(fo.push(t),t.flags|=1),ri()}function Ua(t,s,o=Cs+1){for(;o<es.length;o++){const n=es[o];if(n&&n.flags&2){if(t&&n.id!==t.uid)continue;es.splice(o,1),o--,n.flags&4&&(n.flags&=-2),n(),n.flags&4||(n.flags&=-2)}}}function di(t){if(fo.length){const s=[...new Set(fo)].sort((o,n)=>Uo(o)-Uo(n));if(fo.length=0,zs){zs.push(...s);return}for(zs=s,co=0;co<zs.length;co++){const o=zs[co];o.flags&4&&(o.flags&=-2),o.flags&8||o(),o.flags&=-2}zs=null,co=0}}const Uo=t=>t.id==null?t.flags&2?-1:1/0:t.id;function ui(t){try{for(Cs=0;Cs<es.length;Cs++){const s=es[Cs];s&&!(s.flags&8)&&(s.flags&4&&(s.flags&=-2),Wo(s,s.i,s.i?15:14),s.flags&4||(s.flags&=-2))}}finally{for(;Cs<es.length;Cs++){const s=es[Cs];s&&(s.flags&=-2)}Cs=-1,es.length=0,di(),vn=null,(es.length||fo.length)&&ui()}}let rs=null,vi=null;function pn(t){const s=rs;return rs=t,vi=t&&t.type.__scopeId||null,s}function ko(t,s=rs,o){if(!s||t._n)return t;const n=(...a)=>{n._d&&gn(-1);const l=pn(s);let i;try{i=t(...a)}finally{pn(l),n._d&&gn(1)}return i};return n._n=!0,n._c=!0,n._d=!0,n}function ke(t,s){if(rs===null)return t;const o=Vn(rs),n=t.dirs||(t.dirs=[]);for(let a=0;a<s.length;a++){let[l,i,r,c=At]=s[a];l&&(lt(l)&&(l={mounted:l,updated:l}),l.deep&&Ps(i),n.push({dir:l,instance:o,value:i,oldValue:void 0,arg:r,modifiers:c}))}return t}function Ys(t,s,o,n){const a=t.dirs,l=s&&s.dirs;for(let i=0;i<a.length;i++){const r=a[i];l&&(r.oldValue=l[i].value);let c=r.dir[n];c&&(Bs(),ws(c,o,8,[t.el,r,t,s]),Vs())}}function fc(t,s){if(Zt){let o=Zt.provides;const n=Zt.parent&&Zt.parent.provides;n===o&&(o=Zt.provides=Object.create(n)),o[t]=s}}function on(t,s,o=!1){const n=Bn();if(n||mo){let a=mo?mo._context.provides:n?n.parent==null||n.ce?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(a&&t in a)return a[t];if(arguments.length>1)return o&&lt(s)?s.call(n&&n.proxy):s}}const mc=Symbol.for("v-scx"),gc=()=>on(mc);function Ft(t,s,o){return pi(t,s,o)}function pi(t,s,o=At){const{immediate:n,deep:a,flush:l,once:i}=o,r=Ot({},o),c=s&&n||!s&&l!=="post";let d;if(Oo){if(l==="sync"){const w=gc();d=w.__watcherHandles||(w.__watcherHandles=[])}else if(!c){const w=()=>{};return w.stop=hs,w.resume=hs,w.pause=hs,w}}const u=Zt;r.call=(w,I,j)=>ws(w,u,I,j);let v=!1;l==="post"?r.scheduler=w=>{Qt(w,u&&u.suspense)}:l!=="sync"&&(v=!0,r.scheduler=(w,I)=>{I?w():Ia(w)}),r.augmentJob=w=>{s&&(w.flags|=4),v&&(w.flags|=2,u&&(w.id=u.uid,w.i=u))};const b=uc(t,s,r);return Oo&&(d?d.push(b):c&&b()),b}function hc(t,s,o){const n=this.proxy,a=Vt(t)?t.includes(".")?fi(n,t):()=>n[t]:t.bind(n,n);let l;lt(s)?l=s:(l=s.handler,o=s);const i=Go(this),r=pi(a,l.bind(n),o);return i(),r}function fi(t,s){const o=s.split(".");return()=>{let n=t;for(let a=0;a<o.length&&n;a++)n=n[o[a]];return n}}const mi=Symbol("_vte"),gi=t=>t.__isTeleport,jo=t=>t&&(t.disabled||t.disabled===""),Ra=t=>t&&(t.defer||t.defer===""),Na=t=>typeof SVGElement<"u"&&t instanceof SVGElement,Oa=t=>typeof MathMLElement=="function"&&t instanceof MathMLElement,aa=(t,s)=>{const o=t&&t.to;return Vt(o)?s?s(o):null:o},hi={name:"Teleport",__isTeleport:!0,process(t,s,o,n,a,l,i,r,c,d){const{mc:u,pc:v,pbc:b,o:{insert:w,querySelector:I,createText:j,createComment:$}}=d,x=jo(s.props);let{shapeFlag:S,children:M,dynamicChildren:A}=s;if(t==null){const T=s.el=j(""),G=s.anchor=j("");w(T,o,n),w(G,o,n);const K=(ee,Z)=>{S&16&&u(M,ee,Z,a,l,i,r,c)},q=()=>{const ee=s.target=aa(s.props,I),Z=yi(ee,s,j,w);ee&&(i!=="svg"&&Na(ee)?i="svg":i!=="mathml"&&Oa(ee)&&(i="mathml"),a&&a.isCE&&(a.ce._teleportTargets||(a.ce._teleportTargets=new Set)).add(ee),x||(K(ee,Z),nn(s,!1)))};x&&(K(o,G),nn(s,!0)),Ra(s.props)?(s.el.__isMounted=!1,Qt(()=>{q(),delete s.el.__isMounted},l)):q()}else{if(Ra(s.props)&&t.el.__isMounted===!1){Qt(()=>{hi.process(t,s,o,n,a,l,i,r,c,d)},l);return}s.el=t.el,s.targetStart=t.targetStart;const T=s.anchor=t.anchor,G=s.target=t.target,K=s.targetAnchor=t.targetAnchor,q=jo(t.props),ee=q?o:G,Z=q?T:K;if(i==="svg"||Na(G)?i="svg":(i==="mathml"||Oa(G))&&(i="mathml"),A?(b(t.dynamicChildren,A,ee,a,l,i,r),Ea(t,s,!0)):c||v(t,s,ee,Z,a,l,i,r,!1),x)q?s.props&&t.props&&s.props.to!==t.props.to&&(s.props.to=t.props.to):Qo(s,o,T,d,1);else if((s.props&&s.props.to)!==(t.props&&t.props.to)){const E=s.target=aa(s.props,I);E&&Qo(s,E,null,d,0)}else q&&Qo(s,G,K,d,1);nn(s,x)}},remove(t,s,o,{um:n,o:{remove:a}},l){const{shapeFlag:i,children:r,anchor:c,targetStart:d,targetAnchor:u,target:v,props:b}=t;if(v&&(a(d),a(u)),l&&a(c),i&16){const w=l||!jo(b);for(let I=0;I<r.length;I++){const j=r[I];n(j,s,o,w,!!j.dynamicChildren)}}},move:Qo,hydrate:yc};function Qo(t,s,o,{o:{insert:n},m:a},l=2){l===0&&n(t.targetAnchor,s,o);const{el:i,anchor:r,shapeFlag:c,children:d,props:u}=t,v=l===2;if(v&&n(i,s,o),(!v||jo(u))&&c&16)for(let b=0;b<d.length;b++)a(d[b],s,o,2);v&&n(r,s,o)}function yc(t,s,o,n,a,l,{o:{nextSibling:i,parentNode:r,querySelector:c,insert:d,createText:u}},v){function b(j,$,x,S){$.anchor=v(i(j),$,r(j),o,n,a,l),$.targetStart=x,$.targetAnchor=S}const w=s.target=aa(s.props,c),I=jo(s.props);if(w){const j=w._lpa||w.firstChild;if(s.shapeFlag&16)if(I)b(t,s,j,j&&i(j));else{s.anchor=i(t);let $=j;for(;$;){if($&&$.nodeType===8){if($.data==="teleport start anchor")s.targetStart=$;else if($.data==="teleport anchor"){s.targetAnchor=$,w._lpa=s.targetAnchor&&i(s.targetAnchor);break}}$=i($)}s.targetAnchor||yi(w,s,u,d),v(j&&i(j),s,w,o,n,a,l)}nn(s,I)}else I&&s.shapeFlag&16&&b(t,s,t,i(t));return s.anchor&&i(s.anchor)}const bc=hi;function nn(t,s){const o=t.ctx;if(o&&o.ut){let n,a;for(s?(n=t.el,a=t.anchor):(n=t.targetStart,a=t.targetAnchor);n&&n!==a;)n.nodeType===1&&n.setAttribute("data-v-owner",o.uid),n=n.nextSibling;o.ut()}}function yi(t,s,o,n){const a=s.targetStart=o(""),l=s.targetAnchor=o("");return a[mi]=l,t&&(n(a,t),n(l,t)),l}const Ts=Symbol("_leaveCb"),en=Symbol("_enterCb");function bi(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return it(()=>{t.isMounted=!0}),Ai(()=>{t.isUnmounting=!0}),t}const ds=[Function,Array],wi={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:ds,onEnter:ds,onAfterEnter:ds,onEnterCancelled:ds,onBeforeLeave:ds,onLeave:ds,onAfterLeave:ds,onLeaveCancelled:ds,onBeforeAppear:ds,onAppear:ds,onAfterAppear:ds,onAppearCancelled:ds},ki=t=>{const s=t.subTree;return s.component?ki(s.component):s},wc={name:"BaseTransition",props:wi,setup(t,{slots:s}){const o=Bn(),n=bi();return()=>{const a=s.default&&La(s.default(),!0);if(!a||!a.length)return;const l=xi(a),i=ht(t),{mode:r}=i;if(n.isLeaving)return Gn(l);const c=za(l);if(!c)return Gn(l);let d=Ro(c,i,n,o,v=>d=v);c.type!==ts&&lo(c,d);let u=o.subTree&&za(o.subTree);if(u&&u.type!==ts&&!to(u,c)&&ki(o).type!==ts){let v=Ro(u,i,n,o);if(lo(u,v),r==="out-in"&&c.type!==ts)return n.isLeaving=!0,v.afterLeave=()=>{n.isLeaving=!1,o.job.flags&8||o.update(),delete v.afterLeave,u=void 0},Gn(l);r==="in-out"&&c.type!==ts?v.delayLeave=(b,w,I)=>{const j=Ci(n,u);j[String(u.key)]=u,b[Ts]=()=>{w(),b[Ts]=void 0,delete d.delayedLeave,u=void 0},d.delayedLeave=()=>{I(),delete d.delayedLeave,u=void 0}}:u=void 0}else u&&(u=void 0);return l}}};function xi(t){let s=t[0];if(t.length>1){for(const o of t)if(o.type!==ts){s=o;break}}return s}const kc=wc;function Ci(t,s){const{leavingVNodes:o}=t;let n=o.get(s.type);return n||(n=Object.create(null),o.set(s.type,n)),n}function Ro(t,s,o,n,a){const{appear:l,mode:i,persisted:r=!1,onBeforeEnter:c,onEnter:d,onAfterEnter:u,onEnterCancelled:v,onBeforeLeave:b,onLeave:w,onAfterLeave:I,onLeaveCancelled:j,onBeforeAppear:$,onAppear:x,onAfterAppear:S,onAppearCancelled:M}=s,A=String(t.key),T=Ci(o,t),G=(ee,Z)=>{ee&&ws(ee,n,9,Z)},K=(ee,Z)=>{const E=Z[1];G(ee,Z),Qe(ee)?ee.every(m=>m.length<=1)&&E():ee.length<=1&&E()},q={mode:i,persisted:r,beforeEnter(ee){let Z=c;if(!o.isMounted)if(l)Z=$||c;else return;ee[Ts]&&ee[Ts](!0);const E=T[A];E&&to(t,E)&&E.el[Ts]&&E.el[Ts](),G(Z,[ee])},enter(ee){let Z=d,E=u,m=v;if(!o.isMounted)if(l)Z=x||d,E=S||u,m=M||v;else return;let g=!1;const D=ee[en]=W=>{g||(g=!0,W?G(m,[ee]):G(E,[ee]),q.delayedLeave&&q.delayedLeave(),ee[en]=void 0)};Z?K(Z,[ee,D]):D()},leave(ee,Z){const E=String(t.key);if(ee[en]&&ee[en](!0),o.isUnmounting)return Z();G(b,[ee]);let m=!1;const g=ee[Ts]=D=>{m||(m=!0,Z(),D?G(j,[ee]):G(I,[ee]),ee[Ts]=void 0,T[E]===t&&delete T[E])};T[E]=t,w?K(w,[ee,g]):g()},clone(ee){const Z=Ro(ee,s,o,n,a);return a&&a(Z),Z}};return q}function Gn(t){if(Tn(t))return t=Gs(t),t.children=null,t}function za(t){if(!Tn(t))return gi(t.type)&&t.children?xi(t.children):t;if(t.component)return t.component.subTree;const{shapeFlag:s,children:o}=t;if(o){if(s&16)return o[0];if(s&32&&lt(o.default))return o.default()}}function lo(t,s){t.shapeFlag&6&&t.component?(t.transition=s,lo(t.component.subTree,s)):t.shapeFlag&128?(t.ssContent.transition=s.clone(t.ssContent),t.ssFallback.transition=s.clone(t.ssFallback)):t.transition=s}function La(t,s=!1,o){let n=[],a=0;for(let l=0;l<t.length;l++){let i=t[l];const r=o==null?i.key:String(o)+String(i.key!=null?i.key:l);i.type===Le?(i.patchFlag&128&&a++,n=n.concat(La(i.children,s,r))):(s||i.type!==ts)&&n.push(r!=null?Gs(i,{key:r}):i)}if(a>1)for(let l=0;l<n.length;l++)n[l].patchFlag=-2;return n}function $i(t){t.ids=[t.ids[0]+t.ids[2]+++"-",0,0]}const fn=new WeakMap;function Po(t,s,o,n,a=!1){if(Qe(t)){t.forEach((I,j)=>Po(I,s&&(Qe(s)?s[j]:s),o,n,a));return}if(Eo(n)&&!a){n.shapeFlag&512&&n.type.__asyncResolved&&n.component.subTree.component&&Po(t,s,o,n.component.subTree);return}const l=n.shapeFlag&4?Vn(n.component):n.el,i=a?null:l,{i:r,r:c}=t,d=s&&s.r,u=r.refs===At?r.refs={}:r.refs,v=r.setupState,b=ht(v),w=v===At?Hl:I=>kt(b,I);if(d!=null&&d!==c){if(Ka(s),Vt(d))u[d]=null,w(d)&&(v[d]=null);else if(Jt(d)){d.value=null;const I=s;I.k&&(u[I.k]=null)}}if(lt(c))Wo(c,r,12,[i,u]);else{const I=Vt(c),j=Jt(c);if(I||j){const $=()=>{if(t.f){const x=I?w(c)?v[c]:u[c]:c.value;if(a)Qe(x)&&ba(x,l);else if(Qe(x))x.includes(l)||x.push(l);else if(I)u[c]=[l],w(c)&&(v[c]=u[c]);else{const S=[l];c.value=S,t.k&&(u[t.k]=S)}}else I?(u[c]=i,w(c)&&(v[c]=i)):j&&(c.value=i,t.k&&(u[t.k]=i))};if(i){const x=()=>{$(),fn.delete(t)};x.id=-1,fn.set(t,x),Qt(x,o)}else Ka(t),$()}}}function Ka(t){const s=fn.get(t);s&&(s.flags|=8,fn.delete(t))}Sn().requestIdleCallback;Sn().cancelIdleCallback;const Eo=t=>!!t.type.__asyncLoader,Tn=t=>t.type.__isKeepAlive;function xc(t,s){_i(t,"a",s)}function Cc(t,s){_i(t,"da",s)}function _i(t,s,o=Zt){const n=t.__wdc||(t.__wdc=()=>{let a=o;for(;a;){if(a.isDeactivated)return;a=a.parent}return t()});if(jn(s,n,o),o){let a=o.parent;for(;a&&a.parent;)Tn(a.parent.vnode)&&$c(n,s,o,a),a=a.parent}}function $c(t,s,o,n){const a=jn(s,t,n,!0);zt(()=>{ba(n[s],a)},o)}function jn(t,s,o=Zt,n=!1){if(o){const a=o[t]||(o[t]=[]),l=s.__weh||(s.__weh=(...i)=>{Bs();const r=Go(o),c=ws(s,o,t,i);return r(),Vs(),c});return n?a.unshift(l):a.push(l),l}}const Fs=t=>(s,o=Zt)=>{(!Oo||t==="sp")&&jn(t,(...n)=>s(...n),o)},_c=Fs("bm"),it=Fs("m"),Mi=Fs("bu"),Si=Fs("u"),Ai=Fs("bum"),zt=Fs("um"),Mc=Fs("sp"),Sc=Fs("rtg"),Ac=Fs("rtc");function Ic(t,s=Zt){jn("ec",t,s)}const Lc="components",Ii=Symbol.for("v-ndc");function Ta(t){return Vt(t)?Tc(Lc,t,!1)||t:t||Ii}function Tc(t,s,o=!0,n=!1){const a=rs||Zt;if(a){const l=a.type;{const r=md(l,!1);if(r&&(r===s||r===fs(s)||r===_n(fs(s))))return l}const i=Wa(a[t]||l[t],s)||Wa(a.appContext[t],s);return!i&&n?l:i}}function Wa(t,s){return t&&(t[s]||t[fs(s)]||t[_n(fs(s))])}function Fe(t,s,o,n){let a;const l=o,i=Qe(t);if(i||Vt(t)){const r=i&&no(t);let c=!1,d=!1;r&&(c=!vs(t),d=Ds(t),t=An(t)),a=new Array(t.length);for(let u=0,v=t.length;u<v;u++)a[u]=s(c?d?ho(bs(t[u])):bs(t[u]):t[u],u,void 0,l)}else if(typeof t=="number"){a=new Array(t);for(let r=0;r<t;r++)a[r]=s(r+1,r,void 0,l)}else if(_t(t))if(t[Symbol.iterator])a=Array.from(t,(r,c)=>s(r,c,void 0,l));else{const r=Object.keys(t);a=new Array(r.length);for(let c=0,d=r.length;c<d;c++){const u=r[c];a[c]=s(t[u],u,c,l)}}else a=[];return a}const la=t=>t?Gi(t)?Vn(t):la(t.parent):null,Bo=Ot(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>la(t.parent),$root:t=>la(t.root),$host:t=>t.ce,$emit:t=>t.emit,$options:t=>Ti(t),$forceUpdate:t=>t.f||(t.f=()=>{Ia(t.update)}),$nextTick:t=>t.n||(t.n=Yt.bind(t.proxy)),$watch:t=>hc.bind(t)}),qn=(t,s)=>t!==At&&!t.__isScriptSetup&&kt(t,s),jc={get({_:t},s){if(s==="__v_skip")return!0;const{ctx:o,setupState:n,data:a,props:l,accessCache:i,type:r,appContext:c}=t;if(s[0]!=="$"){const b=i[s];if(b!==void 0)switch(b){case 1:return n[s];case 2:return a[s];case 4:return o[s];case 3:return l[s]}else{if(qn(n,s))return i[s]=1,n[s];if(a!==At&&kt(a,s))return i[s]=2,a[s];if(kt(l,s))return i[s]=3,l[s];if(o!==At&&kt(o,s))return i[s]=4,o[s];ia&&(i[s]=0)}}const d=Bo[s];let u,v;if(d)return s==="$attrs"&&qt(t.attrs,"get",""),d(t);if((u=r.__cssModules)&&(u=u[s]))return u;if(o!==At&&kt(o,s))return i[s]=4,o[s];if(v=c.config.globalProperties,kt(v,s))return v[s]},set({_:t},s,o){const{data:n,setupState:a,ctx:l}=t;return qn(a,s)?(a[s]=o,!0):n!==At&&kt(n,s)?(n[s]=o,!0):kt(t.props,s)||s[0]==="$"&&s.slice(1)in t?!1:(l[s]=o,!0)},has({_:{data:t,setupState:s,accessCache:o,ctx:n,appContext:a,props:l,type:i}},r){let c;return!!(o[r]||t!==At&&r[0]!=="$"&&kt(t,r)||qn(s,r)||kt(l,r)||kt(n,r)||kt(Bo,r)||kt(a.config.globalProperties,r)||(c=i.__cssModules)&&c[r])},defineProperty(t,s,o){return o.get!=null?t._.accessCache[s]=0:kt(o,"value")&&this.set(t,s,o.value,null),Reflect.defineProperty(t,s,o)}};function Ga(t){return Qe(t)?t.reduce((s,o)=>(s[o]=null,s),{}):t}let ia=!0;function Pc(t){const s=Ti(t),o=t.proxy,n=t.ctx;ia=!1,s.beforeCreate&&qa(s.beforeCreate,t,"bc");const{data:a,computed:l,methods:i,watch:r,provide:c,inject:d,created:u,beforeMount:v,mounted:b,beforeUpdate:w,updated:I,activated:j,deactivated:$,beforeDestroy:x,beforeUnmount:S,destroyed:M,unmounted:A,render:T,renderTracked:G,renderTriggered:K,errorCaptured:q,serverPrefetch:ee,expose:Z,inheritAttrs:E,components:m,directives:g,filters:D}=s;if(d&&Ec(d,n,null),i)for(const R in i){const F=i[R];lt(F)&&(n[R]=F.bind(o))}if(a){const R=a.call(o,o);_t(R)&&(t.data=In(R))}if(ia=!0,l)for(const R in l){const F=l[R],ie=lt(F)?F.bind(o,o):lt(F.get)?F.get.bind(o,o):hs,re=!lt(F)&&lt(F.set)?F.set.bind(o):hs,pe=tt({get:ie,set:re});Object.defineProperty(n,R,{enumerable:!0,configurable:!0,get:()=>pe.value,set:we=>pe.value=we})}if(r)for(const R in r)Li(r[R],n,o,R);if(c){const R=lt(c)?c.call(o):c;Reflect.ownKeys(R).forEach(F=>{fc(F,R[F])})}u&&qa(u,t,"c");function te(R,F){Qe(F)?F.forEach(ie=>R(ie.bind(o))):F&&R(F.bind(o))}if(te(_c,v),te(it,b),te(Mi,w),te(Si,I),te(xc,j),te(Cc,$),te(Ic,q),te(Ac,G),te(Sc,K),te(Ai,S),te(zt,A),te(Mc,ee),Qe(Z))if(Z.length){const R=t.exposed||(t.exposed={});Z.forEach(F=>{Object.defineProperty(R,F,{get:()=>o[F],set:ie=>o[F]=ie,enumerable:!0})})}else t.exposed||(t.exposed={});T&&t.render===hs&&(t.render=T),E!=null&&(t.inheritAttrs=E),m&&(t.components=m),g&&(t.directives=g),ee&&$i(t)}function Ec(t,s,o=hs){Qe(t)&&(t=ra(t));for(const n in t){const a=t[n];let l;_t(a)?"default"in a?l=on(a.from||n,a.default,!0):l=on(a.from||n):l=on(a),Jt(l)?Object.defineProperty(s,n,{enumerable:!0,configurable:!0,get:()=>l.value,set:i=>l.value=i}):s[n]=l}}function qa(t,s,o){ws(Qe(t)?t.map(n=>n.bind(s.proxy)):t.bind(s.proxy),s,o)}function Li(t,s,o,n){let a=n.includes(".")?fi(o,n):()=>o[n];if(Vt(t)){const l=s[t];lt(l)&&Ft(a,l)}else if(lt(t))Ft(a,t.bind(o));else if(_t(t))if(Qe(t))t.forEach(l=>Li(l,s,o,n));else{const l=lt(t.handler)?t.handler.bind(o):s[t.handler];lt(l)&&Ft(a,l,t)}}function Ti(t){const s=t.type,{mixins:o,extends:n}=s,{mixins:a,optionsCache:l,config:{optionMergeStrategies:i}}=t.appContext,r=l.get(s);let c;return r?c=r:!a.length&&!o&&!n?c=s:(c={},a.length&&a.forEach(d=>mn(c,d,i,!0)),mn(c,s,i)),_t(s)&&l.set(s,c),c}function mn(t,s,o,n=!1){const{mixins:a,extends:l}=s;l&&mn(t,l,o,!0),a&&a.forEach(i=>mn(t,i,o,!0));for(const i in s)if(!(n&&i==="expose")){const r=Bc[i]||o&&o[i];t[i]=r?r(t[i],s[i]):s[i]}return t}const Bc={data:Za,props:Ja,emits:Ja,methods:Mo,computed:Mo,beforeCreate:Xt,created:Xt,beforeMount:Xt,mounted:Xt,beforeUpdate:Xt,updated:Xt,beforeDestroy:Xt,beforeUnmount:Xt,destroyed:Xt,unmounted:Xt,activated:Xt,deactivated:Xt,errorCaptured:Xt,serverPrefetch:Xt,components:Mo,directives:Mo,watch:Dc,provide:Za,inject:Vc};function Za(t,s){return s?t?function(){return Ot(lt(t)?t.call(this,this):t,lt(s)?s.call(this,this):s)}:s:t}function Vc(t,s){return Mo(ra(t),ra(s))}function ra(t){if(Qe(t)){const s={};for(let o=0;o<t.length;o++)s[t[o]]=t[o];return s}return t}function Xt(t,s){return t?[...new Set([].concat(t,s))]:s}function Mo(t,s){return t?Ot(Object.create(null),t,s):s}function Ja(t,s){return t?Qe(t)&&Qe(s)?[...new Set([...t,...s])]:Ot(Object.create(null),Ga(t),Ga(s??{})):s}function Dc(t,s){if(!t)return s;if(!s)return t;const o=Ot(Object.create(null),t);for(const n in s)o[n]=Xt(t[n],s[n]);return o}function ji(){return{app:null,config:{isNativeTag:Hl,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Hc=0;function Fc(t,s){return function(n,a=null){lt(n)||(n=Ot({},n)),a!=null&&!_t(a)&&(a=null);const l=ji(),i=new WeakSet,r=[];let c=!1;const d=l.app={_uid:Hc++,_component:n,_props:a,_container:null,_context:l,_instance:null,version:hd,get config(){return l.config},set config(u){},use(u,...v){return i.has(u)||(u&&lt(u.install)?(i.add(u),u.install(d,...v)):lt(u)&&(i.add(u),u(d,...v))),d},mixin(u){return l.mixins.includes(u)||l.mixins.push(u),d},component(u,v){return v?(l.components[u]=v,d):l.components[u]},directive(u,v){return v?(l.directives[u]=v,d):l.directives[u]},mount(u,v,b){if(!c){const w=d._ceVNode||Ye(n,a);return w.appContext=l,b===!0?b="svg":b===!1&&(b=void 0),t(w,u,b),c=!0,d._container=u,u.__vue_app__=d,Vn(w.component)}},onUnmount(u){r.push(u)},unmount(){c&&(ws(r,d._instance,16),t(null,d._container),delete d._container.__vue_app__)},provide(u,v){return l.provides[u]=v,d},runWithContext(u){const v=mo;mo=d;try{return u()}finally{mo=v}}};return d}}let mo=null;const Uc=(t,s)=>s==="modelValue"||s==="model-value"?t.modelModifiers:t[`${s}Modifiers`]||t[`${fs(s)}Modifiers`]||t[`${Zs(s)}Modifiers`];function Rc(t,s,...o){if(t.isUnmounted)return;const n=t.vnode.props||At;let a=o;const l=s.startsWith("update:"),i=l&&Uc(n,s.slice(7));i&&(i.trim&&(a=o.map(u=>Vt(u)?u.trim():u)),i.number&&(a=o.map(Mn)));let r,c=n[r=Nn(s)]||n[r=Nn(fs(s))];!c&&l&&(c=n[r=Nn(Zs(s))]),c&&ws(c,t,6,a);const d=n[r+"Once"];if(d){if(!t.emitted)t.emitted={};else if(t.emitted[r])return;t.emitted[r]=!0,ws(d,t,6,a)}}const Nc=new WeakMap;function Pi(t,s,o=!1){const n=o?Nc:s.emitsCache,a=n.get(t);if(a!==void 0)return a;const l=t.emits;let i={},r=!1;if(!lt(t)){const c=d=>{const u=Pi(d,s,!0);u&&(r=!0,Ot(i,u))};!o&&s.mixins.length&&s.mixins.forEach(c),t.extends&&c(t.extends),t.mixins&&t.mixins.forEach(c)}return!l&&!r?(_t(t)&&n.set(t,null),null):(Qe(l)?l.forEach(c=>i[c]=null):Ot(i,l),_t(t)&&n.set(t,i),i)}function Pn(t,s){return!t||!Cn(s)?!1:(s=s.slice(2).replace(/Once$/,""),kt(t,s[0].toLowerCase()+s.slice(1))||kt(t,Zs(s))||kt(t,s))}function Ya(t){const{type:s,vnode:o,proxy:n,withProxy:a,propsOptions:[l],slots:i,attrs:r,emit:c,render:d,renderCache:u,props:v,data:b,setupState:w,ctx:I,inheritAttrs:j}=t,$=pn(t);let x,S;try{if(o.shapeFlag&4){const A=a||n,T=A;x=$s(d.call(T,A,u,v,w,b,I)),S=r}else{const A=s;x=$s(A.length>1?A(v,{attrs:r,slots:i,emit:c}):A(v,null)),S=s.props?r:Oc(r)}}catch(A){Do.length=0,Ln(A,t,1),x=Ye(ts)}let M=x;if(S&&j!==!1){const A=Object.keys(S),{shapeFlag:T}=M;A.length&&T&7&&(l&&A.some(ya)&&(S=zc(S,l)),M=Gs(M,S,!1,!0))}return o.dirs&&(M=Gs(M,null,!1,!0),M.dirs=M.dirs?M.dirs.concat(o.dirs):o.dirs),o.transition&&lo(M,o.transition),x=M,pn($),x}const Oc=t=>{let s;for(const o in t)(o==="class"||o==="style"||Cn(o))&&((s||(s={}))[o]=t[o]);return s},zc=(t,s)=>{const o={};for(const n in t)(!ya(n)||!(n.slice(9)in s))&&(o[n]=t[n]);return o};function Kc(t,s,o){const{props:n,children:a,component:l}=t,{props:i,children:r,patchFlag:c}=s,d=l.emitsOptions;if(s.dirs||s.transition)return!0;if(o&&c>=0){if(c&1024)return!0;if(c&16)return n?Xa(n,i,d):!!i;if(c&8){const u=s.dynamicProps;for(let v=0;v<u.length;v++){const b=u[v];if(i[b]!==n[b]&&!Pn(d,b))return!0}}}else return(a||r)&&(!r||!r.$stable)?!0:n===i?!1:n?i?Xa(n,i,d):!0:!!i;return!1}function Xa(t,s,o){const n=Object.keys(s);if(n.length!==Object.keys(t).length)return!0;for(let a=0;a<n.length;a++){const l=n[a];if(s[l]!==t[l]&&!Pn(o,l))return!0}return!1}function Wc({vnode:t,parent:s},o){for(;s;){const n=s.subTree;if(n.suspense&&n.suspense.activeBranch===t&&(n.el=t.el),n===t)(t=s.vnode).el=o,s=s.parent;else break}}const Ei={},Bi=()=>Object.create(Ei),Vi=t=>Object.getPrototypeOf(t)===Ei;function Gc(t,s,o,n=!1){const a={},l=Bi();t.propsDefaults=Object.create(null),Di(t,s,a,l);for(const i in t.propsOptions[0])i in a||(a[i]=void 0);o?t.props=n?a:oc(a):t.type.props?t.props=a:t.props=l,t.attrs=l}function qc(t,s,o,n){const{props:a,attrs:l,vnode:{patchFlag:i}}=t,r=ht(a),[c]=t.propsOptions;let d=!1;if((n||i>0)&&!(i&16)){if(i&8){const u=t.vnode.dynamicProps;for(let v=0;v<u.length;v++){let b=u[v];if(Pn(t.emitsOptions,b))continue;const w=s[b];if(c)if(kt(l,b))w!==l[b]&&(l[b]=w,d=!0);else{const I=fs(b);a[I]=ca(c,r,I,w,t,!1)}else w!==l[b]&&(l[b]=w,d=!0)}}}else{Di(t,s,a,l)&&(d=!0);let u;for(const v in r)(!s||!kt(s,v)&&((u=Zs(v))===v||!kt(s,u)))&&(c?o&&(o[v]!==void 0||o[u]!==void 0)&&(a[v]=ca(c,r,v,void 0,t,!0)):delete a[v]);if(l!==r)for(const v in l)(!s||!kt(s,v))&&(delete l[v],d=!0)}d&&js(t.attrs,"set","")}function Di(t,s,o,n){const[a,l]=t.propsOptions;let i=!1,r;if(s)for(let c in s){if(Io(c))continue;const d=s[c];let u;a&&kt(a,u=fs(c))?!l||!l.includes(u)?o[u]=d:(r||(r={}))[u]=d:Pn(t.emitsOptions,c)||(!(c in n)||d!==n[c])&&(n[c]=d,i=!0)}if(l){const c=ht(o),d=r||At;for(let u=0;u<l.length;u++){const v=l[u];o[v]=ca(a,c,v,d[v],t,!kt(d,v))}}return i}function ca(t,s,o,n,a,l){const i=t[o];if(i!=null){const r=kt(i,"default");if(r&&n===void 0){const c=i.default;if(i.type!==Function&&!i.skipFactory&&lt(c)){const{propsDefaults:d}=a;if(o in d)n=d[o];else{const u=Go(a);n=d[o]=c.call(null,s),u()}}else n=c;a.ce&&a.ce._setProp(o,n)}i[0]&&(l&&!r?n=!1:i[1]&&(n===""||n===Zs(o))&&(n=!0))}return n}const Zc=new WeakMap;function Hi(t,s,o=!1){const n=o?Zc:s.propsCache,a=n.get(t);if(a)return a;const l=t.props,i={},r=[];let c=!1;if(!lt(t)){const u=v=>{c=!0;const[b,w]=Hi(v,s,!0);Ot(i,b),w&&r.push(...w)};!o&&s.mixins.length&&s.mixins.forEach(u),t.extends&&u(t.extends),t.mixins&&t.mixins.forEach(u)}if(!l&&!c)return _t(t)&&n.set(t,vo),vo;if(Qe(l))for(let u=0;u<l.length;u++){const v=fs(l[u]);Qa(v)&&(i[v]=At)}else if(l)for(const u in l){const v=fs(u);if(Qa(v)){const b=l[u],w=i[v]=Qe(b)||lt(b)?{type:b}:Ot({},b),I=w.type;let j=!1,$=!0;if(Qe(I))for(let x=0;x<I.length;++x){const S=I[x],M=lt(S)&&S.name;if(M==="Boolean"){j=!0;break}else M==="String"&&($=!1)}else j=lt(I)&&I.name==="Boolean";w[0]=j,w[1]=$,(j||kt(w,"default"))&&r.push(v)}}const d=[i,r];return _t(t)&&n.set(t,d),d}function Qa(t){return t[0]!=="$"&&!Io(t)}const ja=t=>t==="_"||t==="_ctx"||t==="$stable",Pa=t=>Qe(t)?t.map($s):[$s(t)],Jc=(t,s,o)=>{if(s._n)return s;const n=ko((...a)=>Pa(s(...a)),o);return n._c=!1,n},Fi=(t,s,o)=>{const n=t._ctx;for(const a in t){if(ja(a))continue;const l=t[a];if(lt(l))s[a]=Jc(a,l,n);else if(l!=null){const i=Pa(l);s[a]=()=>i}}},Ui=(t,s)=>{const o=Pa(s);t.slots.default=()=>o},Ri=(t,s,o)=>{for(const n in s)(o||!ja(n))&&(t[n]=s[n])},Yc=(t,s,o)=>{const n=t.slots=Bi();if(t.vnode.shapeFlag&32){const a=s._;a?(Ri(n,s,o),o&&Nl(n,"_",a,!0)):Fi(s,n)}else s&&Ui(t,s)},Xc=(t,s,o)=>{const{vnode:n,slots:a}=t;let l=!0,i=At;if(n.shapeFlag&32){const r=s._;r?o&&r===1?l=!1:Ri(a,s,o):(l=!s.$stable,Fi(s,a)),i=s}else s&&(Ui(t,s),i={default:1});if(l)for(const r in a)!ja(r)&&i[r]==null&&delete a[r]},Qt=od;function Qc(t){return ed(t)}function ed(t,s){const o=Sn();o.__VUE__=!0;const{insert:n,remove:a,patchProp:l,createElement:i,createText:r,createComment:c,setText:d,setElementText:u,parentNode:v,nextSibling:b,setScopeId:w=hs,insertStaticContent:I}=t,j=(P,U,O,Q=null,ae=null,fe=null,Me=void 0,Ie=null,$e=!!U.dynamicChildren)=>{if(P===U)return;P&&!to(P,U)&&(Q=L(P),we(P,ae,fe,!0),P=null),U.patchFlag===-2&&($e=!1,U.dynamicChildren=null);const{type:ye,ref:Ne,shapeFlag:Ee}=U;switch(ye){case En:$(P,U,O,Q);break;case ts:x(P,U,O,Q);break;case Vo:P==null&&S(U,O,Q,Me);break;case Le:m(P,U,O,Q,ae,fe,Me,Ie,$e);break;default:Ee&1?T(P,U,O,Q,ae,fe,Me,Ie,$e):Ee&6?g(P,U,O,Q,ae,fe,Me,Ie,$e):(Ee&64||Ee&128)&&ye.process(P,U,O,Q,ae,fe,Me,Ie,$e,H)}Ne!=null&&ae?Po(Ne,P&&P.ref,fe,U||P,!U):Ne==null&&P&&P.ref!=null&&Po(P.ref,null,fe,P,!0)},$=(P,U,O,Q)=>{if(P==null)n(U.el=r(U.children),O,Q);else{const ae=U.el=P.el;U.children!==P.children&&d(ae,U.children)}},x=(P,U,O,Q)=>{P==null?n(U.el=c(U.children||""),O,Q):U.el=P.el},S=(P,U,O,Q)=>{[P.el,P.anchor]=I(P.children,U,O,Q,P.el,P.anchor)},M=({el:P,anchor:U},O,Q)=>{let ae;for(;P&&P!==U;)ae=b(P),n(P,O,Q),P=ae;n(U,O,Q)},A=({el:P,anchor:U})=>{let O;for(;P&&P!==U;)O=b(P),a(P),P=O;a(U)},T=(P,U,O,Q,ae,fe,Me,Ie,$e)=>{if(U.type==="svg"?Me="svg":U.type==="math"&&(Me="mathml"),P==null)G(U,O,Q,ae,fe,Me,Ie,$e);else{const ye=P.el&&P.el._isVueCE?P.el:null;try{ye&&ye._beginPatch(),ee(P,U,ae,fe,Me,Ie,$e)}finally{ye&&ye._endPatch()}}},G=(P,U,O,Q,ae,fe,Me,Ie)=>{let $e,ye;const{props:Ne,shapeFlag:Ee,transition:He,dirs:Ge}=P;if($e=P.el=i(P.type,fe,Ne&&Ne.is,Ne),Ee&8?u($e,P.children):Ee&16&&q(P.children,$e,null,Q,ae,Zn(P,fe),Me,Ie),Ge&&Ys(P,null,Q,"created"),K($e,P,P.scopeId,Me,Q),Ne){for(const me in Ne)me!=="value"&&!Io(me)&&l($e,me,null,Ne[me],fe,Q);"value"in Ne&&l($e,"value",null,Ne.value,fe),(ye=Ne.onVnodeBeforeMount)&&ks(ye,Q,P)}Ge&&Ys(P,null,Q,"beforeMount");const et=td(ae,He);et&&He.beforeEnter($e),n($e,U,O),((ye=Ne&&Ne.onVnodeMounted)||et||Ge)&&Qt(()=>{ye&&ks(ye,Q,P),et&&He.enter($e),Ge&&Ys(P,null,Q,"mounted")},ae)},K=(P,U,O,Q,ae)=>{if(O&&w(P,O),Q)for(let fe=0;fe<Q.length;fe++)w(P,Q[fe]);if(ae){let fe=ae.subTree;if(U===fe||zi(fe.type)&&(fe.ssContent===U||fe.ssFallback===U)){const Me=ae.vnode;K(P,Me,Me.scopeId,Me.slotScopeIds,ae.parent)}}},q=(P,U,O,Q,ae,fe,Me,Ie,$e=0)=>{for(let ye=$e;ye<P.length;ye++){const Ne=P[ye]=Ie?Ks(P[ye]):$s(P[ye]);j(null,Ne,U,O,Q,ae,fe,Me,Ie)}},ee=(P,U,O,Q,ae,fe,Me)=>{const Ie=U.el=P.el;let{patchFlag:$e,dynamicChildren:ye,dirs:Ne}=U;$e|=P.patchFlag&16;const Ee=P.props||At,He=U.props||At;let Ge;if(O&&Xs(O,!1),(Ge=He.onVnodeBeforeUpdate)&&ks(Ge,O,U,P),Ne&&Ys(U,P,O,"beforeUpdate"),O&&Xs(O,!0),(Ee.innerHTML&&He.innerHTML==null||Ee.textContent&&He.textContent==null)&&u(Ie,""),ye?Z(P.dynamicChildren,ye,Ie,O,Q,Zn(U,ae),fe):Me||F(P,U,Ie,null,O,Q,Zn(U,ae),fe,!1),$e>0){if($e&16)E(Ie,Ee,He,O,ae);else if($e&2&&Ee.class!==He.class&&l(Ie,"class",null,He.class,ae),$e&4&&l(Ie,"style",Ee.style,He.style,ae),$e&8){const et=U.dynamicProps;for(let me=0;me<et.length;me++){const le=et[me],De=Ee[le],xe=He[le];(xe!==De||le==="value")&&l(Ie,le,De,xe,ae,O)}}$e&1&&P.children!==U.children&&u(Ie,U.children)}else!Me&&ye==null&&E(Ie,Ee,He,O,ae);((Ge=He.onVnodeUpdated)||Ne)&&Qt(()=>{Ge&&ks(Ge,O,U,P),Ne&&Ys(U,P,O,"updated")},Q)},Z=(P,U,O,Q,ae,fe,Me)=>{for(let Ie=0;Ie<U.length;Ie++){const $e=P[Ie],ye=U[Ie],Ne=$e.el&&($e.type===Le||!to($e,ye)||$e.shapeFlag&198)?v($e.el):O;j($e,ye,Ne,null,Q,ae,fe,Me,!0)}},E=(P,U,O,Q,ae)=>{if(U!==O){if(U!==At)for(const fe in U)!Io(fe)&&!(fe in O)&&l(P,fe,U[fe],null,ae,Q);for(const fe in O){if(Io(fe))continue;const Me=O[fe],Ie=U[fe];Me!==Ie&&fe!=="value"&&l(P,fe,Ie,Me,ae,Q)}"value"in O&&l(P,"value",U.value,O.value,ae)}},m=(P,U,O,Q,ae,fe,Me,Ie,$e)=>{const ye=U.el=P?P.el:r(""),Ne=U.anchor=P?P.anchor:r("");let{patchFlag:Ee,dynamicChildren:He,slotScopeIds:Ge}=U;Ge&&(Ie=Ie?Ie.concat(Ge):Ge),P==null?(n(ye,O,Q),n(Ne,O,Q),q(U.children||[],O,Ne,ae,fe,Me,Ie,$e)):Ee>0&&Ee&64&&He&&P.dynamicChildren&&P.dynamicChildren.length===He.length?(Z(P.dynamicChildren,He,O,ae,fe,Me,Ie),(U.key!=null||ae&&U===ae.subTree)&&Ea(P,U,!0)):F(P,U,O,Ne,ae,fe,Me,Ie,$e)},g=(P,U,O,Q,ae,fe,Me,Ie,$e)=>{U.slotScopeIds=Ie,P==null?U.shapeFlag&512?ae.ctx.activate(U,O,Q,Me,$e):D(U,O,Q,ae,fe,Me,$e):W(P,U,$e)},D=(P,U,O,Q,ae,fe,Me)=>{const Ie=P.component=dd(P,Q,ae);if(Tn(P)&&(Ie.ctx.renderer=H),ud(Ie,!1,Me),Ie.asyncDep){if(ae&&ae.registerDep(Ie,te,Me),!P.el){const $e=Ie.subTree=Ye(ts);x(null,$e,U,O),P.placeholder=$e.el}}else te(Ie,P,U,O,ae,fe,Me)},W=(P,U,O)=>{const Q=U.component=P.component;if(Kc(P,U,O))if(Q.asyncDep&&!Q.asyncResolved){R(Q,U,O);return}else Q.next=U,Q.update();else U.el=P.el,Q.vnode=U},te=(P,U,O,Q,ae,fe,Me)=>{const Ie=()=>{if(P.isMounted){let{next:Ee,bu:He,u:Ge,parent:et,vnode:me}=P;{const xt=Ni(P);if(xt){Ee&&(Ee.el=me.el,R(P,Ee,Me)),xt.asyncDep.then(()=>{P.isUnmounted||Ie()});return}}let le=Ee,De;Xs(P,!1),Ee?(Ee.el=me.el,R(P,Ee,Me)):Ee=me,He&&sn(He),(De=Ee.props&&Ee.props.onVnodeBeforeUpdate)&&ks(De,et,Ee,me),Xs(P,!0);const xe=Ya(P),Ve=P.subTree;P.subTree=xe,j(Ve,xe,v(Ve.el),L(Ve),P,ae,fe),Ee.el=xe.el,le===null&&Wc(P,xe.el),Ge&&Qt(Ge,ae),(De=Ee.props&&Ee.props.onVnodeUpdated)&&Qt(()=>ks(De,et,Ee,me),ae)}else{let Ee;const{el:He,props:Ge}=U,{bm:et,m:me,parent:le,root:De,type:xe}=P,Ve=Eo(U);Xs(P,!1),et&&sn(et),!Ve&&(Ee=Ge&&Ge.onVnodeBeforeMount)&&ks(Ee,le,U),Xs(P,!0);{De.ce&&De.ce._def.shadowRoot!==!1&&De.ce._injectChildStyle(xe);const xt=P.subTree=Ya(P);j(null,xt,O,Q,P,ae,fe),U.el=xt.el}if(me&&Qt(me,ae),!Ve&&(Ee=Ge&&Ge.onVnodeMounted)){const xt=U;Qt(()=>ks(Ee,le,xt),ae)}(U.shapeFlag&256||le&&Eo(le.vnode)&&le.vnode.shapeFlag&256)&&P.a&&Qt(P.a,ae),P.isMounted=!0,U=O=Q=null}};P.scope.on();const $e=P.effect=new Wl(Ie);P.scope.off();const ye=P.update=$e.run.bind($e),Ne=P.job=$e.runIfDirty.bind($e);Ne.i=P,Ne.id=P.uid,$e.scheduler=()=>Ia(Ne),Xs(P,!0),ye()},R=(P,U,O)=>{U.component=P;const Q=P.vnode.props;P.vnode=U,P.next=null,qc(P,U.props,Q,O),Xc(P,U.children,O),Bs(),Ua(P),Vs()},F=(P,U,O,Q,ae,fe,Me,Ie,$e=!1)=>{const ye=P&&P.children,Ne=P?P.shapeFlag:0,Ee=U.children,{patchFlag:He,shapeFlag:Ge}=U;if(He>0){if(He&128){re(ye,Ee,O,Q,ae,fe,Me,Ie,$e);return}else if(He&256){ie(ye,Ee,O,Q,ae,fe,Me,Ie,$e);return}}Ge&8?(Ne&16&&B(ye,ae,fe),Ee!==ye&&u(O,Ee)):Ne&16?Ge&16?re(ye,Ee,O,Q,ae,fe,Me,Ie,$e):B(ye,ae,fe,!0):(Ne&8&&u(O,""),Ge&16&&q(Ee,O,Q,ae,fe,Me,Ie,$e))},ie=(P,U,O,Q,ae,fe,Me,Ie,$e)=>{P=P||vo,U=U||vo;const ye=P.length,Ne=U.length,Ee=Math.min(ye,Ne);let He;for(He=0;He<Ee;He++){const Ge=U[He]=$e?Ks(U[He]):$s(U[He]);j(P[He],Ge,O,null,ae,fe,Me,Ie,$e)}ye>Ne?B(P,ae,fe,!0,!1,Ee):q(U,O,Q,ae,fe,Me,Ie,$e,Ee)},re=(P,U,O,Q,ae,fe,Me,Ie,$e)=>{let ye=0;const Ne=U.length;let Ee=P.length-1,He=Ne-1;for(;ye<=Ee&&ye<=He;){const Ge=P[ye],et=U[ye]=$e?Ks(U[ye]):$s(U[ye]);if(to(Ge,et))j(Ge,et,O,null,ae,fe,Me,Ie,$e);else break;ye++}for(;ye<=Ee&&ye<=He;){const Ge=P[Ee],et=U[He]=$e?Ks(U[He]):$s(U[He]);if(to(Ge,et))j(Ge,et,O,null,ae,fe,Me,Ie,$e);else break;Ee--,He--}if(ye>Ee){if(ye<=He){const Ge=He+1,et=Ge<Ne?U[Ge].el:Q;for(;ye<=He;)j(null,U[ye]=$e?Ks(U[ye]):$s(U[ye]),O,et,ae,fe,Me,Ie,$e),ye++}}else if(ye>He)for(;ye<=Ee;)we(P[ye],ae,fe,!0),ye++;else{const Ge=ye,et=ye,me=new Map;for(ye=et;ye<=He;ye++){const oe=U[ye]=$e?Ks(U[ye]):$s(U[ye]);oe.key!=null&&me.set(oe.key,ye)}let le,De=0;const xe=He-et+1;let Ve=!1,xt=0;const yt=new Array(xe);for(ye=0;ye<xe;ye++)yt[ye]=0;for(ye=Ge;ye<=Ee;ye++){const oe=P[ye];if(De>=xe){we(oe,ae,fe,!0);continue}let ve;if(oe.key!=null)ve=me.get(oe.key);else for(le=et;le<=He;le++)if(yt[le-et]===0&&to(oe,U[le])){ve=le;break}ve===void 0?we(oe,ae,fe,!0):(yt[ve-et]=ye+1,ve>=xt?xt=ve:Ve=!0,j(oe,U[ve],O,null,ae,fe,Me,Ie,$e),De++)}const ce=Ve?sd(yt):vo;for(le=ce.length-1,ye=xe-1;ye>=0;ye--){const oe=et+ye,ve=U[oe],Ze=U[oe+1],_e=oe+1<Ne?Ze.el||Oi(Ze):Q;yt[ye]===0?j(null,ve,O,_e,ae,fe,Me,Ie,$e):Ve&&(le<0||ye!==ce[le]?pe(ve,O,_e,2):le--)}}},pe=(P,U,O,Q,ae=null)=>{const{el:fe,type:Me,transition:Ie,children:$e,shapeFlag:ye}=P;if(ye&6){pe(P.component.subTree,U,O,Q);return}if(ye&128){P.suspense.move(U,O,Q);return}if(ye&64){Me.move(P,U,O,H);return}if(Me===Le){n(fe,U,O);for(let Ee=0;Ee<$e.length;Ee++)pe($e[Ee],U,O,Q);n(P.anchor,U,O);return}if(Me===Vo){M(P,U,O);return}if(Q!==2&&ye&1&&Ie)if(Q===0)Ie.beforeEnter(fe),n(fe,U,O),Qt(()=>Ie.enter(fe),ae);else{const{leave:Ee,delayLeave:He,afterLeave:Ge}=Ie,et=()=>{P.ctx.isUnmounted?a(fe):n(fe,U,O)},me=()=>{fe._isLeaving&&fe[Ts](!0),Ee(fe,()=>{et(),Ge&&Ge()})};He?He(fe,et,me):me()}else n(fe,U,O)},we=(P,U,O,Q=!1,ae=!1)=>{const{type:fe,props:Me,ref:Ie,children:$e,dynamicChildren:ye,shapeFlag:Ne,patchFlag:Ee,dirs:He,cacheIndex:Ge}=P;if(Ee===-2&&(ae=!1),Ie!=null&&(Bs(),Po(Ie,null,O,P,!0),Vs()),Ge!=null&&(U.renderCache[Ge]=void 0),Ne&256){U.ctx.deactivate(P);return}const et=Ne&1&&He,me=!Eo(P);let le;if(me&&(le=Me&&Me.onVnodeBeforeUnmount)&&ks(le,U,P),Ne&6)ge(P.component,O,Q);else{if(Ne&128){P.suspense.unmount(O,Q);return}et&&Ys(P,null,U,"beforeUnmount"),Ne&64?P.type.remove(P,U,O,H,Q):ye&&!ye.hasOnce&&(fe!==Le||Ee>0&&Ee&64)?B(ye,U,O,!1,!0):(fe===Le&&Ee&384||!ae&&Ne&16)&&B($e,U,O),Q&&he(P)}(me&&(le=Me&&Me.onVnodeUnmounted)||et)&&Qt(()=>{le&&ks(le,U,P),et&&Ys(P,null,U,"unmounted")},O)},he=P=>{const{type:U,el:O,anchor:Q,transition:ae}=P;if(U===Le){Ue(O,Q);return}if(U===Vo){A(P);return}const fe=()=>{a(O),ae&&!ae.persisted&&ae.afterLeave&&ae.afterLeave()};if(P.shapeFlag&1&&ae&&!ae.persisted){const{leave:Me,delayLeave:Ie}=ae,$e=()=>Me(O,fe);Ie?Ie(P.el,fe,$e):$e()}else fe()},Ue=(P,U)=>{let O;for(;P!==U;)O=b(P),a(P),P=O;a(U)},ge=(P,U,O)=>{const{bum:Q,scope:ae,job:fe,subTree:Me,um:Ie,m:$e,a:ye}=P;el($e),el(ye),Q&&sn(Q),ae.stop(),fe&&(fe.flags|=8,we(Me,P,U,O)),Ie&&Qt(Ie,U),Qt(()=>{P.isUnmounted=!0},U)},B=(P,U,O,Q=!1,ae=!1,fe=0)=>{for(let Me=fe;Me<P.length;Me++)we(P[Me],U,O,Q,ae)},L=P=>{if(P.shapeFlag&6)return L(P.component.subTree);if(P.shapeFlag&128)return P.suspense.next();const U=b(P.anchor||P.el),O=U&&U[mi];return O?b(O):U};let k=!1;const y=(P,U,O)=>{let Q;P==null?U._vnode&&(we(U._vnode,null,null,!0),Q=U._vnode.component):j(U._vnode||null,P,U,null,null,null,O),U._vnode=P,k||(k=!0,Ua(Q),di(),k=!1)},H={p:j,um:we,m:pe,r:he,mt:D,mc:q,pc:F,pbc:Z,n:L,o:t};return{render:y,hydrate:void 0,createApp:Fc(y)}}function Zn({type:t,props:s},o){return o==="svg"&&t==="foreignObject"||o==="mathml"&&t==="annotation-xml"&&s&&s.encoding&&s.encoding.includes("html")?void 0:o}function Xs({effect:t,job:s},o){o?(t.flags|=32,s.flags|=4):(t.flags&=-33,s.flags&=-5)}function td(t,s){return(!t||t&&!t.pendingBranch)&&s&&!s.persisted}function Ea(t,s,o=!1){const n=t.children,a=s.children;if(Qe(n)&&Qe(a))for(let l=0;l<n.length;l++){const i=n[l];let r=a[l];r.shapeFlag&1&&!r.dynamicChildren&&((r.patchFlag<=0||r.patchFlag===32)&&(r=a[l]=Ks(a[l]),r.el=i.el),!o&&r.patchFlag!==-2&&Ea(i,r)),r.type===En&&(r.patchFlag!==-1?r.el=i.el:r.__elIndex=l+(t.type===Le?1:0)),r.type===ts&&!r.el&&(r.el=i.el)}}function sd(t){const s=t.slice(),o=[0];let n,a,l,i,r;const c=t.length;for(n=0;n<c;n++){const d=t[n];if(d!==0){if(a=o[o.length-1],t[a]<d){s[n]=a,o.push(n);continue}for(l=0,i=o.length-1;l<i;)r=l+i>>1,t[o[r]]<d?l=r+1:i=r;d<t[o[l]]&&(l>0&&(s[n]=o[l-1]),o[l]=n)}}for(l=o.length,i=o[l-1];l-- >0;)o[l]=i,i=s[i];return o}function Ni(t){const s=t.subTree.component;if(s)return s.asyncDep&&!s.asyncResolved?s:Ni(s)}function el(t){if(t)for(let s=0;s<t.length;s++)t[s].flags|=8}function Oi(t){if(t.placeholder)return t.placeholder;const s=t.component;return s?Oi(s.subTree):null}const zi=t=>t.__isSuspense;function od(t,s){s&&s.pendingBranch?Qe(t)?s.effects.push(...t):s.effects.push(t):ci(t)}const Le=Symbol.for("v-fgt"),En=Symbol.for("v-txt"),ts=Symbol.for("v-cmt"),Vo=Symbol.for("v-stc"),Do=[];let cs=null;function p(t=!1){Do.push(cs=t?null:[])}function nd(){Do.pop(),cs=Do[Do.length-1]||null}let No=1;function gn(t,s=!1){No+=t,t<0&&cs&&s&&(cs.hasOnce=!0)}function Ki(t){return t.dynamicChildren=No>0?cs||vo:null,nd(),No>0&&cs&&cs.push(t),t}function f(t,s,o,n,a,l){return Ki(e(t,s,o,n,a,l,!0))}function nt(t,s,o,n,a){return Ki(Ye(t,s,o,n,a,!0))}function hn(t){return t?t.__v_isVNode===!0:!1}function to(t,s){return t.type===s.type&&t.key===s.key}const Wi=({key:t})=>t??null,an=({ref:t,ref_key:s,ref_for:o})=>(typeof t=="number"&&(t=""+t),t!=null?Vt(t)||Jt(t)||lt(t)?{i:rs,r:t,k:s,f:!!o}:t:null);function e(t,s=null,o=null,n=0,a=null,l=t===Le?0:1,i=!1,r=!1){const c={__v_isVNode:!0,__v_skip:!0,type:t,props:s,key:s&&Wi(s),ref:s&&an(s),scopeId:vi,slotScopeIds:null,children:o,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:l,patchFlag:n,dynamicProps:a,dynamicChildren:null,appContext:null,ctx:rs};return r?(Ba(c,o),l&128&&t.normalize(c)):o&&(c.shapeFlag|=Vt(o)?8:16),No>0&&!i&&cs&&(c.patchFlag>0||l&6)&&c.patchFlag!==32&&cs.push(c),c}const Ye=ad;function ad(t,s=null,o=null,n=0,a=null,l=!1){if((!t||t===Ii)&&(t=ts),hn(t)){const r=Gs(t,s,!0);return o&&Ba(r,o),No>0&&!l&&cs&&(r.shapeFlag&6?cs[cs.indexOf(t)]=r:cs.push(r)),r.patchFlag=-2,r}if(gd(t)&&(t=t.__vccOpts),s){s=ld(s);let{class:r,style:c}=s;r&&!Vt(r)&&(s.class=Se(r)),_t(c)&&(Aa(c)&&!Qe(c)&&(c=Ot({},c)),s.style=Oe(c))}const i=Vt(t)?1:zi(t)?128:gi(t)?64:_t(t)?4:lt(t)?2:0;return e(t,s,o,n,a,i,l,!0)}function ld(t){return t?Aa(t)||Vi(t)?Ot({},t):t:null}function Gs(t,s,o=!1,n=!1){const{props:a,ref:l,patchFlag:i,children:r,transition:c}=t,d=s?id(a||{},s):a,u={__v_isVNode:!0,__v_skip:!0,type:t.type,props:d,key:d&&Wi(d),ref:s&&s.ref?o&&l?Qe(l)?l.concat(an(s)):[l,an(s)]:an(s):l,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:r,target:t.target,targetStart:t.targetStart,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:s&&t.type!==Le?i===-1?16:i|16:i,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:c,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Gs(t.ssContent),ssFallback:t.ssFallback&&Gs(t.ssFallback),placeholder:t.placeholder,el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return c&&n&&lo(u,c.clone(u)),u}function ot(t=" ",s=0){return Ye(En,null,t,s)}function mt(t,s){const o=Ye(Vo,null,t);return o.staticCount=s,o}function N(t="",s=!1){return s?(p(),nt(ts,null,t)):Ye(ts,null,t)}function $s(t){return t==null||typeof t=="boolean"?Ye(ts):Qe(t)?Ye(Le,null,t.slice()):hn(t)?Ks(t):Ye(En,null,String(t))}function Ks(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:Gs(t)}function Ba(t,s){let o=0;const{shapeFlag:n}=t;if(s==null)s=null;else if(Qe(s))o=16;else if(typeof s=="object")if(n&65){const a=s.default;a&&(a._c&&(a._d=!1),Ba(t,a()),a._c&&(a._d=!0));return}else{o=32;const a=s._;!a&&!Vi(s)?s._ctx=rs:a===3&&rs&&(rs.slots._===1?s._=1:(s._=2,t.patchFlag|=1024))}else lt(s)?(s={default:s,_ctx:rs},o=32):(s=String(s),n&64?(o=16,s=[ot(s)]):o=8);t.children=s,t.shapeFlag|=o}function id(...t){const s={};for(let o=0;o<t.length;o++){const n=t[o];for(const a in n)if(a==="class")s.class!==n.class&&(s.class=Se([s.class,n.class]));else if(a==="style")s.style=Oe([s.style,n.style]);else if(Cn(a)){const l=s[a],i=n[a];i&&l!==i&&!(Qe(l)&&l.includes(i))&&(s[a]=l?[].concat(l,i):i)}else a!==""&&(s[a]=n[a])}return s}function ks(t,s,o,n=null){ws(t,s,7,[o,n])}const rd=ji();let cd=0;function dd(t,s,o){const n=t.type,a=(s?s.appContext:t.appContext)||rd,l={uid:cd++,vnode:t,type:n,parent:s,appContext:a,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Dr(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:s?s.provides:Object.create(a.provides),ids:s?s.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Hi(n,a),emitsOptions:Pi(n,a),emit:null,emitted:null,propsDefaults:At,inheritAttrs:n.inheritAttrs,ctx:At,data:At,props:At,attrs:At,slots:At,refs:At,setupState:At,setupContext:null,suspense:o,suspenseId:o?o.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return l.ctx={_:l},l.root=s?s.root:l,l.emit=Rc.bind(null,l),t.ce&&t.ce(l),l}let Zt=null;const Bn=()=>Zt||rs;let yn,da;{const t=Sn(),s=(o,n)=>{let a;return(a=t[o])||(a=t[o]=[]),a.push(n),l=>{a.length>1?a.forEach(i=>i(l)):a[0](l)}};yn=s("__VUE_INSTANCE_SETTERS__",o=>Zt=o),da=s("__VUE_SSR_SETTERS__",o=>Oo=o)}const Go=t=>{const s=Zt;return yn(t),t.scope.on(),()=>{t.scope.off(),yn(s)}},tl=()=>{Zt&&Zt.scope.off(),yn(null)};function Gi(t){return t.vnode.shapeFlag&4}let Oo=!1;function ud(t,s=!1,o=!1){s&&da(s);const{props:n,children:a}=t.vnode,l=Gi(t);Gc(t,n,l,s),Yc(t,a,o||s);const i=l?vd(t,s):void 0;return s&&da(!1),i}function vd(t,s){const o=t.type;t.accessCache=Object.create(null),t.proxy=new Proxy(t.ctx,jc);const{setup:n}=o;if(n){Bs();const a=t.setupContext=n.length>1?fd(t):null,l=Go(t),i=Wo(n,t,0,[t.props,a]),r=Fl(i);if(Vs(),l(),(r||t.sp)&&!Eo(t)&&$i(t),r){if(i.then(tl,tl),s)return i.then(c=>{sl(t,c)}).catch(c=>{Ln(c,t,0)});t.asyncDep=i}else sl(t,i)}else qi(t)}function sl(t,s,o){lt(s)?t.type.__ssrInlineRender?t.ssrRender=s:t.render=s:_t(s)&&(t.setupState=li(s)),qi(t)}function qi(t,s,o){const n=t.type;t.render||(t.render=n.render||hs);{const a=Go(t);Bs();try{Pc(t)}finally{Vs(),a()}}}const pd={get(t,s){return qt(t,"get",""),t[s]}};function fd(t){const s=o=>{t.exposed=o||{}};return{attrs:new Proxy(t.attrs,pd),slots:t.slots,emit:t.emit,expose:s}}function Vn(t){return t.exposed?t.exposeProxy||(t.exposeProxy=new Proxy(li(nc(t.exposed)),{get(s,o){if(o in s)return s[o];if(o in Bo)return Bo[o](t)},has(s,o){return o in s||o in Bo}})):t.proxy}function md(t,s=!0){return lt(t)?t.displayName||t.name:t.name||s&&t.__name}function gd(t){return lt(t)&&"__vccOpts"in t}const tt=(t,s)=>cc(t,s,Oo);function bn(t,s,o){try{gn(-1);const n=arguments.length;return n===2?_t(s)&&!Qe(s)?hn(s)?Ye(t,null,[s]):Ye(t,s):Ye(t,null,s):(n>3?o=Array.prototype.slice.call(arguments,2):n===3&&hn(o)&&(o=[o]),Ye(t,s,o))}finally{gn(1)}}const hd="3.5.26";/**
* @vue/runtime-dom v3.5.26
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let ua;const ol=typeof window<"u"&&window.trustedTypes;if(ol)try{ua=ol.createPolicy("vue",{createHTML:t=>t})}catch{}const Zi=ua?t=>ua.createHTML(t):t=>t,yd="http://www.w3.org/2000/svg",bd="http://www.w3.org/1998/Math/MathML",Ls=typeof document<"u"?document:null,nl=Ls&&Ls.createElement("template"),wd={insert:(t,s,o)=>{s.insertBefore(t,o||null)},remove:t=>{const s=t.parentNode;s&&s.removeChild(t)},createElement:(t,s,o,n)=>{const a=s==="svg"?Ls.createElementNS(yd,t):s==="mathml"?Ls.createElementNS(bd,t):o?Ls.createElement(t,{is:o}):Ls.createElement(t);return t==="select"&&n&&n.multiple!=null&&a.setAttribute("multiple",n.multiple),a},createText:t=>Ls.createTextNode(t),createComment:t=>Ls.createComment(t),setText:(t,s)=>{t.nodeValue=s},setElementText:(t,s)=>{t.textContent=s},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Ls.querySelector(t),setScopeId(t,s){t.setAttribute(s,"")},insertStaticContent(t,s,o,n,a,l){const i=o?o.previousSibling:s.lastChild;if(a&&(a===l||a.nextSibling))for(;s.insertBefore(a.cloneNode(!0),o),!(a===l||!(a=a.nextSibling)););else{nl.innerHTML=Zi(n==="svg"?`<svg>${t}</svg>`:n==="mathml"?`<math>${t}</math>`:t);const r=nl.content;if(n==="svg"||n==="mathml"){const c=r.firstChild;for(;c.firstChild;)r.appendChild(c.firstChild);r.removeChild(c)}s.insertBefore(r,o)}return[i?i.nextSibling:s.firstChild,o?o.previousSibling:s.lastChild]}},Us="transition",Co="animation",yo=Symbol("_vtc"),Ji={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},Yi=Ot({},wi,Ji),kd=t=>(t.displayName="Transition",t.props=Yi,t),Xi=kd((t,{slots:s})=>bn(kc,Qi(t),s)),Qs=(t,s=[])=>{Qe(t)?t.forEach(o=>o(...s)):t&&t(...s)},al=t=>t?Qe(t)?t.some(s=>s.length>1):t.length>1:!1;function Qi(t){const s={};for(const m in t)m in Ji||(s[m]=t[m]);if(t.css===!1)return s;const{name:o="v",type:n,duration:a,enterFromClass:l=`${o}-enter-from`,enterActiveClass:i=`${o}-enter-active`,enterToClass:r=`${o}-enter-to`,appearFromClass:c=l,appearActiveClass:d=i,appearToClass:u=r,leaveFromClass:v=`${o}-leave-from`,leaveActiveClass:b=`${o}-leave-active`,leaveToClass:w=`${o}-leave-to`}=t,I=xd(a),j=I&&I[0],$=I&&I[1],{onBeforeEnter:x,onEnter:S,onEnterCancelled:M,onLeave:A,onLeaveCancelled:T,onBeforeAppear:G=x,onAppear:K=S,onAppearCancelled:q=M}=s,ee=(m,g,D,W)=>{m._enterCancelled=W,Ns(m,g?u:r),Ns(m,g?d:i),D&&D()},Z=(m,g)=>{m._isLeaving=!1,Ns(m,v),Ns(m,w),Ns(m,b),g&&g()},E=m=>(g,D)=>{const W=m?K:S,te=()=>ee(g,m,D);Qs(W,[g,te]),ll(()=>{Ns(g,m?c:l),xs(g,m?u:r),al(W)||il(g,n,j,te)})};return Ot(s,{onBeforeEnter(m){Qs(x,[m]),xs(m,l),xs(m,i)},onBeforeAppear(m){Qs(G,[m]),xs(m,c),xs(m,d)},onEnter:E(!1),onAppear:E(!0),onLeave(m,g){m._isLeaving=!0;const D=()=>Z(m,g);xs(m,v),m._enterCancelled?(xs(m,b),va(m)):(va(m),xs(m,b)),ll(()=>{m._isLeaving&&(Ns(m,v),xs(m,w),al(A)||il(m,n,$,D))}),Qs(A,[m,D])},onEnterCancelled(m){ee(m,!1,void 0,!0),Qs(M,[m])},onAppearCancelled(m){ee(m,!0,void 0,!0),Qs(q,[m])},onLeaveCancelled(m){Z(m),Qs(T,[m])}})}function xd(t){if(t==null)return null;if(_t(t))return[Jn(t.enter),Jn(t.leave)];{const s=Jn(t);return[s,s]}}function Jn(t){return Ar(t)}function xs(t,s){s.split(/\s+/).forEach(o=>o&&t.classList.add(o)),(t[yo]||(t[yo]=new Set)).add(s)}function Ns(t,s){s.split(/\s+/).forEach(n=>n&&t.classList.remove(n));const o=t[yo];o&&(o.delete(s),o.size||(t[yo]=void 0))}function ll(t){requestAnimationFrame(()=>{requestAnimationFrame(t)})}let Cd=0;function il(t,s,o,n){const a=t._endId=++Cd,l=()=>{a===t._endId&&n()};if(o!=null)return setTimeout(l,o);const{type:i,timeout:r,propCount:c}=er(t,s);if(!i)return n();const d=i+"end";let u=0;const v=()=>{t.removeEventListener(d,b),l()},b=w=>{w.target===t&&++u>=c&&v()};setTimeout(()=>{u<c&&v()},r+1),t.addEventListener(d,b)}function er(t,s){const o=window.getComputedStyle(t),n=I=>(o[I]||"").split(", "),a=n(`${Us}Delay`),l=n(`${Us}Duration`),i=rl(a,l),r=n(`${Co}Delay`),c=n(`${Co}Duration`),d=rl(r,c);let u=null,v=0,b=0;s===Us?i>0&&(u=Us,v=i,b=l.length):s===Co?d>0&&(u=Co,v=d,b=c.length):(v=Math.max(i,d),u=v>0?i>d?Us:Co:null,b=u?u===Us?l.length:c.length:0);const w=u===Us&&/\b(?:transform|all)(?:,|$)/.test(n(`${Us}Property`).toString());return{type:u,timeout:v,propCount:b,hasTransform:w}}function rl(t,s){for(;t.length<s.length;)t=t.concat(t);return Math.max(...s.map((o,n)=>cl(o)+cl(t[n])))}function cl(t){return t==="auto"?0:Number(t.slice(0,-1).replace(",","."))*1e3}function va(t){return(t?t.ownerDocument:document).body.offsetHeight}function $d(t,s,o){const n=t[yo];n&&(s=(s?[s,...n]:[...n]).join(" ")),s==null?t.removeAttribute("class"):o?t.setAttribute("class",s):t.className=s}const wn=Symbol("_vod"),tr=Symbol("_vsh"),go={name:"show",beforeMount(t,{value:s},{transition:o}){t[wn]=t.style.display==="none"?"":t.style.display,o&&s?o.beforeEnter(t):$o(t,s)},mounted(t,{value:s},{transition:o}){o&&s&&o.enter(t)},updated(t,{value:s,oldValue:o},{transition:n}){!s!=!o&&(n?s?(n.beforeEnter(t),$o(t,!0),n.enter(t)):n.leave(t,()=>{$o(t,!1)}):$o(t,s))},beforeUnmount(t,{value:s}){$o(t,s)}};function $o(t,s){t.style.display=s?t[wn]:"none",t[tr]=!s}const sr=Symbol("");function _d(t){const s=Bn();if(!s)return;const o=s.ut=(a=t(s.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${s.uid}"]`)).forEach(l=>kn(l,a))},n=()=>{const a=t(s.proxy);s.ce?kn(s.ce,a):pa(s.subTree,a),o(a)};Mi(()=>{ci(n)}),it(()=>{Ft(n,hs,{flush:"post"});const a=new MutationObserver(n);a.observe(s.subTree.el.parentNode,{childList:!0}),zt(()=>a.disconnect())})}function pa(t,s){if(t.shapeFlag&128){const o=t.suspense;t=o.activeBranch,o.pendingBranch&&!o.isHydrating&&o.effects.push(()=>{pa(o.activeBranch,s)})}for(;t.component;)t=t.component.subTree;if(t.shapeFlag&1&&t.el)kn(t.el,s);else if(t.type===Le)t.children.forEach(o=>pa(o,s));else if(t.type===Vo){let{el:o,anchor:n}=t;for(;o&&(kn(o,s),o!==n);)o=o.nextSibling}}function kn(t,s){if(t.nodeType===1){const o=t.style;let n="";for(const a in s){const l=Vr(s[a]);o.setProperty(`--${a}`,l),n+=`--${a}: ${l};`}o[sr]=n}}const Md=/(?:^|;)\s*display\s*:/;function Sd(t,s,o){const n=t.style,a=Vt(o);let l=!1;if(o&&!a){if(s)if(Vt(s))for(const i of s.split(";")){const r=i.slice(0,i.indexOf(":")).trim();o[r]==null&&ln(n,r,"")}else for(const i in s)o[i]==null&&ln(n,i,"");for(const i in o)i==="display"&&(l=!0),ln(n,i,o[i])}else if(a){if(s!==o){const i=n[sr];i&&(o+=";"+i),n.cssText=o,l=Md.test(o)}}else s&&t.removeAttribute("style");wn in t&&(t[wn]=l?n.display:"",t[tr]&&(n.display="none"))}const dl=/\s*!important$/;function ln(t,s,o){if(Qe(o))o.forEach(n=>ln(t,s,n));else if(o==null&&(o=""),s.startsWith("--"))t.setProperty(s,o);else{const n=Ad(t,s);dl.test(o)?t.setProperty(Zs(n),o.replace(dl,""),"important"):t[n]=o}}const ul=["Webkit","Moz","ms"],Yn={};function Ad(t,s){const o=Yn[s];if(o)return o;let n=fs(s);if(n!=="filter"&&n in t)return Yn[s]=n;n=_n(n);for(let a=0;a<ul.length;a++){const l=ul[a]+n;if(l in t)return Yn[s]=l}return s}const vl="http://www.w3.org/1999/xlink";function pl(t,s,o,n,a,l=Er(s)){n&&s.startsWith("xlink:")?o==null?t.removeAttributeNS(vl,s.slice(6,s.length)):t.setAttributeNS(vl,s,o):o==null||l&&!Ol(o)?t.removeAttribute(s):t.setAttribute(s,l?"":_s(o)?String(o):o)}function fl(t,s,o,n,a){if(s==="innerHTML"||s==="textContent"){o!=null&&(t[s]=s==="innerHTML"?Zi(o):o);return}const l=t.tagName;if(s==="value"&&l!=="PROGRESS"&&!l.includes("-")){const r=l==="OPTION"?t.getAttribute("value")||"":t.value,c=o==null?t.type==="checkbox"?"on":"":String(o);(r!==c||!("_value"in t))&&(t.value=c),o==null&&t.removeAttribute(s),t._value=o;return}let i=!1;if(o===""||o==null){const r=typeof t[s];r==="boolean"?o=Ol(o):o==null&&r==="string"?(o="",i=!0):r==="number"&&(o=0,i=!0)}try{t[s]=o}catch{}i&&t.removeAttribute(a||s)}function Es(t,s,o,n){t.addEventListener(s,o,n)}function Id(t,s,o,n){t.removeEventListener(s,o,n)}const ml=Symbol("_vei");function Ld(t,s,o,n,a=null){const l=t[ml]||(t[ml]={}),i=l[s];if(n&&i)i.value=n;else{const[r,c]=Td(s);if(n){const d=l[s]=Ed(n,a);Es(t,r,d,c)}else i&&(Id(t,r,i,c),l[s]=void 0)}}const gl=/(?:Once|Passive|Capture)$/;function Td(t){let s;if(gl.test(t)){s={};let n;for(;n=t.match(gl);)t=t.slice(0,t.length-n[0].length),s[n[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):Zs(t.slice(2)),s]}let Xn=0;const jd=Promise.resolve(),Pd=()=>Xn||(jd.then(()=>Xn=0),Xn=Date.now());function Ed(t,s){const o=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=o.attached)return;ws(Bd(n,o.value),s,5,[n])};return o.value=t,o.attached=Pd(),o}function Bd(t,s){if(Qe(s)){const o=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{o.call(t),t._stopped=!0},s.map(n=>a=>!a._stopped&&n&&n(a))}else return s}const hl=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,Vd=(t,s,o,n,a,l)=>{const i=a==="svg";s==="class"?$d(t,n,i):s==="style"?Sd(t,o,n):Cn(s)?ya(s)||Ld(t,s,o,n,l):(s[0]==="."?(s=s.slice(1),!0):s[0]==="^"?(s=s.slice(1),!1):Dd(t,s,n,i))?(fl(t,s,n),!t.tagName.includes("-")&&(s==="value"||s==="checked"||s==="selected")&&pl(t,s,n,i,l,s!=="value")):t._isVueCE&&(/[A-Z]/.test(s)||!Vt(n))?fl(t,fs(s),n,l,s):(s==="true-value"?t._trueValue=n:s==="false-value"&&(t._falseValue=n),pl(t,s,n,i))};function Dd(t,s,o,n){if(n)return!!(s==="innerHTML"||s==="textContent"||s in t&&hl(s)&&lt(o));if(s==="spellcheck"||s==="draggable"||s==="translate"||s==="autocorrect"||s==="sandbox"&&t.tagName==="IFRAME"||s==="form"||s==="list"&&t.tagName==="INPUT"||s==="type"&&t.tagName==="TEXTAREA")return!1;if(s==="width"||s==="height"){const a=t.tagName;if(a==="IMG"||a==="VIDEO"||a==="CANVAS"||a==="SOURCE")return!1}return hl(s)&&Vt(o)?!1:s in t}const or=new WeakMap,nr=new WeakMap,xn=Symbol("_moveCb"),yl=Symbol("_enterCb"),Hd=t=>(delete t.props.mode,t),Fd=Hd({name:"TransitionGroup",props:Ot({},Yi,{tag:String,moveClass:String}),setup(t,{slots:s}){const o=Bn(),n=bi();let a,l;return Si(()=>{if(!a.length)return;const i=t.moveClass||`${t.name||"v"}-move`;if(!zd(a[0].el,o.vnode.el,i)){a=[];return}a.forEach(Rd),a.forEach(Nd);const r=a.filter(Od);va(o.vnode.el),r.forEach(c=>{const d=c.el,u=d.style;xs(d,i),u.transform=u.webkitTransform=u.transitionDuration="";const v=d[xn]=b=>{b&&b.target!==d||(!b||b.propertyName.endsWith("transform"))&&(d.removeEventListener("transitionend",v),d[xn]=null,Ns(d,i))};d.addEventListener("transitionend",v)}),a=[]}),()=>{const i=ht(t),r=Qi(i);let c=i.tag||Le;if(a=[],l)for(let d=0;d<l.length;d++){const u=l[d];u.el&&u.el instanceof Element&&(a.push(u),lo(u,Ro(u,r,n,o)),or.set(u,{left:u.el.offsetLeft,top:u.el.offsetTop}))}l=s.default?La(s.default()):[];for(let d=0;d<l.length;d++){const u=l[d];u.key!=null&&lo(u,Ro(u,r,n,o))}return Ye(c,null,l)}}}),Ud=Fd;function Rd(t){const s=t.el;s[xn]&&s[xn](),s[yl]&&s[yl]()}function Nd(t){nr.set(t,{left:t.el.offsetLeft,top:t.el.offsetTop})}function Od(t){const s=or.get(t),o=nr.get(t),n=s.left-o.left,a=s.top-o.top;if(n||a){const l=t.el.style;return l.transform=l.webkitTransform=`translate(${n}px,${a}px)`,l.transitionDuration="0s",t}}function zd(t,s,o){const n=t.cloneNode(),a=t[yo];a&&a.forEach(r=>{r.split(/\s+/).forEach(c=>c&&n.classList.remove(c))}),o.split(/\s+/).forEach(r=>r&&n.classList.add(r)),n.style.display="none";const l=s.nodeType===1?s:s.parentNode;l.appendChild(n);const{hasTransform:i}=er(n);return l.removeChild(n),i}const qs=t=>{const s=t.props["onUpdate:modelValue"]||!1;return Qe(s)?o=>sn(s,o):s};function Kd(t){t.target.composing=!0}function bl(t){const s=t.target;s.composing&&(s.composing=!1,s.dispatchEvent(new Event("input")))}const ps=Symbol("_assign");function wl(t,s,o){return s&&(t=t.trim()),o&&(t=Mn(t)),t}const je={created(t,{modifiers:{lazy:s,trim:o,number:n}},a){t[ps]=qs(a);const l=n||a.props&&a.props.type==="number";Es(t,s?"change":"input",i=>{i.target.composing||t[ps](wl(t.value,o,l))}),(o||l)&&Es(t,"change",()=>{t.value=wl(t.value,o,l)}),s||(Es(t,"compositionstart",Kd),Es(t,"compositionend",bl),Es(t,"change",bl))},mounted(t,{value:s}){t.value=s??""},beforeUpdate(t,{value:s,oldValue:o,modifiers:{lazy:n,trim:a,number:l}},i){if(t[ps]=qs(i),t.composing)return;const r=(l||t.type==="number")&&!/^0\d/.test(t.value)?Mn(t.value):t.value,c=s??"";r!==c&&(document.activeElement===t&&t.type!=="range"&&(n&&s===o||a&&t.value.trim()===c)||(t.value=c))}},os={deep:!0,created(t,s,o){t[ps]=qs(o),Es(t,"change",()=>{const n=t._modelValue,a=bo(t),l=t.checked,i=t[ps];if(Qe(n)){const r=ka(n,a),c=r!==-1;if(l&&!c)i(n.concat(a));else if(!l&&c){const d=[...n];d.splice(r,1),i(d)}}else if(wo(n)){const r=new Set(n);l?r.add(a):r.delete(a),i(r)}else i(ar(t,l))})},mounted:kl,beforeUpdate(t,s,o){t[ps]=qs(o),kl(t,s,o)}};function kl(t,{value:s,oldValue:o},n){t._modelValue=s;let a;if(Qe(s))a=ka(s,n.props.value)>-1;else if(wo(s))a=s.has(n.props.value);else{if(s===o)return;a=ao(s,ar(t,!0))}t.checked!==a&&(t.checked=a)}const Wd={created(t,{value:s},o){t.checked=ao(s,o.props.value),t[ps]=qs(o),Es(t,"change",()=>{t[ps](bo(t))})},beforeUpdate(t,{value:s,oldValue:o},n){t[ps]=qs(n),s!==o&&(t.checked=ao(s,n.props.value))}},Hs={deep:!0,created(t,{value:s,modifiers:{number:o}},n){const a=wo(s);Es(t,"change",()=>{const l=Array.prototype.filter.call(t.options,i=>i.selected).map(i=>o?Mn(bo(i)):bo(i));t[ps](t.multiple?a?new Set(l):l:l[0]),t._assigning=!0,Yt(()=>{t._assigning=!1})}),t[ps]=qs(n)},mounted(t,{value:s}){xl(t,s)},beforeUpdate(t,s,o){t[ps]=qs(o)},updated(t,{value:s}){t._assigning||xl(t,s)}};function xl(t,s){const o=t.multiple,n=Qe(s);if(!(o&&!n&&!wo(s))){for(let a=0,l=t.options.length;a<l;a++){const i=t.options[a],r=bo(i);if(o)if(n){const c=typeof r;c==="string"||c==="number"?i.selected=s.some(d=>String(d)===String(r)):i.selected=ka(s,r)>-1}else i.selected=s.has(r);else if(ao(bo(i),s)){t.selectedIndex!==a&&(t.selectedIndex=a);return}}!o&&t.selectedIndex!==-1&&(t.selectedIndex=-1)}}function bo(t){return"_value"in t?t._value:t.value}function ar(t,s){const o=s?"_trueValue":"_falseValue";return o in t?t[o]:s}const Gd={created(t,s,o){tn(t,s,o,null,"created")},mounted(t,s,o){tn(t,s,o,null,"mounted")},beforeUpdate(t,s,o,n){tn(t,s,o,n,"beforeUpdate")},updated(t,s,o,n){tn(t,s,o,n,"updated")}};function qd(t,s){switch(t){case"SELECT":return Hs;case"TEXTAREA":return je;default:switch(s){case"checkbox":return os;case"radio":return Wd;default:return je}}}function tn(t,s,o,n,a){const i=qd(t.tagName,o.props&&o.props.type)[a];i&&i(t,s,o,n)}const Zd=["ctrl","shift","alt","meta"],Jd={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,s)=>Zd.some(o=>t[`${o}Key`]&&!s.includes(o))},Pe=(t,s)=>{const o=t._withMods||(t._withMods={}),n=s.join(".");return o[n]||(o[n]=(a,...l)=>{for(let i=0;i<s.length;i++){const r=Jd[s[i]];if(r&&r(a,s))return}return t(a,...l)})},Yd={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},ns=(t,s)=>{const o=t._withKeys||(t._withKeys={}),n=s.join(".");return o[n]||(o[n]=a=>{if(!("key"in a))return;const l=Zs(a.key);if(s.some(i=>i===l||Yd[i]===l))return t(a)})},Xd=Ot({patchProp:Vd},wd);let Cl;function Qd(){return Cl||(Cl=Qc(Xd))}const eu=(...t)=>{const s=Qd().createApp(...t),{mount:o}=s;return s.mount=n=>{const a=su(n);if(!a)return;const l=s._component;!lt(l)&&!l.render&&!l.template&&(l.template=a.innerHTML),a.nodeType===1&&(a.textContent="");const i=o(a,!1,tu(a));return a instanceof Element&&(a.removeAttribute("v-cloak"),a.setAttribute("data-v-app","")),i},s};function tu(t){if(t instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&t instanceof MathMLElement)return"mathml"}function su(t){return Vt(t)?document.querySelector(t):t}class ou{constructor(){this.dbName="MyPhoneDB",this.version=10,this.db=null}emitChange(s){try{typeof window<"u"&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("idb-change",{detail:s}))}catch(o){console.warn("IndexedDB change event failed:",o)}}async init(){return this.db?this.db:new Promise((s,o)=>{const n=indexedDB.open(this.dbName,this.version);n.onerror=()=>o(n.error),n.onsuccess=()=>{this.db=n.result,s(this.db)},n.onupgradeneeded=a=>{const l=a.target.result;if(l.objectStoreNames.contains("settings")||l.createObjectStore("settings",{keyPath:"key"}),l.objectStoreNames.contains("chatRecords")||l.createObjectStore("chatRecords",{keyPath:"id",autoIncrement:!0}),l.objectStoreNames.contains("apiKeys")||l.createObjectStore("apiKeys",{keyPath:"key"}),l.objectStoreNames.contains("characterCards")||l.createObjectStore("characterCards",{keyPath:"id",autoIncrement:!0}),l.objectStoreNames.contains("contacts")||l.createObjectStore("contacts",{keyPath:"id",autoIncrement:!0}),l.objectStoreNames.contains("chatList")||l.createObjectStore("chatList",{keyPath:"id",autoIncrement:!0}).createIndex("lastMessageTime","lastMessageTime",{unique:!1}),!l.objectStoreNames.contains("chatMessages")){const i=l.createObjectStore("chatMessages",{keyPath:"id",autoIncrement:!0});i.createIndex("chatId","chatId",{unique:!1}),i.createIndex("time","time",{unique:!1})}if(l.objectStoreNames.contains("userSettings")||l.createObjectStore("userSettings",{keyPath:"id",autoIncrement:!0}),!l.objectStoreNames.contains("diaries")){const i=l.createObjectStore("diaries",{keyPath:"id",autoIncrement:!0});i.createIndex("contactId","contactId",{unique:!1}),i.createIndex("date","date",{unique:!1})}if(l.objectStoreNames.contains("momentPosts")||l.createObjectStore("momentPosts",{keyPath:"id"}).createIndex("createdAt","createdAt",{unique:!1}),!l.objectStoreNames.contains("worldBooks")){const i=l.createObjectStore("worldBooks",{keyPath:"id",autoIncrement:!0});i.createIndex("bookName","bookName",{unique:!1}),i.createIndex("characterId","characterId",{unique:!1})}if(l.objectStoreNames.contains("groups")||l.createObjectStore("groups",{keyPath:"id",autoIncrement:!0}),!l.objectStoreNames.contains("groupMessages")){const i=l.createObjectStore("groupMessages",{keyPath:"id",autoIncrement:!0});i.createIndex("groupId","groupId",{unique:!1}),i.createIndex("time","time",{unique:!1})}if(!l.objectStoreNames.contains("customEmojis")){const i=l.createObjectStore("customEmojis",{keyPath:"id",autoIncrement:!0});i.createIndex("name","name",{unique:!1}),i.createIndex("createdAt","createdAt",{unique:!1})}l.objectStoreNames.contains("emails")||l.createObjectStore("emails",{keyPath:"id",autoIncrement:!0}).createIndex("timestamp","timestamp",{unique:!1}),l.objectStoreNames.contains("liveContents")||l.createObjectStore("liveContents",{keyPath:"title"}).createIndex("timestamp","timestamp",{unique:!1})}})}async set(s,o){return await this.init(),new Promise((n,a)=>{const i=this.db.transaction([s],"readwrite").objectStore(s),r=JSON.parse(JSON.stringify(o)),c=i.put(r);c.onsuccess=()=>{this.emitChange({storeName:s,action:"put",key:c.result,data:r,ts:Date.now()}),n()},c.onerror=()=>a(c.error)})}async get(s,o){return await this.init(),new Promise((n,a)=>{const r=this.db.transaction([s],"readonly").objectStore(s).get(o);r.onsuccess=()=>n(r.result),r.onerror=()=>a(r.error)})}async getAll(s){return await this.init(),new Promise((o,n)=>{const i=this.db.transaction([s],"readonly").objectStore(s).getAll();i.onsuccess=()=>o(i.result||[]),i.onerror=()=>n(i.error)})}async delete(s,o){return await this.init(),new Promise((n,a)=>{const r=this.db.transaction([s],"readwrite").objectStore(s).delete(o);r.onsuccess=()=>{this.emitChange({storeName:s,action:"delete",key:o,ts:Date.now()}),n()},r.onerror=()=>a(r.error)})}async clear(s){return await this.init(),new Promise((o,n)=>{const i=this.db.transaction([s],"readwrite").objectStore(s).clear();i.onsuccess=()=>{this.emitChange({storeName:s,action:"clear",ts:Date.now()}),o()},i.onerror=()=>n(i.error)})}}const Ce=new ou,C={async setSetting(t,s){return Ce.set("settings",{key:t,value:s})},async getSetting(t){const s=await Ce.get("settings",t);return s==null?void 0:s.value},async setApiKey(t,s){return Ce.set("apiKeys",{key:t,value:s})},async getApiKey(t){const s=await Ce.get("apiKeys",t);return s==null?void 0:s.value},async addChatRecord(t){return Ce.set("chatRecords",t)},async getChatRecords(){return Ce.getAll("chatRecords")},async deleteChatRecord(t){return Ce.delete("chatRecords",t)},async addCharacterCard(t){return Ce.set("characterCards",t)},async getCharacterCards(){return Ce.getAll("characterCards")},async deleteCharacterCard(t){return Ce.delete("characterCards",t)},async addContact(t){return Ce.set("contacts",t)},async getContacts(){return Ce.getAll("contacts")},async getContact(t){return Ce.get("contacts",t)},async getContactByName(t){return(await Ce.getAll("contacts")).find(o=>o.name===t)},async updateContact(t){return Ce.set("contacts",t)},async deleteContact(t){return Ce.delete("contacts",t)},async addChatListItem(t){return Ce.set("chatList",t)},async getChatList(){return Ce.getAll("chatList")},async getChatListItem(t){return Ce.get("chatList",t)},async updateChatListItem(t){return Ce.set("chatList",t)},async deleteChatListItem(t){return Ce.delete("chatList",t)},async addChatMessage(t){return t.isSummarized===void 0&&(t.isSummarized=!1),t.processedForMoment===void 0&&(t.processedForMoment=!1),Ce.set("chatMessages",t)},async getChatMessages(t){return(await Ce.getAll("chatMessages")).filter(o=>o.chatId===t).sort((o,n)=>o.time-n.time)},async getUnprocessedForMomentMessages(t,s=50){const n=(await Ce.getAll("chatMessages")).filter(a=>a.chatId===t&&(a.processedForMoment===!1||a.processedForMoment===void 0)).sort((a,l)=>a.time-l.time);return s?n.slice(0,s):n},async markMessagesAsProcessedForMoment(t){const s=await Ce.getAll("chatMessages");for(const o of s)t.includes(o.id)&&(o.processedForMoment=!0,await Ce.set("chatMessages",o))},async markAllMessagesAsProcessedForMoment(t){const s=await Ce.getAll("chatMessages");for(const o of s)o.chatId===t&&(o.processedForMoment=!0,await Ce.set("chatMessages",o))},async getUnsummarizedMessages(t,s=50){const n=(await Ce.getAll("chatMessages")).filter(a=>a.chatId===t&&a.isSummarized===!1).sort((a,l)=>a.time-l.time);return s?n.slice(0,s):n},async markMessagesAsSummarized(t){const s=await Ce.getAll("chatMessages");for(const o of s)t.includes(o.id)&&(o.isSummarized=!0,await Ce.set("chatMessages",o))},async markAllMessagesAsSummarized(t){const s=await Ce.getAll("chatMessages");for(const o of s)o.chatId===t&&(o.isSummarized=!0,await Ce.set("chatMessages",o))},async deleteChatMessage(t){return Ce.delete("chatMessages",t)},async clearChatMessages(t){const o=(await Ce.getAll("chatMessages")).filter(n=>n.chatId===t);for(const n of o)await Ce.delete("chatMessages",n.id)},async markMessagesAsRead(t){const o=(await Ce.getAll("chatMessages")).filter(n=>n.chatId===t&&!n.sent);for(const n of o)n.read=!0,await Ce.set("chatMessages",n)},async setUserSetting(t,s,o){const n=`user_${t}_${s}`;return Ce.set("userSettings",{id:n,contactId:t,key:s,value:o})},async getUserSetting(t,s){const o=`user_${t}_${s}`,n=await Ce.get("userSettings",o);return n==null?void 0:n.value},async getUserSettings(t){return(await Ce.getAll("userSettings")).filter(o=>o.contactId===t)},async deleteUserSettings(t){const o=(await Ce.getAll("userSettings")).filter(n=>n.contactId===t);for(const n of o)await Ce.delete("userSettings",n.id)},async addDiary(t){return Ce.set("diaries",t)},async getDiaries(t){return(await Ce.getAll("diaries")).filter(o=>o.contactId===t).sort((o,n)=>new Date(n.date)-new Date(o.date))},async getDiary(t){return Ce.get("diaries",t)},async updateDiary(t){return Ce.set("diaries",t)},async deleteDiary(t){return Ce.delete("diaries",t)},async deleteDiaries(t){const o=(await Ce.getAll("diaries")).filter(n=>n.contactId===t);for(const n of o)await Ce.delete("diaries",n.id)},async upsertMomentPost(t){return Ce.set("momentPosts",t)},async getMomentPost(t){return Ce.get("momentPosts",t)},async getMomentPosts(){return(await Ce.getAll("momentPosts")).sort((s,o)=>(o.createdAt||0)-(s.createdAt||0))},async deleteMomentPost(t){return Ce.delete("momentPosts",t)},async clearMomentPosts(){return Ce.clear("momentPosts")},async addWorldBookEntry(t){return Ce.set("worldBooks",t)},async getWorldBookEntries(t){return(await Ce.getAll("worldBooks")).filter(o=>o.bookName===t)},async getAllWorldBooks(){return Ce.getAll("worldBooks")},async getWorldBookNames(){const t=await Ce.getAll("worldBooks");return[...new Set(t.map(o=>o.bookName))].filter(Boolean)},async updateWorldBookEntry(t){return Ce.set("worldBooks",t)},async deleteWorldBookEntry(t){return Ce.delete("worldBooks",t)},async deleteWorldBook(t){const o=(await Ce.getAll("worldBooks")).filter(n=>n.bookName===t);for(const n of o)await Ce.delete("worldBooks",n.id)},async matchWorldBookEntries(t,s){var a;if(console.log(" [] "),console.log("   - :",t),console.log("   - :",s),!t)return console.warn(" [] "),[];const o=await this.getWorldBookEntries(t);console.log(" [] ",o.length,"");const n=[];for(const l of o){if(console.log("   :",{id:l.id,keys:l.keys,enabled:l.enabled,constant:l.constant,content:((a=l.content)==null?void 0:a.substring(0,30))+"..."}),!l.enabled){console.log("    ");continue}if(l.constant===!0){console.log("    "),n.push(l);continue}const i=l.keys||[];if(i.length===0){console.log("    ");continue}if(!s){console.log("    ");continue}for(const r of i)if(s.includes(r)){console.log("    :",r),n.push(l);break}}return console.log(" [] ",n.length,""),n},async createGroup(t){return Ce.set("groups",t)},async getGroups(){return Ce.getAll("groups")},async getGroup(t){return Ce.get("groups",t)},async updateGroup(t){return Ce.set("groups",t)},async deleteGroup(t){return Ce.delete("groups",t)},async getGroupMembers(t){return!t||t.length===0?[]:(await this.getContacts()).filter(o=>t.includes(o.id))},async addGroupMessage(t){return Ce.set("groupMessages",t)},async getGroupMessages(t){return(await Ce.getAll("groupMessages")).filter(o=>o.groupId===t).sort((o,n)=>o.time-n.time)},async deleteGroupMessage(t){return Ce.delete("groupMessages",t)},async clearGroupMessages(t){const o=(await Ce.getAll("groupMessages")).filter(n=>n.groupId===t);for(const n of o)await Ce.delete("groupMessages",n.id)},async addCustomEmoji(t){return Ce.set("customEmojis",t)},async getCustomEmojis(){return(await Ce.getAll("customEmojis")).sort((s,o)=>(o.createdAt||0)-(s.createdAt||0))},async getCustomEmojiByName(t){return(await Ce.getAll("customEmojis")).find(o=>o.name===t)},async deleteCustomEmoji(t){return Ce.delete("customEmojis",t)},async clearCustomEmojis(){return Ce.clear("customEmojis")},async addEmail(t){return Ce.set("emails",t)},async getEmails(){return(await Ce.getAll("emails")).sort((s,o)=>(o.timestamp||0)-(s.timestamp||0))},async getEmail(t){return Ce.get("emails",t)},async deleteEmail(t){return Ce.delete("emails",t)},async clearEmails(){return Ce.clear("emails")},async saveLiveContent(t){console.log(" [IndexedDB] saveLiveContent "),console.log("   - :",t);const s={title:t.title,username:t.username,viewers:t.viewers,cover:t.cover,contactId:t.contactId,content:t.content,danmus:t.danmus||[],timestamp:t.timestamp||Date.now()};console.log("   - :",s),console.log("   -  key (title):",s.title);try{await Ce.set("liveContents",s),console.log("    ");const o=await Ce.get("liveContents",s.title);return console.log("   - :",o),o}catch(o){throw console.error("    :",o),o}},async getLiveContent(t){var s,o;console.log(" [IndexedDB] getLiveContent "),console.log("   -  key (title):",t);try{const n=await Ce.get("liveContents",t);return console.log("   - :",n),n?(console.log("    "),console.log("   - :",((s=n.content)==null?void 0:s.length)||0),console.log("   - :",((o=n.danmus)==null?void 0:o.length)||0)):console.log("    "),n}catch(n){throw console.error("    :",n),n}},async getAllLiveContents(){return(await Ce.getAll("liveContents")).sort((s,o)=>(o.timestamp||0)-(s.timestamp||0))},async deleteLiveContent(t){return Ce.delete("liveContents",t)}},is=Object.freeze(Object.defineProperty({__proto__:null,db:C,dbManager:Ce},Symbol.toStringTag,{value:"Module"})),Xe=(t,s)=>{const o=t.__vccOpts||t;for(const[n,a]of s)o[n]=a;return o},nu=["src","alt"],au={__name:"AppIcon",props:{name:{type:String,required:!0},iconSrc:{type:String,required:!0},isBottomBar:{type:Boolean,default:!1}},emits:["click"],setup(t,{emit:s}){const o=s,n=h(!0),a=()=>{o("click")},l=async()=>{try{const r=await C.getSetting("iconBackdropFilter");r!==void 0&&(n.value=r)}catch(r){console.error(":",r)}},i=r=>{n.value=r.detail.enabled};return it(()=>{l(),window.addEventListener("icon-backdrop-filter-changed",i)}),zt(()=>{window.removeEventListener("icon-backdrop-filter-changed",i)}),(r,c)=>(p(),f("div",{class:Se(["app-icon",{"app-block":!t.isBottomBar,"bottom-bar-app":t.isBottomBar,"no-backdrop":!t.isBottomBar&&!n.value}]),onClick:a},[e("img",{src:t.iconSrc,alt:t.name},null,8,nu),e("span",null,_(t.name),1)],2))}},gs=Xe(au,[["__scopeId","data-v-ce9e7bf7"]]),lu={class:"phone-container"},iu={class:"dialog-content"},ru={class:"dialog-content"},cu={class:"status-bar"},du={class:"status-bar-left"},uu={class:"desktop-page"},vu={class:"widget-container"},pu={class:"time"},fu={class:"date"},mu=["innerHTML"],gu={class:"desktop-page"},hu={class:"pagination-dots"},yu={class:"bottom-bar"},bu=2,wu={__name:"Desktop",emits:["open-messages","open-settings","open-moments","open-worldbook","open-pornhub","open-music","open-forum","open-live","open-mail"],setup(t,{emit:s}){_d(O=>({v152fcd44:u.value}));const o=s,n=h(!1),a=h(!1),l=h(""),i=h(""),r=h("12:00"),c=h("Sunday, Dec 15"),d=h(null),u=h("url(/src/assets/wallpaper.jpg)"),v=h(!0),b=h({Messages:"https://files.catbox.moe/14op6b.jpg",Moments:"https://files.catbox.moe/gvs6a5.jpg",Mori:"https://files.catbox.moe/f0p41u.png",Forum:"https://files.catbox.moe/jpd1lk.jpg",Music:"https://img.wjwj.top/2026/02/18/f6486d844bff10d88a0514db5f710875.md.png",Pornhub:"https://upload.wikimedia.org/wikipedia/commons/f/f1/Pornhub-logo.svg",Live:"https://files.catbox.moe/mg3qg0.jpg",Phone:"https://files.catbox.moe/7ji6fb.png",Mail:"https://files.catbox.moe/edai70.png",World:"https://files.catbox.moe/it221m.png",Settings:"https://files.catbox.moe/2khrtz.png"}),w=h(""),I=h(""),j=h(0),$=h(null),x=h(!1),S=h(0),M=h(0),A=h(0);h(null);const T=h(!1),G=tt(()=>x.value?{transform:`translateX(${M.value}px)`,transition:"none",cursor:"grabbing"}:{transform:`translateX(${-j.value*100}%)`,transition:"transform 0.3s ease-out",cursor:"grab"}),K=O=>O.type.includes("mouse")?O.pageX:O.touches[0].clientX,q=O=>{x.value=!0,T.value=!1,S.value=K(O),A.value=-j.value*window.innerWidth},ee=O=>{q(O)},Z=O=>{q(O)},E=O=>{if(x.value){const ae=K(O)-S.value;Math.abs(ae)>5&&(T.value=!0),M.value=A.value+ae}},m=O=>{x.value&&E(O)},g=O=>{x.value&&(O.preventDefault(),E(O))},D=()=>{if(T.value){const O=M.value-A.value,Q=50;O<-Q&&j.value<bu-1?j.value+=1:O>Q&&j.value>0&&(j.value-=1)}x.value=!1,T.value=!1,M.value=0},W=()=>D(),te=()=>D(),R=()=>{x.value&&D()},F=O=>{j.value=O,ie()},ie=()=>{d.value&&(d.value.currentTime=0,d.value.play().catch(O=>console.log(":",O)))},re=()=>{const O=new Date,Q=String(O.getHours()).padStart(2,"0"),ae=String(O.getMinutes()).padStart(2,"0");r.value=`${Q}:${ae}`;const fe=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Me=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.value=`${fe[O.getDay()]}, ${Me[O.getMonth()]} ${O.getDate()}`},pe=()=>{ie(),n.value=!0},we=()=>{n.value=!1,l.value=""},he=()=>{a.value=!1,i.value=""},Ue=()=>{const O=l.value.trim();O&&(typeof window.triggerSlash=="function"?window.triggerSlash(`/send ${O}|/trigger`):console.log(":",O),we())},ge=()=>{const O=i.value.trim();O&&(typeof window.triggerSlash=="function"?window.triggerSlash(`/send ${O}|/trigger`):console.log(":",O),he())},B=O=>{console.log(":",O),ie();const Q={Messages:()=>o("open-messages"),Moments:()=>o("open-moments"),Mori:()=>{typeof window.triggerSlash=="function"&&window.triggerSlash("/send  Mori|/trigger")},Live:()=>{console.log(" Live emit"),o("open-live")},Forum:()=>{console.log(" Forum emit"),o("open-forum")},Mail:()=>{console.log(" Mail emit"),o("open-mail")},Settings:()=>o("open-settings"),World:()=>o("open-worldbook"),Music:()=>{console.log(" Music emit"),o("open-music")},Pornhub:()=>{console.log(" Pornhub emit"),o("open-pornhub")}};Q[O]?Q[O]():console.log(":",O)},L=async()=>{try{const O=await C.getSetting("wallpaper");O&&(u.value=`url(${O})`);const Q=await C.getSetting("iconBackdropFilter");Q!==void 0&&(v.value=Q);const ae=await C.getSetting("appIcons");ae&&Array.isArray(ae)&&ae.forEach(Ie=>{b.value[Ie.name]=Ie.iconSrc});const fe=await C.getSetting("desktopCustomCSS"),Me=await C.getSetting("desktopCustomHTML");fe&&(w.value=fe),Me&&(I.value=Me)}catch(O){console.error(":",O)}},k=O=>{u.value=`url(${O.detail.wallpaper})`},y=O=>{v.value=O.detail.enabled},H=O=>{b.value[O.detail.appName]=O.detail.iconSrc},se=O=>{w.value=O.detail.css,I.value=O.detail.html},P=O=>{w.value=O.detail.css,I.value=O.detail.html};let U=null;return it(()=>{re(),U=setInterval(re,1e3),L(),window.addEventListener("wallpaper-changed",k),window.addEventListener("icon-backdrop-filter-changed",y),window.addEventListener("app-icon-changed",H),window.addEventListener("desktop-customization-preview",se),window.addEventListener("desktop-customization-apply",P)}),zt(()=>{U&&clearInterval(U),window.removeEventListener("wallpaper-changed",k),window.removeEventListener("icon-backdrop-filter-changed",y),window.removeEventListener("app-icon-changed",H),window.removeEventListener("desktop-customization-preview",se),window.removeEventListener("desktop-customization-apply",P)}),(O,Q)=>(p(),f("div",lu,[w.value?(p(),nt(Ta("style"),{key:0},{default:ko(()=>[ot(_(w.value),1)]),_:1})):N("",!0),e("div",{id:"phoneDialog",class:Se(["dialog",{show:n.value}]),onClick:Pe(we,["self"])},[e("div",iu,[Q[18]||(Q[18]=e("h3",null,"",-1)),ke(e("input",{type:"text","onUpdate:modelValue":Q[0]||(Q[0]=ae=>l.value=ae),placeholder:"",onKeyup:ns(Ue,["enter"])},null,544),[[je,l.value]]),e("div",{class:"dialog-buttons"},[e("button",{onClick:Ue},""),e("button",{onClick:we},"")])])],2),e("div",{id:"searchDialog",class:Se(["dialog",{show:a.value}]),onClick:Pe(he,["self"])},[e("div",ru,[Q[19]||(Q[19]=e("h3",null,"",-1)),ke(e("input",{type:"text","onUpdate:modelValue":Q[1]||(Q[1]=ae=>i.value=ae),placeholder:"",onKeyup:ns(ge,["enter"])},null,544),[[je,i.value]]),e("div",{class:"dialog-buttons"},[e("button",{onClick:ge},""),e("button",{onClick:he},"")])])],2),e("div",cu,[e("div",du,[e("span",null,_(r.value),1)]),Q[20]||(Q[20]=mt('<div class="status-bar-right" data-v-d70fbd14><svg class="status-icon-svg" viewBox="0 0 24 24" data-v-d70fbd14><path d="M20,20h2v-2h-2V20z M18,20h-2v-4h2V20z M14,20h-2v-6h2V20z M10,20H8v-8h2V20z M6,20H4v-10h2V20z" data-v-d70fbd14></path></svg><svg class="status-icon-svg" viewBox="0 0 24 24" data-v-d70fbd14><path d="M12,3C7.41,3,3.86,4.53,0.96,7.03L2.37,8.44C4.89,6.31,8.06,5,12,5s7.11,1.31,9.63,3.44l1.41-1.41C20.14,4.53,16.59,3,12,3z M12,7C9.3,7,6.81,7.89,4.8,9.4l1.4,1.4C7.6,9.67,9.69,9,12,9s4.4,0.67,5.8,1.8l1.4-1.4C17.19,7.89,14.7,7,12,7z M12,11c-1.94,0-3.5,0.5-4.7,1.3l1.4,1.4c0.8-0.5,2-0.7,3.3-0.7s2.5,0.2,3.3,0.7l1.4-1.4C15.5,11.5,13.94,11,12,11z M12,15c-0.85,0-1.5,0.15-2,0.4l2,2l2-2C13.5,15.15,12.85,15,12,15z" data-v-d70fbd14></path></svg><svg class="status-icon-svg" viewBox="0 0 24 24" data-v-d70fbd14><path d="M15.67,4H14V2h-4v2H8.33C7.6,4,7,4.6,7,5.33v15.33C7,21.4,7.6,22,8.33,22h7.33c0.74,0,1.33-0.6,1.33-1.33V5.33C17,4.6,16.4,4,15.67,4z M15,20H9V6h6V20z" data-v-d70fbd14></path></svg></div>',1))]),e("div",{class:"desktop-slider",ref_key:"desktopSlider",ref:$,style:Oe(G.value),onTouchstart:ee,onTouchmove:m,onTouchend:W,onMousedown:Z,onMousemove:g,onMouseup:te,onMouseleave:R},[e("div",uu,[e("div",vu,[e("div",{class:"widget widget-clock",onClick:ie},[e("div",pu,_(r.value),1),e("div",fu,_(c.value),1)]),e("div",{class:"widget widget-weather",onClick:ie},[...Q[21]||(Q[21]=[e("div",{class:"temp"},"23C",-1),e("div",{class:"condition"},"Sunny",-1)])])]),I.value?(p(),f("div",{key:0,class:"custom-html-container",innerHTML:I.value},null,8,mu)):N("",!0),e("div",{class:"app-grid",onMousedown:Q[6]||(Q[6]=Pe(()=>{},["stop"])),onTouchstart:Q[7]||(Q[7]=Pe(()=>{},["stop"]))},[Ye(gs,{name:"Messages","icon-src":b.value.Messages,onClick:Q[2]||(Q[2]=ae=>B("Messages"))},null,8,["icon-src"]),Ye(gs,{name:"Moments","icon-src":b.value.Moments,onClick:Q[3]||(Q[3]=ae=>B("Moments"))},null,8,["icon-src"]),Ye(gs,{name:"Mori","icon-src":b.value.Mori,onClick:Q[4]||(Q[4]=ae=>B("Mori"))},null,8,["icon-src"]),Ye(gs,{name:"Forum","icon-src":b.value.Forum,onClick:Q[5]||(Q[5]=ae=>B("Forum"))},null,8,["icon-src"])],32)]),e("div",gu,[e("div",{class:"app-grid",onMousedown:Q[11]||(Q[11]=Pe(()=>{},["stop"])),onTouchstart:Q[12]||(Q[12]=Pe(()=>{},["stop"]))},[Ye(gs,{name:"Music","icon-src":b.value.Music,onClick:Q[8]||(Q[8]=ae=>B("Music"))},null,8,["icon-src"]),Ye(gs,{name:"Pornhub","icon-src":b.value.Pornhub,onClick:Q[9]||(Q[9]=ae=>B("Pornhub"))},null,8,["icon-src"]),Ye(gs,{name:"Live","icon-src":b.value.Live,onClick:Q[10]||(Q[10]=ae=>B("Live"))},null,8,["icon-src"])],32)])],36),e("div",hu,[e("div",{class:Se(["dot",{active:j.value===0}]),onClick:Q[13]||(Q[13]=ae=>F(0))},null,2),e("div",{class:Se(["dot",{active:j.value===1}]),onClick:Q[14]||(Q[14]=ae=>F(1))},null,2)]),e("div",yu,[Ye(gs,{name:"Phone","icon-src":b.value.Phone,"is-bottom-bar":"",onClick:pe},null,8,["icon-src"]),Ye(gs,{name:"Mail","icon-src":b.value.Mail,"is-bottom-bar":"",onClick:Q[15]||(Q[15]=ae=>B("Mail"))},null,8,["icon-src"]),Ye(gs,{name:"World","icon-src":b.value.World,"is-bottom-bar":"",onClick:Q[16]||(Q[16]=ae=>B("World"))},null,8,["icon-src"]),Ye(gs,{name:"Settings","icon-src":b.value.Settings,"is-bottom-bar":"",onClick:Q[17]||(Q[17]=ae=>B("Settings"))},null,8,["icon-src"])]),e("audio",{ref_key:"clickSound",ref:d,preload:"auto"},[...Q[22]||(Q[22]=[e("source",{src:"https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3",type:"audio/mpeg"},null,-1)])],512)]))}},ku=Xe(wu,[["__scopeId","data-v-d70fbd14"]]);function xu(){const t=h([]),s=h([]),o=h(!1),n=tt(()=>s.value.reduce((j,$)=>j+($.unreadCount||0),0)),a=async()=>{try{o.value=!0,t.value=await C.getContacts()}catch(j){console.error(":",j)}finally{o.value=!1}},l=async()=>{try{o.value=!0;const j=await C.getChatList();s.value=j.sort(($,x)=>{if($.isPinned&&!x.isPinned)return-1;if(!$.isPinned&&x.isPinned)return 1;const S=$.lastMessageTime||0;return(x.lastMessageTime||0)-S})}catch(j){console.error(":",j)}finally{o.value=!1}},i=async j=>{try{const $={...j,createdAt:Date.now(),updatedAt:Date.now()};return await C.addContact($),await a(),t.value.find(S=>S.name===$.name&&Math.abs(S.createdAt-$.createdAt)<1e3)||$}catch($){throw console.error(":",$),$}},r=async j=>{try{const $={...j,updatedAt:Date.now()};return await C.updateContact($),await a(),$}catch($){throw console.error(":",$),$}},c=async j=>{try{await C.deleteContact(j),await a()}catch($){throw console.error(":",$),$}},d=async(j,$,x,S="")=>{try{const M=s.value.find(T=>T.type==="single"&&T.contactId===j);if(M)return M;const A={type:"single",contactId:j,name:$,avatar:x,bio:S,lastMessage:"",lastMessageTime:Date.now(),unreadCount:0,createdAt:Date.now()};return await C.addChatListItem(A),await l(),A}catch(M){throw console.error(":",M),M}},u=async j=>{try{const $=Array.isArray(j.members)?[...j.members]:[],x={name:j.name,avatar:j.avatar,memberIds:$,announcement:"",createdAt:Date.now(),updatedAt:Date.now()};await C.createGroup(x);const M=(await C.getGroups()).find(T=>T.name===x.name&&Math.abs(T.createdAt-x.createdAt)<1e3);if(!M)throw new Error("ID");const A={type:"group",groupId:M.id,name:j.name,avatar:j.avatar,members:$,bio:j.bio||"",lastMessage:"",lastMessageTime:Date.now(),unreadCount:0,createdAt:Date.now()};return await C.addChatListItem(A),await l(),A}catch($){throw console.error(":",$),$}},v=async(j,$)=>{try{const x=await C.getChatListItem(j);if(!x)return;const S={...x,...$,updatedAt:Date.now()};return await C.updateChatListItem(S),await l(),S}catch(x){throw console.error(":",x),x}};return{contacts:t,chatList:s,loading:o,totalUnread:n,loadContacts:a,loadChatList:l,addContact:i,updateContact:r,deleteContact:c,addSingleChat:d,addGroupChat:u,updateChatListItem:v,deleteChatListItem:async j=>{try{await C.deleteChatListItem(j),await l()}catch($){throw console.error(":",$),$}},markAsRead:async j=>{await v(j,{unreadCount:0})},togglePin:async j=>{try{const $=await C.getChatListItem(j);if(!$)return;const x={...$,isPinned:!$.isPinned,updatedAt:Date.now()};return await C.updateChatListItem(x),await l(),x}catch($){throw console.error(":",$),$}}}}const Cu={class:"importer-container"},$u={class:"importer-body"},_u={class:"upload-text"},Mu={key:0,class:"preview-section"},Su={class:"preview-item"},Au={class:"preview-value"},Iu={class:"preview-item"},Lu={class:"preview-value"},Tu={class:"worldbook-info"},ju={key:0,class:"preview-item worldbook-found"},Pu={class:"preview-value success"},Eu={key:1,class:"preview-item worldbook-not-found"},Bu={key:2,class:"worldbook-hint"},Vu={key:3,class:"worldbook-hint"},Du={key:1,class:"error-message"},Hu={class:"importer-actions"},Fu=["disabled"],Uu={__name:"CharacterImporter",emits:["success","cancel"],setup(t,{emit:s}){const o=s,n=h(null),a=h(null),l=h(null),i=h(""),r=h(!1),c=()=>{var b;(b=n.value)==null||b.click()},d=async b=>{var I,j,$,x;const w=b.target.files[0];if(w){a.value=w,i.value="",l.value=null;try{const S=await w.text(),M=JSON.parse(S);console.log(" ...",M);const A={name:M.name||M.char_name||((I=M.data)==null?void 0:I.name)||"",description:M.description||M.char_persona||M.personality||((j=M.data)==null?void 0:j.description)||"",avatar:M.avatar||(($=M.data)==null?void 0:$.avatar)||"https://via.placeholder.com/100",prompt:M.description||M.char_persona||M.personality||((x=M.data)==null?void 0:x.description)||"",worldBookEntries:0,characterBook:null};let T=null;const G=["character_book","characterBook","lorebook","loreBook","world_book","worldBook","data.character_book","data.extensions.world"];for(const K of G){const q=K.split(".");let ee=M;for(const Z of q)if(ee=ee==null?void 0:ee[Z],!ee)break;if(ee&&(ee.entries||ee.data)){T=ee,console.log(`  "${K}" `,T);break}}if(T){const K=T.entries||T.data||[],q=Array.isArray(K)?K.filter(ee=>(ee.content||ee.value||ee.text||"").trim().length>0):[];A.worldBookEntries=q.length,A.characterBook={...T,entries:q},console.log(`  ${q.length} `)}else console.log(" ");l.value=A}catch(S){console.error(" :",S),i.value=" JSON "}}},u=async()=>{if(l.value){r.value=!0,i.value="";try{let b=!1,w=0;if(l.value.characterBook&&l.value.worldBookEntries>0){console.log("  IndexedDB...");const j=l.value.characterBook.entries||[];for(const $ of j){let x=[];Array.isArray($.keys)?x=$.keys:typeof $.keys=="string"?x=$.keys.split(",").map(M=>M.trim()).filter(M=>M):$.key&&(x=[$.key]);const S=$.content||$.value||$.text||$.description||"";if(S.trim()){const M={bookName:l.value.name,keys:x,content:S,enabled:$.enabled!==!1,priority:$.priority||$.order||0,createdAt:Date.now()};await C.addWorldBookEntry(M),w++,console.log(`  ${w}:`,{keys:x,content:S.substring(0,50)+"..."})}}b=!0,console.log(`  ${w} `)}else console.log(" ");o("success",{name:l.value.name,avatar:l.value.avatar,bio:l.value.description,prompt:l.value.prompt,hasWorldBook:b,linkedBookName:b?l.value.name:null,worldBookEntriesCount:w}),alert(b?` 

${l.value.name}
${w} 

 World `:` 

${l.value.name}

 World `)}catch(b){console.error(" :",b),i.value=""+b.message,alert(" "+b.message)}finally{r.value=!1}}},v=()=>{o("cancel")};return(b,w)=>{var I,j;return p(),f("div",Cu,[w[6]||(w[6]=e("div",{class:"importer-header"},[e("h3",null,""),e("p",{class:"importer-desc"}," JSON ")],-1)),e("div",$u,[e("div",{class:"file-upload-area",onClick:c},[e("input",{ref_key:"fileInput",ref:n,type:"file",accept:".json",onChange:d,style:{display:"none"}},null,544),w[0]||(w[0]=e("div",{class:"upload-icon"},"",-1)),e("div",_u,_(a.value?a.value.name:" JSON "),1)]),l.value?(p(),f("div",Mu,[w[5]||(w[5]=e("h4",null," ",-1)),e("div",Su,[w[1]||(w[1]=e("span",{class:"preview-label"},"",-1)),e("span",Au,_(l.value.name),1)]),e("div",Iu,[w[2]||(w[2]=e("span",{class:"preview-label"},"",-1)),e("span",Lu,_((I=l.value.description)==null?void 0:I.substring(0,100))+_(((j=l.value.description)==null?void 0:j.length)>100?"...":""),1)]),e("div",Tu,[l.value.worldBookEntries>0?(p(),f("div",ju,[w[3]||(w[3]=e("span",{class:"preview-label"}," ",-1)),e("span",Pu,"  "+_(l.value.worldBookEntries)+" ",1)])):(p(),f("div",Eu,[...w[4]||(w[4]=[e("span",{class:"preview-label"}," ",-1),e("span",{class:"preview-value warning"}," ",-1)])])),l.value.worldBookEntries>0?(p(),f("div",Bu,'  "'+_(l.value.name)+'" World  ',1)):(p(),f("div",Vu,"   World  "))])])):N("",!0),i.value?(p(),f("div",Du,_(i.value),1)):N("",!0)]),e("div",Hu,[e("button",{class:"btn btn-cancel",onClick:v},""),e("button",{class:"btn btn-confirm",onClick:u,disabled:!l.value||r.value},_(r.value?"...":""),9,Fu)])])}}},Ru=Xe(Uu,[["__scopeId","data-v-845bf5c3"]]),Nu={class:"status-bar"},Ou={class:"status-bar-left"},zu={class:"nav-header"},Ku={class:"nav-profile-group"},Wu=["src"],Gu={key:1,class:"nav-back-avatar-placeholder","aria-hidden":"true"},qu={class:"chat-list-container"},Zu=["onClick","onContextmenu","onTouchstart"],Ju=["src","alt"],Yu={class:"chat-info"},Xu={class:"chat-header"},Qu={class:"chat-name"},e1={class:"chat-header-right"},t1={class:"chat-time"},s1={class:"chat-preview-wrapper"},o1={class:"chat-preview"},n1={class:"modal nav-customizer-modal"},a1={class:"modal-body"},l1={class:"form-group"},i1=["src"],r1=["src"],c1={key:2},d1={class:"form-group"},u1={class:"form-group"},v1=["src"],p1=["src"],f1={key:2},m1={class:"modal"},g1={class:"tabs"},h1={class:"modal-body"},y1={class:"form-group"},b1=["src"],w1={key:1,id:"uploadHint"},k1={class:"form-group"},x1={class:"form-group"},C1={class:"form-group"},$1=["src"],_1={key:1,id:"groupUploadHint"},M1={class:"form-group"},S1={class:"form-group"},A1={class:"contact-selection"},I1=["onClick"],L1=["src"],T1={style:{"font-size":"14px",color:"#333"}},j1={key:0,style:{padding:"15px",color:"#999","font-size":"12px","text-align":"center"}},P1={class:"modal importer-modal"},$l="https://files.catbox.moe/3ehyu8.jpg",E1={__name:"MessageList",emits:["back","open-chat"],setup(t,{emit:s}){const o=s,{contacts:n,chatList:a,loadContacts:l,loadChatList:i,addContact:r,addSingleChat:c,addGroupChat:d,deleteChatListItem:u,togglePin:v,updateChatListItem:b}=xu(),w=h(!1),I=h("contact"),j=h({name:"",bio:"",avatar:""}),$=h({name:"",avatar:"",members:[]}),x=h(null),S=h(null),M=h(null),A=h({show:!1,x:0,y:0,item:null}),T=h(null);h(null);const G=h(!1),K=()=>{pe(),G.value=!0},q=()=>{G.value=!1},ee=async me=>{pe(),j.value={name:me.name||"",bio:me.bio||me.prompt||"",avatar:me.avatar||""},q(),alert(`
${me.name}
${me.hasWorldBook?" World ":""}

""`)},Z=h(!1),E=h(""),m=h(""),g=h(""),D=h(""),W=h(null),te=h(null),R=h({avatar:"",moodText:"",wallpaper:""});let F=null;const ie=()=>{const me=new Date,le=String(me.getHours()).padStart(2,"0"),De=String(me.getMinutes()).padStart(2,"0");D.value=`${le}:${De}`},re=tt(()=>g.value?{backgroundImage:`url(${g.value})`}:{}),pe=()=>{M.value&&(M.value.currentTime=0,M.value.play().catch(()=>{}))},we=()=>{pe(),o("back")},he=()=>{pe(),R.value={avatar:"",moodText:m.value||"",wallpaper:""},Z.value=!0},Ue=()=>{Z.value=!1},ge=me=>new Promise((le,De)=>{const xe=new FileReader;xe.onload=Ve=>{var xt;return le(((xt=Ve==null?void 0:Ve.target)==null?void 0:xt.result)||"")},xe.onerror=()=>De(xe.error),xe.readAsDataURL(me)}),B=async me=>{var De,xe;const le=(xe=(De=me==null?void 0:me.target)==null?void 0:De.files)==null?void 0:xe[0];if(le)try{R.value.avatar=await ge(le)}catch(Ve){console.error(":",Ve),alert("")}},L=async me=>{var De,xe;const le=(xe=(De=me==null?void 0:me.target)==null?void 0:De.files)==null?void 0:xe[0];if(le)try{R.value.wallpaper=await ge(le)}catch(Ve){console.error(":",Ve),alert("")}},k=async()=>{try{pe();const me=(R.value.moodText||"").trim();m.value=me,await C.setSetting("navMoodText",me),R.value.avatar&&(E.value=R.value.avatar,await C.setSetting("navAvatar",E.value)),R.value.wallpaper&&(g.value=R.value.wallpaper,await C.setSetting("phoneContainerWallpaper",g.value)),Ue()}catch(me){console.error(":",me),alert("")}},y=()=>{pe(),w.value=!0,I.value==="group"&&l()},H=()=>{w.value=!1,U()},se=async me=>{pe(),I.value=me,me==="group"&&await l()},P=(me,le)=>{const De=me.target;if(De.files&&De.files[0]){const xe=new FileReader;xe.onload=Ve=>{le==="contact"?j.value.avatar=Ve.target.result:$.value.avatar=Ve.target.result},xe.readAsDataURL(De.files[0])}},U=()=>{j.value={name:"",bio:"",avatar:""},$.value={name:"",avatar:"",members:[]},I.value="contact"},O=async()=>{const me=j.value.name.trim(),le=j.value.bio.trim(),De=j.value.avatar||$l;if(!me){alert("");return}try{pe();const Ve=await r({name:me,bio:le,avatar:De,prompt:le,type:"contact"});await c(Ve.id,Ve.name,Ve.avatar,Ve.bio||Ve.prompt||""),await Promise.all([l(),i()]),H()}catch(xe){console.error(":",xe),alert("")}},Q=me=>{pe();const le=$.value.members.indexOf(me);le>-1?$.value.members.splice(le,1):$.value.members.push(me)},ae=me=>$.value.members.includes(me),fe=async()=>{const me=$.value.name.trim(),le=$.value.avatar||$l;if(!me){alert("");return}if($.value.members.length===0){alert("");return}try{pe(),n.value.length===0&&await l();const De=n.value.filter(yt=>$.value.members.includes(yt.id));if(De.length===0){alert("");return}const xe=De.map(yt=>yt.name).join(""),Ve={name:me,avatar:le,members:$.value.members,bio:`: ${xe}`};if(!await d(Ve))throw new Error("");await i(),H()}catch(De){console.error(":",De),console.error(":",De),alert(`: ${De.message||""}`)}},Me=async me=>{if(console.log(" :",me.name,":",me.unreadCount),A.value.show){console.log(" ");return}if(pe(),me.type==="single"&&me.contactId){console.log(" contactId:",me.contactId);const le=await C.getChatMessages(me.contactId);console.log(" :",le.map(xe=>{var Ve;return{id:xe.id,sent:xe.sent,read:xe.read,text:(Ve=xe.text)==null?void 0:Ve.substring(0,20)}})),await C.markMessagesAsRead(me.contactId),console.log("  markMessagesAsRead");const De=await C.getChatMessages(me.contactId);console.log(" :",De.map(xe=>{var Ve;return{id:xe.id,sent:xe.sent,read:xe.read,text:(Ve=xe.text)==null?void 0:Ve.substring(0,20)}})),console.log("  unreadCount = 0"),await b(me.id,{unreadCount:0}),console.log(" "),await i(),console.log(" ")}me.type==="single"?(console.log(" "),o("open-chat",{contactId:me.contactId,contactName:me.name,contactAvatar:me.avatar,isGroup:!1})):me.type==="group"&&(console.log(" "),o("open-chat",{groupId:me.groupId,isGroup:!0}))},Ie=me=>{if(!me)return"";const le=new Date(me),xe=new Date-le,Ve=Math.floor(xe/(1e3*60*60*24));return Ve===0?"":Ve===1?"":Ve<7?`${Ve}`:`${le.getMonth()+1}/${le.getDate()}`},$e=(me,le)=>{T.value=setTimeout(()=>{Ne(me,le)},500)},ye=()=>{T.value&&(clearTimeout(T.value),T.value=null)},Ne=(me,le)=>{var Ve,xt,yt,ce;T.value&&(clearTimeout(T.value),T.value=null),pe();const De=me.clientX||((xt=(Ve=me.touches)==null?void 0:Ve[0])==null?void 0:xt.clientX)||0,xe=me.clientY||((ce=(yt=me.touches)==null?void 0:yt[0])==null?void 0:ce.clientY)||0;A.value={show:!0,x:De,y:xe,item:le},setTimeout(()=>{document.addEventListener("click",Ee,{once:!0})},0)},Ee=()=>{A.value.show=!1},He=async me=>{try{await v(me.id),Ee(),pe()}catch(le){console.error(":",le),alert("")}},Ge=async me=>{if(confirm(`"${me.name}"`))try{await u(me.id),Ee(),pe()}catch(le){console.error(":",le),alert("")}},et=async()=>{console.log(" ");for(const me of a.value)if(me.type==="single"&&me.contactId){console.log(`
 : ${me.name} (contactId: ${me.contactId})`);const le=await C.getChatMessages(me.contactId);if(console.log(`   : ${le.length}`),le.length>0){const De=le[le.length-1];let xe="";De.type==="text"?xe=De.text:De.type==="image"?xe="[]":De.type==="transfer"?xe="[]":De.type==="voice"?xe="[]":De.type==="file"&&(xe="[]");const Ve=le.filter(yt=>yt.sent===!1&&(yt.read===!1||yt.read===void 0)),xt=Ve.length;console.log("   :"),console.log(`   - : ${le.filter(yt=>yt.sent===!1).length}`),console.log(`   - : ${xt}`),console.log("   - :",Ve.map(yt=>{var ce;return{id:yt.id,sent:yt.sent,read:yt.read,text:(ce=yt.text)==null?void 0:ce.substring(0,20)}})),await b(me.id,{lastMessage:xe,lastMessageTime:De.time,unreadCount:xt}),console.log(`    : ${xt}`)}}console.log(" ..."),await i(),console.log(` 
`)};return it(async()=>{console.log(" MessageList "),await Promise.all([l(),i()]),console.log(" "),await et(),console.log(" "),E.value=await C.getSetting("navAvatar")||"",m.value=await C.getSetting("navMoodText")||"",g.value=await C.getSetting("phoneContainerWallpaper")||"",ie(),F=setInterval(ie,6e4);const me=async()=>{console.log(" "),await i(),console.log(" ")};window.addEventListener("refresh-message-list",me),console.log(" "),window.__messageListRefreshCleanup=()=>{window.removeEventListener("refresh-message-list",me)},console.log(" MessageList ")}),zt(()=>{F&&clearInterval(F),F=null,window.__messageListRefreshCleanup&&(window.__messageListRefreshCleanup(),delete window.__messageListRefreshCleanup)}),(me,le)=>{var De;return p(),f("div",{class:"phone-container",style:Oe(re.value)},[e("div",Nu,[e("div",Ou,[e("span",null,_(D.value),1)]),le[18]||(le[18]=mt('<div class="status-bar-right" data-v-7ce53b9f><svg class="status-icon-svg" viewBox="0 0 24 24" data-v-7ce53b9f><path d="M20,20h2v-2h-2V20z M18,20h-2v-4h2V20z M14,20h-2v-6h2V20z M10,20H8v-8h2V20z M6,20H4v-10h2V20z" data-v-7ce53b9f></path></svg><svg class="status-icon-svg" viewBox="0 0 24 24" data-v-7ce53b9f><path d="M12,3C7.41,3,3.86,4.53,0.96,7.03L2.37,8.44C4.89,6.31,8.06,5,12,5s7.11,1.31,9.63,3.44l1.41-1.41C20.14,4.53,16.59,3,12,3z M12,7C9.3,7,6.81,7.89,4.8,9.4l1.4,1.4C7.6,9.67,9.69,9,12,9s4.4,0.67,5.8,1.8l1.4-1.4C17.19,7.89,14.7,7,12,7z M12,11c-1.94,0-3.5,0.5-4.7,1.3l1.4,1.4c0.8-0.5,2-0.7,3.3-0.7s2.5,0.2,3.3,0.7l1.4-1.4C15.5,11.5,13.94,11,12,11z M12,15c-0.85,0-1.5,0.15-2,0.4l2,2l2-2C13.5,15.15,12.85,15,12,15z" data-v-7ce53b9f></path></svg><svg class="status-icon-svg" viewBox="0 0 24 24" data-v-7ce53b9f><path d="M15.67,4H14V2h-4v2H8.33C7.6,4,7,4.6,7,5.33v15.33C7,21.4,7.6,22,8.33,22h7.33c0.74,0,1.33-0.6,1.33-1.33V5.33C17,4.6,16.4,4,15.67,4z M15,20H9V6h6V20z" data-v-7ce53b9f></path></svg></div>',1))]),e("div",zu,[e("div",Ku,[e("button",{class:"nav-back-avatar",type:"button",onClick:we,"aria-label":""},[E.value?(p(),f("img",{key:0,src:E.value,alt:""},null,8,Wu)):(p(),f("span",Gu))]),e("button",{class:"nav-status-text",type:"button",onClick:he},_(m.value||""),1)])]),e("div",qu,[(p(!0),f(Le,null,Fe(Ke(a),xe=>(p(),f("div",{key:xe.id,class:Se(["chat-list-item",{pinned:xe.isPinned}]),onClick:Ve=>Me(xe),onContextmenu:Pe(Ve=>Ne(Ve,xe),["prevent"]),onTouchstart:Ve=>$e(Ve,xe),onTouchend:ye},[e("img",{src:xe.avatar,class:"chat-avatar",alt:xe.name},null,8,Ju),e("div",Yu,[e("div",Xu,[e("span",Qu,_(xe.name)+_(xe.type==="group"?" ()":""),1),e("div",e1,[e("span",t1,_(Ie(xe.lastMessageTime)),1)])]),e("div",s1,[e("span",o1,_(xe.lastMessage||xe.bio||""),1)])])],42,Zu))),128)),A.value.show?(p(),f("div",{key:0,class:"context-menu",style:Oe({left:A.value.x+"px",top:A.value.y+"px"}),onClick:le[2]||(le[2]=Pe(()=>{},["stop"]))},[e("div",{class:"menu-item",onClick:le[0]||(le[0]=xe=>He(A.value.item))},[le[19]||(le[19]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})],-1)),e("span",null,_((De=A.value.item)!=null&&De.isPinned?"":""),1)]),e("div",{class:"menu-item delete",onClick:le[1]||(le[1]=xe=>Ge(A.value.item))},[...le[20]||(le[20]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1),e("span",null,"",-1)])])],4)):N("",!0)]),e("button",{class:"new-chat-btn",onClick:y},[...le[21]||(le[21]=[e("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])]),Z.value?(p(),f("div",{key:0,class:"modal-overlay",onClick:Pe(Ue,["self"])},[e("div",n1,[le[25]||(le[25]=e("div",{class:"modal-title"},"",-1)),e("div",a1,[e("div",l1,[le[22]||(le[22]=e("label",null,"",-1)),e("div",{class:"avatar-upload nav-avatar-upload",onClick:le[4]||(le[4]=()=>{var xe;return(xe=W.value)==null?void 0:xe.click()})},[R.value.avatar?(p(),f("img",{key:0,src:R.value.avatar},null,8,i1)):E.value?(p(),f("img",{key:1,src:E.value},null,8,r1)):(p(),f("span",c1,"")),e("input",{ref_key:"navAvatarInputRef",ref:W,type:"file",accept:"image/*",onClick:le[3]||(le[3]=Pe(()=>{},["stop"])),onChange:B,style:{display:"none"}},null,544)])]),e("div",d1,[le[23]||(le[23]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":le[5]||(le[5]=xe=>R.value.moodText=xe),type:"text",class:"form-input",placeholder:"..."},null,512),[[je,R.value.moodText]])]),e("div",u1,[le[24]||(le[24]=e("label",null,"",-1)),e("div",{class:"wallpaper-upload",onClick:le[6]||(le[6]=()=>{var xe;return(xe=te.value)==null?void 0:xe.click()})},[R.value.wallpaper?(p(),f("img",{key:0,src:R.value.wallpaper,class:"wallpaper-preview"},null,8,v1)):g.value?(p(),f("img",{key:1,src:g.value,class:"wallpaper-preview"},null,8,p1)):(p(),f("span",f1,"")),e("input",{ref_key:"navWallpaperInputRef",ref:te,type:"file",accept:"image/*",onChange:L,style:{display:"none"}},null,544)])])]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-cancel",onClick:Ue},""),e("button",{class:"btn btn-confirm",onClick:k},"")])])])):N("",!0),w.value?(p(),f("div",{key:1,class:"modal-overlay",onClick:Pe(H,["self"])},[e("div",m1,[e("div",g1,[e("div",{class:Se(["tab",{active:I.value==="contact"}]),onClick:le[7]||(le[7]=xe=>se("contact"))},"  ",2),e("div",{class:Se(["tab",{active:I.value==="group"}]),onClick:le[8]||(le[8]=xe=>se("group"))},"  ",2)]),e("div",h1,[ke(e("div",null,[e("div",y1,[le[26]||(le[26]=e("label",null,"",-1)),e("div",{class:"avatar-upload",onClick:le[11]||(le[11]=()=>{var xe;return(xe=x.value)==null?void 0:xe.click()})},[j.value.avatar?(p(),f("img",{key:0,src:j.value.avatar,id:"contactAvatarPreview"},null,8,b1)):(p(),f("span",w1,"")),e("input",{ref_key:"contactAvatarInputRef",ref:x,type:"file",id:"contactAvatarInput",accept:"image/*",onClick:le[9]||(le[9]=Pe(()=>{},["stop"])),onChange:le[10]||(le[10]=xe=>P(xe,"contact")),style:{display:"none"}},null,544)])]),e("div",k1,[le[27]||(le[27]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":le[12]||(le[12]=xe=>j.value.name=xe),type:"text",id:"contactName",class:"form-input",placeholder:""},null,512),[[je,j.value.name]])]),e("div",x1,[le[28]||(le[28]=e("label",null,"",-1)),ke(e("textarea",{"onUpdate:modelValue":le[13]||(le[13]=xe=>j.value.bio=xe),id:"contactBio",class:"form-textarea",placeholder:"..."},null,512),[[je,j.value.bio]])]),e("div",{class:"form-group"},[e("button",{class:"btn-import-character",onClick:K},"   (JSON) ")]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-cancel",onClick:H},""),e("button",{class:"btn btn-confirm",onClick:O},"  ")])],512),[[go,I.value==="contact"]]),ke(e("div",null,[e("div",C1,[le[29]||(le[29]=e("label",null,"",-1)),e("div",{class:"avatar-upload",onClick:le[16]||(le[16]=()=>{var xe;return(xe=S.value)==null?void 0:xe.click()})},[$.value.avatar?(p(),f("img",{key:0,src:$.value.avatar,id:"groupAvatarPreview"},null,8,$1)):(p(),f("span",_1,"")),e("input",{ref_key:"groupAvatarInputRef",ref:S,type:"file",id:"groupAvatarInput",accept:"image/*",onClick:le[14]||(le[14]=Pe(()=>{},["stop"])),onChange:le[15]||(le[15]=xe=>P(xe,"group")),style:{display:"none"}},null,544)])]),e("div",M1,[le[30]||(le[30]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":le[17]||(le[17]=xe=>$.value.name=xe),type:"text",id:"groupName",class:"form-input",placeholder:""},null,512),[[je,$.value.name]])]),e("div",S1,[le[32]||(le[32]=e("label",null,"",-1)),e("div",A1,[(p(!0),f(Le,null,Fe(Ke(n),xe=>(p(),f("div",{key:xe.id,class:Se(["selectable-contact",{selected:ae(xe.id)}]),onClick:Ve=>Q(xe.id)},[le[31]||(le[31]=e("div",{class:"checkbox-custom"},null,-1)),e("img",{src:xe.avatar,style:{width:"28px",height:"28px","border-radius":"50%","object-fit":"cover"}},null,8,L1),e("span",T1,_(xe.name),1)],10,I1))),128)),Ke(n).length===0?(p(),f("div",j1,' "" ')):N("",!0)])]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-cancel",onClick:H},""),e("button",{class:"btn btn-confirm",onClick:fe},"  ")])],512),[[go,I.value==="group"]])])])])):N("",!0),G.value?(p(),f("div",{key:2,class:"modal-overlay",onClick:Pe(q,["self"])},[e("div",P1,[Ye(Ru,{onSuccess:ee,onCancel:q})])])):N("",!0),e("audio",{ref_key:"clickSound",ref:M,preload:"auto"},[...le[33]||(le[33]=[e("source",{src:"https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3",type:"audio/mpeg"},null,-1)])],512)],4)}}},B1=Xe(E1,[["__scopeId","data-v-7ce53b9f"]]),V1={key:0,class:"mori-badge"},D1=["innerHTML"],H1={__name:"ChatBubble",props:{content:{type:String,required:!0},isSent:{type:Boolean,default:!1},type:{type:String,default:"text"},isMoriSent:{type:Boolean,default:!1}},setup(t){return(s,o)=>(p(),f("div",{class:Se(["chat-bubble",[t.type,{sent:t.isSent,received:!t.isSent,"mori-sent":t.isMoriSent}]])},[t.isMoriSent?(p(),f("div",V1,[...o[0]||(o[0]=[e("img",{src:"https://files.catbox.moe/f0p41u.png",class:"mori-icon",alt:"Mori"},null,-1),e("span",null,"Mori ",-1)])])):N("",!0),e("div",{class:"bubble-content",innerHTML:t.content},null,8,D1)],2))}},F1=Xe(H1,[["__scopeId","data-v-d645f373"]]),U1={key:0,class:"chat-add-menu"},R1={class:"modal modal-higher"},N1={class:"modal-body"},O1={class:"modal-hint"},z1={class:"modal modal-higher"},K1={class:"modal-body"},W1={class:"modal-hint"},G1={__name:"ChatAddMenu",props:{show:{type:Boolean,default:!1}},emits:["send-image","send-voice","send-call","send-video","send-file","send-location","send-takeout","send-transfer","send-emoji","open-emoji-manager"],setup(t,{expose:s,emit:o}){const n=o,a=h(null),l=h(null),i=h(null),r=h(null),c=h(!1),d=h(""),u=h(!1),v=h(!1),b=h(""),w=()=>{u.value=!0},I=m=>{const g=m.target.files[0];if(g){const D=new FileReader;D.onload=W=>{n("send-image",{file:g,url:W.target.result,name:g.name})},D.readAsDataURL(g)}m.target.value="",u.value=!1},j=()=>{var m;(m=l.value)==null||m.click()},$=()=>{u.value=!1,v.value=!0},x=()=>{v.value=!1,b.value=""},S=()=>{if(!b.value.trim()){alert("");return}const m=["https://files.catbox.moe/0g3kqu.jpg","https://files.catbox.moe/d5b7k6.jpg","https://files.catbox.moe/0yrhh6.jpg","https://files.catbox.moe/8mjvdg.jpg","https://files.catbox.moe/fvidas.jpg","https://files.catbox.moe/q6so2i.jpg","https://files.catbox.moe/5a96cp.jpg","https://files.catbox.moe/0mp6h0.jpg","https://files.catbox.moe/epcn03.jpg","https://files.catbox.moe/7jzdp7.jpg","https://files.catbox.moe/jrmu6w.jpg","https://files.catbox.moe/c0bwhn.jpg","https://files.catbox.moe/0blxme.jpg","https://files.catbox.moe/qicobr.jpg","https://files.catbox.moe/n94ztu.jpg"],g=m[Math.floor(Math.random()*m.length)];n("send-image",{url:g,name:"",isAiGenerated:!0,prompt:b.value.trim()}),x()},M=()=>{u.value=!1},A=()=>{var m;(m=i.value)==null||m.click()},T=m=>{const g=m.target.files[0];if(g){const D=new FileReader;D.onload=W=>{n("send-video",{file:g,url:W.target.result,name:g.name})},D.readAsDataURL(g)}m.target.value=""},G=()=>{var m;(m=r.value)==null||m.click()},K=m=>{const g=m.target.files[0];g&&n("send-file",{file:g,name:g.name,size:q(g.size)}),m.target.value=""},q=m=>m<1024?m+" B":m<1024*1024?(m/1024).toFixed(2)+" KB":(m/(1024*1024)).toFixed(2)+" MB",ee=()=>{c.value=!1,d.value=""},Z=()=>{c.value=!0},E=()=>{if(!d.value.trim()){alert("");return}const m=Math.max(1,Math.ceil(d.value.length/3));n("send-voice",{text:d.value.trim(),duration:m}),ee()};return s({openVoiceModal:Z}),(m,g)=>t.show?(p(),f("div",U1,[e("div",{class:"add-menu-scroll",ref_key:"menuScroll",ref:a},[e("div",{class:"add-menu-item",onClick:g[0]||(g[0]=D=>m.$emit("open-emoji-manager"))},[...g[7]||(g[7]=[e("div",{class:"add-menu-icon"},[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M12,2C6.477,2,2,6.477,2,12c0,5.523,4.477,10,10,10s10-4.477,10-10C22,6.477,17.523,2,12,2z M12,20c-4.418,0-8-3.582-8-8 s3.582-8,8-8s8,3.582,8,8S16.418,20,12,20z M15.5,11c0.828,0,1.5-0.672,1.5-1.5S16.328,8,15.5,8S14,8.672,14,9.5S14.672,11,15.5,11z M8.5,11c0.828,0,1.5-0.672,1.5-1.5S9.328,8,8.5,8S7,8.672,7,9.5S7.672,11,8.5,11z M12,17.5c2.33,0,4.31-1.46,5.11-3.5H6.89 C7.69,16.04,9.67,17.5,12,17.5z"})])],-1),e("span",null,"",-1)])]),e("div",{class:"add-menu-item",onClick:g[1]||(g[1]=D=>m.$emit("send-transfer"))},[...g[8]||(g[8]=[e("div",{class:"add-menu-icon"},[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,17L7,12L8.41,10.59L12,14.17L15.59,10.59L17,12M12,7L17,12L15.59,13.41L12,9.83L8.41,13.41L7,12L12,7Z"})])],-1),e("span",null,"",-1)])]),e("div",{class:"add-menu-item",onClick:w},[g[9]||(g[9]=e("div",{class:"add-menu-icon"},[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19M8.5,13.5L11,16.5L14.5,12L19,18H5L8.5,13.5Z"})])],-1)),g[10]||(g[10]=e("span",null,"",-1)),e("input",{ref_key:"imageInput",ref:l,type:"file",accept:"image/*",onChange:I,style:{display:"none"}},null,544)]),e("div",{class:"add-menu-item",onClick:g[2]||(g[2]=D=>m.$emit("send-call"))},[...g[11]||(g[11]=[e("div",{class:"add-menu-icon"},[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 0 0-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02c-.37-1.11-.56-2.3-.56-3.53c0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99C3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"})])],-1),e("span",null,"",-1)])]),e("div",{class:"add-menu-item",onClick:Z},[...g[12]||(g[12]=[e("div",{class:"add-menu-icon"},[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z"})])],-1),e("span",null,"",-1)])]),e("div",{class:"add-menu-item",onClick:A},[g[13]||(g[13]=e("div",{class:"add-menu-icon"},[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M17,10.5V7A1,1 0 0,0 16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5Z"})])],-1)),g[14]||(g[14]=e("span",null,"",-1)),e("input",{ref_key:"videoInput",ref:i,type:"file",accept:"video/*",onChange:T,style:{display:"none"}},null,544)]),e("div",{class:"add-menu-item",onClick:G},[g[15]||(g[15]=e("div",{class:"add-menu-icon"},[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})])],-1)),g[16]||(g[16]=e("span",null,"",-1)),e("input",{ref_key:"fileInput",ref:r,type:"file",onChange:K,style:{display:"none"}},null,544)]),e("div",{class:"add-menu-item",onClick:g[3]||(g[3]=D=>m.$emit("send-location"))},[...g[17]||(g[17]=[e("div",{class:"add-menu-icon"},[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z"})])],-1),e("span",null,"",-1)])]),e("div",{class:"add-menu-item",onClick:g[4]||(g[4]=D=>m.$emit("send-takeout"))},[...g[18]||(g[18]=[e("div",{class:"add-menu-icon"},[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M18.06 23H19.72C20.56 23 21.25 22.35 21.35 21.53L23 5.05H18V1H16.03V5.05H11.06L11.36 7.39C13.07 7.86 14.67 8.71 15.63 9.65C17.07 11.07 18.06 12.54 18.06 14.94V23M1 22V21H16.03V22C16.03 22.54 15.58 23 15 23H2C1.45 23 1 22.54 1 22M16.03 15C16.03 7 1 7 1 15H16.03M1 17H16V19H1V17Z"})])],-1),e("span",null,"",-1)])])],512),u.value?(p(),f("div",{key:0,class:"modal-overlay",onClick:Pe(M,["self"])},[e("div",{class:"modal"},[g[21]||(g[21]=e("div",{class:"modal-title"},"",-1)),e("div",{class:"modal-body"},[e("button",{class:"option-btn",onClick:j},[...g[19]||(g[19]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z"})],-1),e("span",null,"",-1)])]),e("button",{class:"option-btn",onClick:$},[...g[20]||(g[20]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7H14A7,7 0 0,1 21,14H22A1,1 0 0,1 23,15V18A1,1 0 0,1 22,19H21V20A2,2 0 0,1 19,22H5A2,2 0 0,1 3,20V19H2A1,1 0 0,1 1,18V15A1,1 0 0,1 2,14H3A7,7 0 0,1 10,7H11V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2M7.5,13A2.5,2.5 0 0,0 5,15.5A2.5,2.5 0 0,0 7.5,18A2.5,2.5 0 0,0 10,15.5A2.5,2.5 0 0,0 7.5,13M16.5,13A2.5,2.5 0 0,0 14,15.5A2.5,2.5 0 0,0 16.5,18A2.5,2.5 0 0,0 19,15.5A2.5,2.5 0 0,0 16.5,13Z"})],-1),e("span",null,"",-1)])])])])])):N("",!0),v.value?(p(),f("div",{key:1,class:"modal-overlay",onClick:Pe(x,["self"])},[e("div",R1,[g[22]||(g[22]=e("div",{class:"modal-title"},"",-1)),e("div",N1,[ke(e("textarea",{"onUpdate:modelValue":g[5]||(g[5]=D=>b.value=D),class:"modal-textarea",placeholder:"...",rows:"4",maxlength:"200"},null,512),[[je,b.value]]),e("div",O1,_(b.value.length)+"/200 ",1)]),e("div",{class:"modal-actions"},[e("button",{class:"modal-btn modal-btn-cancel",onClick:x},""),e("button",{class:"modal-btn modal-btn-confirm",onClick:S},"")])])])):N("",!0),c.value?(p(),f("div",{key:2,class:"modal-overlay",onClick:Pe(ee,["self"])},[e("div",z1,[g[23]||(g[23]=e("div",{class:"modal-title"},"",-1)),e("div",K1,[ke(e("textarea",{"onUpdate:modelValue":g[6]||(g[6]=D=>d.value=D),class:"modal-textarea",placeholder:"...",rows:"4",maxlength:"200"},null,512),[[je,d.value]]),e("div",W1,_(d.value.length)+"/200 ",1)]),e("div",{class:"modal-actions"},[e("button",{class:"modal-btn modal-btn-cancel",onClick:ee},""),e("button",{class:"modal-btn modal-btn-confirm",onClick:E},"")])])])):N("",!0)])):N("",!0)}},q1=Xe(G1,[["__scopeId","data-v-773a0fd5"]]),Z1={class:"modal contact-settings-modal"},J1={class:"settings-tabs"},Y1={key:0,class:"modal-body settings-scrollable"},X1={class:"form-group"},Q1={key:1},ev={class:"form-group"},tv={class:"form-group"},sv={class:"form-group"},ov=["value"],nv={class:"settings-section"},av={viewBox:"0 0 24 24",width:"20",height:"20",style:{color:"#999"}},lv={class:"form-group"},iv={class:"context-length-selector"},rv={class:"slider-container"},cv={class:"slider-value"},dv={class:"context-presets"},uv=["onClick"],vv={class:"form-group"},pv={class:"bubble-theme-selector"},fv=["onClick"],mv={class:"form-group"},gv=["src"],hv={key:1},yv={class:"settings-section danger"},bv={key:1,class:"modal-body settings-scrollable"},wv={class:"form-group"},kv={key:1},xv={class:"form-group"},Cv={key:1,class:"emoji-manager-fullscreen"},$v={class:"emoji-manager-container"},_v={class:"manager-header"},Mv={class:"emoji-grid-fullscreen"},Sv=["onClick"],Av=["src","alt"],Iv={class:"emoji-name-large"},Lv={key:0,class:"emoji-selected-mark"},Tv={key:0,class:"empty-state-large"},jv={class:"manager-footer-large"},Pv={class:"modal"},Ev={class:"modal-body"},Bv={class:"form-group"},Vv={key:0,class:"image-preview"},Dv=["src"],Hv={class:"form-group"},Fv={class:"modal modal-large"},Uv={class:"modal-body"},Rv={class:"form-group"},Nv={__name:"ContactSettings",props:{show:{type:Boolean,default:!1},contactId:{type:Number,required:!0},contactInfo:{type:Object,required:!0}},emits:["close","save-character","save-user","clear-history","block-contact","delete-contact"],setup(t,{emit:s}){const o=t,n=s,a=h("contact"),l=h({avatar:"",nickname:"",prompt:"",linkedWorldBook:"",bubbleTheme:"default",contextLength:20}),i=h({avatar:"",prompt:""}),r=h([]),c=h(""),d=h(""),u=h([]);h([]),h(!1);const v=h(!1),b=h(null),w=h(!1),I=h(!1),j=h(""),$=h(""),x=h(null),S=h(""),M=h(null),A=[{id:"default",name:"",gradient:"linear-gradient(135deg, #6c8cd5, #4a6fbf)"},{id:"pink",name:"",gradient:"linear-gradient(135deg, #ff6b9d, #c44569)"},{id:"green",name:"",gradient:"linear-gradient(135deg, #56ab2f, #a8e063)"},{id:"purple",name:"",gradient:"linear-gradient(135deg, #667eea, #764ba2)"},{id:"orange",name:"",gradient:"linear-gradient(135deg, #f093fb, #f5576c)"},{id:"cyan",name:"",gradient:"linear-gradient(135deg, #4facfe, #00f2fe)"},{id:"sunset",name:"",gradient:"linear-gradient(135deg, #fa709a, #fee140)"},{id:"forest",name:"",gradient:"linear-gradient(135deg, #134e5e, #71b280)"}],T=[{label:"",value:10},{label:"",value:15},{label:"",value:20},{label:"",value:30},{label:"",value:50}],G=h(null),K=h(null),q=h(null);Ft(()=>o.show,async y=>{y?(await ee(),await Z(),await E(),await R(),a.value="contact"):c.value=""});const ee=async()=>{try{const y=await C.getContact(o.contactId);y&&(l.value.avatar=y.avatar,l.value.nickname=y.name,l.value.prompt=y.prompt||y.bio||"",l.value.linkedWorldBook=y.linkedWorldBook||"",l.value.bubbleTheme=y.bubbleTheme||"default",l.value.contextLength=y.contextLength||20)}catch(y){console.error(":",y)}},Z=async()=>{try{r.value=await C.getWorldBookNames()}catch(y){console.error(":",y)}},E=async()=>{try{const y=await C.getUserSetting(o.contactId,"chatBackground");y&&(d.value=y)}catch(y){console.error(":",y)}},m=async()=>{a.value="user";try{const y=await C.getUserSetting(o.contactId,"avatar"),H=await C.getUserSetting(o.contactId,"prompt");y&&(i.value.avatar=y),H&&(i.value.prompt=H)}catch(y){console.error(":",y)}},g=(y,H)=>{const se=y.target;if(se.files&&se.files[0]){const P=new FileReader;P.onload=U=>{H==="character"?l.value.avatar=U.target.result:H==="user"&&(i.value.avatar=U.target.result)},P.readAsDataURL(se.files[0])}},D=y=>{const H=y.target;if(H.files&&H.files[0]){const se=new FileReader;se.onload=P=>{c.value=P.target.result},se.readAsDataURL(H.files[0])}},W=()=>{n("close")},te=async()=>{a.value==="contact"?n("save-character",{...l.value,backgroundPreview:c.value,customEmojis:u.value}):n("save-user",i.value)},R=async()=>{try{const y=await C.getContact(o.contactId);y&&y.customEmojis?u.value=y.customEmojis:u.value=[]}catch(y){console.error(":",y)}},F=()=>{v.value=!0,b.value=null},ie=()=>{v.value=!1,b.value=null},re=y=>{var H;((H=b.value)==null?void 0:H.id)===y.id?b.value=null:b.value=y},pe=()=>{b.value&&(u.value=u.value.filter(y=>y.id!==b.value.id),b.value=null)},we=()=>{w.value=!0},he=()=>{w.value=!1,j.value="",$.value="",x.value=null},Ue=y=>{const H=y.target.files[0];if(!H)return;x.value=H;const se=new FileReader;se.onload=P=>{$.value=P.target.result},se.readAsDataURL(H)},ge=()=>{if(!j.value.trim()){alert("");return}if(!$.value){alert("");return}const y={id:Date.now(),name:j.value.trim(),url:$.value,type:"base64",createdAt:Date.now()};u.value.push(y),he(),alert("")},B=()=>{I.value=!0},L=()=>{I.value=!1,S.value=""},k=()=>{if(!S.value.trim()){alert("");return}const y=S.value.trim().split(`
`);let H=0,se=0;for(const P of y){const U=P.trim();if(!U)continue;let O,Q;if(U.includes("")||U.includes(":")){const ae=U.split(/[:]/);O=ae[0].trim(),Q=ae[1].trim()}else{const ae=U.split(/\s+/);if(ae.length>=2)Q=ae[0].trim(),O=ae.slice(1).join(" ").trim();else{se++;continue}}if(O&&Q){const ae={id:Date.now()+H,name:O,url:Q,type:"link",createdAt:Date.now()};u.value.push(ae),H++}else se++}L(),alert(`
${H} 
${se} `)};return(y,H)=>(p(),f(Le,null,[t.show?(p(),f("div",{key:0,class:"modal-overlay",onClick:Pe(W,["self"])},[e("div",Z1,[H[34]||(H[34]=e("div",{class:"modal-title"},"",-1)),e("div",J1,[e("div",{class:Se(["tab-item",{active:a.value==="contact"}]),onClick:H[0]||(H[0]=se=>a.value="contact")},"  ",2),e("div",{class:Se(["tab-item",{active:a.value==="user"}]),onClick:m},"  ",2)]),a.value==="contact"?(p(),f("div",Y1,[e("div",X1,[H[16]||(H[16]=e("label",null,"",-1)),e("div",{class:"avatar-upload-circle",onClick:H[2]||(H[2]=()=>{var se;return(se=G.value)==null?void 0:se.click()})},[l.value.avatar?(p(),f("div",{key:0,class:"avatar-preview",style:Oe({backgroundImage:`url(${l.value.avatar})`})},null,4)):(p(),f("span",Q1,"")),e("input",{ref_key:"characterAvatarInputRef",ref:G,type:"file",accept:"image/*",onChange:H[1]||(H[1]=se=>g(se,"character")),style:{display:"none"}},null,544)])]),e("div",ev,[H[17]||(H[17]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":H[3]||(H[3]=se=>l.value.nickname=se),type:"text",class:"form-input",placeholder:""},null,512),[[je,l.value.nickname]])]),e("div",tv,[H[18]||(H[18]=e("label",null,"",-1)),ke(e("textarea",{"onUpdate:modelValue":H[4]||(H[4]=se=>l.value.prompt=se),class:"form-textarea",placeholder:"...",rows:"4"},null,512),[[je,l.value.prompt]])]),e("div",sv,[H[20]||(H[20]=e("label",null,"",-1)),ke(e("select",{"onUpdate:modelValue":H[5]||(H[5]=se=>l.value.linkedWorldBook=se),class:"form-input"},[H[19]||(H[19]=e("option",{value:""},"",-1)),(p(!0),f(Le,null,Fe(r.value,se=>(p(),f("option",{key:se,value:se},_(se),9,ov))),128))],512),[[Hs,l.value.linkedWorldBook]]),H[21]||(H[21]=e("div",{class:"form-hint"},"",-1))]),e("div",nv,[e("div",{class:"settings-item",onClick:F},[H[23]||(H[23]=e("span",null,"",-1)),(p(),f("svg",av,[...H[22]||(H[22]=[e("path",{fill:"currentColor",d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"},null,-1)])]))])]),e("div",lv,[H[24]||(H[24]=e("label",null," ",-1)),e("div",iv,[e("div",rv,[ke(e("input",{type:"range","onUpdate:modelValue":H[6]||(H[6]=se=>l.value.contextLength=se),min:"5",max:"50",step:"5",class:"context-slider"},null,512),[[je,l.value.contextLength,void 0,{number:!0}]]),e("div",cv,_(l.value.contextLength)+" ",1)]),e("div",dv,[(p(),f(Le,null,Fe(T,se=>e("button",{key:se.value,class:Se(["preset-btn",{active:l.value.contextLength===se.value}]),onClick:P=>l.value.contextLength=se.value},_(se.label),11,uv)),64))])]),H[25]||(H[25]=e("div",{class:"form-hint"},[ot("  AI  AI  "),e("br"),e("span",{style:{color:"#ff6b6b"}},"  AI ")],-1))]),e("div",vv,[H[26]||(H[26]=e("label",null,"",-1)),e("div",pv,[(p(),f(Le,null,Fe(A,se=>e("div",{key:se.id,class:Se(["bubble-theme-item",{active:l.value.bubbleTheme===se.id}]),onClick:P=>l.value.bubbleTheme=se.id},[e("div",{class:"theme-preview",style:Oe({background:se.gradient})},[e("span",null,_(se.name),1)],4)],10,fv)),64))]),H[27]||(H[27]=e("div",{class:"form-hint"},"",-1))]),e("div",mv,[H[28]||(H[28]=e("label",null,"",-1)),e("div",{class:"wallpaper-upload-small",onClick:H[7]||(H[7]=()=>{var se;return(se=q.value)==null?void 0:se.click()})},[c.value||d.value?(p(),f("img",{key:0,src:c.value||d.value,class:"wallpaper-preview-small"},null,8,gv)):(p(),f("span",hv,"")),e("input",{ref_key:"backgroundInputRef",ref:q,type:"file",accept:"image/*",onChange:D,style:{display:"none"}},null,544)])]),e("div",yv,[e("div",{class:"settings-item danger",onClick:H[8]||(H[8]=se=>y.$emit("clear-history"))},[...H[29]||(H[29]=[e("span",null,"",-1)])]),e("div",{class:"settings-item danger",onClick:H[9]||(H[9]=se=>y.$emit("block-contact"))},[...H[30]||(H[30]=[e("span",null,"",-1)])]),e("div",{class:"settings-item danger",onClick:H[10]||(H[10]=se=>y.$emit("delete-contact"))},[...H[31]||(H[31]=[e("span",null,"",-1)])])])])):N("",!0),a.value==="user"?(p(),f("div",bv,[e("div",wv,[H[32]||(H[32]=e("label",null,"",-1)),e("div",{class:"avatar-upload-circle",onClick:H[12]||(H[12]=()=>{var se;return(se=K.value)==null?void 0:se.click()})},[i.value.avatar?(p(),f("div",{key:0,class:"avatar-preview",style:Oe({backgroundImage:`url(${i.value.avatar})`})},null,4)):(p(),f("span",kv,"")),e("input",{ref_key:"userAvatarInputRef",ref:K,type:"file",accept:"image/*",onChange:H[11]||(H[11]=se=>g(se,"user")),style:{display:"none"}},null,544)])]),e("div",xv,[H[33]||(H[33]=e("label",null,"",-1)),ke(e("textarea",{"onUpdate:modelValue":H[13]||(H[13]=se=>i.value.prompt=se),class:"form-textarea",placeholder:"...",rows:"4"},null,512),[[je,i.value.prompt]])])])):N("",!0),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-cancel",onClick:W},"  "),e("button",{class:"btn btn-confirm",onClick:te},"  ")])])])):N("",!0),v.value?(p(),f("div",Cv,[e("div",$v,[e("div",_v,[e("button",{class:"back-btn",onClick:ie},[...H[35]||(H[35]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"})],-1)])]),e("h3",null,_(t.contactInfo.name)+" ",1),H[36]||(H[36]=e("div",{style:{width:"40px"}},null,-1))]),e("div",Mv,[(p(!0),f(Le,null,Fe(u.value,se=>{var P;return p(),f("div",{key:se.id,class:"emoji-card-large",onClick:U=>re(se)},[e("img",{src:se.url,alt:se.name,class:"emoji-image-large"},null,8,Av),e("div",Iv,_(se.name),1),((P=b.value)==null?void 0:P.id)===se.id?(p(),f("div",Lv,[...H[37]||(H[37]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"white",d:"M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"})],-1)])])):N("",!0)],8,Sv)}),128)),u.value.length===0?(p(),f("div",Tv,[...H[38]||(H[38]=[e("div",{class:"empty-icon"},"",-1),e("div",{class:"empty-text"},"",-1),e("div",{class:"empty-hint"},"",-1)])])):N("",!0)]),e("div",jv,[b.value?(p(),f("button",{key:0,class:"action-btn-large danger",onClick:pe},[...H[39]||(H[39]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"})],-1),e("span",null,"",-1)])])):(p(),f("button",{key:1,class:"action-btn-large",onClick:we},[...H[40]||(H[40]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z"})],-1),e("span",null,"",-1)])])),b.value?N("",!0):(p(),f("button",{key:2,class:"action-btn-large primary",onClick:B},[...H[41]||(H[41]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1),e("span",null,"",-1)])]))]),w.value?(p(),f("div",{key:0,class:"modal-overlay",onClick:Pe(he,["self"])},[e("div",Pv,[H[44]||(H[44]=e("div",{class:"modal-title"},"",-1)),e("div",Ev,[e("div",Bv,[H[42]||(H[42]=e("label",null,"",-1)),e("input",{ref_key:"fileInputRef",ref:M,type:"file",accept:"image/*",onChange:Ue,class:"file-input"},null,544),$.value?(p(),f("div",Vv,[e("img",{src:$.value,alt:""},null,8,Dv)])):N("",!0)]),e("div",Hv,[H[43]||(H[43]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":H[14]||(H[14]=se=>j.value=se),type:"text",class:"form-input",placeholder:""},null,512),[[je,j.value]])])]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-cancel",onClick:he},""),e("button",{class:"btn btn-confirm",onClick:ge},"")])])])):N("",!0),I.value?(p(),f("div",{key:1,class:"modal-overlay",onClick:Pe(L,["self"])},[e("div",Fv,[H[47]||(H[47]=e("div",{class:"modal-title"},"",-1)),e("div",Uv,[e("div",Rv,[H[45]||(H[45]=e("label",null,"",-1)),ke(e("textarea",{"onUpdate:modelValue":H[15]||(H[15]=se=>S.value=se),class:"form-textarea",rows:"10",placeholder:`


https://img.58sb.cn/file/img/jktb7oi4.jpg
https://img.58sb.cn/file/img/8hlgSoU0.jpg`},null,512),[[je,S.value]]),H[46]||(H[46]=e("div",{class:"hint-text"},"",-1))])]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-cancel",onClick:L},""),e("button",{class:"btn btn-confirm",onClick:k},"")])])])):N("",!0)])])):N("",!0)],64))}},Ov=Xe(Nv,[["__scopeId","data-v-164fd98b"]]),zv={class:"modal forward-modal"},Kv={class:"modal-body"},Wv={class:"contact-list"},Gv=["onClick"],qv=["src","alt"],Zv={class:"contact-name"},Jv={__name:"ForwardModal",props:{show:{type:Boolean,default:!1},selectedMessages:{type:Array,required:!0},currentContactInfo:{type:Object,required:!0},userAvatar:{type:String,required:!0}},emits:["close","forward-complete"],setup(t,{emit:s}){const o=t,n=s,a=h([]);Ft(()=>o.show,async d=>{d&&await l()});const l=async()=>{try{const d=await C.getContacts();a.value=d.filter(u=>u.id!==o.currentContactInfo.id)}catch(d){console.error(":",d)}},i=async d=>{try{const u=r(o.selectedMessages),v={id:Date.now(),type:"text",text:u.text,html:u.html,sent:!0,time:Date.now(),chatId:`chat_${d.id}`,isForwarded:!0};await C.addChatMessage(v);const w=(await C.getChatList()).find(I=>I.type==="single"&&I.contactId===d.id);w&&await C.updateChatListItem({...w,lastMessage:`[${o.selectedMessages.length}]`,lastMessageTime:Date.now()}),alert(` ${o.selectedMessages.length}  ${d.name}`),n("forward-complete")}catch(u){console.error(":",u),alert("")}},r=d=>{const u=[...d].sort((x,S)=>x.time-S.time),b=`[]
${u.map(x=>{const S=x.sent?"":o.currentContactInfo.name;let M="";return x.type==="text"?M=x.text:x.type==="image"?M="[]":x.type==="voice"?M="[]":x.type==="transfer"?M=`[${x.amount}]`:x.type==="file"&&(M=`[${x.fileName}]`),`${S}: ${M}`}).join(`
`)}`,w=u.map(x=>{const S=x.sent?"":o.currentContactInfo.name,M=x.sent?o.userAvatar:o.currentContactInfo.avatar;let A="";return x.type==="text"?A=x.text:x.type==="image"?A="[]":x.type==="voice"?A="[]":x.type==="transfer"?A=`[${x.amount}]`:x.type==="file"&&(A=`[${x.fileName}]`),{sender:S,avatar:M,content:A}}),j=`showForwardDetail_${Date.now()}`;window[j]=function(){const x=`
      <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;" onclick="this.remove()">
        <div style="background: white; border-radius: 16px; width: 85%; max-width: 400px; max-height: 70vh; display: flex; flex-direction: column; overflow: hidden;" onclick="event.stopPropagation()">
          <div style="padding: 16px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center;">
            <div>
              <div style="font-size: 16px; font-weight: 600; color: #333;"></div>
              <div style="font-size: 12px; color: #666; margin-top: 2px;"> ${o.currentContactInfo.name}</div>
            </div>
            <button onclick="this.closest('[style*=\\'position: fixed\\']').remove()" style="width: 32px; height: 32px; border: none; background: #f5f5f5; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; color: #666;"></button>
          </div>
          <div style="flex: 1; overflow-y: auto; padding: 16px;">
            ${w.map(S=>`
              <div style="display: flex; gap: 10px; align-items: flex-start; margin-bottom: 16px;">
                <img src="${S.avatar}" style="width: 32px; height: 32px; border-radius: 50%; flex-shrink: 0; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);" />
                <div style="flex: 1; min-width: 0;">
                  <div style="font-size: 12px; color: #6c8cd5; font-weight: 600; margin-bottom: 4px;">${S.sender}</div>
                  <div style="background: #f5f5f5; padding: 8px 12px; border-radius: 8px; font-size: 13px; color: #333; word-wrap: break-word;">${S.content}</div>
                </div>
              </div>
            `).join("")}
          </div>
        </div>
      </div>
    `;document.body.insertAdjacentHTML("beforeend",x)};const $=`
    <div class="forward-chat-card" onclick="window.${j}()" style="
      background: white;
      border-radius: 8px;
      padding: 12px;
      border: 1px solid #e5e5e5;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      cursor: pointer;
      transition: all 0.2s;
      max-width: 240px;
    " onmouseover="this.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.12)'" onmouseout="this.style.boxShadow='0 1px 3px rgba(0, 0, 0, 0.08)'">
      <div style="display: flex; align-items: center; gap: 10px;">
        <div style="width: 36px; height: 36px; background: #6c8cd5; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
          </svg>
        </div>
        <div style="flex: 1; min-width: 0;">
          <div style="font-size: 13px; font-weight: 600; color: #333; margin-bottom: 2px;"></div>
          <div style="font-size: 11px; color: #999;">${o.currentContactInfo.name}${d.length}</div>
        </div>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#999" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </div>
    </div>
  `;return{text:b,html:$}},c=()=>{n("close")};return(d,u)=>t.show?(p(),f("div",{key:0,class:"modal-overlay",onClick:Pe(c,["self"])},[e("div",zv,[u[0]||(u[0]=e("div",{class:"modal-title"},"",-1)),e("div",Kv,[e("div",Wv,[(p(!0),f(Le,null,Fe(a.value,v=>(p(),f("div",{key:v.id,class:"contact-item",onClick:b=>i(v)},[e("img",{src:v.avatar,class:"contact-avatar",alt:v.name},null,8,qv),e("span",Zv,_(v.name),1)],8,Gv))),128))])]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-cancel",onClick:c},"  ")])])])):N("",!0)}},Yv=Xe(Jv,[["__scopeId","data-v-2c050574"]]),Xv={class:"emoji-manager"},Qv={class:"manager-header"},ep=["onClick","onContextmenu"],tp=["src","alt"],sp={class:"emoji-name"},op={key:0,class:"empty-state"},np={class:"modal modal-large"},ap={class:"modal-body"},lp={class:"form-group"},ip={key:0,class:"emoji-preview-list"},rp={class:"preview-image-wrapper"},cp=["src","alt"],dp=["onClick"],up=["onUpdate:modelValue","placeholder"],vp={key:1,class:"empty-upload-state"},pp={class:"modal-actions"},fp=["disabled"],mp={class:"modal modal-large"},gp={class:"modal-body"},hp={class:"form-group"},yp={__name:"EmojiManager",props:{show:{type:Boolean,default:!1}},emits:["close","select"],setup(t,{emit:s}){const o=s,n=h([]),a=h(null),l=h(null),i=h(!1),r=h([]),c=h(!1),d=h(""),u=h(!1),v=h({x:0,y:0}),b=h(null),w=async()=>{try{const E=await C.getCustomEmojis();n.value=E||[]}catch(E){console.error(":",E)}},I=E=>{o("select",E),o("close")},j=()=>{i.value=!0},$=()=>{i.value=!1,r.value=[],l.value&&(l.value.value="")},x=()=>{var E;(E=l.value)==null||E.click()},S=E=>{const m=Array.from(E.target.files);m.length!==0&&m.forEach((g,D)=>{const W=new FileReader;W.onload=te=>{const R=g.name.replace(/\.[^/.]+$/,"");r.value.push({name:R,preview:te.target.result,file:g})},W.readAsDataURL(g)})},M=E=>{r.value.splice(E,1)},A=async()=>{if(r.value.length===0){alert("");return}const E=r.value.filter(m=>!m.name.trim()).length;if(!(E>0&&!confirm(` ${E} `)))try{let m=0,g=0;for(let D=0;D<r.value.length;D++){const W=r.value[D],te=W.name.trim()||`_${Date.now()}_${D}`;try{await C.addCustomEmoji({name:te,url:W.preview,type:"base64",createdAt:Date.now()}),m++}catch(R){console.error(":",te,R),g++}}await w(),$(),alert(g===0?` ${m} `:`
${m} 
${g} `)}catch(m){console.error(":",m),alert("")}},T=()=>{c.value=!0},G=()=>{c.value=!1,d.value=""},K=async()=>{if(!d.value.trim()){alert("");return}try{const E=d.value.trim().split(`
`);let m=0,g=0;for(const D of E){const W=D.trim();if(!W)continue;let te,R;if(W.includes("")||W.includes(":")){const F=W.split(/[:]/);te=F[0].trim(),R=F[1].trim()}else{const F=W.split(/\s+/);if(F.length>=2)R=F[0].trim(),te=F.slice(1).join(" ").trim();else{g++;continue}}if(te&&R)try{await C.addCustomEmoji({name:te,url:R,type:"link",createdAt:Date.now()}),m++}catch(F){console.error(":",te,F),g++}else g++}await w(),G(),alert(`
${m} 
${g} `)}catch(E){console.error(":",E),alert("")}},q=(E,m)=>{b.value=m,v.value={x:Math.min(E.clientX,window.innerWidth-150),y:Math.min(E.clientY,window.innerHeight-100)},u.value=!0},ee=async()=>{if(b.value&&confirm(`"${b.value.name}"`))try{await C.deleteCustomEmoji(b.value.id),await w(),u.value=!1}catch(E){console.error(":",E),alert("")}},Z=()=>{u.value=!1,b.value=null};return it(()=>{w(),document.addEventListener("click",E=>{u.value&&!E.target.closest(".emoji-menu")&&Z()})}),(E,m)=>t.show?(p(),f("div",{key:0,class:"emoji-manager-overlay",onClick:m[2]||(m[2]=Pe(g=>E.$emit("close"),["self"]))},[e("div",Xv,[e("div",Qv,[m[3]||(m[3]=e("h3",null,"",-1)),e("button",{class:"close-btn",onClick:m[0]||(m[0]=g=>E.$emit("close"))},"")]),e("div",{class:"emoji-grid",ref_key:"emojiGridRef",ref:a},[(p(!0),f(Le,null,Fe(n.value,g=>(p(),f("div",{key:g.id,class:"emoji-card",onClick:D=>I(g),onContextmenu:Pe(D=>q(D,g),["prevent"])},[e("img",{src:g.url,alt:g.name,class:"emoji-image"},null,8,tp),e("div",sp,_(g.name),1)],40,ep))),128)),n.value.length===0?(p(),f("div",op,[...m[4]||(m[4]=[e("div",{class:"empty-icon"},"",-1),e("div",{class:"empty-text"},"",-1)])])):N("",!0)],512),e("div",{class:"manager-footer"},[e("button",{class:"action-btn",onClick:j},[...m[5]||(m[5]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z"})],-1),e("span",null,"",-1)])]),e("button",{class:"action-btn primary",onClick:T},[...m[6]||(m[6]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1),e("span",null,"",-1)])])]),i.value?(p(),f("div",{key:0,class:"modal-overlay",onClick:Pe($,["self"])},[e("div",np,[m[11]||(m[11]=e("div",{class:"modal-title"},"",-1)),e("div",ap,[e("div",lp,[e("button",{class:"select-files-btn",onClick:x},[...m[7]||(m[7]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z"})],-1),e("span",null,"",-1)])]),e("input",{ref_key:"fileInputRef",ref:l,type:"file",accept:"image/*",multiple:"",onChange:S,style:{display:"none"}},null,544),m[8]||(m[8]=e("div",{class:"hint-text"},"",-1))]),r.value.length>0?(p(),f("div",ip,[(p(!0),f(Le,null,Fe(r.value,(g,D)=>(p(),f("div",{key:D,class:"emoji-preview-item"},[e("div",rp,[e("img",{src:g.preview,alt:g.name,class:"preview-image"},null,8,cp),e("button",{class:"remove-btn",onClick:W=>M(D)},[...m[9]||(m[9]=[e("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},[e("path",{fill:"currentColor",d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})],-1)])],8,dp)]),ke(e("input",{"onUpdate:modelValue":W=>g.name=W,type:"text",class:"emoji-name-input",placeholder:` ${D+1}`},null,8,up),[[je,g.name]])]))),128))])):(p(),f("div",vp,[...m[10]||(m[10]=[e("div",{class:"empty-icon"},"",-1),e("div",{class:"empty-text"},"",-1)])]))]),e("div",pp,[e("button",{class:"btn btn-cancel",onClick:$},""),e("button",{class:"btn btn-confirm",onClick:A,disabled:r.value.length===0},"  ("+_(r.value.length)+") ",9,fp)])])])):N("",!0),c.value?(p(),f("div",{key:1,class:"modal-overlay",onClick:Pe(G,["self"])},[e("div",mp,[m[14]||(m[14]=e("div",{class:"modal-title"},"",-1)),e("div",gp,[e("div",hp,[m[12]||(m[12]=e("label",null,"",-1)),ke(e("textarea",{"onUpdate:modelValue":m[1]||(m[1]=g=>d.value=g),class:"form-textarea",rows:"10",placeholder:`


https://img.58sb.cn/file/img/jktb7oi4.jpg
https://img.58sb.cn/file/img/8hlgSoU0.jpg
https://img.58sb.cn/file/img/C5o7L9vf.jpg`},null,512),[[je,d.value]]),m[13]||(m[13]=e("div",{class:"hint-text"},"",-1))])]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-cancel",onClick:G},""),e("button",{class:"btn btn-confirm",onClick:K},"")])])])):N("",!0),u.value?(p(),f("div",{key:2,class:"emoji-menu",style:Oe({top:v.value.y+"px",left:v.value.x+"px"})},[e("div",{class:"menu-item",onClick:ee},[...m[15]||(m[15]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18"},[e("path",{fill:"currentColor",d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"})],-1),e("span",null,"",-1)])])],4)):N("",!0)])])):N("",!0)}},bp=Xe(yp,[["__scopeId","data-v-dd5eed6c"]]),wp="modulepreload",kp=function(t){return"/"+t},_l={},Kt=function(s,o,n){let a=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),r=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));a=Promise.allSettled(o.map(c=>{if(c=kp(c),c in _l)return;_l[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const v=document.createElement("link");if(v.rel=d?"stylesheet":wp,d||(v.as="script"),v.crossOrigin="",v.href=c,r&&v.setAttribute("nonce",r),document.head.appendChild(v),d)return new Promise((b,w)=>{v.addEventListener("load",b),v.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${c}`)))})}))}function l(i){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=i,window.dispatchEvent(r),!r.defaultPrevented)throw i}return a.then(i=>{for(const r of i||[])r.status==="rejected"&&l(r.reason);return s().catch(l)})};class xp{constructor(){this.isBackgroundRunning=!1,this.backgroundInterval=null}normalizeBaseUrl(s){return s?s.endsWith("/v1")?s.slice(0,-3):s.endsWith("/")?s.slice(0,-1):s:""}buildApiUrl(s,o,n){return s?`${this.normalizeBaseUrl(s)}${n}`:`${{deepseek:"https://api.deepseek.com",gemini:"https://generativelanguage.googleapis.com",openai:"https://api.openai.com"}[o]}${n}`}async getApiConfig(){return await C.getSetting("apiConfig")||{provider:"deepseek",apiKey:"",baseUrl:"",model:""}}async saveApiConfig(s){try{await C.setSetting("apiConfig",s),console.log("API :",s)}catch(o){throw console.error(" API :",o),o}}async fetchModels(s,o,n){var l;const a=this.buildApiUrl(n,s,"/v1/models");console.log(" ..."),console.log(" URL:",a),console.log(" Provider:",s),console.log(" BaseUrl:",n);try{const i=await fetch(a,{method:"GET",headers:{Authorization:`Bearer ${o}`}});if(console.log(" :",i.status,i.statusText),!i.ok){const c=await i.text().catch(()=>"");throw console.error(" :",{status:i.status,statusText:i.statusText,url:a,errorText:c}),i.status===0||c.includes("CORS")?new Error(`
1. 
2. ${a}
3. `):i.status===404?new Error(`
${a}
`):i.status===401||i.status===403?new Error(`
API Key 
${i.status}`):new Error(`HTTP ${i.status}: ${c||i.statusText}`)}const r=await i.json();return console.log(" :",((l=r.data)==null?void 0:l.length)||0),r.data||[]}catch(i){throw console.error(" :",{error:i.message,url:a,provider:s,baseUrl:n}),i.message.includes("Failed to fetch")||i.message.includes("NetworkError")?new Error(` 

${a}


1. 
2.  127.0.0.1
3. 

 
-  127.0.0.1  IP
- http://192.168.1.100:8888`):i}}extractValidContent(s){if(!s)return"";if(!s.includes("[")&&!s.includes("{"))return s.trim();const o=s.match(/\[[\s\S]*\]/);if(o)try{const a=JSON.parse(o[0]);if(Array.isArray(a))return a.join(`
`)}catch{}const n=s.match(/\{[\s\S]*\}/);if(n)try{const a=JSON.parse(n[0]);if(a.content)return a.content;if(a.text)return a.text;if(a.message)return a.message}catch{}return s=s.replace(/```json\s*/g,"").replace(/```\s*/g,""),s=s.replace(/\\n/g,`
`).replace(/\\"/g,'"'),s.trim()}async sendWithRetry(s,o,n,a=3){var i,r,c,d;let l=null;for(let u=1;u<=a;u++)try{console.log(`  ( ${u}/${a} )...`);const v=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.apiKey}`},body:JSON.stringify({model:o.model,messages:n,temperature:.8,max_tokens:2e3,stream:!1,top_p:.9})}),b=await v.text();if(console.log(`  (: ${v.status}):`,b.substring(0,200)),!v.ok)throw new Error(`HTTP ${v.status}: ${b}`);let w;try{w=JSON.parse(b)}catch(j){console.warn(" JSON ...");const $=this.extractValidContent(b);if($)return $;throw new Error(`: ${j.message}`)}let I=null;if(w.choices&&w.choices[0]&&(I=((i=w.choices[0].message)==null?void 0:i.content)||w.choices[0].text),!I&&w.candidates&&w.candidates[0]&&(I=(d=(c=(r=w.candidates[0].content)==null?void 0:r.parts)==null?void 0:c[0])==null?void 0:d.text),!I&&w.content&&(I=w.content),!I&&w.text&&(I=w.text),I||(console.warn(" ..."),I=this.extractValidContent(JSON.stringify(w))),!I)throw new Error("");return console.log(" :",I.substring(0,100)),I}catch(v){if(l=v,console.error(`  ${u} :`,v.message),u<a){const b=u*1e3;console.log(`  ${b}ms ...`),await new Promise(w=>setTimeout(w,b))}}throw new Error(` ${a} : ${l.message}`)}async sendMessage(s,o,n){const a=await this.getApiConfig();if(!a.apiKey||!a.model)throw new Error(" API ");const l=this.buildApiUrl(a.baseUrl,a.provider,"/v1/chat/completions"),i=await C.getUserSetting(o,"prompt"),r=await this.getWorldBookContext(o,s),c=await this.getAvailableEmojis(o),u=[{role:"system",content:await this.buildEnhancedSystemPrompt(n,i,r,c)},...s];try{const v=await this.sendWithRetry(l,a,u);return this.extractValidContent(v)}catch(v){throw console.error(" :",v),v}}async buildEnhancedSystemPrompt(s,o,n,a){const l=await this.getMusicPlaylistInfo();return this.buildSystemPrompt(s,o,n,a,l)+`

 AI
- 
- 
- 
- 

 AI `}async getMusicPlaylistInfo(){try{const s=(await Kt(async()=>{const{default:i}=await Promise.resolve().then(()=>_p);return{default:i}},void 0)).default,o=await s.getAllPlaylists();if(!o||o.length===0)return null;let n=[];for(const i of o){const r=await s.getSongsInPlaylist(i.id);n=n.concat(r.map(c=>({title:c.title,artist:c.artist,playlistName:i.name,hasLyrics:!!c.lyrics,lyrics:c.lyrics||""})))}const a=o.map(i=>{var r;return`${i.name}${((r=i.songs)==null?void 0:r.length)||0}`}).join(""),l=n.map(i=>`${i.title}- ${i.artist}`).join("");return{playlistInfo:a,songList:l,allSongs:n,totalSongs:n.length}}catch(s){return console.error(":",s),null}}async findSongLyrics(s){try{const o=await this.getMusicPlaylistInfo();if(!o||!o.allSongs)return null;const n=o.allSongs.find(a=>a.title.includes(s)||s.includes(a.title));return(n==null?void 0:n.lyrics)||null}catch(o){return console.error(":",o),null}}async getAvailableEmojis(s){try{const o=await C.getContact(s);let n=[];o&&o.customEmojis&&o.customEmojis.length>0&&(n=[...o.customEmojis]);const a=await C.getCustomEmojis();if(a&&a.length>0){const l=new Set(n.map(i=>i.name));for(const i of a)l.has(i.name)||n.push(i)}return n}catch(o){return console.error(":",o),[]}}async getWorldBookContext(s,o){try{const n=await C.getContact(s);if(console.log(" [] :",n),!n||!n.linkedWorldBook)return console.warn(" [] "),console.log("   - ID:",s),console.log("   - :",n==null?void 0:n.name),console.log("   - :",n==null?void 0:n.linkedWorldBook),null;console.log(" [] :",n.linkedWorldBook);const a=o.slice(-5).map(c=>c.content).join(" ");console.log(" [] :",a);const l=await C.matchWorldBookEntries(n.linkedWorldBook,a);if(console.log(" [] :",l.length),l.length>0)console.log(" [] :",l.map(c=>({keys:c.keys,content:c.content.substring(0,50)+"...",enabled:c.enabled})));else{console.warn(" [] ");const c=await C.getWorldBookEntries(n.linkedWorldBook);console.log(" [] :",c.map(d=>({keys:d.keys,enabled:d.enabled,content:d.content.substring(0,30)+"..."})))}if(l.length===0)return null;const r=l.map(c=>c.content).join(`

`);return console.log(" [] :",r.length,""),r}catch(n){return console.error(" [] :",n),null}}buildSystemPrompt(s,o,n,a,l){let r=`
1) "//"[]()**
2) 
3) 1-201-3
4) 1-2
5) AI
6) 7
7) 
8) 
   - []
   - []
   - [||]
   - []
   - [|]
   - []
   - []
   - [||]
   - [||]
   - []
   - [|]
   
   
   []
   []
   [|25.8|]
   []
   [100|]
   []
   []
   [.docx|2.5MB|]
   [|22C|]
   []
   [|   ]
   
   
   - []
   - []
   - []
   - [||][|]
   - [||]
   - []
   - [||]
   - []
   - []
   - [|]
   
   
   - [xxx][xxx][xxx]
   - 
   - 
   - 
   - 
   - "[]""[]""["`;if(a&&a.length>0){const c=a.map(d=>d.name).join("");r+=`

[]
${c}

`}if(l&&l.totalSongs>0&&(r+=`

${l.totalSongs}
${l.songList}

[][|]`),n&&(r+=`


${n}`),s)if(s.prompt)r+=`


${s.prompt}

`;else{const c=s.name||"",d=s.personality||"",u=s.description||s.bio||"",v=s.speakingStyle||"";(d||u||v)&&(r+=`


`,r+=`${c}
`,d&&(r+=`${d}
`),u&&(r+=`/${u}
`),v&&(r+=`${v}
`),r+=`
`)}return o&&(r+=`


${o}`),r}splitMessages(s){if(!s||typeof s!="string")return[""];s=s.trim();const o=[],n=/\[(||||||||||)[^\]]+\]/g,l=s.replace(n,r=>{const c=o.length;return o.push(r),`__SPECIAL_${c}__`}).split(new RegExp("(?<=[])\\s*","g")),i=[];for(let r of l){if(r=r.trim(),!r)continue;const c=r.split(/(__SPECIAL_\d+__)/g);for(let d of c)if(d=d.trim(),!!d)if(d.startsWith("__SPECIAL_")){const u=d.match(/__SPECIAL_(\d+)__/);if(u){const v=o[parseInt(u[1])];v&&i.push(v)}}else i.push(d)}return i.length===0?[s]:i}async startBackgroundMessages(){if(this.isBackgroundRunning)return;this.isBackgroundRunning=!0,await C.setSetting("backgroundMessagesEnabled",!0);const s=()=>{const o=Math.random()*10*60*1e3+3e5;this.backgroundInterval=setTimeout(async()=>{await this.sendBackgroundMessage(),this.isBackgroundRunning&&s()},o)};s()}async stopBackgroundMessages(){this.isBackgroundRunning=!1,await C.setSetting("backgroundMessagesEnabled",!1),this.backgroundInterval&&(clearTimeout(this.backgroundInterval),this.backgroundInterval=null)}async sendBackgroundMessage(){console.log("...")}async getBackgroundStatus(){return await C.getSetting("backgroundMessagesEnabled")}}const Wt=new xp,fa=Object.freeze(Object.defineProperty({__proto__:null,aiService:Wt},Symbol.toStringTag,{value:"Module"}));class Cp{constructor(){this.notifications=[],this.listeners=[],this.maxNotifications=1,this.currentPage="home",this.currentChatId=null}setCurrentPage(s){this.currentPage=s}setCurrentChatId(s){this.currentChatId=s}addNotification(s){if(this.currentPage==="chat"&&this.currentChatId===s.contactId)return;const o={id:Date.now(),...s,timestamp:Date.now()};this.notifications=[o],this.notifyListeners(),setTimeout(()=>{this.removeNotification(o.id)},5e3),this.playNotificationSound()}removeNotification(s){const o=this.notifications.findIndex(n=>n.id===s);o>-1&&(this.notifications.splice(o,1),this.notifyListeners())}clearAll(){this.notifications=[],this.notifyListeners()}addListener(s){this.listeners.push(s)}removeListener(s){const o=this.listeners.indexOf(s);o>-1&&this.listeners.splice(o,1)}notifyListeners(){this.listeners.forEach(s=>{s(this.notifications)})}playNotificationSound(){try{const s=new Audio("https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3");s.volume=.3,s.play().catch(()=>{})}catch{console.log("")}}formatMessageContent(s){if(!s)return"";switch(s.type||"text"){case"text":const n=s.text||s.content||"";return n.length>30?n.substring(0,30)+"...":n;case"image":return" []";case"voice":return" []";case"video":return" []";case"file":return" []";case"location":return" []";case"takeout":return" []";case"transfer":return" []";default:return s.text||"[]"}}formatTime(s){const n=Date.now()-s;if(n<6e4)return"";if(n<36e5)return`${Math.floor(n/6e4)}`;if(n<864e5)return`${Math.floor(n/36e5)}`;{const a=new Date(s);return`${a.getMonth()+1}${a.getDate()}`}}}const Ht=new Cp,Ct=new Audio;Ct.preload="auto";const Ae=In({currentSong:null,playlist:[],currentIndex:-1,isPlaying:!1,currentTime:0,duration:0,volume:1,loopMode:"list",isFavorite:!1,listenTogether:{active:!1,character:null,friendAvatar:null,startTime:null,elapsedTime:0},showGlobalLyrics:!1});Ct.addEventListener("loadedmetadata",()=>{Ae.duration=Ct.duration});Ct.addEventListener("timeupdate",()=>{if(Ae.currentTime=Ct.currentTime,Ae.listenTogether.active&&Ae.isPlaying){const t=Date.now();Ae.listenTogether.startTime&&(Ae.listenTogether.elapsedTime=Math.floor((t-Ae.listenTogether.startTime)/1e3))}});Ct.addEventListener("ended",()=>{Pt.next()});Ct.addEventListener("play",()=>{Ae.isPlaying=!0});Ct.addEventListener("pause",()=>{Ae.isPlaying=!1});Ct.addEventListener("error",t=>{console.error(":",t),Ae.isPlaying=!1});const Pt={playSong(t,s=null){t&&(Ae.currentSong=t,s&&Array.isArray(s)?(Ae.playlist=s,Ae.currentIndex=s.findIndex(o=>o.id===t.id)):Ae.playlist.length===0&&(Ae.playlist=[t],Ae.currentIndex=0),t.url?(Ct.src=t.url,Ct.load(),Ct.play().catch(o=>{console.error(":",o)})):console.error("URL:",t))},togglePlay(){Ae.currentSong&&(Ae.isPlaying?Ct.pause():Ct.play().catch(t=>{console.error(":",t)}))},pause(){Ct.pause()},play(){Ae.currentSong&&Ct.play().catch(t=>{console.error(":",t)})},previous(){if(Ae.playlist.length===0)return;let t;Ae.loopMode==="random"?t=Math.floor(Math.random()*Ae.playlist.length):(t=Ae.currentIndex-1,t<0&&(t=Ae.playlist.length-1)),Ae.currentIndex=t,this.playSong(Ae.playlist[t])},next(){if(Ae.playlist.length===0)return;let t;if(Ae.loopMode==="single"){Ct.currentTime=0,Ct.play();return}else Ae.loopMode==="random"?t=Math.floor(Math.random()*Ae.playlist.length):(t=Ae.currentIndex+1,t>=Ae.playlist.length&&(t=0));Ae.currentIndex=t,this.playSong(Ae.playlist[t])},seek(t){Ct.duration&&(Ct.currentTime=Math.max(0,Math.min(t,Ct.duration)))},setVolume(t){Ae.volume=Math.max(0,Math.min(1,t)),Ct.volume=Ae.volume},toggleLoopMode(){const t=["list","random","single"],s=t.indexOf(Ae.loopMode);return Ae.loopMode=t[(s+1)%t.length],Ae.loopMode},setPlaylist(t,s=0){Ae.playlist=t,Ae.currentIndex=s,t.length>0&&this.playSong(t[s],t)},addToPlaylist(t){Ae.playlist.find(s=>s.id===t.id)||Ae.playlist.push(t)},removeFromPlaylist(t){if(t>=0&&t<Ae.playlist.length)if(Ae.playlist.splice(t,1),t===Ae.currentIndex)if(Ae.playlist.length>0){const s=Math.min(t,Ae.playlist.length-1);Ae.currentIndex=s,this.playSong(Ae.playlist[s])}else Ae.currentSong=null,Ae.currentIndex=-1,Ct.pause(),Ct.src="";else t<Ae.currentIndex&&Ae.currentIndex--},removeFromPlaylistById(t){const s=Ae.playlist.findIndex(o=>o.id===t);s!==-1&&this.removeFromPlaylist(s)},clearPlaylist(){Ae.playlist=[],Ae.currentIndex=-1,Ae.currentSong=null,Ct.pause(),Ct.src=""},playAtIndex(t){t>=0&&t<Ae.playlist.length&&(Ae.currentIndex=t,this.playSong(Ae.playlist[t]))},_removeFromPlaylistOld(t){const s=Ae.playlist.findIndex(o=>o.id===t);s!==-1&&this.removeFromPlaylist(s)},stop(){Ct.pause(),Ct.currentTime=0,Ae.currentSong=null,Ae.isPlaying=!1},toggleFavorite(){return Ae.isFavorite=!Ae.isFavorite,Ae.isFavorite},startListenTogether(t,s=null){Ae.listenTogether.isActive=!0,Ae.listenTogether.roomId=Math.random().toString(36).substr(2,6).toUpperCase(),Ae.listenTogether.startTime=Date.now(),Ae.listenTogether.elapsedTime=0,Ae.listenTogether.character=t,s&&this.playSong(s)},startListenTogether(t){Ae.listenTogether.active=!0,Ae.listenTogether.character=t,Ae.listenTogether.friendAvatar=t.avatar,Ae.listenTogether.startTime=Date.now(),Ae.listenTogether.elapsedTime=0},endListenTogether(){Ae.listenTogether.active=!1,Ae.listenTogether.character=null,Ae.listenTogether.friendAvatar=null,Ae.listenTogether.startTime=null,Ae.listenTogether.elapsedTime=0},updateListenTogetherTime(){if(Ae.listenTogether.active&&Ae.listenTogether.startTime){const t=Date.now();Ae.listenTogether.elapsedTime=Math.floor((t-Ae.listenTogether.startTime)/1e3)}},formatTime(t){if(!t||isNaN(t))return"0:00";const s=Math.floor(t/60),o=Math.floor(t%60);return`${s}:${o.toString().padStart(2,"0")}`},toggleGlobalLyrics(){return Ae.showGlobalLyrics=!Ae.showGlobalLyrics,Ae.showGlobalLyrics}},qo=dn(Ae);Ft(()=>Ae.loopMode,t=>{localStorage.setItem("musicLoopMode",t)});Ft(()=>Ae.volume,t=>{localStorage.setItem("musicVolume",t.toString())});const Ml=localStorage.getItem("musicLoopMode");Ml&&(Ae.loopMode=Ml);const Sl=localStorage.getItem("musicVolume");if(Sl){const t=parseFloat(Sl);Ae.volume=t,Ct.volume=t}class $p{async getUserConfig(){return await C.getSetting("musicUserConfig")||{wallpaper:"https://picsum.photos/1080/1920?random=33",uiColor:"#000000",opacity:.4,textColor:"#ffffff"}}async saveUserConfig(s){await C.setSetting("musicUserConfig",s)}async getPlaylist(s){return(await C.getSetting("musicPlaylists")||[]).find(n=>n.id===s)}async getSongsInPlaylist(s){return(await C.getSetting("musicSongs")||[]).filter(n=>n.playlistId===s)}async updatePlaylist(s,o){const n=await C.getSetting("musicPlaylists")||[],a=n.findIndex(l=>l.id===s);a!==-1&&(n[a]={...n[a],...o},await C.setSetting("musicPlaylists",n))}async deletePlaylist(s){const n=(await C.getSetting("musicPlaylists")||[]).filter(i=>i.id!==s);await C.setSetting("musicPlaylists",n);const l=(await C.getSetting("musicSongs")||[]).filter(i=>i.playlistId!==s);await C.setSetting("musicSongs",l)}async incrementPlayCount(s){const o=await C.getSetting("musicPlaylists")||[],n=o.findIndex(a=>a.id===s);n!==-1&&(o[n].playCount=(o[n].playCount||0)+1,await C.setSetting("musicPlaylists",o))}async deleteSongFromPlaylist(s){const n=(await C.getSetting("musicSongs")||[]).filter(a=>a.id!==s);await C.setSetting("musicSongs",n)}async addSongToPlaylist(s,o){const n=await C.getSetting("musicSongs")||[],a={...o,id:Date.now(),playlistId:s};return n.push(a),await C.setSetting("musicSongs",n),a}async getAllPlaylists(){return await C.getSetting("musicPlaylists")||[]}async createPlaylist(s){const o=await C.getSetting("musicPlaylists")||[],n={...s,id:Date.now(),playCount:0,isCollected:!1,songs:[]};return o.push(n),await C.setSetting("musicPlaylists",o),n}async saveMusicActivity(s){const o=await C.getSetting("musicActivities")||[],n={...s,id:Date.now()};return o.unshift(n),o.length>50&&o.splice(50),await C.setSetting("musicActivities",o),n}async getMusicActivities(s=null){const o=await C.getSetting("musicActivities")||[];return s?o.filter(n=>n.characterId===s):o}async clearMusicActivities(){await C.setSetting("musicActivities",[])}async saveRankingSettings(s){await C.setSetting("musicRankingSettings",s)}async getRankingSettings(){return await C.getSetting("musicRankingSettings")}async saveRankingCover(s){await C.setSetting("musicRankingCover",s)}async getRankingCover(){return await C.getSetting("musicRankingCover")}async recordListeningTime(s,o,n){const a=await C.getSetting("listeningRecords")||[];a.push({id:Date.now(),userId:s,songId:o,duration:n,timestamp:Date.now()}),await C.setSetting("listeningRecords",a)}async getListeningRecords(s="all"){const o=await C.getSetting("listeningRecords")||[],n=Date.now();let a=o;if(s==="today"){const l=new Date().setHours(0,0,0,0);a=o.filter(i=>i.timestamp>=l)}else if(s==="week"){const l=n-6048e5;a=o.filter(i=>i.timestamp>=l)}else if(s==="month"){const l=n-2592e6;a=o.filter(i=>i.timestamp>=l)}return a}}const ft=new $p,_p=Object.freeze(Object.defineProperty({__proto__:null,default:ft},Symbol.toStringTag,{value:"Module"})),Mp={class:"chat-window-fullscreen"},Sp={key:0,class:"voice-call-modal"},Ap={class:"modal-content"},Ip=["src","alt"],Lp={class:"caller-name"},Tp={class:"chat-container"},jp={class:"chat-header"},Pp=["src","alt"],Ep={class:"header-text"},Bp={class:"header-icons"},Vp={key:0,class:"load-more-container"},Dp={key:0,class:"loading-indicator"},Hp={key:1,class:"load-more-hint"},Fp={key:0,class:"system-message"},Up=["onClick"],Rp={key:0,viewBox:"0 0 24 24",width:"16",height:"16"},Np=["onDblclick"],Op=["onTouchstart","onContextmenu"],zp={key:0,class:"forwarded-moment-bubble"},Kp={class:"moment-content"},Wp={class:"message-time"},Gp={key:1,class:"message received typing-message"},qp={class:"modal"},Zp={class:"modal-body"},Jp={class:"form-group"},Yp={class:"form-group"},Xp={class:"modal"},Qp={class:"modal-body"},ef={class:"form-group"},tf={class:"modal"},sf={class:"modal-body"},of={class:"form-group"},nf={class:"form-group"},af={class:"form-group"},lf={class:"modal"},rf={class:"modal-body"},cf={class:"form-group"},df={class:"form-group"},uf={class:"form-group"},vf={class:"modal"},pf={class:"modal-body",style:{"text-align":"center",padding:"24px 16px"}},ff={style:{"font-size":"28px","font-weight":"600",color:"#333","margin-bottom":"8px"}},mf={style:{"font-size":"14px",color:"#666"}},gf={class:"modal"},hf={class:"modal-body"},yf={key:7,class:"multi-select-toolbar"},bf={key:8,class:"chat-input"},wf=["disabled"],kf={key:0,viewBox:"0 0 24 24",width:"20",height:"20"},xf={key:1,viewBox:"0 0 24 24",width:"20",height:"20",class:"loading-icon"},Cf=500,Al=10,$f={__name:"ChatWindow",props:{contactId:{type:Number,required:!0},contactName:{type:String,required:!0},contactAvatar:{type:String,required:!0}},emits:["back","open-diary"],setup(t,{emit:s}){const o=t,n=s,a=h({id:o.contactId,name:o.contactName,avatar:o.contactAvatar});h([]);const l=h([]),i=h([]),r=h(15),c=h(!1),d=h(!0),u=h(""),v=h(!1),b=h(!1),w=h(!1),I=h(null),j=h(null),$=h("https://via.placeholder.com/36");h(null);const x=h(null),S=h(!1),M=h([]),A=h(!1),T=h(!1),G=h(!1),K=h({x:0,y:0}),q=h(null),ee=h(-1),Z=h(!1),E=h([]),m=h(!1),g=h(""),D=h(null),W=h(!1);let te=null,R=0,F=0;tt(()=>M.value.length>0);const ie=tt(()=>`chat_${o.contactId}`),re={click:new Audio("https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"),send:new Audio("https://assets.mixkit.co/active_storage/sfx/2570/2570-preview.mp3"),emoji:new Audio("https://files.catbox.moe/gb0so5.mp3"),bubble:new Audio("https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"),avatar:new Audio("https://assets.mixkit.co/active_storage/sfx/2575/2575-preview.mp3")},pe=(Y="click")=>{const z=re[Y];z&&(z.currentTime=0,z.play().catch(()=>{}))},we=async Y=>{try{const z=await ft.getAllPlaylists();for(const qe of z){const wt=(await ft.getSongsInPlaylist(qe.id)).find(ze=>ze.title===Y||ze.title.includes(Y));if(wt){Pt.playSong(wt),pe("send");return}}alert(`${Y}`)}catch(z){console.error(":",z),alert("")}};typeof window<"u"&&(window.playSongFromChat=we);const he=async Y=>{if(!Y)return{text:Y,html:Y,type:"text"};const z=Y.match(/^\[(.+)\]$/);if(z){const st=z[1],$t=await C.getContact(o.contactId);let Rt=null;return $t&&$t.customEmojis&&$t.customEmojis.length>0&&(Rt=$t.customEmojis.find(Cr=>Cr.name===st)),Rt||(Rt=await C.getCustomEmojiByName(st)),Rt?{text:`[${st}]`,html:`<img src="${Rt.url}" alt="${st}" style="width: 90px; height: 90px; object-fit: contain; border-radius: 8px;" />`,type:"emoji"}:{text:`[${st}]`,html:`<span style="color: #999; font-size: 13px;">[${st}]</span>`,type:"text"}}const qe=Y.match(/^\[(.+)\]$/);if(qe){const st=qe[1],$t=Math.max(1,Math.ceil(st.length/3));return{text:`[] ${st}`,html:`<div class="voice-message-wrapper" style="display: flex; flex-direction: column; align-items: flex-start; gap: 8px;">
        <div style="display: flex; align-items: center; gap: 8px;">
          <div class="voice-bubble" style="display: flex; align-items: center; background: white; padding: 8px 12px; border-radius: 20px; border-top-left-radius: 4px; cursor: pointer; min-width: 85px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="#5c7cd1" style="margin-right: 8px;">
              <path d="M8 5v14l11-7z"/>
            </svg>
            <div style="display: flex; align-items: center; gap: 2px; height: 12px; margin-right: 12px;">
              <div style="width: 2px; height: 45%; background: rgba(92,124,209,0.5); border-radius: 2px;"></div>
              <div style="width: 2px; height: 90%; background: rgba(92,124,209,0.5); border-radius: 2px;"></div>
              <div style="width: 2px; height: 60%; background: rgba(92,124,209,0.5); border-radius: 2px;"></div>
              <div style="width: 2px; height: 100%; background: rgba(92,124,209,0.5); border-radius: 2px;"></div>
              <div style="width: 2px; height: 75%; background: rgba(92,124,209,0.5); border-radius: 2px;"></div>
            </div>
            <span style="color: #5c7cd1; font-size: 11px; font-weight: bold; font-style: italic;">${$t}"</span>
          </div>
          <button onclick="const wrapper = this.closest('.voice-message-wrapper'); const textEl = wrapper.querySelector('.voice-text'); const isHidden = textEl.style.display === 'none' || !textEl.style.display; textEl.style.display = isHidden ? 'flex' : 'none'; this.style.background = isHidden ? '#5c7cd1' : 'white'; this.style.color = isHidden ? 'white' : '#5c7cd1';" style="width: 24px; height: 24px; border-radius: 50%; background: white; color: #5c7cd1; border: 1px solid rgba(92,124,209,0.2); font-size: 10px; font-weight: bold; cursor: pointer; box-shadow: 0 1px 2px rgba(0,0,0,0.05);"></button>
        </div>
        <div class="voice-text" style="display: none; padding: 6px 12px; background: white; border-radius: 20px; border-top-left-radius: 4px; font-size: 13px; color: #333; max-width: 200px; word-wrap: break-word; box-shadow: 0 1px 2px rgba(0,0,0,0.05); border: 1px solid #f0f0f0;">${st}</div>
      </div>`,type:"voice"}}const Je=Y.match(/^\[([^|]+)\|([^|]+)(?:\|(.+))?\]$/);if(Je){const[,st,$t,Rt]=Je;return{text:`[] ${st}`,html:`<div style="display: inline-flex; align-items: center; gap: 12px; padding: 12px; background: #fff; border-radius: 12px; border: 1px solid #e0e0e0; max-width: 260px;">
        <div style="font-size: 36px; flex-shrink: 0;"></div>
        <div style="flex: 1; min-width: 0;">
          <div style="font-weight: 600; font-size: 14px; color: #333; margin-bottom: 4px;">${st}</div>
          <div style="font-size: 15px; color: #ff6b6b; font-weight: 600; margin-bottom: 2px;">${$t}</div>
          ${Rt?`<div style="font-size: 12px; color: #999;">${Rt}</div>`:""}
        </div>
      </div>`,type:"takeout"}}const wt=Y.match(/^\[(.+)\]$/);if(wt){const st=wt[1],$t=["https://img.wjwj.top/2026/02/14/618ba7726d83280c55ac2cd72ad77c48.md.png","https://img.wjwj.top/2026/02/14/e2bf1bd411e4938d461fdb93734d0ba8.md.png","https://img.wjwj.top/2026/02/14/513c5e9eea4829323a5d4b40349b5037.md.png","https://img.wjwj.top/2026/02/14/6f9080ad44c879ae0f5eb3e01bc77fcf.md.png","https://img.wjwj.top/2026/02/14/db59081b9ab226d8c2c07b3d2defda29.md.png","https://img.wjwj.top/2026/02/14/7111d2e400f6ee5d072105f4421f5b10.md.png","https://img.wjwj.top/2026/02/14/9d771362701465ecade9da8eccc9c317.md.png","https://img.wjwj.top/2026/02/14/4f4286a6d3170b8910b6866830864e3d.md.png","https://img.wjwj.top/2026/02/14/2e01f4619d5140622c1adc1d0cb10f37.md.png","https://img.wjwj.top/2026/02/14/23aa94b79868c8daa814933079b8398f.md.png"],Rt=$t[Math.floor(Math.random()*$t.length)];return{text:`[] ${st}`,html:`<div style="background: white; padding: 10px; border-radius: 32px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); border: 1px solid #f0f0f0; width: 256px;">
        <div style="padding: 8px 12px;"><h3 style="color: #333; font-size: 15px; font-weight: bold; margin: 0;">${st}</h3></div>
        <div style="position: relative; height: 176px; border-radius: 24px; overflow: hidden; background: #f5f5f5;">
          <img src="${Rt}" style="width: 100%; height: 100%; object-fit: cover; opacity: 0.9;">
          <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
            <div style="position: relative; background: white; width: 40px; height: 40px; border-radius: 50%; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center;">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="#5c7cd1" fill-opacity="0.15" stroke="#5c7cd1" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
            </div>
          </div>
        </div>
      </div>`,type:"location"}}const ze=Y.match(/^\[([^|]+)(?:\|(.+))?\]$/);if(ze){const[,st,$t]=ze,Rt=Date.now();return{text:`[] ${st}`,html:`<div onclick="window.handleTransferClick && window.handleTransferClick(${Rt}, '${st}', '${$t||""}')" style="background: #f8f8f8; border-radius: 12px; padding: 10px; width: 125px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='#f8f8f8'">
        <div style="display: flex; align-items: center; gap: 8px;">
          <div style="width: 28px; height: 28px; background: #6C8CD5; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
              <path d="M12 2v20M2 12h20"/>
            </svg>
          </div>
          <div style="flex: 1;">
            <div style="font-size: 15px; font-weight: 600; color: #333;">${st}</div>
            <div style="font-size: 11px; color: #666;">${$t||""}</div>
          </div>
        </div>
      </div>`,type:"transfer",transferData:{amount:st,note:$t||"",id:Rt}}}const Dt=Y.match(/^\[([^|]+)(?:\|([^|]+))?(?:\|(.+))?\]$/);if(Dt){const[,st,$t,Rt]=Dt;return{text:`[] ${st}`,html:`<div style="display: inline-flex; align-items: center; gap: 10px; padding: 12px; background: #f5f5f5; border-radius: 12px; border: 1px solid #e0e0e0; max-width: 240px;">
        <div style="width: 40px; height: 40px; background: #6c8cd5; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
          </svg>
        </div>
        <div style="flex: 1;">
          <div style="font-weight: 600; font-size: 14px; color: #333;">${st}</div>
          ${$t?`<div style="font-size: 12px; color: #999; margin-top: 2px;">${$t}</div>`:""}
          ${Rt?`<div style="font-size: 12px; color: #666; margin-top: 4px;">${Rt}</div>`:""}
        </div>
      </div>`,type:"file"}}const ct=Y.match(/^\[(.+)\]$/);if(ct){const st=ct[1],$t=["https://files.catbox.moe/0g3kqu.jpg","https://files.catbox.moe/d5b7k6.jpg","https://files.catbox.moe/0yrhh6.jpg","https://files.catbox.moe/8mjvdg.jpg","https://files.catbox.moe/fvidas.jpg","https://files.catbox.moe/q6so2i.jpg","https://files.catbox.moe/5a96cp.jpg","https://files.catbox.moe/0mp6h0.jpg","https://files.catbox.moe/epcn03.jpg","https://files.catbox.moe/7jzdp7.jpg","https://files.catbox.moe/jrmu6w.jpg","https://files.catbox.moe/c0bwhn.jpg","https://files.catbox.moe/0blxme.jpg","https://files.catbox.moe/qicobr.jpg","https://files.catbox.moe/n94ztu.jpg"],Rt=$t[Math.floor(Math.random()*$t.length)];return{text:`[] ${st}`,html:`<div class="random-image-container" style="display: inline-block; position: relative; min-width: 100px; max-width: 100%; min-height: 100px; max-height: 130px; border: 2px solid transparent; border-radius: 15px; margin: 0 0 -6px 0; overflow-y: auto; box-shadow: 0 4px 8px rgba(255, 182, 193, 0.4); background: url('${Rt}') center/cover; background-color: rgba(255, 255, 255, 0.8); backdrop-filter: blur(5px);">
        <details style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer;">
          <summary style="list-style: none; width: 100%; height: 100%;"></summary>
          <div style="position: absolute; top: 2px; left: 2px; right: 2px; background: linear-gradient(135deg, rgba(255, 192, 203, 0.4), rgba(255, 182, 193, 0.4)); color: #333333; padding: 8px; border-radius: 12px; text-align: center; z-index: 0; box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.5);">
            <div style="border: 1px solid rgba(255, 192, 203, 0.3); padding: 12px 8px; width: calc(100% - 3px); text-align: center; word-wrap: break-word; border-radius: 10px; background: rgba(255, 255, 255, 0.98); box-shadow: inset 0 0 8px rgba(255, 192, 203, 0.2);">
              <p style="margin: 0; font-family: 'Comic Sans MS', cursive; font-size: 11px; text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);">${st}</p>
            </div>
          </div>
        </details>
      </div>`,type:"image"}}const St=Y.match(/^\[(.+)\]$/);if(St){const st=St[1];return{text:`[] ${st}`,html:`<div class="random-image-container" style="display: inline-block; position: relative; min-width: 100px; max-width: 100%; min-height: 100px; max-height: 130px; border: 2px solid transparent; border-radius: 15px; margin: 0 0 -6px 0; overflow-y: auto; box-shadow: 0 4px 8px rgba(92, 124, 209, 0.4); background: url('https://via.placeholder.com/200x130/5c7cd1/ffffff?text=Video') center/cover; background-color: rgba(255, 255, 255, 0.8); backdrop-filter: blur(5px);">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 40px; height: 40px; background: rgba(255,255,255,0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; pointer-events: none;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="#5c7cd1">
            <path d="M8 5v14l11-7z"/>
          </svg>
        </div>
        <details style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer;">
          <summary style="list-style: none; width: 100%; height: 100%;"></summary>
          <div style="position: absolute; top: 2px; left: 2px; right: 2px; background: linear-gradient(135deg, rgba(92, 124, 209, 0.4), rgba(108, 140, 213, 0.4)); color: #333333; padding: 8px; border-radius: 12px; text-align: center; z-index: 0; box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.5);">
            <div style="border: 1px solid rgba(92, 124, 209, 0.3); padding: 12px 8px; width: calc(100% - 3px); text-align: center; word-wrap: break-word; border-radius: 10px; background: rgba(255, 255, 255, 0.98); box-shadow: inset 0 0 8px rgba(92, 124, 209, 0.2);">
              <p style="margin: 0; font-family: 'Comic Sans MS', cursive; font-size: 11px; text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);">${st}</p>
            </div>
          </div>
        </details>
      </div>`,type:"video"}}const Ut=Y.match(/^\[(.+)\]$/);if(Ut){const st=Ut[1];return{text:`[] ${st}`,html:`<div onclick="window.playSongFromChat && window.playSongFromChat('${st.replace(/'/g,"\\'")}');" style="display: inline-flex; flex-direction: column; gap: 0; padding: 0; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 16px; max-width: 280px; cursor: pointer; box-shadow: 0 2px 8px rgba(33, 150, 243, 0.15); transition: all 0.3s; overflow: hidden; border: 1px solid rgba(33, 150, 243, 0.1);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(33, 150, 243, 0.25)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(33, 150, 243, 0.15)';">
        <div style="display: flex; align-items: center; gap: 12px; padding: 14px;">
          <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 2px 6px rgba(33, 150, 243, 0.3);">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
              <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
            </svg>
          </div>
          <div style="flex: 1; min-width: 0;">
            <div style="font-weight: 600; font-size: 15px; color: #1565c0; margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${st}</div>
            <div style="font-size: 12px; color: #1976d2; display: flex; align-items: center; gap: 4px; opacity: 0.8;">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="#1976d2">
                <path d="M8 5v14l11-7z"/>
              </svg>
              
            </div>
          </div>
        </div>
        <div style="height: 3px; background: linear-gradient(90deg, #2196f3 0%, #64b5f6 50%, #2196f3 100%); background-size: 200% 100%; animation: shimmer 2s infinite;"></div>
      </div>
      <style>
        @keyframes shimmer {
          0% { background-position: 200% 0; }
          100% { background-position: -200% 0; }
        }
      </style>`,type:"song",songData:{name:st}}}const vt=Y.match(/^\[([^|]+)\|(.+)\]$/);if(vt){const[,st,$t]=vt;return{text:`[] ${st}`,html:`<div style="display: inline-block; padding: 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f5f9ff 100%); border-left: 4px solid #2196f3; border-radius: 12px; max-width: 280px; box-shadow: 0 2px 8px rgba(33, 150, 243, 0.1);">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="#2196f3">
            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
          </svg>
          <div style="font-weight: 600; font-size: 13px; color: #1565c0;">${st}</div>
        </div>
        <div style="font-size: 14px; line-height: 1.6; color: #1976d2; font-style: italic; white-space: pre-wrap; opacity: 0.9;">${$t}</div>
      </div>`,type:"lyrics",lyricsData:{songName:st,lyrics:$t}}}return{text:Y,html:Y,type:"text"}},Ue=Y=>{if(!Y)return"";const z=new Date(Y),qe=String(z.getHours()).padStart(2,"0"),Je=String(z.getMinutes()).padStart(2,"0");return`${qe}:${Je}`},ge=Y=>Y?(Y.text||Y.content||"").includes(""):!1,B=Y=>Y?(Y.text||Y.content||"").replace(`
`,"").replace("",""):"",L=async(Y=!1)=>{await Yt(),I.value&&I.value.scrollTo({top:I.value.scrollHeight,behavior:Y?"smooth":"auto"})},k=async()=>{if(!I.value||c.value||!d.value)return;I.value.scrollTop<100&&await y()},y=async()=>{var wt;if(c.value||!d.value)return;c.value=!0;const Y=((wt=I.value)==null?void 0:wt.scrollHeight)||0;await new Promise(ze=>setTimeout(ze,300));const z=i.value.length,Je=l.value.slice(Math.max(0,l.value.length-z-20),l.value.length-z);if(Je.length===0)d.value=!1;else if(i.value=[...Je,...i.value],await Yt(),I.value){const ze=I.value.scrollHeight;I.value.scrollTop=ze-Y}c.value=!1},H=()=>{l.value.length<=r.value?(i.value=[...l.value],d.value=!1):(i.value=l.value.slice(-r.value),d.value=!0)},se=()=>{pe("click"),b.value=!b.value},P=()=>{b.value=!1},U=async()=>{const Y=u.value.trim();if(!Y)return;pe("send");const z={id:Date.now(),text:Y,html:Y,sent:!0,time:Date.now(),type:"text",chatId:ie.value};await C.addChatMessage(z),l.value.push(z),i.value.push(z),M.value.push(z),u.value="",L(),await Q(Y,!0)},O=async()=>{if(u.value.trim()&&await U(),M.value.length!==0&&!A.value){A.value=!0;try{T.value=!0,await L(),await new Promise(ct=>setTimeout(ct,Math.random()*1e3+1e3));const Y=await C.getContact(o.contactId),z=(Y==null?void 0:Y.contextLength)||20,qe=await C.getSetting("visionEnabled"),Je=l.value.slice(-z).map(ct=>{let St=ct.text||"";if(ct.type==="emoji"){const vt=St.match(/\[(.+)\]/);vt&&(St=`${vt[1]}`)}else if(ct.type==="voice"){const vt=St.match(/\[(.+)\]/)||St.match(/\[\] (.+)/);vt&&(St=`"${vt[1]}"`)}else if(ct.type==="transfer"){const vt=St.match(/\[([^|]+)(?:\|(.+))?\]/)||St.match(/\[\] (.+)/);vt&&(St=` ${vt[1]}`)}else if(ct.type==="image"){const vt=St.match(/\[(.+)\]/);vt?St=`${vt[1]}`:St=""}else if(ct.type==="location"){const vt=St.match(/\[(.+)\]/)||St.match(/\[\] (.+)/);vt&&(St=`${vt[1]}`)}else if(ct.type==="takeout"){const vt=St.match(/\[([^|]+)\|([^|]+)(?:\|(.+))?\]/);vt&&(St=`${vt[1]}`)}else if(ct.type==="file"){const vt=St.match(/\[([^|]+)(?:\|([^|]+))?(?:\|(.+))?\]/);vt&&(St=`${vt[1]}`)}const Ut={role:ct.sent?"user":"assistant",content:St};if(qe&&ct.type==="image"&&ct.imageData)if(ct.html&&ct.html.includes("random-image-container")&&ct.imageData&&ct.imageData.startsWith("https://files.catbox.moe/"))console.log(" "),Ut.content=St;else{const st=ct.imageData.length*.75/1024;st>1024?(console.warn(`  (${st.toFixed(2)}KB) AI`),Ut.content="[]AI "):Ut.content=[{type:"text",text:ct.text||"[]"},{type:"image_url",image_url:{url:ct.imageData}}]}return Ut}),wt={name:(Y==null?void 0:Y.name)||a.value.name,prompt:(Y==null?void 0:Y.prompt)||"",personality:(Y==null?void 0:Y.personality)||"",description:(Y==null?void 0:Y.bio)||"",speakingStyle:(Y==null?void 0:Y.speakingStyle)||""},ze=await Wt.sendMessage(Je,o.contactId,wt);T.value=!1;const Dt=Wt.splitMessages(ze);for(let ct=0;ct<Dt.length;ct++){const St=Math.random()*2e3+1e3;await new Promise(st=>setTimeout(st,St));const Ut=await he(Dt[ct]),vt={id:Date.now()+ct,type:Ut.type,text:Ut.text,html:Ut.html,sent:!1,time:Date.now(),chatId:ie.value,read:!1};await C.addChatMessage(vt),l.value.push(vt),i.value.push(vt),await Q(Ut.text,!1),Ht.addNotification({contactId:o.contactId,name:a.value.name,avatar:a.value.avatar,message:Ht.formatMessageContent(vt),type:"chat"}),await L(),pe("send")}M.value=[]}catch(Y){console.error("AI :",Y),T.value=!1,alert("AI ")}finally{A.value=!1}}},Q=async(Y,z)=>{try{const Je=(await C.getChatList()).find(wt=>wt.type==="single"&&wt.contactId===o.contactId);Je&&await C.updateChatListItem({...Je,lastMessage:Y,lastMessageTime:Date.now(),unreadCount:z?0:Je.unreadCount||0})}catch(qe){console.error(":",qe)}},ae=()=>{pe("click"),n("back"),typeof window.triggerSlash=="function"&&window.triggerSlash("/send |/trigger")},fe=()=>{pe("avatar"),typeof window.triggerSlash=="function"&&window.triggerSlash(`/send ${a.value.name}|/trigger`)},Me=()=>{pe("click"),n("open-diary"),typeof window.triggerSlash=="function"&&window.triggerSlash(`/send ${a.value.name}|/trigger`)},Ie=()=>{pe("click"),w.value=!0},$e=()=>{w.value=!1},ye=async Y=>{pe("click");try{await C.updateContact({id:o.contactId,avatar:Y.avatar,name:Y.nickname,prompt:Y.prompt,linkedWorldBook:Y.linkedWorldBook||null,bubbleTheme:Y.bubbleTheme||"default",contextLength:Y.contextLength||20,customEmojis:Y.customEmojis||[]}),a.value.avatar=Y.avatar,a.value.name=Y.nickname;const qe=(await C.getChatList()).find(Je=>Je.type==="single"&&Je.contactId===o.contactId);if(qe&&await C.updateChatListItem({...qe,avatar:Y.avatar,name:Y.nickname}),Y.backgroundPreview){await C.setUserSetting(o.contactId,"chatBackground",Y.backgroundPreview);const Je=document.querySelector(".chat-container");Je&&(Je.style.backgroundImage=`url(${Y.backgroundPreview})`)}$e(),alert("")}catch(z){console.error(":",z),alert("")}},Ne=async Y=>{pe("click");try{await C.setUserSetting(o.contactId,"avatar",Y.avatar),await C.setUserSetting(o.contactId,"prompt",Y.prompt),$.value=Y.avatar,$e(),alert("")}catch(z){console.error(":",z),alert("")}},Ee=async()=>{if(confirm("")){pe("click");try{await C.clearChatMessages(ie.value),l.value=[],i.value=[];const z=(await C.getChatList()).find(qe=>qe.type==="single"&&qe.contactId===o.contactId);z&&await C.updateChatListItem({...z,lastMessage:"",lastMessageTime:Date.now(),unreadCount:0}),alert("")}catch(Y){console.error(":",Y),alert("")}$e()}},He=()=>{confirm("")&&(pe("click"),alert(""),$e())},Ge=()=>{confirm("")&&(pe("click"),alert(""),$e(),ae())},et=async Y=>{pe("click"),P();let z,qe=Y.url;if(!Y.isAiGenerated&&Y.url.startsWith("data:image"))try{const wt=Y.url.length*.75/1024;if(console.log(` : ${wt.toFixed(2)}KB`),wt>500){console.log(" ..."),qe=await me(Y.url,800,800,.7);const ze=qe.length*.75/1024;console.log(` : ${ze.toFixed(2)}KB`)}}catch(wt){console.error(":",wt)}Y.isAiGenerated?z=`<div class="random-image-container" style="display: inline-block; position: relative; min-width: 100px; max-width: 100%; min-height: 100px; max-height: 130px; border: 2px solid transparent; border-radius: 15px; margin: 0 0 -6px 0; overflow-y: auto; box-shadow: 0 4px 8px rgba(255, 182, 193, 0.4); background: url('${Y.url}') center/cover; background-color: rgba(255, 255, 255, 0.8); backdrop-filter: blur(5px);">
  <details style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer;">
    <summary style="list-style: none; width: 100%; height: 100%;"></summary>
    <div style="position: absolute; top: 2px; left: 2px; right: 2px; background: linear-gradient(135deg, rgba(255, 192, 203, 0.4), rgba(255, 182, 193, 0.4)); color: #333333; padding: 8px; border-radius: 12px; text-align: center; z-index: 0; box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.5);">
      <div style="border: 1px solid rgba(255, 192, 203, 0.3); padding: 12px 8px; width: calc(100% - 3px); text-align: center; word-wrap: break-word; border-radius: 10px; background: rgba(255, 255, 255, 0.98); box-shadow: inset 0 0 8px rgba(255, 192, 203, 0.2);">
        <p style="margin: 0; font-family: 'Comic Sans MS', cursive; font-size: 11px; text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);">${Y.prompt}</p>
      </div>
    </div>
  </details>
</div>`:z=`<img src="${Y.url}" style="max-width: 200px; border-radius: 8px;" />`;const Je={id:Date.now(),text:Y.isAiGenerated?`[${Y.prompt}]`:"[]",html:z,sent:!0,time:Date.now(),type:"image",chatId:ie.value,imageData:qe};await C.addChatMessage(Je),l.value.push(Je),i.value.push(Je),M.value.push(Je),L(),await Q("[]",!0)},me=(Y,z,qe,Je=.7)=>new Promise((wt,ze)=>{const Dt=new Image;Dt.onload=()=>{const ct=document.createElement("canvas"),St=ct.getContext("2d");let Ut=Dt.width,vt=Dt.height;if(Ut>z||vt>qe){const $t=Math.min(z/Ut,qe/vt);Ut=Ut*$t,vt=vt*$t}ct.width=Ut,ct.height=vt,St.drawImage(Dt,0,0,Ut,vt);const st=ct.toDataURL("image/jpeg",Je);wt(st)},Dt.onerror=()=>ze(new Error("")),Dt.src=Y}),le=()=>{pe("click"),P(),v.value=!0,j.value&&(j.value.currentTime=0,j.value.play());const Y=Math.floor(Math.random()*7001+3e3);setTimeout(()=>{const z=Math.random();v.value=!1,j.value&&j.value.pause(),z<=.8?typeof window.triggerSlash=="function"&&window.triggerSlash(`/send ${a.value.name}|/trigger`):typeof window.triggerSlash=="function"&&window.triggerSlash(`/send ${a.value.name}|/trigger`)},Y)},De=async Y=>{pe("click"),P();const z={id:Date.now(),text:"[]",html:`<video src="${Y.url}" controls style="max-width: 200px; border-radius: 8px;"></video>`,sent:!0,time:Date.now(),type:"video",chatId:ie.value};await C.addChatMessage(z),l.value.push(z),i.value.push(z),M.value.push(z),L(),await Q("[]",!0)},xe=async Y=>{pe("click"),P(),gt.value=!0,at.value={name:Y.name||"",size:Y.size||"",content:"",url:Y.url||""}},Ve=()=>{pe("click"),P(),Gt.value=!0},xt=()=>{pe("click"),P(),_e.value=!0},yt=()=>{pe("emoji"),P(),alert("...")},ce=()=>{pe("click"),P(),S.value=!0},oe=()=>{S.value=!1},ve=async Y=>{pe("click");const z={id:Date.now(),text:`[${Y.name}]`,html:`<img src="${Y.url}" alt="${Y.name}" style="width: 90px; height: 90px; object-fit: contain; border-radius: 8px;" />`,sent:!0,time:Date.now(),type:"emoji",chatId:ie.value};await C.addChatMessage(z),l.value.push(z),i.value.push(z),M.value.push(z),L(),await Q(`[${Y.name}]`,!0)},Ze=async Y=>{const z={id:Date.now(),text:Y.text,html:`<div class="voice-message-wrapper" style="display: flex; flex-direction: column; align-items: flex-end; gap: 8px;">
      <!--  +  -->
      <div style="display: flex; align-items: center; gap: 8px;">
        <!--  -->
        <button class="voice-convert-btn" onclick="const wrapper = this.closest('.voice-message-wrapper'); const textEl = wrapper.querySelector('.voice-text'); const isHidden = textEl.style.display === 'none' || !textEl.style.display; textEl.style.display = isHidden ? 'flex' : 'none'; this.style.background = isHidden ? '#5c7cd1' : 'white'; this.style.color = isHidden ? 'white' : '#5c7cd1'; this.style.border = isHidden ? 'none' : '1px solid rgba(92, 124, 209, 0.2)';" style="width: 24px; height: 24px; border-radius: 50%; background: white; color: #5c7cd1; border: 1px solid rgba(92, 124, 209, 0.2); font-size: 10px; font-weight: bold; cursor: pointer; flex-shrink: 0; box-shadow: 0 1px 2px rgba(0,0,0,0.05); transition: all 0.2s;"></button>
        
        <!--  -->
        <div class="voice-bubble" onclick="this.classList.toggle('playing')" style="display: flex; align-items: center; background: #5c7cd1; padding: 8px 12px; border-radius: 20px; border-top-right-radius: 4px; cursor: pointer; min-width: 85px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); transition: all 0.2s; user-select: none;">
          <!--  -->
          <svg width="12" height="12" viewBox="0 0 24 24" fill="white" style="margin-right: 8px; opacity: 0.9;">
            <path d="M8 5v14l11-7z"/>
          </svg>
          <!--  -->
          <div style="display: flex; align-items: center; gap: 2px; height: 12px; margin-right: 12px;">
            <div style="width: 2px; height: 45%; background: rgba(255,255,255,0.5); border-radius: 2px;"></div>
            <div style="width: 2px; height: 90%; background: rgba(255,255,255,0.5); border-radius: 2px;"></div>
            <div style="width: 2px; height: 60%; background: rgba(255,255,255,0.5); border-radius: 2px;"></div>
            <div style="width: 2px; height: 100%; background: rgba(255,255,255,0.5); border-radius: 2px;"></div>
            <div style="width: 2px; height: 75%; background: rgba(255,255,255,0.5); border-radius: 2px;"></div>
          </div>
          <!--  -->
          <span style="color: white; font-size: 11px; font-weight: bold; font-style: italic; letter-spacing: -0.5px;">${Y.duration}"</span>
        </div>
      </div>
      
      <!--  -->
      <div class="voice-text" style="display: none; padding: 6px 12px; background: white; border-radius: 20px; border-top-right-radius: 4px; font-size: 13px; color: #333; max-width: 200px; word-wrap: break-word; box-shadow: 0 1px 2px rgba(0,0,0,0.05); border: 1px solid #f0f0f0; animation: fadeIn 0.2s; font-weight: 500; line-height: 1; white-space: nowrap;">{{VOICE_TEXT}}</div>
    </div>
    <style>
      @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95) translateY(-5px); }
        to { opacity: 1; transform: scale(1) translateY(0); }
      }
    </style>`,sent:!0,time:Date.now(),type:"voice",chatId:ie.value,voiceData:Y};z.html=z.html.replace("{{VOICE_TEXT}}",Y.text),await C.addChatMessage(z),l.value.push(z),i.value.push(z),M.value.push(z),L(),await Q("[]",!0)},_e=h(!1),ut=h({amount:"",note:""}),gt=h(!1),at=h({name:"",size:"",content:"",url:""}),Gt=h(!1),It=h({foodName:"",price:"",note:""}),as=h(!1),be=h({id:null,amount:"",note:""}),V=()=>{_e.value=!1,ut.value={amount:"",note:""}},de=()=>{gt.value=!1,at.value={name:"",size:"",content:"",url:""}},pt=()=>{Gt.value=!1,It.value={foodName:"",price:"",note:""}},rt=(Y,z,qe)=>{pe("click"),be.value={id:Y,amount:z,note:qe},as.value=!0},Et=async()=>{pe("click");const Y={id:Date.now(),text:` ${be.value.amount} `,type:"system",time:Date.now(),chatId:ie.value};await C.addChatMessage(Y),l.value.push(Y),i.value.push(Y),as.value=!1,L()},bt=async()=>{pe("click");const Y={id:Date.now(),text:` ${be.value.amount} `,type:"system",time:Date.now(),chatId:ie.value};await C.addChatMessage(Y),l.value.push(Y),i.value.push(Y),as.value=!1,L()};typeof window<"u"&&(window.handleTransferClick=rt);const J=async()=>{const Y=parseFloat(ut.value.amount);if(!Y||Y<=0){alert("");return}Ue(Date.now());const z={id:Date.now(),text:`[] ${Y}`,html:`<div class="transfer-bubble" style="background: #f8f8f8; border-radius: 12px; padding: 10px; width: 125px; cursor: pointer;">
      <div class="transfer-content" style="display: flex; align-items: center; gap: 8px;">
        <div class="transfer-icon" style="width: 28px; height: 28px; background: #6C8CD5; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
            <path d="M12 2v20M2 12h20"/>
          </svg>
        </div>
        <div class="transfer-info" style="flex: 1; min-width: 0;">
          <div class="transfer-amount" style="font-size: 15px; font-weight: 600; color: #333; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${Y}</div>
          <div class="transfer-status" style="font-size: 11px; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"></div>
        </div>
      </div>
    </div>`,sent:!0,time:Date.now(),type:"transfer",chatId:ie.value,transferData:{amount:Y,note:ut.value.note}};await C.addChatMessage(z),l.value.push(z),i.value.push(z),M.value.push(z),L(),await Q("[]",!0),V()},X=async()=>{if(!at.value.name.trim()){alert("");return}const Y={id:Date.now(),text:`[] ${at.value.name}`,html:`<div style="display: inline-flex; align-items: center; gap: 10px; padding: 12px; background: #f5f5f5; border-radius: 12px; border: 1px solid #e0e0e0; max-width: 240px;">
      <div style="width: 40px; height: 40px; background: #6c8cd5; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
          <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
        </svg>
      </div>
      <div style="flex: 1; min-width: 0;">
        <div style="font-weight: 600; font-size: 14px; color: #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{FILE_NAME}}</div>
        {{SIZE_HTML}}
        {{CONTENT_HTML}}
      </div>
    </div>`,sent:!0,time:Date.now(),type:"file",chatId:ie.value,fileData:at.value};let z=Y.html.replace("{{FILE_NAME}}",at.value.name);at.value.size?z=z.replace("{{SIZE_HTML}}",`<div style="font-size: 12px; color: #999; margin-top: 2px;">${at.value.size}</div>`):z=z.replace("{{SIZE_HTML}}",""),at.value.content?z=z.replace("{{CONTENT_HTML}}",`<div style="font-size: 12px; color: #666; margin-top: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${at.value.content}</div>`):z=z.replace("{{CONTENT_HTML}}",""),Y.html=z,await C.addChatMessage(Y),l.value.push(Y),i.value.push(Y),M.value.push(Y),L(),await Q("[]",!0),de()},ne=async()=>{if(!It.value.foodName.trim()){alert("");return}if(!It.value.price){alert("");return}const Y={id:Date.now(),text:`[] ${It.value.foodName}`,html:`<div style="display: inline-flex; align-items: center; gap: 12px; padding: 12px; background: #fff; border-radius: 12px; border: 1px solid #e0e0e0; max-width: 260px;">
      <div style="font-size: 36px; flex-shrink: 0;"></div>
      <div style="flex: 1; min-width: 0;">
        <div style="font-weight: 600; font-size: 14px; color: #333; margin-bottom: 4px;">{{FOOD_NAME}}</div>
        <div style="font-size: 15px; color: #ff6b6b; font-weight: 600; margin-bottom: 2px;">{{PRICE}}</div>
        {{NOTE_HTML}}
      </div>
    </div>`,sent:!0,time:Date.now(),type:"takeout",chatId:ie.value,takeoutData:It.value};let z=Y.html.replace("{{FOOD_NAME}}",It.value.foodName).replace("{{PRICE}}",It.value.price);It.value.note?z=z.replace("{{NOTE_HTML}}",`<div style="font-size: 12px; color: #999; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${It.value.note}</div>`):z=z.replace("{{NOTE_HTML}}",""),Y.html=z,await C.addChatMessage(Y),l.value.push(Y),i.value.push(Y),M.value.push(Y),L(),await Q("[]",!0),pt()},Te=()=>{pe("click"),P(),ue.value=!0},ue=h(!1),We=h({address:""}),Re=()=>{ue.value=!1,We.value={address:""}},Be=async()=>{const Y=We.value.address.trim();if(!Y){alert("");return}const z=["https://img.wjwj.top/2026/02/14/618ba7726d83280c55ac2cd72ad77c48.md.png","https://img.wjwj.top/2026/02/14/e2bf1bd411e4938d461fdb93734d0ba8.md.png","https://img.wjwj.top/2026/02/14/513c5e9eea4829323a5d4b40349b5037.md.png","https://img.wjwj.top/2026/02/14/6f9080ad44c879ae0f5eb3e01bc77fcf.md.png","https://img.wjwj.top/2026/02/14/db59081b9ab226d8c2c07b3d2defda29.md.png","https://img.wjwj.top/2026/02/14/7111d2e400f6ee5d072105f4421f5b10.md.png","https://img.wjwj.top/2026/02/14/9d771362701465ecade9da8eccc9c317.md.png","https://img.wjwj.top/2026/02/14/4f4286a6d3170b8910b6866830864e3d.md.png","https://img.wjwj.top/2026/02/14/2e01f4619d5140622c1adc1d0cb10f37.md.png","https://img.wjwj.top/2026/02/14/23aa94b79868c8daa814933079b8398f.md.png"],qe=z[Math.floor(Math.random()*z.length)],Je={id:Date.now(),text:`[] ${Y}`,html:`<div class="location-card" style="background: white; padding: 10px; border-radius: 32px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); border: 1px solid #f0f0f0; overflow: hidden; width: 256px; cursor: pointer; transition: all 0.2s;">
      <!--  -->
      <div style="padding: 8px 12px; text-align: left;">
        <h3 style="color: #333; font-size: 15px; font-weight: bold; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; letter-spacing: -0.3px;">{{LOCATION_NAME}}</h3>
      </div>
      <!--  -->
      <div style="position: relative; height: 176px; width: 100%; border-radius: 24px; overflow: hidden; background: #f5f5f5;">
        <img src="{{MAP_IMAGE}}" alt="Map" style="width: 100%; height: 100%; object-fit: cover; opacity: 0.9;">
        <!--  -->
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none;">
          <div style="position: relative;">
            <!--  -->
            <div style="position: absolute; inset: 0; background: #5c7cd1; border-radius: 50%; animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite; opacity: 0.2; transform: scale(2.2);"></div>
            <!--  -->
            <div style="position: relative; background: white; width: 40px; height: 40px; border-radius: 50%; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; border: 2px solid white;">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="#5c7cd1" fill-opacity="0.15" stroke="#5c7cd1" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              <div style="position: absolute; width: 6px; height: 6px; background: #5c7cd1; border-radius: 50%; top: 13px;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <style>
      @keyframes ping {
        75%, 100% {
          transform: scale(2.2);
          opacity: 0;
        }
      }
    </style>`,sent:!0,time:Date.now(),type:"location",chatId:ie.value,locationData:{address:Y,mapImage:qe}};Je.html=Je.html.replace("{{LOCATION_NAME}}",Y).replace("{{MAP_IMAGE}}",qe),await C.addChatMessage(Je),l.value.push(Je),i.value.push(Je),M.value.push(Je),L(),await Q("[]",!0),Re()},Mt=()=>{v.value=!1,j.value&&j.value.pause(),typeof window.triggerSlash=="function"&&window.triggerSlash(`/send ${a.value.name}|/trigger`)},Lt=()=>{v.value=!1,j.value&&j.value.pause()},Ms=(Y,z,qe)=>{R=Y.touches[0].clientX,F=Y.touches[0].clientY,te=setTimeout(()=>{Zo(Y,z,qe)},Cf)},Js=Y=>{const z=Math.abs(Y.touches[0].clientX-R),qe=Math.abs(Y.touches[0].clientY-F);(z>Al||qe>Al)&&clearTimeout(te)},Ss=()=>{clearTimeout(te)},Zo=(Y,z,qe)=>{pe("click"),q.value=z,ee.value=qe;const Je=Y.touches?Y.touches[0].clientX:Y.clientX,wt=Y.touches?Y.touches[0].clientY:Y.clientY;K.value={x:Math.min(Je,window.innerWidth-150),y:Math.min(wt,window.innerHeight-200)},G.value=!0},Bt=()=>{G.value=!1,q.value=null,ee.value=-1},Hn=()=>{pe("click");const Y=q.value;Y&&(u.value=`${Y.text}
`,Bt())},Fn=()=>{pe("click"),Z.value=!0,E.value=[],Bt(),P()},Un=()=>{pe("click"),Z.value=!1,E.value=[]},ur=Y=>{pe("click");const z=E.value.indexOf(Y);z>-1?E.value.splice(z,1):E.value.push(Y)},vr=async()=>{if(q.value&&confirm("")){pe("click");const Y=q.value.id;await C.deleteChatMessage(Y);const z=l.value.findIndex(Je=>Je.id===Y);z>-1&&l.value.splice(z,1);const qe=i.value.findIndex(Je=>Je.id===Y);qe>-1&&i.value.splice(qe,1),Bt()}},pr=async()=>{if(E.value.length===0){alert("");return}if(confirm(` ${E.value.length} `)){pe("click");for(const Y of E.value){await C.deleteChatMessage(Y);const z=l.value.findIndex(Je=>Je.id===Y);z>-1&&l.value.splice(z,1);const qe=i.value.findIndex(Je=>Je.id===Y);qe>-1&&i.value.splice(qe,1)}Un()}},fr=async()=>{if(!q.value)return;pe("click");const Y=q.value.id,z={id:Date.now(),text:"",type:"system",time:Date.now(),chatId:ie.value},qe=l.value.findIndex(wt=>wt.id===Y);qe>-1&&(l.value.splice(qe,1),await C.deleteChatMessage(Y));const Je=i.value.findIndex(wt=>wt.id===Y);Je>-1&&i.value.splice(Je,1),await C.addChatMessage(z),l.value.push(z),i.value.push(z),Bt(),L()},mr=async Y=>{if(Y.sent)return;pe("click");const z={id:Date.now(),text:` ${a.value.name}`,type:"system",time:Date.now(),chatId:ie.value};await C.addChatMessage(z),l.value.push(z),i.value.push(z),L()},gr=()=>{q.value&&(pe("click"),g.value=q.value.text,D.value=q.value.id,m.value=!0,Bt())},Rn=()=>{m.value=!1,g.value="",D.value=null},hr=async()=>{if(!g.value.trim()){alert("");return}pe("click");const Y=l.value.findIndex(qe=>qe.id===D.value);Y>-1&&(l.value[Y].text=g.value.trim(),l.value[Y].html=g.value.trim(),await C.addChatMessage(l.value[Y]));const z=i.value.findIndex(qe=>qe.id===D.value);z>-1&&(i.value[z].text=g.value.trim(),i.value[z].html=g.value.trim()),Rn()},yr=()=>{if(E.value.length===0){alert("");return}pe("click"),W.value=!0},br=()=>l.value.filter(Y=>E.value.includes(Y.id)),wr=()=>{W.value=!1},kr=()=>{W.value=!1,Un()},xr=()=>{if(E.value.length===0){alert("");return}pe("click"),alert(` ${E.value.length} ...`)};return it(async()=>{Object.values(re).forEach(Y=>{Y.load()});try{const Y=await C.getChatMessages(ie.value);l.value=Y||[],H();const z=await C.getUserSetting(o.contactId,"avatar");z&&($.value=z);const qe=await C.getContact(o.contactId);qe&&(a.value.avatar=qe.avatar,a.value.name=qe.name);const Je=await C.getUserSetting(o.contactId,"chatBackground");if(Je){const Dt=document.querySelector(".chat-container");Dt&&(Dt.style.backgroundImage=`url(${Je})`)}await C.markMessagesAsRead(ie.value);const ze=(await C.getChatList()).find(Dt=>Dt.type==="single"&&Dt.contactId===o.contactId);ze&&await C.updateChatListItem({...ze,unreadCount:0}),L()}catch(Y){console.error(":",Y)}}),(Y,z)=>{var qe,Je,wt;return p(),f("div",Mp,[v.value?(p(),f("div",Sp,[e("audio",{ref_key:"callAudio",ref:j,loop:""},[...z[15]||(z[15]=[e("source",{src:"https://files.catbox.moe/23kcq4.mp3",type:"audio/mpeg"},null,-1)])],512),e("div",Ap,[e("img",{src:a.value.avatar,class:"caller-avatar",alt:a.value.name},null,8,Ip),e("div",Lp,_(a.value.name),1),z[18]||(z[18]=e("div",{class:"call-status"},"...",-1)),e("div",{class:"call-buttons"},[e("button",{class:"call-button accept-call",onClick:Mt},[...z[16]||(z[16]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 0 0-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02c-.37-1.11-.56-2.3-.56-3.53c0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99C3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"})],-1)])]),e("button",{class:"call-button reject-call",onClick:Lt},[...z[17]||(z[17]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9c-.98.49-1.87 1.12-2.66 1.85c-.18.18-.43.28-.7.28c-.28 0-.53-.11-.71-.29L.29 13.08a.996.996 0 0 1 0-1.41c1.34-1.34 2.87-2.42 4.55-3.2C6.87 7.81 9.04 7 12 7s5.13.81 7.16 2.47c1.68.78 3.21 1.86 4.55 3.2c.39.39.39 1.02 0 1.41l-2.49 2.49c-.18.18-.43.29-.71.29c-.27 0-.52-.11-.7-.28c-.79-.74-1.69-1.36-2.67-1.85c-.33-.16-.56-.51-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"})],-1)])])])])])):N("",!0),e("div",Tp,[e("div",jp,[e("div",{class:"header-info",onClick:fe},[e("img",{src:a.value.avatar,class:"avatar",alt:a.value.name},null,8,Pp),e("div",Ep,[e("h2",null,_(a.value.name),1),z[19]||(z[19]=e("div",{class:"header-status"},[e("div",{class:"status-dot"}),ot("  ")],-1))])]),e("div",Bp,[(p(),f("svg",{class:"header-icon diary-btn",onClick:Me,viewBox:"0 0 24 24"},[...z[20]||(z[20]=[e("path",{fill:"currentColor",d:"M19,3H14.82C14.4,1.84 13.3,1 12,1C10.7,1 9.6,1.84 9.18,3H5C3.9,3 3,3.9 3,5V19C3,20.1 3.9,21 5,21H19C20.1,21 21,20.1 21,19V5C21,3.9 20.1,3 19,3M12,3C12.55,3 13,3.45 13,4C13,4.55 12.55,5 12,5C11.45,5 11,4.55 11,4C11,3.45 11.45,3 12,3M7,7H17V5H19V19H5V5H7V7Z"},null,-1)])])),(p(),f("svg",{class:"header-icon home-btn",onClick:ae,viewBox:"0 0 24 24"},[...z[21]||(z[21]=[e("path",{fill:"currentColor",d:"M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"},null,-1)])])),(p(),f("svg",{class:"header-icon menu-btn",onClick:Ie,viewBox:"0 0 24 24"},[...z[22]||(z[22]=[e("path",{fill:"currentColor",d:"M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"},null,-1)])]))])]),e("div",{class:"chat-messages",ref_key:"messagesContainer",ref:I,onClick:Bt,onScroll:k},[d.value&&i.value.length>0?(p(),f("div",Vp,[c.value?(p(),f("div",Dp,[...z[23]||(z[23]=[e("div",{class:"loading-spinner"},null,-1),e("span",null,"...",-1)])])):(p(),f("div",Hp,[...z[24]||(z[24]=[e("span",null," ",-1)])]))])):N("",!0),(p(!0),f(Le,null,Fe(i.value,(ze,Dt)=>(p(),f("div",{key:ze.id||Dt,class:Se(["message-container",{"multi-select-mode":Z.value}])},[ze.type==="system"?(p(),f("div",Fp,_(ze.text),1)):(p(),f(Le,{key:1},[Z.value?(p(),f("div",{key:0,class:"message-checkbox",onClick:Pe(ct=>ur(ze.id),["stop"])},[e("div",{class:Se(["checkbox",{checked:E.value.includes(ze.id)}])},[E.value.includes(ze.id)?(p(),f("svg",Rp,[...z[25]||(z[25]=[e("path",{fill:"white",d:"M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"},null,-1)])])):N("",!0)],2)],8,Up)):N("",!0),e("div",{class:Se(["message",[ze.sent?"sent":"received",{selected:E.value.includes(ze.id)}]])},[e("div",{class:Se(["avatar",ze.sent?"user_avatar":"character_avatar"]),style:Oe({backgroundImage:`url(${ze.sent?$.value:a.value.avatar})`,backgroundSize:"cover",backgroundPosition:"center"}),onClick:z[0]||(z[0]=ct=>pe("avatar")),onDblclick:ct=>!ze.sent&&mr(ze)},null,46,Np),e("div",{class:"message-wrapper",onTouchstart:ct=>Ms(ct,ze,Dt),onTouchend:Ss,onTouchmove:Js,onContextmenu:Pe(ct=>Zo(ct,ze,Dt),["prevent"])},[ge(ze)?(p(),f("div",zp,[z[26]||(z[26]=e("div",{class:"forward-tag"},"",-1)),e("div",Kp,_(B(ze)),1)])):(p(),nt(F1,{key:1,content:ze.html||ze.text,"is-sent":ze.sent,type:ze.type||"text",onClick:z[1]||(z[1]=ct=>pe("bubble"))},null,8,["content","is-sent","type"])),e("div",Wp,_(Ue(ze.time)),1)],40,Op)],2)],64))],2))),128)),T.value?(p(),f("div",Gp,[e("div",{class:"avatar character_avatar",style:Oe({backgroundImage:`url(${a.value.avatar})`,backgroundSize:"cover",backgroundPosition:"center"})},null,4),z[27]||(z[27]=e("div",{class:"message-wrapper"},[e("div",{class:"message-content typing-bubble"},[e("div",{class:"typing-dots"},[e("span"),e("span"),e("span")])])],-1))])):N("",!0)],544),Ye(q1,{ref_key:"chatAddMenuRef",ref:x,show:b.value,onSendEmoji:yt,onSendTransfer:xt,onSendImage:et,onSendCall:le,onSendVoice:Ze,onSendVideo:De,onSendFile:xe,onSendLocation:Te,onSendTakeout:Ve,onOpenEmojiManager:ce},null,8,["show"]),Ye(bp,{show:S.value,onClose:oe,onSelect:ve},null,8,["show"]),_e.value?(p(),f("div",{key:0,class:"modal-overlay",onClick:Pe(V,["self"])},[e("div",qp,[z[30]||(z[30]=e("div",{class:"modal-title"},"",-1)),e("div",Zp,[e("div",Jp,[z[28]||(z[28]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":z[2]||(z[2]=ze=>ut.value.amount=ze),type:"number",class:"form-input",placeholder:""},null,512),[[je,ut.value.amount]])]),e("div",Yp,[z[29]||(z[29]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":z[3]||(z[3]=ze=>ut.value.note=ze),type:"text",class:"form-input",placeholder:""},null,512),[[je,ut.value.note]])])]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-cancel",onClick:V},""),e("button",{class:"btn btn-confirm",onClick:J},"")])])])):N("",!0),ue.value?(p(),f("div",{key:1,class:"modal-overlay",onClick:Pe(Re,["self"])},[e("div",Xp,[z[32]||(z[32]=e("div",{class:"modal-title"},"",-1)),e("div",Qp,[e("div",ef,[z[31]||(z[31]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":z[4]||(z[4]=ze=>We.value.address=ze),type:"text",class:"form-input",placeholder:""},null,512),[[je,We.value.address]])])]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-cancel",onClick:Re},""),e("button",{class:"btn btn-confirm",onClick:Be},"")])])])):N("",!0),gt.value?(p(),f("div",{key:2,class:"modal-overlay",onClick:Pe(de,["self"])},[e("div",tf,[z[36]||(z[36]=e("div",{class:"modal-title"},"",-1)),e("div",sf,[e("div",of,[z[33]||(z[33]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":z[5]||(z[5]=ze=>at.value.name=ze),type:"text",class:"form-input",placeholder:""},null,512),[[je,at.value.name]])]),e("div",nf,[z[34]||(z[34]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":z[6]||(z[6]=ze=>at.value.size=ze),type:"text",class:"form-input",placeholder:"2.5MB"},null,512),[[je,at.value.size]])]),e("div",af,[z[35]||(z[35]=e("label",null,"",-1)),ke(e("textarea",{"onUpdate:modelValue":z[7]||(z[7]=ze=>at.value.content=ze),class:"form-input",rows:"3",placeholder:"..."},null,512),[[je,at.value.content]])])]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-cancel",onClick:de},""),e("button",{class:"btn btn-confirm",onClick:X},"")])])])):N("",!0),Gt.value?(p(),f("div",{key:3,class:"modal-overlay",onClick:Pe(pt,["self"])},[e("div",lf,[z[40]||(z[40]=e("div",{class:"modal-title"},"",-1)),e("div",rf,[e("div",cf,[z[37]||(z[37]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":z[8]||(z[8]=ze=>It.value.foodName=ze),type:"text",class:"form-input",placeholder:""},null,512),[[je,It.value.foodName]])]),e("div",df,[z[38]||(z[38]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":z[9]||(z[9]=ze=>It.value.price=ze),type:"number",class:"form-input",placeholder:""},null,512),[[je,It.value.price]])]),e("div",uf,[z[39]||(z[39]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":z[10]||(z[10]=ze=>It.value.note=ze),type:"text",class:"form-input",placeholder:""},null,512),[[je,It.value.note]])])]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-cancel",onClick:pt},""),e("button",{class:"btn btn-confirm",onClick:ne},"")])])])):N("",!0),as.value?(p(),f("div",{key:4,class:"modal-overlay",onClick:z[11]||(z[11]=Pe(ze=>as.value=!1,["self"]))},[e("div",vf,[z[42]||(z[42]=e("div",{class:"modal-title"},"",-1)),e("div",pf,[z[41]||(z[41]=e("div",{style:{"font-size":"36px","margin-bottom":"16px"}},"",-1)),e("div",ff," "+_(be.value.amount),1),e("div",mf,_(be.value.note),1)]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-cancel",onClick:bt},""),e("button",{class:"btn btn-confirm",onClick:Et},"")])])])):N("",!0),Ye(Ov,{show:w.value,"contact-id":a.value.id,"contact-info":a.value,onClose:$e,onSaveCharacter:ye,onSaveUser:Ne,onClearHistory:Ee,onBlockContact:He,onDeleteContact:Ge},null,8,["show","contact-id","contact-info"]),Ye(Yv,{show:W.value,"selected-messages":br(),"current-contact-info":a.value,"user-avatar":$.value,onClose:wr,onForwardComplete:kr},null,8,["show","selected-messages","current-contact-info","user-avatar"]),G.value?(p(),f("div",{key:5,class:"message-menu",style:Oe({top:K.value.y+"px",left:K.value.x+"px"})},[(qe=q.value)!=null&&qe.sent?(p(),f("div",{key:0,class:"menu-item",onClick:Hn},[...z[43]||(z[43]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18"},[e("path",{fill:"currentColor",d:"M14,17H17L19,13V7H13V13H16M6,17H9L11,13V7H5V13H8L6,17Z"})],-1),e("span",null,"",-1)])])):N("",!0),e("div",{class:"menu-item",onClick:Fn},[...z[44]||(z[44]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18"},[e("path",{fill:"currentColor",d:"M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,5V19H5V5H19M11.5,10A0.5,0.5 0 0,0 11,10.5V13H13.5A0.5,0.5 0 0,0 14,12.5A0.5,0.5 0 0,0 13.5,12H12V10.5A0.5,0.5 0 0,0 11.5,10M8,10V12H9.5A0.5,0.5 0 0,1 10,12.5A0.5,0.5 0 0,1 9.5,13H8V14.5A0.5,0.5 0 0,1 7.5,15A0.5,0.5 0 0,1 7,14.5V10H8M16,10V14.5A0.5,0.5 0 0,1 15.5,15A0.5,0.5 0 0,1 15,14.5V10H16Z"})],-1),e("span",null,"",-1)])]),e("div",{class:"menu-item",onClick:vr},[...z[45]||(z[45]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18"},[e("path",{fill:"currentColor",d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"})],-1),e("span",null,"",-1)])]),(Je=q.value)!=null&&Je.sent?(p(),f("div",{key:1,class:"menu-item",onClick:fr},[...z[46]||(z[46]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18"},[e("path",{fill:"currentColor",d:"M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z"})],-1),e("span",null,"",-1)])])):N("",!0),(wt=q.value)!=null&&wt.sent?N("",!0):(p(),f("div",{key:2,class:"menu-item",onClick:gr},[...z[47]||(z[47]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18"},[e("path",{fill:"currentColor",d:"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"})],-1),e("span",null,"",-1)])]))],4)):N("",!0),m.value?(p(),f("div",{key:6,class:"modal-overlay",onClick:Pe(Rn,["self"])},[e("div",gf,[z[48]||(z[48]=e("div",{class:"modal-title"},"",-1)),e("div",hf,[ke(e("textarea",{"onUpdate:modelValue":z[12]||(z[12]=ze=>g.value=ze),class:"form-input",rows:"4",placeholder:"..."},null,512),[[je,g.value]])]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-cancel",onClick:Rn},""),e("button",{class:"btn btn-confirm",onClick:hr},"")])])])):N("",!0),Z.value?(p(),f("div",yf,[e("button",{class:"toolbar-btn",onClick:yr},[...z[49]||(z[49]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M12,8V4L20,12L12,20V16H4V8H12Z"})],-1),e("span",null,"",-1)])]),e("button",{class:"toolbar-btn",onClick:pr},[...z[50]||(z[50]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"})],-1),e("span",null,"",-1)])]),e("button",{class:"toolbar-btn",onClick:xr},[...z[51]||(z[51]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"})],-1),e("span",null,"",-1)])]),e("button",{class:"toolbar-btn cancel",onClick:Un},[...z[52]||(z[52]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})],-1),e("span",null,"",-1)])])])):N("",!0),Z.value?N("",!0):(p(),f("div",bf,[e("button",{class:"add-btn",onClick:se},[...z[53]||(z[53]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"})],-1)])]),ke(e("input",{type:"text",class:"input-field","onUpdate:modelValue":z[13]||(z[13]=ze=>u.value=ze),placeholder:"...",onKeyup:ns(U,["enter"]),onClick:z[14]||(z[14]=ze=>pe("bubble")),onFocus:P},null,544),[[je,u.value]]),e("button",{class:Se(["send-btn",{"is-sending":A.value}]),onClick:O,disabled:A.value},[A.value?(p(),f("svg",xf,[...z[55]||(z[55]=[e("circle",{cx:"12",cy:"12",r:"10",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-dasharray":"31.4 31.4","stroke-dashoffset":"0"},[e("animateTransform",{attributeName:"transform",type:"rotate",from:"0 12 12",to:"360 12 12",dur:"1s",repeatCount:"indefinite"})],-1)])])):(p(),f("svg",kf,[...z[54]||(z[54]=[e("path",{fill:"currentColor",d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"},null,-1)])]))],10,wf)]))])])}}},_f=Xe($f,[["__scopeId","data-v-b771a14e"]]),Mf={class:"modal group-info-modal"},Sf={class:"modal-header"},Af={class:"modal-body"},If={class:"group-basic-info"},Lf=["src"],Tf={class:"group-name-large"},jf={class:"group-id"},Pf={class:"info-section"},Ef={key:0,class:"announcement-content"},Bf={key:1,class:"announcement-placeholder"},Vf={class:"info-section"},Df={class:"section-title"},Hf={class:"members-grid"},Ff=["onClick"],Uf={class:"member-avatar-wrapper"},Rf=["src"],Nf={key:0,class:"member-badge owner"},Of={key:1,class:"member-badge admin"},zf={key:2,class:"member-badge muted"},Kf={class:"member-name"},Wf={class:"info-section"},Gf={class:"settings-list"},qf={class:"modal announcement-modal"},Zf={class:"modal-body"},Jf={class:"modal member-manage-modal"},Yf={class:"modal-body"},Xf={class:"member-manage-info"},Qf=["src"],e0={class:"member-manage-name"},t0={class:"member-manage-status"},s0={key:0,class:"status-badge owner"},o0={key:1,class:"status-badge admin"},n0={key:2,class:"status-badge member"},a0={class:"member-manage-actions"},l0={__name:"GroupInfoModal",props:{groupInfo:{type:Object,required:!0},groupMembers:{type:Array,required:!0}},emits:["close","update-announcement","update-avatar"],setup(t,{emit:s}){const o=t,n=s,a=h(!1),l=h(!1),i=h(!1),r=h(o.groupInfo.announcement||""),c=h(!1),d=h(null),u=h(null),v=()=>{var g;(g=u.value)==null||g.click()},b=async g=>{var W;const D=(W=g.target.files)==null?void 0:W[0];if(D)try{const te=new FileReader;te.onload=R=>{const F=R.target.result;n("update-avatar",F),alert("")},te.readAsDataURL(D)}catch(te){console.error(":",te),alert("")}},w=()=>{r.value=o.groupInfo.announcement||"",i.value=!0},I=()=>{i.value=!1},j=()=>{n("update-announcement",r.value),I()},$=g=>{d.value=g,c.value=!0},x=()=>{c.value=!1,d.value=null},S=()=>{confirm(` ${d.value.name} 

`)&&(o.groupMembers.forEach(g=>{g.isOwner&&(g.isOwner=!1)}),d.value.isOwner=!0,d.value.isAdmin=!1,alert(`${d.value.name} `),x())},M=()=>{d.value.isAdmin=!0,alert(`${d.value.name} `),x()},A=()=>{confirm(` ${d.value.name} `)&&(d.value.isAdmin=!1,alert(` ${d.value.name} `),x())},T=()=>{const g=d.value.isMuted?"":"";confirm(`${g} ${d.value.name} `)&&(d.value.isMuted=!d.value.isMuted,alert(`${g} ${d.value.name}`),x())},G=()=>{confirm(` ${d.value.name} 

`)&&(alert(`${d.value.name} `),x())},K=()=>{alert("...")},q=()=>{a.value=!a.value},ee=()=>{l.value=!l.value},Z=()=>{alert("...")},E=async()=>{if(confirm(`

`))try{await C.clearGroupMessages(o.groupInfo.id),alert(""),n("close"),window.location.reload()}catch(g){console.error(":",g),alert("")}},m=async()=>{if(confirm(`

`))try{await C.deleteGroup(o.groupInfo.id);const D=(await C.getChatList()).find(W=>W.groupId===o.groupInfo.id);D&&await C.deleteChatListItem(D.id),await C.clearGroupMessages(o.groupInfo.id),alert(""),n("close"),setTimeout(()=>{window.location.reload()},500)}catch(g){console.error(":",g),alert("")}};return(g,D)=>{var W,te,R,F,ie,re,pe,we,he,Ue,ge;return p(),f("div",{class:"modal-overlay",onClick:D[2]||(D[2]=Pe(B=>g.$emit("close"),["self"]))},[e("div",Mf,[e("div",Sf,[D[3]||(D[3]=e("h3",null,"",-1)),e("button",{class:"close-btn",onClick:D[0]||(D[0]=B=>g.$emit("close"))},"")]),e("div",Af,[e("div",If,[e("div",{class:"group-avatar-wrapper",onClick:v},[e("img",{src:t.groupInfo.avatar,class:"group-avatar-large"},null,8,Lf),D[4]||(D[4]=e("div",{class:"avatar-edit-overlay"},[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"white",d:"M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.13,5.12L18.88,8.87L20.71,7.04Z"})])],-1))]),e("div",Tf,_(t.groupInfo.name),1),e("div",jf,""+_(t.groupInfo.id),1)]),e("input",{ref_key:"avatarInputRef",ref:u,type:"file",accept:"image/*",onChange:b,style:{display:"none"}},null,544),e("div",Pf,[D[5]||(D[5]=e("div",{class:"section-title"},"",-1)),e("div",{class:"announcement-box",onClick:w},[t.groupInfo.announcement?(p(),f("div",Ef,_(t.groupInfo.announcement),1)):(p(),f("div",Bf,"  "))])]),e("div",Vf,[e("div",Df," ("+_(t.groupMembers.length)+")",1),e("div",Hf,[(p(!0),f(Le,null,Fe(t.groupMembers,B=>(p(),f("div",{key:B.id,class:"member-item",onClick:L=>$(B)},[e("div",Uf,[e("img",{src:B.avatar,class:"member-avatar"},null,8,Rf),B.isOwner?(p(),f("div",Nf,"")):B.isAdmin?(p(),f("div",Of,"")):N("",!0),B.isMuted?(p(),f("div",zf,"")):N("",!0)]),e("div",Kf,_(B.name),1)],8,Ff))),128)),e("div",{class:"member-item add-member",onClick:K},[...D[6]||(D[6]=[e("div",{class:"add-icon"},[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"})])],-1),e("div",{class:"member-name"},"",-1)])])])]),e("div",Wf,[e("div",Gf,[e("div",{class:"settings-item",onClick:q},[D[8]||(D[8]=e("span",null,"",-1)),e("div",{class:Se(["toggle-switch",{active:a.value}])},[...D[7]||(D[7]=[e("div",{class:"toggle-slider"},null,-1)])],2)]),e("div",{class:"settings-item",onClick:ee},[D[10]||(D[10]=e("span",null,"",-1)),e("div",{class:Se(["toggle-switch",{active:l.value}])},[...D[9]||(D[9]=[e("div",{class:"toggle-slider"},null,-1)])],2)]),e("div",{class:"settings-item",onClick:Z},[...D[11]||(D[11]=[e("span",null,"",-1),e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"})],-1)])])])]),e("div",{class:"info-section danger-section"},[e("div",{class:"settings-list"},[e("div",{class:"settings-item danger",onClick:E},[...D[12]||(D[12]=[e("span",null,"",-1)])]),e("div",{class:"settings-item danger",onClick:m},[...D[13]||(D[13]=[e("span",null,"",-1)])])])])])]),i.value?(p(),f("div",{key:0,class:"modal-overlay",onClick:Pe(I,["self"])},[e("div",qf,[e("div",{class:"modal-header"},[D[14]||(D[14]=e("h3",null,"",-1)),e("button",{class:"close-btn",onClick:I},"")]),e("div",Zf,[ke(e("textarea",{"onUpdate:modelValue":D[1]||(D[1]=B=>r.value=B),class:"announcement-textarea",placeholder:"...",rows:"6"},null,512),[[je,r.value]])]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-cancel",onClick:I},""),e("button",{class:"btn btn-confirm",onClick:j},"")])])])):N("",!0),c.value?(p(),f("div",{key:1,class:"modal-overlay",onClick:Pe(x,["self"])},[e("div",Jf,[e("div",{class:"modal-header"},[D[15]||(D[15]=e("h3",null,"",-1)),e("button",{class:"close-btn",onClick:x},"")]),e("div",Yf,[e("div",Xf,[e("img",{src:(W=d.value)==null?void 0:W.avatar,class:"member-manage-avatar"},null,8,Qf),e("div",e0,_((te=d.value)==null?void 0:te.name),1),e("div",t0,[(R=d.value)!=null&&R.isOwner?(p(),f("span",s0,"")):(F=d.value)!=null&&F.isAdmin?(p(),f("span",o0,"")):(p(),f("span",n0,""))])]),e("div",a0,[(ie=d.value)!=null&&ie.isOwner?N("",!0):(p(),f("div",{key:0,class:"manage-action-item",onClick:S},[...D[16]||(D[16]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M12,2L2,7V13.5C2,19.75 6.5,25.5 12,27C17.5,25.5 22,19.75 22,13.5V7L12,2M12,4.18L20,8.09V13.5C20,18.87 16.25,23.74 12,25.23C7.75,23.74 4,18.87 4,13.5V8.09L12,4.18M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9"})],-1),e("span",null,"",-1)])])),!((re=d.value)!=null&&re.isOwner)&&!((pe=d.value)!=null&&pe.isAdmin)?(p(),f("div",{key:1,class:"manage-action-item",onClick:M},[...D[17]||(D[17]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,5A3,3 0 0,1 15,8A3,3 0 0,1 12,11A3,3 0 0,1 9,8A3,3 0 0,1 12,5M17.13,17C15.92,18.85 14.11,20.24 12,20.92C9.89,20.24 8.08,18.85 6.87,17C6.53,16.5 6.24,16 6,15.47C6,13.82 8.71,12.47 12,12.47C15.29,12.47 18,13.79 18,15.47C17.76,16 17.47,16.5 17.13,17Z"})],-1),e("span",null,"",-1)])])):N("",!0),(we=d.value)!=null&&we.isAdmin?(p(),f("div",{key:2,class:"manage-action-item",onClick:A},[...D[18]||(D[18]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,5A3,3 0 0,1 15,8A3,3 0 0,1 12,11A3,3 0 0,1 9,8A3,3 0 0,1 12,5M17.13,17C15.92,18.85 14.11,20.24 12,20.92C9.89,20.24 8.08,18.85 6.87,17C6.53,16.5 6.24,16 6,15.47C6,13.82 8.71,12.47 12,12.47C15.29,12.47 18,13.79 18,15.47C17.76,16 17.47,16.5 17.13,17Z"})],-1),e("span",null,"",-1)])])):N("",!0),(he=d.value)!=null&&he.isOwner?N("",!0):(p(),f("div",{key:3,class:"manage-action-item",onClick:T},[D[19]||(D[19]=e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4M9,9V15H15V9"})],-1)),e("span",null,_((Ue=d.value)!=null&&Ue.isMuted?"":""),1)])),(ge=d.value)!=null&&ge.isOwner?N("",!0):(p(),f("div",{key:4,class:"manage-action-item danger",onClick:G},[...D[20]||(D[20]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})],-1),e("span",null,"",-1)])]))])])])])):N("",!0)])}}},i0=Xe(l0,[["__scopeId","data-v-4d972600"]]),r0={class:"modal user-profile-modal"},c0={class:"modal-header"},d0={class:"modal-body"},u0={class:"profile-section"},v0=["src"],p0={class:"profile-section"},f0={class:"profile-section"},m0={class:"modal-actions"},g0={__name:"UserProfileModal",emits:["close","update"],setup(t,{emit:s}){const o=s,n=h({avatar:"https://via.placeholder.com/120",name:"",bio:""}),a=h(null),l=()=>{var d;(d=a.value)==null||d.click()},i=async d=>{var v;const u=(v=d.target.files)==null?void 0:v[0];if(u)try{const b=new FileReader;b.onload=w=>{n.value.avatar=w.target.result},b.readAsDataURL(u)}catch(b){console.error(":",b),alert("")}},r=async()=>{try{await C.setSetting("userAvatar",n.value.avatar),await C.setSetting("userName",n.value.name),await C.setSetting("userBio",n.value.bio),o("update",n.value),o("close"),alert("")}catch(d){console.error(":",d),alert("")}},c=async()=>{try{const d=await C.getSetting("userAvatar"),u=await C.getSetting("userName"),v=await C.getSetting("userBio");d&&(n.value.avatar=d),u&&(n.value.name=u),v&&(n.value.bio=v)}catch(d){console.error(":",d)}};return it(()=>{c()}),(d,u)=>(p(),f("div",{class:"modal-overlay",onClick:u[4]||(u[4]=Pe(v=>d.$emit("close"),["self"]))},[e("div",r0,[e("div",c0,[u[5]||(u[5]=e("h3",null,"",-1)),e("button",{class:"close-btn",onClick:u[0]||(u[0]=v=>d.$emit("close"))},"")]),e("div",d0,[e("div",u0,[u[7]||(u[7]=e("div",{class:"section-title"},"",-1)),e("div",{class:"avatar-upload-wrapper",onClick:l},[e("img",{src:n.value.avatar,class:"user-avatar-large"},null,8,v0),u[6]||(u[6]=e("div",{class:"avatar-edit-overlay"},[e("svg",{viewBox:"0 0 24 24",width:"28",height:"28"},[e("path",{fill:"white",d:"M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.13,5.12L18.88,8.87L20.71,7.04Z"})]),e("div",{class:"edit-text"},"")],-1))]),e("input",{ref_key:"avatarInputRef",ref:a,type:"file",accept:"image/*",onChange:i,style:{display:"none"}},null,544)]),e("div",p0,[u[8]||(u[8]=e("div",{class:"section-title"},"",-1)),ke(e("input",{"onUpdate:modelValue":u[1]||(u[1]=v=>n.value.name=v),type:"text",class:"profile-input",placeholder:"..."},null,512),[[je,n.value.name]])]),e("div",f0,[u[9]||(u[9]=e("div",{class:"section-title"},"",-1)),ke(e("textarea",{"onUpdate:modelValue":u[2]||(u[2]=v=>n.value.bio=v),class:"profile-textarea",placeholder:`...


- 
- 
- 
- `,rows:"8"},null,512),[[je,n.value.bio]]),u[10]||(u[10]=e("div",{class:"bio-hint"},"   AI  ",-1))])]),e("div",m0,[e("button",{class:"btn btn-cancel",onClick:u[3]||(u[3]=v=>d.$emit("close"))},""),e("button",{class:"btn btn-confirm",onClick:r},"")])])]))}},h0=Xe(g0,[["__scopeId","data-v-2014be9a"]]),y0={class:"phone-container"},b0={key:0,class:"loading-overlay"},w0={class:"chat-header"},k0=["src","alt"],x0={class:"header-text"},C0={class:"header-status"},$0={class:"header-icons"},_0=["title"],M0=["d"],S0={class:"announcement-text"},A0=["onContextmenu","onClick"],I0={key:0,class:"message-checkbox"},L0={key:0,viewBox:"0 0 24 24",width:"16",height:"16"},T0={class:"message-wrapper"},j0={key:0,class:"sender-name"},P0=["innerHTML"],E0=["onClick"],B0={class:"redpacket-info"},V0={class:"redpacket-blessing"},D0={class:"redpacket-status"},H0=["onClick"],F0={class:"vote-title"},U0={class:"vote-options"},R0={class:"vote-option-text"},N0={class:"vote-option-count"},O0=["onClick"],z0={class:"solitaire-title"},K0={class:"solitaire-count"},W0={key:5,class:"message-content location-message"},G0={class:"location-info"},q0={class:"location-name"},Z0={class:"location-address"},J0={key:6,class:"message-content"},Y0=["src","alt"],X0={class:"message-time"},Q0={key:0,class:"typing-indicator"},em={key:1,class:"mention-panel"},tm=["onClick"],sm=["src"],om={key:2,class:"add-menu"},nm={key:3,class:"chat-input"},am={key:4,class:"multi-select-toolbar"},lm=["disabled"],im=["disabled"],rm={__name:"GroupChatWindow",props:{groupId:{type:Number,required:!0}},emits:["back"],setup(t,{emit:s}){const o=t,n=s,a=h(!0),l=h({id:o.groupId,name:"",avatar:"",memberIds:[]}),i=h([]),r=h([]),c=h(""),d=h("https://via.placeholder.com/36"),u=h(null),v=h(null),b=h(null),w=h(!1),I=h(""),j=h([]),$=h(!1),x=h(!1),S=h([]),M=h(""),A=h([]),T=h(!1),G=h(!1),K=h(!1),q=h(null),ee=h({avatar:"https://via.placeholder.com/36",name:"",bio:""}),Z=tt(()=>r.value),E=ce=>{const oe=i.value.find(ve=>ve.id===ce);return(oe==null?void 0:oe.avatar)||"https://via.placeholder.com/36"},m=ce=>{const oe=i.value.find(ve=>ve.id===ce);return(oe==null?void 0:oe.name)||""},g=tt(()=>I.value?i.value.filter(ce=>ce.name.toLowerCase().includes(I.value.toLowerCase())):i.value),D=ce=>ce?ce.replace(/@(\S+)/g,(oe,ve)=>`<span class="mention-highlight">@${ve}</span>`):"",W=()=>{const ce=c.value,oe=ce.lastIndexOf("@");if(oe!==-1&&oe===ce.length-1)w.value=!0,I.value="";else if(oe!==-1){const ve=ce.substring(oe+1);ve.includes(" ")?w.value=!1:(w.value=!0,I.value=ve)}else w.value=!1},te=()=>{w.value=!w.value,w.value&&!c.value.endsWith("@")&&(c.value+="@")},R=ce=>{var ve;const oe=c.value.lastIndexOf("@");oe!==-1?c.value=c.value.substring(0,oe)+`@${ce.name} `:c.value+=`@${ce.name} `,w.value=!1,j.value.push(ce.id),(ve=b.value)==null||ve.focus()},F=async()=>{const ce=c.value.trim();if(!ce)return;const oe={id:Date.now(),type:"text",text:ce,sent:!0,senderId:"me",time:Date.now(),groupId:o.groupId,mentions:j.value};try{await C.addGroupMessage(oe),r.value.push(oe),c.value="",j.value=[],await De()}catch(ve){console.error(":",ve)}},ie=()=>{G.value=!0},re=ce=>{ee.value=ce,d.value=ce.avatar},pe=()=>{K.value=!K.value,K.value?(alert(` AI 


 10-30 `),we()):(alert(" AI "),he())},we=()=>{if(q.value)return;const ce=()=>{if(!K.value)return;const oe=i.value.filter(_e=>_e.id!=="me");if(oe.length===0)return;const ve=oe[Math.floor(Math.random()*oe.length)];Ue(ve);const Ze=Math.random()*2e4+1e4;q.value=setTimeout(ce,Ze)};q.value=setTimeout(ce,3e3)},he=()=>{q.value&&(clearTimeout(q.value),q.value=null)},Ue=async ce=>{var oe,ve,Ze;try{const _e=await Wt.getApiConfig();if(!_e.apiKey||!_e.model){console.error(" API Key ");return}console.log(" AI :",ce.name);const ut=r.value.slice(-15).filter(rt=>rt.type==="text").map(rt=>`${m(rt.senderId)}: ${rt.text}`).join(`
`),gt=Wt.buildApiUrl(_e.baseUrl,_e.provider,"/v1/chat/completions"),at=r.value.filter(rt=>rt.type==="text").slice(-1)[0],Gt=at?m(at.senderId):"",It=at?at.text:"",as=`"${ce.name}"


${ce.bio||ce.prompt||""}

 - 
1. 
2. 5-15
3. 
4. 
5. 
6. 
7. 


A: 
B: 
C: 
A: 

 - 
 ""
 ""
 ""
 "**"

 - 
 ""
 ""
 ""
 ""
 ""
 ""
 ""
 "6666"


${ut}

 ${Gt} "${It}"

"${ce.name}"
- 5-15
- 
- 
- `,be=await fetch(gt,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${_e.apiKey}`},body:JSON.stringify({model:_e.model,messages:[{role:"system",content:as},{role:"user",content:`5-15"${ce.name}"`}],temperature:.7,max_tokens:30,presence_penalty:.6,frequency_penalty:.6})});if(!be.ok){const rt=await be.text();throw console.error("API :",be.status,rt),new Error(`API : ${be.status}`)}let de=(Ze=(ve=(oe=(await be.json()).choices[0])==null?void 0:oe.message)==null?void 0:ve.content)==null?void 0:Ze.trim();if(!de){console.error("AI ");return}if(de=de.replace(/^["']|["']$/g,""),de=de.replace(/\*[^*]+\*/g,"").replace(/\([^)]+\)/g,"").replace(/\[[^\]]+\]/g,"").replace(/~[^~]+~/g,"").replace(/[^]+/g,"").trim(),de.length>50&&(de=de.substring(0,50)),!de||de.length<2){console.warn("");return}console.log(" AI :",de);const pt={id:Date.now(),type:"text",text:de,sent:!1,senderId:ce.id,time:Date.now(),groupId:o.groupId,mentions:[]};await C.addGroupMessage(pt),r.value.push(pt),await De()}catch(_e){console.error(" AI :",_e),console.error(":",_e.message)}},ge=()=>{T.value=!0},B=ce=>{M.value=ce},L=async ce=>{try{l.value.avatar=ce,await C.updateGroup(l.value);const ve=(await C.getChatList()).find(Ze=>Ze.groupId===o.groupId);ve&&(ve.avatar=ce,await C.updateChatListItem(ve))}catch(oe){console.error(":",oe)}},k=ce=>{const oe=ce.redpacket.claimed,ve=ce.redpacket.count,Ze=ce.redpacket.remaining;let _e=` ${ce.redpacket.blessing}

`;_e+=`${ce.redpacket.amount.toFixed(2)}
`,_e+=`${oe.length}/${ve}
`,_e+=`${Ze.toFixed(2)}

`,oe.length>0?(_e+=`
`,oe.forEach((ut,gt)=>{const at=new Date(ut.time).toLocaleTimeString();_e+=`${gt+1}. ${ut.memberName} - ${ut.amount.toFixed(2)} (${at})
`})):_e+="",alert(_e)},y=ce=>{const oe=ce.vote;let ve=` ${oe.title}

`;const Ze=oe.options.reduce((_e,ut)=>_e+ut.voters.length,0);ve+=`${Ze}

`,oe.options.forEach((_e,ut)=>{const gt=Ze>0?(_e.voters.length/Ze*100).toFixed(1):0;ve+=`${ut+1}. ${_e.text}
`,ve+=`   ${_e.voters.length} (${gt}%)
`,_e.voters.length>0&&(ve+=`   ${_e.voters.map(at=>at.memberName).join("")}
`),ve+=`
`}),alert(ve)},H=ce=>{const oe=ce.solitaire;let ve=` ${oe.title}

`;ve+=`${oe.items.length}

`,oe.items.length>0?oe.items.forEach((Ze,_e)=>{const ut=new Date(Ze.time).toLocaleTimeString();ve+=`${_e+1}. ${Ze.content} (${ut})
`}):ve+="",alert(ve)},se=()=>{$.value=!$.value,$.value&&(w.value=!1)},P=async()=>{$.value=!1;const ce=prompt(` 

`);if(!ce||isNaN(ce)||parseFloat(ce)<=0)return;const oe=prompt("");if(!oe||isNaN(oe)||parseInt(oe)<=0)return;const ve=prompt("")||"",Ze={id:Date.now(),type:"redpacket",text:ve,sent:!0,senderId:"me",time:Date.now(),groupId:o.groupId,redpacket:{amount:parseFloat(ce),count:parseInt(oe),blessing:ve,claimed:[],remaining:parseFloat(ce)}};try{await C.addGroupMessage(Ze),r.value.push(Ze),await De(),K.value&&setTimeout(()=>U(Ze),2e3)}catch(_e){console.error(":",_e)}},U=async ce=>{const oe=i.value.filter(_e=>_e.id!=="me"&&!ce.redpacket.claimed.find(ut=>ut.memberId===_e.id));if(oe.length===0||ce.redpacket.remaining<=0)return;const ve=Math.min(Math.floor(Math.random()*oe.length)+1,ce.redpacket.count-ce.redpacket.claimed.length);for(let _e=0;_e<ve&&oe.length!==0;_e++){const ut=Math.floor(Math.random()*oe.length),gt=oe.splice(ut,1)[0],at=ce.redpacket.remaining,Gt=ce.redpacket.count-ce.redpacket.claimed.length,It=Gt===1?at:parseFloat((Math.random()*(at/Gt*2)).toFixed(2));ce.redpacket.claimed.push({memberId:gt.id,memberName:gt.name,amount:It,time:Date.now()+_e*500}),ce.redpacket.remaining-=It,await C.addGroupMessage(ce),await new Promise(as=>setTimeout(as,800))}const Ze=r.value.findIndex(_e=>_e.id===ce.id);Ze!==-1&&(r.value[Ze]={...ce})},O=async()=>{$.value=!1;const ce=prompt(` 

`);if(!ce)return;const oe=prompt(`
A,B,C`);if(!oe)return;const ve=oe.split(",").map(_e=>_e.trim()).filter(_e=>_e);if(ve.length<2){alert("2");return}const Ze={id:Date.now(),type:"vote",text:ce,sent:!0,senderId:"me",time:Date.now(),groupId:o.groupId,vote:{title:ce,options:ve.map(_e=>({text:_e,voters:[]})),multipleChoice:!1}};try{await C.addGroupMessage(Ze),r.value.push(Ze),await De(),K.value&&setTimeout(()=>Q(Ze),3e3)}catch(_e){console.error(":",_e)}},Q=async ce=>{const oe=i.value.filter(_e=>_e.id!=="me"),ve=Math.floor(Math.random()*oe.length)+1;for(let _e=0;_e<ve&&oe.length!==0;_e++){const ut=Math.floor(Math.random()*oe.length),gt=oe.splice(ut,1)[0],at=Math.floor(Math.random()*ce.vote.options.length);ce.vote.options[at].voters.push({memberId:gt.id,memberName:gt.name,time:Date.now()+_e*1e3}),await C.addGroupMessage(ce),await new Promise(Gt=>setTimeout(Gt,1200))}const Ze=r.value.findIndex(_e=>_e.id===ce.id);Ze!==-1&&(r.value[Ze]={...ce})},ae=()=>{$.value=!1;const ce=document.createElement("input");ce.type="file",ce.accept="image/*",ce.onchange=async oe=>{var Ze;const ve=(Ze=oe.target.files)==null?void 0:Ze[0];if(ve)try{const _e=new FileReader;_e.onload=async ut=>{const gt={id:Date.now(),type:"image",text:"[]",imageUrl:ut.target.result,sent:!0,senderId:"me",time:Date.now(),groupId:o.groupId};await C.addGroupMessage(gt),r.value.push(gt),await De(),K.value&&setTimeout(()=>fe(gt),2e3)},_e.readAsDataURL(ve)}catch(_e){console.error(":",_e)}},ce.click()},fe=async ce=>{const oe=["","","","","","",""],ve=i.value.filter(_e=>_e.id!=="me");if(ve.length===0)return;const Ze=Math.floor(Math.random()*2)+1;for(let _e=0;_e<Ze&&_e<ve.length;_e++){const ut=ve[Math.floor(Math.random()*ve.length)],gt=oe[Math.floor(Math.random()*oe.length)],at={id:Date.now()+_e,type:"text",text:gt,sent:!1,senderId:ut.id,time:Date.now()+_e*1e3,groupId:o.groupId,mentions:[]};await C.addGroupMessage(at),r.value.push(at),await De(),await new Promise(Gt=>setTimeout(Gt,1500))}},Me=()=>{$.value=!1,alert(` ...

`)},Ie=async()=>{$.value=!1;const ce=prompt(` 

`);if(!ce)return;const oe={id:Date.now(),type:"solitaire",text:ce,sent:!0,senderId:"me",time:Date.now(),groupId:o.groupId,solitaire:{title:ce,items:[]}};try{await C.addGroupMessage(oe),r.value.push(oe),await De(),K.value&&setTimeout(()=>$e(oe),2e3)}catch(ve){console.error(":",ve)}},$e=async ce=>{const oe=i.value.filter(_e=>_e.id!=="me"),ve=Math.floor(Math.random()*oe.length)+1;for(let _e=0;_e<ve&&oe.length!==0;_e++){const ut=Math.floor(Math.random()*oe.length),gt=oe.splice(ut,1)[0];ce.solitaire.items.push({memberId:gt.id,memberName:gt.name,content:`${gt.name} +1`,time:Date.now()+_e*1e3}),await C.addGroupMessage(ce),await new Promise(at=>setTimeout(at,1500))}const Ze=r.value.findIndex(_e=>_e.id===ce.id);Ze!==-1&&(r.value[Ze]={...ce})},ye=async()=>{$.value=!1;const ce=prompt(` 

`)||"",oe={id:Date.now(),type:"location",text:ce,sent:!0,senderId:"me",time:Date.now(),groupId:o.groupId,location:{name:ce,address:""}};try{await C.addGroupMessage(oe),r.value.push(oe),await De()}catch(ve){console.error(":",ve)}},Ne=(ce,oe)=>{x.value},Ee=ce=>{const oe=S.value.findIndex(ve=>ve.id===ce.id);oe>-1?S.value.splice(oe,1):S.value.push(ce)},He=ce=>S.value.some(oe=>oe.id===ce.id),Ge=()=>{x.value=!1,S.value=[]},et=()=>{alert("...")},me=async()=>{confirm(`${S.value.length}`)&&Ge()},le=ce=>{if(!ce)return"";const oe=new Date(ce),ve=String(oe.getHours()).padStart(2,"0"),Ze=String(oe.getMinutes()).padStart(2,"0");return`${ve}:${Ze}`},De=async()=>{await Yt(),u.value&&(u.value.scrollTop=u.value.scrollHeight)},xe=()=>{n("back")},Ve=async()=>{try{const ce=await C.getGroup(o.groupId);if(console.log(":",ce),ce){l.value=ce,M.value=ce.announcement||"";let oe=ce.memberIds||[];if(oe.length===0){const Ze=(await C.getChatList()).find(_e=>_e.groupId===o.groupId);Ze&&Ze.members&&(oe=Ze.members,console.log(" chatList ID:",oe))}if(console.log("ID:",oe),oe.length>0){const ve=await C.getGroupMembers(oe);console.log(":",ve),i.value=ve}else console.warn(""),i.value=[]}}catch(ce){console.error(":",ce)}},xt=async()=>{try{const ce=await C.getGroupMessages(o.groupId);r.value=ce,await De()}catch(ce){console.error(":",ce)}},yt=async()=>{try{const ce=await C.getSetting("userAvatar"),oe=await C.getSetting("userName"),ve=await C.getSetting("userBio");ce&&(ee.value.avatar=ce,d.value=ce),oe&&(ee.value.name=oe),ve&&(ee.value.bio=ve)}catch(ce){console.error(":",ce)}};return it(async()=>{try{await Promise.all([Ve(),xt(),yt()]),a.value=!1}catch(ce){console.error(":",ce),a.value=!1}}),zt(()=>{he()}),(ce,oe)=>(p(),f("div",y0,[a.value?(p(),f("div",b0,[...oe[5]||(oe[5]=[e("div",{class:"loading-spinner"},null,-1),e("div",{class:"loading-text"},"...",-1)])])):N("",!0),e("div",{class:"chat-container",ref_key:"chatContainer",ref:v},[e("div",w0,[e("div",{class:"header-info",onClick:oe[0]||(oe[0]=(...ve)=>ce.showGroupInfo&&ce.showGroupInfo(...ve))},[e("img",{src:l.value.avatar,class:"avatar header-avatar",alt:l.value.name},null,8,k0),e("div",x0,[e("h2",null,_(l.value.name),1),e("div",C0,[e("span",null,_(i.value.length)+"",1)])])]),e("div",$0,[(p(),f("svg",{class:"header-icon",onClick:ie,viewBox:"0 0 24 24",title:""},[...oe[6]||(oe[6]=[e("path",{fill:"currentColor",d:"M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"},null,-1)])])),(p(),f("svg",{class:"header-icon",onClick:pe,viewBox:"0 0 24 24",title:K.value?"AI":"AI"},[e("path",{fill:"currentColor",d:K.value?"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,16.5L6.5,12L7.91,10.59L11,13.67L16.59,8.09L18,9.5L11,16.5Z":"M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z"},null,8,M0)],8,_0)),(p(),f("svg",{class:"header-icon",onClick:xe,viewBox:"0 0 24 24"},[...oe[7]||(oe[7]=[e("path",{fill:"currentColor",d:"M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"},null,-1)])])),(p(),f("svg",{class:"header-icon",onClick:ge,viewBox:"0 0 24 24"},[...oe[8]||(oe[8]=[e("path",{fill:"currentColor",d:"M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"},null,-1)])]))])]),M.value?(p(),f("div",{key:0,class:"group-announcement",onClick:oe[1]||(oe[1]=(...ve)=>ce.showAnnouncementDetail&&ce.showAnnouncementDetail(...ve))},[oe[9]||(oe[9]=e("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},[e("path",{fill:"currentColor",d:"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,16.5L6.5,12L7.91,10.59L11,13.67L16.59,8.09L18,9.5L11,16.5Z"})],-1)),e("span",S0,_(M.value),1),oe[10]||(oe[10]=e("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},[e("path",{fill:"currentColor",d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"})],-1))])):N("",!0),e("div",{class:"chat-messages",ref_key:"messagesContainer",ref:u},[(p(!0),f(Le,null,Fe(Z.value,(ve,Ze)=>(p(),f("div",{key:ve.id||Ze,class:Se(["message",[ve.sent?"sent":"received",{"multi-select-mode":x.value}]]),onContextmenu:Pe(_e=>Ne(),["prevent"]),onClick:_e=>x.value?Ee(ve):null},[x.value?(p(),f("div",I0,[e("div",{class:Se(["checkbox",{checked:He(ve)}])},[He(ve)?(p(),f("svg",L0,[...oe[11]||(oe[11]=[e("path",{fill:"white",d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},null,-1)])])):N("",!0)],2)])):N("",!0),e("div",{class:"avatar",style:Oe({backgroundImage:`url(${ve.sent?d.value:E(ve.senderId)})`,backgroundSize:"cover",backgroundPosition:"center"})},null,4),e("div",T0,[ve.sent?N("",!0):(p(),f("div",j0,_(m(ve.senderId)),1)),ve.type==="text"?(p(),f("div",{key:1,class:"message-content",innerHTML:D(ve.text)},null,8,P0)):ve.type==="redpacket"?(p(),f("div",{key:2,class:"message-content redpacket-message",onClick:_e=>k(ve)},[oe[12]||(oe[12]=e("div",{class:"redpacket-icon"},"",-1)),e("div",B0,[e("div",V0,_(ve.redpacket.blessing),1),e("div",D0,_(ve.redpacket.claimed.length)+"/"+_(ve.redpacket.count)+"  ",1)])],8,E0)):ve.type==="vote"?(p(),f("div",{key:3,class:"message-content vote-message",onClick:_e=>y(ve)},[e("div",F0," "+_(ve.vote.title),1),e("div",U0,[(p(!0),f(Le,null,Fe(ve.vote.options,(_e,ut)=>(p(),f("div",{key:ut,class:"vote-option"},[e("div",R0,_(_e.text),1),e("div",N0,_(_e.voters.length)+"",1)]))),128))])],8,H0)):ve.type==="solitaire"?(p(),f("div",{key:4,class:"message-content solitaire-message",onClick:_e=>H(ve)},[e("div",z0," "+_(ve.solitaire.title),1),e("div",K0,_(ve.solitaire.items.length)+"",1)],8,O0)):ve.type==="location"?(p(),f("div",W0,[oe[13]||(oe[13]=e("div",{class:"location-icon"},"",-1)),e("div",G0,[e("div",q0,_(ve.location.name),1),e("div",Z0,_(ve.location.address),1)])])):ve.type==="image"?(p(),f("div",J0,[e("img",{src:ve.imageUrl,class:"message-image",alt:ve.text||""},null,8,Y0)])):N("",!0),e("div",X0,_(le(ve.time)),1)])],42,A0))),128)),A.value.length>0?(p(),f("div",Q0,[e("span",null,_(A.value.join(""))+" ...",1)])):N("",!0)],512),w.value?(p(),f("div",em,[oe[14]||(oe[14]=e("div",{class:"mention-title"},"@",-1)),(p(!0),f(Le,null,Fe(g.value,ve=>(p(),f("div",{key:ve.id,class:"mention-item",onClick:Ze=>R(ve)},[e("img",{src:ve.avatar,class:"mention-avatar"},null,8,sm),e("span",null,_(ve.name),1)],8,tm))),128))])):N("",!0),$.value?(p(),f("div",om,[e("div",{class:"add-menu-grid"},[e("div",{class:"add-menu-item",onClick:P},[...oe[15]||(oe[15]=[mt('<div class="add-menu-icon red-packet" data-v-8120ba77><svg viewBox="0 0 24 24" width="32" height="32" fill="none" stroke="white" stroke-width="2" data-v-8120ba77><rect x="3" y="6" width="18" height="16" rx="2" data-v-8120ba77></rect><path d="M3 10h18" data-v-8120ba77></path><circle cx="12" cy="15" r="2" fill="white" data-v-8120ba77></circle></svg></div><span data-v-8120ba77></span>',2)])]),e("div",{class:"add-menu-item",onClick:O},[...oe[16]||(oe[16]=[e("div",{class:"add-menu-icon vote"},[e("svg",{viewBox:"0 0 24 24",width:"32",height:"32",fill:"none",stroke:"white","stroke-width":"2"},[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),e("path",{d:"M8 12h8M8 8h8M8 16h5"})])],-1),e("span",null,"",-1)])]),e("div",{class:"add-menu-item",onClick:ae},[...oe[17]||(oe[17]=[mt('<div class="add-menu-icon image" data-v-8120ba77><svg viewBox="0 0 24 24" width="32" height="32" fill="none" stroke="white" stroke-width="2" data-v-8120ba77><rect x="3" y="3" width="18" height="18" rx="2" data-v-8120ba77></rect><circle cx="8.5" cy="8.5" r="1.5" fill="white" data-v-8120ba77></circle><path d="M21 15l-5-5L5 21" data-v-8120ba77></path></svg></div><span data-v-8120ba77></span>',2)])]),e("div",{class:"add-menu-item",onClick:Me},[...oe[18]||(oe[18]=[e("div",{class:"add-menu-icon file"},[e("svg",{viewBox:"0 0 24 24",width:"32",height:"32",fill:"none",stroke:"white","stroke-width":"2"},[e("path",{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"}),e("polyline",{points:"13 2 13 9 20 9"})])],-1),e("span",null,"",-1)])]),e("div",{class:"add-menu-item",onClick:Ie},[...oe[19]||(oe[19]=[mt('<div class="add-menu-icon solitaire" data-v-8120ba77><svg viewBox="0 0 24 24" width="32" height="32" fill="none" stroke="white" stroke-width="2" data-v-8120ba77><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" data-v-8120ba77></path><rect x="8" y="2" width="8" height="4" rx="1" data-v-8120ba77></rect><path d="M9 12h6M9 16h6" data-v-8120ba77></path></svg></div><span data-v-8120ba77></span>',2)])]),e("div",{class:"add-menu-item",onClick:ye},[...oe[20]||(oe[20]=[e("div",{class:"add-menu-icon location"},[e("svg",{viewBox:"0 0 24 24",width:"32",height:"32",fill:"none",stroke:"white","stroke-width":"2"},[e("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),e("circle",{cx:"12",cy:"10",r:"3"})])],-1),e("span",null,"",-1)])])])])):N("",!0),x.value?N("",!0):(p(),f("div",nm,[e("button",{class:"add-btn",onClick:se},[...oe[21]||(oe[21]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"})],-1)])]),ke(e("input",{ref_key:"inputField",ref:b,type:"text",class:"input-field","onUpdate:modelValue":oe[2]||(oe[2]=ve=>c.value=ve),placeholder:"...",onKeyup:ns(F,["enter"]),onInput:W},null,544),[[je,c.value]]),e("button",{class:"at-btn",onClick:te},[...oe[22]||(oe[22]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M12,2C6.48,2 2,6.48 2,12C2,17.52 6.48,22 12,22H17V20H12C7.66,20 4,16.34 4,12C4,7.66 7.66,4 12,4C16.34,4 20,7.66 20,12V13.43C20,14.22 19.29,15 18.5,15C17.71,15 17,14.22 17,13.43V12C17,9.24 14.76,7 12,7C9.24,7 7,9.24 7,12C7,14.76 9.24,17 12,17C13.38,17 14.64,16.44 15.54,15.53C16.19,16.42 17.31,17 18.5,17C20.47,17 22,15.4 22,13.43V12C22,6.48 17.52,2 12,2M12,15C10.34,15 9,13.66 9,12C9,10.34 10.34,9 12,9C13.66,9 15,10.34 15,12C15,13.66 13.66,15 12,15Z"})],-1)])]),e("button",{class:"send-btn",onClick:F},[...oe[23]||(oe[23]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})],-1)])])])),x.value?(p(),f("div",am,[e("button",{class:"toolbar-btn",onClick:et,disabled:S.value.length===0},[...oe[24]||(oe[24]=[e("svg",{viewBox:"0 0 24 24",width:"22",height:"22"},[e("path",{fill:"currentColor",d:"M12,8V4L20,12L12,20V16H4V8H12Z"})],-1),e("span",null,"",-1)])],8,lm),e("button",{class:"toolbar-btn danger",onClick:me,disabled:S.value.length===0},[...oe[25]||(oe[25]=[e("svg",{viewBox:"0 0 24 24",width:"22",height:"22"},[e("path",{fill:"currentColor",d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"})],-1),e("span",null,"",-1)])],8,im),oe[27]||(oe[27]=e("div",{style:{flex:"1"}},null,-1)),e("button",{class:"toolbar-btn",onClick:Ge},[...oe[26]||(oe[26]=[e("svg",{viewBox:"0 0 24 24",width:"22",height:"22"},[e("path",{fill:"currentColor",d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})],-1),e("span",null,"",-1)])])])):N("",!0),T.value?(p(),nt(i0,{key:5,"group-info":l.value,"group-members":i.value,onClose:oe[3]||(oe[3]=ve=>T.value=!1),onUpdateAnnouncement:B,onUpdateAvatar:L},null,8,["group-info","group-members"])):N("",!0),G.value?(p(),nt(h0,{key:6,onClose:oe[4]||(oe[4]=ve=>G.value=!1),onUpdate:re})):N("",!0)],512)]))}},cm=Xe(rm,[["__scopeId","data-v-8120ba77"]]),dm={class:"phone-container"},um={key:0,class:"diary-container"},vm={class:"diary-header"},pm={class:"diary-date"},fm={class:"diary-weather"},mm=["innerHTML"],gm={key:1,class:"history-container"},hm={class:"character-avatar"},ym=["src"],bm={class:"diary-list"},wm=["onTouchstart","onTouchend","onMousedown","onMouseup"],km={class:"diary-item-date"},xm={class:"diary-item-preview"},Cm={class:"diary-item-weather"},$m={key:0,class:"empty-state"},_m={key:2,class:"diary-container"},Mm={class:"diary-header"},Sm={class:"diary-date"},Am={class:"diary-weather"},Im=["innerHTML"],Lm=`
  <p><span class="highlight"></span><span class="emphasis"></span></p>
  <p><span class="handwritten"></span><span class="strikethrough"></span></p>
  <p><span class="censored hidden"></span></p>
  <p><span class="underline"></span>~</p>
`,Il=800,Tm={__name:"Diary",props:{contactId:{type:Number,required:!0}},emits:["back"],setup(t,{emit:s}){const o=t,n=s,a=h("main"),l=h({date:"",weather:"",content:""}),i=h(null),r=h("https://via.placeholder.com/80"),c=h(""),d=tt(()=>{const E=new Date,m=E.getFullYear(),g=String(E.getMonth()+1).padStart(2,"0"),D=String(E.getDate()).padStart(2,"0"),te=["","","","","","",""][E.getDay()];return`${m}${g}${D} ${te}`}),u=h("  25C"),v=h([]),b=async()=>{try{const m=(await C.getChatList()).find(g=>g.contactId===o.contactId);m&&(r.value=m.avatar||"https://via.placeholder.com/80",c.value=m.name||"")}catch(E){console.error(":",E)}},w=async()=>{try{const m=(await C.getDiaries(o.contactId)).sort((g,D)=>(D.createdAt||0)-(g.createdAt||0));if(v.value=m.map(g=>({id:g.id,date:g.date,preview:g.content.replace(/<[^>]*>/g,"").substring(0,30)+"...",weather:g.weather||" ",content:g.content,createdAt:g.createdAt})),m.length>0){const g=m[0];l.value={date:g.date,weather:g.weather,content:g.content}}}catch(E){console.error(":",E)}},I=()=>{n("back")},j=async()=>{await w(),a.value="history"},$=()=>{a.value="main"},x=E=>{i.value=E,a.value="view",Yt(()=>{S()})},S=()=>{document.querySelectorAll(".censored").forEach(m=>{m.addEventListener("click",function(){this.classList.toggle("hidden")})})},M=()=>{a.value="history",i.value=null};let A=null,T=0;const G=(E,m)=>{T=Date.now(),A=setTimeout(()=>{ee(E)},Il)},K=(E,m)=>{const g=Date.now()-T;A&&(clearTimeout(A),A=null),g<Il&&x(E)},q=()=>{A&&(clearTimeout(A),A=null)},ee=E=>{confirm(`

${E.date}
${E.preview}`)&&Z(E)},Z=async E=>{try{await C.deleteDiary(E.id);const m=v.value.findIndex(g=>g.id===E.id);if(m>-1&&v.value.splice(m,1),l.value.date===E.date)if(v.value.length>0){const g=v.value[0];l.value={date:g.date,weather:g.weather,content:g.content}}else l.value={date:"",weather:"",content:""};alert("")}catch(m){console.error(":",m),alert("")}};return it(async()=>{await b(),await w(),await Yt(),S()}),(E,m)=>(p(),f("div",dm,[a.value==="main"?(p(),f("div",um,[e("div",vm,[e("div",pm,_(l.value.date||d.value),1),e("div",fm,_(l.value.weather||u.value),1)]),e("div",{class:"diary-entry",innerHTML:l.value.content||Lm},null,8,mm),m[1]||(m[1]=e("div",{class:"diary-footer"},"~~",-1)),m[2]||(m[2]=e("div",{class:"diary-sticker sticker1"},null,-1)),e("div",{class:"back-text",onClick:I},""),e("div",{class:"history-btn",onClick:j},[...m[0]||(m[0]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("polyline",{points:"12 6 12 12 16 14"})],-1)])])])):N("",!0),a.value==="history"?(p(),f("div",gm,[e("div",{class:"history-header"},[e("div",{class:"back-text",onClick:$},""),m[3]||(m[3]=e("div",{class:"history-title"},"",-1)),m[4]||(m[4]=e("div",{style:{width:"40px"}},null,-1))]),e("div",hm,[e("img",{src:r.value,alt:"avatar"},null,8,ym)]),e("div",bm,[(p(!0),f(Le,null,Fe(v.value,(g,D)=>(p(),f("div",{key:D,class:"diary-item",onTouchstart:W=>G(g),onTouchend:W=>K(g),onTouchcancel:q,onMousedown:W=>G(g),onMouseup:W=>K(g),onMouseleave:q},[e("div",km,_(g.date),1),e("div",xm,_(g.preview),1),e("div",Cm,_(g.weather),1)],40,wm))),128)),v.value.length===0?(p(),f("div",$m,"  ")):N("",!0)])])):N("",!0),a.value==="view"?(p(),f("div",_m,[e("div",Mm,[e("div",Sm,_(i.value.date),1),e("div",Am,_(i.value.weather),1)]),e("div",{class:"diary-entry",innerHTML:i.value.content},null,8,Im),m[5]||(m[5]=e("div",{class:"diary-footer"},"~~",-1)),m[6]||(m[6]=e("div",{class:"diary-sticker sticker1"},null,-1)),e("div",{class:"back-text",onClick:M},"")])):N("",!0)]))}},jm=Xe(Tm,[["__scopeId","data-v-d81cb455"]]),rn=()=>crypto.randomUUID?crypto.randomUUID():`id-${Date.now()}-${Math.random().toString(16).slice(2)}`,Rs=(t,s)=>{const o=Array.from(String(t||""));return o.length<=s?o.join(""):o.slice(0,s).join("")};function Pm(t){const s=(t||"").trim();if(!s)return null;console.log(" :",s.substring(0,200));try{return JSON.parse(s)}catch{}let o=s.replace(/```json\s*/g,"").replace(/```\s*/g,"").replace(/[\u0000-\u001F\u007F-\u009F]/g,"").trim();const n=o.match(/(\{[\s\S]*\}|\[[\s\S]*\])/);if(n)try{const a=n[0].trim();return console.log("  JSON:",a.substring(0,100)),JSON.parse(a)}catch(a){console.warn(" :",a.message);try{let l=cleanJson;l=l.replace(/"\s*\n\s*"/g,`",
"`);const i=(l.match(/\{/g)||[]).length,r=(l.match(/\}/g)||[]).length,c=(l.match(/\[/g)||[]).length,d=(l.match(/\]/g)||[]).length;return i>r&&(l+="}".repeat(i-r)),c>d&&(l+="]".repeat(c-d)),console.log("  JSON:",l.substring(0,100)),JSON.parse(l)}catch(l){console.warn(" :",l.message)}}if(o.includes("{")&&!o.includes("}"))try{console.log("  JSON...");const a=o+"}";return JSON.parse(a)}catch{}if(o.includes("[")&&!o.includes("]"))try{console.log(" ...");const a=o+"]";return JSON.parse(a)}catch{}return console.error(" :",s),null}async function cn({system:t,user:s}){var l,i,r,c,d;const o=await Wt.getApiConfig();if(!(o!=null&&o.apiKey)||!(o!=null&&o.model))return{error:"NO_API_CONFIG"};let n=o.baseUrl||"",a;n?n.endsWith("/v1")?a=`${n}/chat/completions`:(n.endsWith("/")&&(n=n.slice(0,-1)),a=`${n}/v1/chat/completions`):a=`${{deepseek:"https://api.deepseek.com",gemini:"https://generativelanguage.googleapis.com",openai:"https://api.openai.com"}[o.provider]}/v1/chat/completions`,console.log(" :",a);try{const u=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.apiKey}`},body:JSON.stringify({model:o.model,messages:[{role:"system",content:t},{role:"user",content:s}],temperature:.9,max_tokens:2e3,stream:!1})});if(!u.ok){const j=await u.text().catch(()=>"");return console.error(" API :",u.status,j),{error:`HTTP_${u.status}`,detail:j}}const v=await u.text();console.log(" :",v.substring(0,200));let b;try{b=JSON.parse(v)}catch(j){return console.error(" JSON :",j),{error:"PARSE_ERROR",raw:v}}let w=null;if(b.choices&&b.choices[0]&&(w=((l=b.choices[0].message)==null?void 0:l.content)||b.choices[0].text),!w&&b.candidates&&b.candidates[0]&&(w=(c=(r=(i=b.candidates[0].content)==null?void 0:i.parts)==null?void 0:r[0])==null?void 0:c.text),!w&&b.content&&(w=b.content),!w)return console.error(" :",JSON.stringify(b,null,2)),b.candidates&&((d=b.candidates[0])==null?void 0:d.finishReason)==="SAFETY"?(console.error(" "),{error:"SAFETY_FILTERED",raw:b,content:" prompt "}):b.choices&&b.choices.length===0?(console.error(" API  choices "),{error:"EMPTY_CHOICES",raw:b,content:"API "}):{error:"NO_CONTENT",raw:b,content:""};console.log(" :",w.substring(0,100));const I=Pm(w);return I||(console.error("  JSON:",w),{error:"INVALID_JSON",raw:w})}catch(u){return console.error(" :",u),{error:"NETWORK_ERROR",detail:u.message}}}async function ma(t){var w,I,j;const s=await C.getContact(t);if(!s)return{ok:!1,reason:"NO_CONTACT"};const o=`chat_${t}`,a=(await C.getChatMessages(o)||[]).slice(-30);if(a.length===0)return{ok:!1,reason:"NO_MESSAGES"};const l=a.map($=>{const x=$.sent?"":"",S=$.type==="text"?$.text:`[${$.type}]`;return`${x}: ${S}`}).join(`
`),i=await cn({system:` ${s.name||"ta"}JSONemoji2080${s.prompt||s.bio||""}`,user:`${l}

 1 
author_id ${String(t)}
${s.name||"ta"}
${s.prompt||s.bio||""}

""(bio)820

 
emojiooc

20











${l}`});console.log("  AI :",i);let r="",c="",d="";if(i!=null&&i.error&&(i==null?void 0:i.error)!=="INVALID_JSON")if(console.error(" AI :",i.error),i!=null&&i.content&&typeof i.content=="string"&&i.content.trim())console.log("  content ");else return{ok:!1,reason:"AI_ERROR",detail:i.error};let u="";if(typeof i=="string"?u=i:i!=null&&i.content?u=i.content:(w=i==null?void 0:i.data)!=null&&w.content?u=i.data.content:i!=null&&i.raw&&(typeof i.raw=="string"?u=i.raw:(I=i.raw)!=null&&I.content?u=i.raw.content:(j=i.raw)!=null&&j.text&&(u=i.raw.text)),u=(u||"").trim(),console.log(" :",u),!u)return console.error(" "),{ok:!1,reason:"EMPTY_RESPONSE"};const v=u.split(/\n\s*\n/).map($=>$.trim()).filter($=>$);if(v.length>=3)r=v[0],c=v[1],d=Rs(v[2],20).trim(),console.log("  3 ");else if(v.length===2){r=v[0],c=v[1];const $=r.split(`
`).map(x=>x.trim()).filter(x=>x);d=$.length>0?Rs($[$.length-1],20).trim():r.substring(0,20),console.log("  2 ")}else if(v.length===1){const $=u.split(`
`).map(x=>x.trim()).filter(x=>x);if($.length>=3){const x=$[$.length-1];if(x.length<=15){const S=$[$.length-2];S.length<=20?(r=$.slice(0,-2).join(`
`),c=S,d=Rs(x,20).trim(),console.log("  +  + ")):(r=$.slice(0,-1).join(`
`),c="",d=Rs(x,20).trim(),console.log("  + "))}else r=$.slice(0,-1).join(`
`),c=$[$.length-1],d=Rs($[0],20).trim(),console.log("  + ")}else $.length===2?(r=$[0],c=$[1],d=Rs($[0],20).trim(),console.log("  2 ")):(r=u,c="",d=Rs(r,20).trim(),console.log("  1 "))}else r=u,c="",d=Rs(r,20).trim(),console.log(" ");if(r=r.replace(/\n/g,`
`).replace(/\"/g,'"').trim(),c=c.replace(/\n/g,`
`).replace(/\"/g,'"').trim(),d=d.replace(/\n/g," ").replace(/\"/g,'"').trim(),!r)return console.error(" "),{ok:!1,reason:"EMPTY_CONTENT"};const b={id:rn(),author_id:t,isSelf:!1,aiGenerated:!0,content:r,mediaDesc:c,image:"",mentions:[],visibility:"public",likes:0,liked:!1,shares:0,comments:[],createdAt:Date.now()};if(await C.upsertMomentPost(b),d)try{await C.updateContact({...s,bio:d,updatedAt:Date.now()})}catch($){console.warn(" bio :",t,$)}return await C.markMessagesAsProcessedForMoment(a.map($=>$.id)),{ok:!0,postId:b.id}}async function Em(){const s=(await C.getChatList()||[]).filter(n=>n.type==="single"&&n.contactId);let o=0;for(const n of s)try{const a=await ma(n.contactId);a!=null&&a.ok&&(o+=1)}catch(a){console.warn(":",n==null?void 0:n.contactId,a)}return{okCount:o,total:s.length}}typeof window<"u"&&window.addEventListener("ai-force-generate-moments",async()=>{try{const t=await Em();window.dispatchEvent(new CustomEvent("ai-force-generate-moments-done",{detail:t}))}catch(t){window.dispatchEvent(new CustomEvent("ai-force-generate-moments-done",{detail:{okCount:0,total:0,error:String((t==null?void 0:t.message)||t)}}))}});class Bm{constructor(){this.isEnabled=!1,this.checkInterval=null,this.lastCheckTime={}}async start(){this.isEnabled=!0,await C.setSetting("autoDiaryEnabled",!0),this.checkInterval=setInterval(()=>{this.checkAndGenerate()},6e4),console.log("")}async stop(){this.isEnabled=!1,await C.setSetting("autoDiaryEnabled",!1),this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null),console.log("")}async enableFirstTime(s){try{const o=`chat_${s}`;await C.markAllMessagesAsSummarized(o),console.log(` ${s} `)}catch(o){console.error(":",o)}}async checkAndGenerate(){if(this.isEnabled)try{const s=await C.getChatList();for(const o of s){if(o.type!=="single")continue;const n=`chat_${o.contactId}`,a=o.contactId;(await C.getUnsummarizedMessages(n,null)).length<=10||(console.log(`:  ${a}`),await this.generateDiary(a,n))}}catch(s){console.error(":",s)}}async generateDiary(s,o){var n,a,l,i;try{const r=await C.getUnsummarizedMessages(o,50);if(r.length===0){console.log("");return}const c=r.map(q=>{const ee=q.sent?"":"ta",Z=q.type==="text"?q.text:`[${q.type}]`;return`${ee}: ${Z}`}).join(`
`),d=await C.getContact(s),u=(d==null?void 0:d.name)||"ta",b=[{role:"system",content:this.buildDiaryPrompt(u)},{role:"user",content:`

${c}`}],w=await Wt.getApiConfig();if(!w.apiKey||!w.model)throw new Error(" API ");let I=w.baseUrl||"";I.endsWith("/v1")?I=I.slice(0,-3):I.endsWith("/")&&(I=I.slice(0,-1));const $=`${{deepseek:I||"https://api.deepseek.com",gemini:I||"https://generativelanguage.googleapis.com",openai:I||"https://api.openai.com"}[w.provider]}/v1/chat/completions`;console.log(" :",$);const x=await fetch($,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w.apiKey}`},body:JSON.stringify({model:w.model,messages:b,temperature:.9,max_tokens:2e3,stream:!1})});if(!x.ok){const q=await x.text();throw console.error(" API :",x.status,q),new Error(`HTTP error! status: ${x.status}`)}const S=await x.text();console.log(" :",S.substring(0,200));let M;try{M=JSON.parse(S)}catch(q){throw console.error(" JSON :",q),new Error(" API ")}let A=null;if(M.choices&&M.choices[0]&&(A=((n=M.choices[0].message)==null?void 0:n.content)||M.choices[0].text),!A&&M.candidates&&M.candidates[0]&&(A=(i=(l=(a=M.candidates[0].content)==null?void 0:a.parts)==null?void 0:l[0])==null?void 0:i.text),!A&&M.content&&(A=M.content),!A)throw console.error(" :",M),new Error("");console.log(" :",A.substring(0,100));const T=this.parseDiaryContent(A),G={contactId:s,date:T.date,weather:T.weather,content:T.content,createdAt:Date.now()};await C.addDiary(G);const K=r.map(q=>q.id);await C.markMessagesAsSummarized(K),this.showDiaryNotification(u),console.log(" :",G)}catch(r){throw console.error(" :",r),r}}async manualGenerate(s){const o=`chat_${s}`;if((await C.getUnsummarizedMessages(o,null)).length===0)throw new Error("");await this.generateDiary(s,o)}buildDiaryPrompt(s){return` ${s}

{{}}
{{}}
{{}}


1. YYYYMMDD X20260118 
2. emoji +  +   / 15
3. 
   - 
   - ""
   - 
   - 5-82-4
   - 

3-5
- ~~~~ - 
- **** - 
- ____ - 
- !!!! - 
- #### - 
- @@@@ - 2-8


-  ${s}""
- """ta""/"
- "ta"""
- ""  "ta"
- "ta"  "tata"


- 
- 
- 
- 
- 
- 
- ${s}


- 5-82-4
- 3-5
- 
- 


20260118 
  / 22
##ta##""""
ta""****
ta
tata""
ta""""""
ta""
____~~~~
@@ta@@ta

`}convertMarkupToHTML(s){return s?s.split(`
`).map(a=>a.trim()).filter(a=>a).map(a=>(a=a.replace(/~~(.+?)~~/g,'<span class="strikethrough">$1</span>'),a=a.replace(/\*\*(.+?)\*\*/g,'<span class="highlight">$1</span>'),a=a.replace(/__(.+?)__/g,'<span class="underline">$1</span>'),a=a.replace(/!!(.+?)!!/g,'<span class="emphasis">$1</span>'),a=a.replace(/##(.+?)##/g,'<span class="handwritten">$1</span>'),a=a.replace(/@@(.+?)@@/g,'<span class="censored hidden">$1</span>'),`<p>${a}</p>`)).join(""):""}parseDiaryContent(s){const o=s.match(/[:]\s*(.+)/),n=o?o[1].trim():this.getCurrentDate(),a=s.match(/[:]\s*(.+)/),l=a?a[1].trim():"  / 22",i=s.match(/[:]\s*([\s\S]+)/);let r=i?i[1].trim():s;return r=this.convertMarkupToHTML(r),{date:n,weather:l,content:r}}getCurrentDate(){const s=new Date,o=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),a=String(s.getDate()).padStart(2,"0"),i=["","","","","","",""][s.getDay()];return`${o}${n}${a} ${i}`}showDiaryNotification(s){window.dispatchEvent(new CustomEvent("show-diary-notification",{detail:{message:`${s}`}}))}async getStatus(){return await C.getSetting("autoDiaryEnabled")}}const uo=new Bm;class Vm{constructor(){this.isEnabled=!1,this.checkInterval=null,this.lastMomentTime={}}async start(){this.isEnabled=!0,await C.setSetting("autoMomentEnabled",!0),this.checkInterval=setInterval(()=>{this.checkAndGenerate()},18e4),console.log(" ")}async stop(){this.isEnabled=!1,await C.setSetting("autoMomentEnabled",!1),this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null),console.log(" ")}async enableFirstTime(s){try{const o=`chat_${s}`;await C.markAllMessagesAsProcessedForMoment(o),console.log(`  ${s} `)}catch(o){console.error(" :",o)}}async checkAndGenerate(){if(this.isEnabled)try{const s=await C.getChatList(),o=Date.now();for(const n of s){if(n.type!=="single"||!n.contactId)continue;const a=n.contactId,l=`chat_${a}`,i=await C.getUnprocessedForMomentMessages(l),r=this.lastMomentTime[a]||0,c=30*60*1e3;if(o-r<c){console.log(`  ${a} `);continue}const d=this.shouldGenerateMoment(i,o,r);if(d.trigger){console.log(` :  ${a}, : ${d.reason}`);try{const u=await ma(a);u!=null&&u.ok&&(this.lastMomentTime[a]=o,console.log(`  ${a} `),this.showMomentNotification(a))}catch(u){console.warn(` : ${a}`,u)}}}}catch(s){console.error(" :",s)}}shouldGenerateMoment(s,o,n){if(!s||s.length===0)return{trigger:!1,reason:""};const a=s.length,l=o-(n||0);return a>=15?{trigger:!0,reason:` (${a})`}:a>=8&&l>2*60*60*1e3?{trigger:!0,reason:` (${a}) + `}:a>=5&&l>4*60*60*1e3&&Math.random()<.3?{trigger:!0,reason:" + "}:!n&&a>=10?{trigger:!0,reason:` (${a})`}:{trigger:!1,reason:` (${a})`}}async showMomentNotification(s){try{const o=await C.getContact(s),n=(o==null?void 0:o.name)||"";window.dispatchEvent(new CustomEvent("show-moment-notification",{detail:{message:`${n} `,contactId:s}}))}catch(o){console.warn(":",o)}}async manualGenerate(s){const o=`chat_${s}`;if((await C.getUnprocessedForMomentMessages(o)).length===0)throw new Error("");const a=await ma(s);return a!=null&&a.ok&&(this.lastMomentTime[s]=Date.now()),a}async getStatus(){return{enabled:await C.getSetting("autoMomentEnabled")||!1,isRunning:this.isEnabled,lastMomentTime:this.lastMomentTime}}resetCooldown(s){delete this.lastMomentTime[s],console.log(`  ${s} `)}resetAllCooldowns(){this.lastMomentTime={},console.log(" ")}scheduleInteractForUserPost(s){if(!(s!=null&&s.isSelf)||!(s!=null&&s.id))return;const o=Math.floor(Math.random()*10001+5e3);setTimeout(()=>{this.interactWithUserPost(s).catch(n=>console.error(":",n))},o)}scheduleReplyToMention({postId:s,actorId:o,userName:n,userCommentText:a}){if(!s||o==null||!n)return;const l=Math.floor(Math.random()*5001+5e3);setTimeout(()=>{this.replyToMention({postId:s,actorId:o,userName:n,userCommentText:a}).catch(i=>console.error(":",i))},l)}scheduleReplyToUserCommentOnRolePost({postId:s,actorId:o,userId:n="self",userName:a,userCommentText:l}){if(!s||o==null||!a)return;const i=Math.floor(Math.random()*10001+5e3);setTimeout(()=>{this.replyToUserCommentOnRolePost({postId:s,actorId:o,userId:n,userName:a,userCommentText:l}).catch(r=>console.error(":",r))},i)}async interactWithUserPost(s){const o=await C.getContacts(),n=o[Math.floor(Math.random()*o.length)];if(!n)return;const a=n.id,l=await cn({system:` ${n.name||"ta"}



 like  comment

 comment525 like 

${n.prompt||n.bio||""}`,user:`
${s.content||"()"}

`});console.log(" :",l);let i="";if(typeof l=="string"?i=l:l!=null&&l.raw&&typeof l.raw=="string"?i=l.raw:l!=null&&l.content&&typeof l.content=="string"&&(i=l.content),i=(i||"").trim(),i=i.replace(/```[\s\S]*?```/g,"").trim(),i=i.replace(/^["']|["']$/g,"").trim(),console.log(" :",i),!i)return;const r=i.split(/\n\s*\n/).map(v=>v.trim()).filter(v=>v);let c="",d="";if(r.length>=2)c=r[0].toLowerCase(),d=r[1];else if(r.length===1){const v=r[0].toLowerCase();v.includes("like")||v.includes("")?c="like":(v.includes("comment")||v.includes(""))&&(c="comment",d=r[0])}const u=await C.getMomentPost(s.id);if(!(!u||!u.isSelf)){if(c==="like"){const v={...u,likes:(u.likes||0)+1};await C.upsertMomentPost(v);return}if(c==="comment"&&d&&d!==""){const v={id:rn(),author_id:a,text:d,createdAt:Date.now()},b={...u,comments:[...u.comments||[],v]};await C.upsertMomentPost(b),window.dispatchEvent(new CustomEvent("moment-ai-comment",{detail:{author_id:a,authorName:n.name,postId:u.id}}))}}}async replyToMention({postId:s,actorId:o,userName:n,userCommentText:a}){const l=await C.getContact(o);if(!l)return;const i=await C.getMomentPost(s);if(!i||!i.isSelf)return;const r=(i.comments||[]).slice().sort((b,w)=>(b.createdAt||0)-(w.createdAt||0)).slice(-12).map(b=>{const w=b.isSelf?"":"",I=b.text||"";return`${w}: ${I}`}).join(`
`),c=await cn({system:` ${l.name||"ta"}

JSON


-  @${n} 
- 
- 630
- 

${l.prompt||l.bio||""}`,user:`${i.content||"()"}

${a||""}


${r}

 @${n} `});console.log("  @:",c);let d="";if(typeof c=="string"?d=c:c!=null&&c.raw&&typeof c.raw=="string"?d=c.raw:c!=null&&c.content&&typeof c.content=="string"&&(d=c.content),d=(d||"").trim(),d=d.replace(/```[\s\S]*?```/g,"").trim(),d=d.replace(/^["']|["']$/g,"").trim(),console.log(" :",d),!d||d.length<2){console.error(" ");return}d.startsWith(`@${n}`)||(d=`@${n} ${d}`);const u={id:rn(),author_id:o,text:d,createdAt:Date.now()},v={...i,comments:[...i.comments||[],u]};await C.upsertMomentPost(v),window.dispatchEvent(new CustomEvent("moment-ai-comment",{detail:{author_id:o,authorName:l.name,postId:i.id}}))}async replyToUserCommentOnRolePost({postId:s,actorId:o,userId:n="self",userName:a,userCommentText:l}){const i=await C.getContact(o);if(!i)return;const r=await C.getMomentPost(s);if(!r||r.isSelf||r.author_id!==o)return;const c=(r.comments||[]).slice().sort((w,I)=>(w.createdAt||0)-(I.createdAt||0)).slice(-14).map(w=>{const I=w.isSelf?"":"",j=w.text||"";return`${I}: ${j}`}).join(`
`),d=await cn({system:` ${i.name||"ta"}

JSON


-  @${a} 
- 
- 635
- 

${i.prompt||i.bio||""}`,user:`${r.content||"()"}

${l||""}


${c}

 @${a} `});console.log(" :",d);let u="";if(typeof d=="string"?u=d:d!=null&&d.raw&&typeof d.raw=="string"?u=d.raw:d!=null&&d.content&&typeof d.content=="string"&&(u=d.content),u=(u||"").trim(),u=u.replace(/```[\s\S]*?```/g,"").trim(),u=u.replace(/^["']|["']$/g,"").trim(),console.log(" :",u),!u||u.length<2){console.error(" ");return}u.startsWith(`@${a}`)||(u=`@${a} ${u}`);const v={id:rn(),author_id:o,text:u,createdAt:Date.now()},b={...r,comments:[...r.comments||[],v]};await C.upsertMomentPost(b),window.dispatchEvent(new CustomEvent("moment-ai-comment",{detail:{author_id:o,authorName:i.name,postId:r.id}}))}}const ls=new Vm,Dm={class:"phone-container"},Hm={class:"settings-container"},Fm={class:"settings-tabs"},Um={class:"settings-list"},Rm={key:0},Nm={class:"setting-section"},Om={class:"setting-item"},zm={class:"setting-item"},Km={class:"setting-item"},Wm={class:"password-input"},Gm=["type"],qm={class:"setting-item"},Zm=["disabled"],Jm={key:0,class:"setting-item"},Ym=["value"],Xm={class:"setting-item"},Qm={class:"switch-container"},eg={class:"switch"},tg={class:"switch-label"},sg={class:"setting-section"},og={class:"setting-item"},ng={class:"switch-container"},ag={class:"switch"},lg={class:"switch-label"},ig={class:"setting-item"},rg=["disabled"],cg={class:"setting-section"},dg={class:"setting-item"},ug={class:"switch-container"},vg={class:"switch"},pg={class:"switch-label"},fg={key:0,class:"setting-item"},mg={class:"setting-section"},gg={class:"setting-item"},hg={class:"switch-container"},yg={class:"switch"},bg={class:"switch-label"},wg={key:1},kg={class:"setting-section"},xg={class:"setting-item"},Cg={class:"avatar-preview-container"},$g={class:"setting-item"},_g={class:"setting-section"},Mg={class:"setting-item"},Sg={key:0,class:"wallpaper-preview"},Ag=["src"],Ig={class:"setting-section"},Lg={viewBox:"0 0 24 24",width:"20",height:"20",style:{fill:"#999"}},Tg={class:"setting-section"},jg={viewBox:"0 0 24 24",width:"20",height:"20",style:{fill:"#999"}},Pg={viewBox:"0 0 24 24",width:"20",height:"20",style:{fill:"#999"}},Eg={class:"setting-section"},Bg={class:"setting-item"},Vg={class:"switch-container"},Dg={class:"switch"},Hg={class:"switch-label"},Fg={class:"setting-item"},Ug={class:"switch-container"},Rg={class:"switch"},Ng={class:"switch-label"},Og={class:"setting-section"},zg={key:0,class:"setting-item"},Kg={style:{padding:"12px",background:"#f0f8ff","border-radius":"8px","margin-bottom":"12px"}},Wg={style:{"font-size":"14px",color:"#333"}},Gg={style:{"font-size":"14px",color:"#333","margin-top":"4px"}},qg={style:{width:"100%",height:"8px",background:"#e0e0e0","border-radius":"4px","margin-top":"8px",overflow:"hidden"}},Zg={class:"setting-item"},Jg=["disabled"],Yg={class:"setting-section"},Xg={class:"setting-item"},Qg=["disabled"],eh={class:"setting-item"},th=["disabled"],sh={class:"font-manager-container"},oh={class:"font-manager-content"},nh={class:"font-preview-section"},ah={class:"setting-item"},lh={class:"switch-container"},ih={class:"switch"},rh={class:"switch-label"},ch={class:"installed-fonts-section"},dh={class:"font-list"},uh={class:"app-icon-info"},vh=["src"],ph={class:"font-item-name"},fh={class:"font-item-actions"},mh=["onClick"],gh=["onClick"],hh={class:"font-manager-container"},yh={class:"customizer-content"},bh={class:"customizer-tabs"},wh={key:0,class:"editor-panel"},kh={key:1,class:"editor-panel"},xh={key:2,class:"preview-panel"},Ch={class:"preview-container"},$h={class:"preview-phone",ref:"previewPhone"},_h={class:"preview-desktop"},Mh={class:"status-bar"},Sh={class:"status-bar-left"},Ah={class:"widget-container"},Ih={class:"widget widget-clock"},Lh={class:"time"},Th={class:"date"},jh=["innerHTML"],Ph={class:"font-manager-container"},Eh={class:"font-manager-content"},Bh={class:"font-preview-section"},Vh={class:"font-upload-section"},Dh={viewBox:"0 0 24 24",width:"48",height:"48",style:{fill:"#6c8cd5","margin-bottom":"12px"}},Hh={class:"font-link-section"},Fh={class:"installed-fonts-section"},Uh={class:"font-list"},Rh=["onClick"],Nh={class:"font-item-actions"},Oh={key:0,class:"font-btn active-btn"},zh={key:1,class:"font-btn apply-btn"},Kh=["onClick"],Wh={__name:"Settings",emits:["back"],setup(t,{emit:s}){const o=s,n=h("ai"),a=h({provider:"deepseek",apiKey:"",baseUrl:"",model:""}),l=h(!1),i=h([]),r=h(!1),c=h(!1),d=h(!1),u=h(!1),v=h(!1),b=h("https://via.placeholder.com/80"),w=h(""),I=h(null),j=h(null),$=h(""),x=h(""),S=h(!0),M=h(!0),A=h(!1),T=h(!1),G=h(null),K=h(!1),q=h({total:0,processed:0,savedSize:"0 KB"}),ee=h(!1),Z=h(""),E=h(!1),m=h(null),g=h(""),D=h("system-ui"),W=h([{name:"",family:"system-ui",isSystem:!0},{name:"Arial",family:"Arial",isSystem:!0},{name:"Times New Roman",family:"Times New Roman",isSystem:!0},{name:"Courier New",family:"Courier New",isSystem:!0}]),te=h(!1),R=h(null),F=h(""),ie=h(!0),re=h([{name:"Messages",iconSrc:"https://files.catbox.moe/14op6b.jpg",isCustom:!1},{name:"Moments",iconSrc:"https://files.catbox.moe/gvs6a5.jpg",isCustom:!1},{name:"Mori",iconSrc:"https://files.catbox.moe/f0p41u.png",isCustom:!1},{name:"Forum",iconSrc:"https://files.catbox.moe/jpd1lk.jpg",isCustom:!1},{name:"Music",iconSrc:"https://img.wjwj.top/2026/02/18/f6486d844bff10d88a0514db5f710875.md.png",isCustom:!1},{name:"Pornhub",iconSrc:"https://upload.wikimedia.org/wikipedia/commons/f/f1/Pornhub-logo.svg",isCustom:!1},{name:"Live",iconSrc:"https://files.catbox.moe/mg3qg0.jpg",isCustom:!1},{name:"Phone",iconSrc:"https://files.catbox.moe/7ji6fb.png",isCustom:!1},{name:"Mail",iconSrc:"https://files.catbox.moe/edai70.png",isCustom:!1},{name:"World",iconSrc:"https://files.catbox.moe/it221m.png",isCustom:!1},{name:"Settings",iconSrc:"https://files.catbox.moe/2khrtz.png",isCustom:!1}]),pe=h(!1),we=h("css"),he=h(""),Ue=h(""),ge=h(""),B=()=>{const be=new Date,V=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],de=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];ge.value=`${V[be.getDay()]}, ${de[be.getMonth()]} ${be.getDate()}`},L=be=>{Z.value=be,ee.value=!0,setTimeout(()=>{ee.value=!1},2e3)},k=async()=>{try{const be=await Wt.getApiConfig();a.value=be;const V=await uo.getStatus();c.value=V||!1;const de=await ls.getStatus();d.value=de.enabled||!1;const pt=await Wt.getBackgroundStatus();u.value=pt||!1;const rt=await C.getSetting("userAvatar");rt&&(b.value=rt);const Et=await C.getSetting("userNickname");Et&&(w.value=Et);const bt=await C.getSetting("wallpaper");bt&&($.value=bt);const J=await C.getSetting("notificationSound");S.value=J!==!1;const X=await C.getSetting("vibration");M.value=X!==!1;const ne=await C.getSetting("visionEnabled");v.value=ne===!0;const Te=await C.getSetting("iconBackdropFilter");Te!==void 0&&(ie.value=Te);const ue=await C.getSetting("appIcons");ue&&Array.isArray(ue)&&(re.value=ue);const We=await C.getSetting("globalFont");We&&(D.value=We,document.documentElement.style.setProperty("--global-font",We));const Re=await C.getSetting("customFonts");if(Re&&Array.isArray(Re)){for(const Be of Re){const Mt=document.createElement("style");Be.data?Mt.textContent=`
            @font-face {
              font-family: '${Be.family}';
              src: url(${Be.data});
            }
          `:Be.url&&(Mt.textContent=`
            @font-face {
              font-family: '${Be.family}';
              src: url(${Be.url});
            }
          `),document.head.appendChild(Mt)}W.value=[...W.value.filter(Be=>Be.isSystem),...Re]}}catch(be){console.error(":",be)}},y=async()=>{if(!a.value.apiKey){L(" API ");return}r.value=!0;try{const be=await Wt.fetchModels(a.value.provider,a.value.apiKey,a.value.baseUrl);i.value=be,L("")}catch(be){L(""),console.error(be)}finally{r.value=!1}},H=async()=>{try{await Wt.saveApiConfig(a.value),L("API ")}catch(be){L(""),console.error(be)}},se=async()=>{try{if(c.value){const be=await C.getChatList();for(const V of be)V.type==="single"&&await uo.enableFirstTime(V.contactId);await uo.start(),L("")}else await uo.stop(),L("")}catch(be){L(""),console.error(be)}},P=async()=>{try{const V=(await C.getChatList()).find(de=>de.type==="single");if(!V){L("");return}L("..."),await uo.manualGenerate(V.contactId),L("")}catch(be){L(""+be.message),console.error(be)}},U=async()=>{try{if(d.value){const be=await C.getChatList();for(const V of be)V.type==="single"&&V.contactId&&await ls.enableFirstTime(V.contactId);await ls.start(),L(" ")}else await ls.stop(),L(" ")}catch(be){L(""),console.error(be)}},O=async()=>{try{ls.resetAllCooldowns(),L(" ")}catch(be){L(""),console.error(be)}},Q=async()=>{try{u.value?(await Wt.startBackgroundMessages(),L("")):(await Wt.stopBackgroundMessages(),L(""))}catch(be){L(""),console.error(be)}},ae=async()=>{try{await C.setSetting("visionEnabled",v.value),L(v.value?" AI ":" AI ")}catch(be){L(""),console.error(be)}},fe=async be=>{const V=be.target.files[0];if(V)try{L("...");const de=await Me(V,400,400,.8);b.value=de,L(" ")}catch(de){console.error(":",de),L(" ")}},Me=(be,V,de,pt=.8)=>new Promise((rt,Et)=>{const bt=new FileReader;bt.onload=J=>{const X=new Image;X.onload=()=>{const ne=document.createElement("canvas"),Te=ne.getContext("2d");let ue=X.width,We=X.height;if(ue>V||We>de){const Be=Math.min(V/ue,de/We);ue=ue*Be,We=We*Be}ne.width=ue,ne.height=We,Te.drawImage(X,0,0,ue,We);const Re=ne.toDataURL("image/jpeg",pt);console.log(` : ${(be.size/1024).toFixed(2)}KB -> ${(Re.length/1024).toFixed(2)}KB`),rt(Re)},X.onerror=()=>{Et(new Error(""))},X.src=J.target.result},bt.onerror=()=>{Et(new Error(""))},bt.readAsDataURL(be)}),Ie=async()=>{try{await C.setSetting("userAvatar",b.value),await C.setSetting("userNickname",w.value),L("")}catch(be){L(""),console.error(be)}},$e=async be=>{const V=be.target.files[0];if(V)try{L("...");const de=await Me(V,1080,1920,.85);$.value=de,x.value=de,L(" ")}catch(de){console.error(":",de),L(" ")}},ye=async()=>{if(!x.value){L("");return}try{await C.setSetting("wallpaper",x.value),L(""),window.dispatchEvent(new CustomEvent("wallpaper-changed",{detail:{wallpaper:x.value}}))}catch(be){L(""),console.error(be)}},Ne=()=>{o("back")},Ee=()=>{E.value=!0},He=()=>{E.value=!1},Ge=async be=>{const V=be.target.files[0];if(V)try{const de=new FileReader;de.onload=async pt=>{const rt=pt.target.result,Et=V.name.replace(/\.[^/.]+$/,""),bt=`custom-${Date.now()}`,J=document.createElement("style");J.textContent=`
        @font-face {
          font-family: '${bt}';
          src: url(${rt});
        }
      `,document.head.appendChild(J);const X={name:Et,family:bt,data:rt,isSystem:!1};W.value.push(X),await C.setSetting("customFonts",W.value.filter(ne=>!ne.isSystem)),L(` "${Et}" `)},de.readAsDataURL(V)}catch(de){L(""),console.error(de)}},et=async()=>{if(!g.value.trim()){L("");return}try{const be=g.value.trim(),V=`url-font-${Date.now()}`,de=document.createElement("style");de.textContent=`
      @font-face {
        font-family: '${V}';
        src: url(${be});
      }
    `,document.head.appendChild(de);const pt={name:`URL-${W.value.length}`,family:V,url:be,isSystem:!1};W.value.push(pt),await C.setSetting("customFonts",W.value.filter(rt=>!rt.isSystem)),L(""),g.value=""}catch(be){L(""),console.error(be)}},me=async be=>{D.value=be,document.documentElement.style.setProperty("--global-font",be),await C.setSetting("globalFont",be),L("")},le=async be=>{W.value=W.value.filter(V=>V.name!==be),await C.setSetting("customFonts",W.value.filter(V=>!V.isSystem)),L(` "${be}" `)},De=()=>{te.value=!0},xe=()=>{te.value=!1},Ve=async()=>{try{await C.setSetting("iconBackdropFilter",ie.value),window.dispatchEvent(new CustomEvent("icon-backdrop-filter-changed",{detail:{enabled:ie.value}})),L(ie.value?"":"")}catch(be){L(""),console.error(be)}},xt=be=>{var V;F.value=be,(V=R.value)==null||V.click()},yt=async be=>{const V=be.target.files[0];if(V)try{L("...");const de=await Me(V,512,512,.9),pt=re.value.findIndex(rt=>rt.name===F.value);pt!==-1&&(re.value[pt].iconSrc=de,re.value[pt].isCustom=!0,await C.setSetting("appIcons",re.value),window.dispatchEvent(new CustomEvent("app-icon-changed",{detail:{appName:F.value,iconSrc:de}})),L(` "${F.value}" `))}catch(de){console.error(":",de),L(" ")}},ce=async be=>{const V={Messages:"https://files.catbox.moe/14op6b.jpg",Moments:"https://files.catbox.moe/gvs6a5.jpg",Mori:"https://files.catbox.moe/f0p41u.png",Forum:"https://files.catbox.moe/jpd1lk.jpg",Music:"https://img.wjwj.top/2026/02/18/f6486d844bff10d88a0514db5f710875.md.png",Pornhub:"https://upload.wikimedia.org/wikipedia/commons/f/f1/Pornhub-logo.svg",Live:"https://files.catbox.moe/mg3qg0.jpg",Phone:"https://files.catbox.moe/7ji6fb.png",Mail:"https://files.catbox.moe/edai70.png",World:"https://files.catbox.moe/it221m.png",Settings:"https://files.catbox.moe/2khrtz.png"},de=re.value.findIndex(pt=>pt.name===be);de!==-1&&(re.value[de].iconSrc=V[be],re.value[de].isCustom=!1,await C.setSetting("appIcons",re.value),window.dispatchEvent(new CustomEvent("app-icon-changed",{detail:{appName:be,iconSrc:V[be]}})),L(`"${be}" `))},oe=async()=>{pe.value=!0,B();const be=await C.getSetting("desktopCustomCSS"),V=await C.getSetting("desktopCustomHTML");be&&(he.value=be),V&&(Ue.value=V)},ve=()=>{pe.value=!1,we.value="css"},Ze=()=>{confirm(" CSS ")&&(he.value="",L("CSS "))},_e=()=>{confirm(" HTML ")&&(Ue.value="",L("HTML "))},ut=()=>{window.dispatchEvent(new CustomEvent("desktop-customization-preview",{detail:{css:he.value,html:Ue.value}})),L(" ")},gt=async()=>{try{await C.setSetting("desktopCustomCSS",he.value),await C.setSetting("desktopCustomHTML",Ue.value),window.dispatchEvent(new CustomEvent("desktop-customization-apply",{detail:{css:he.value,html:Ue.value}})),L(" "),ve()}catch(be){console.error(":",be),L(" ")}},at=async()=>{if(confirm(" ")){K.value=!0,q.value={total:0,processed:0,savedSize:"0 KB"},L(" ...");try{await Ce.init();let be=0,V=0;const de=[],pt=await C.getSetting("wallpaper");pt&&pt.startsWith("data:image")&&de.push({type:"setting",key:"wallpaper",data:pt});const rt=await C.getSetting("userAvatar");rt&&rt.startsWith("data:image")&&de.push({type:"setting",key:"userAvatar",data:rt});const Et=await C.getSetting("appIcons");if(Et&&Array.isArray(Et)&&Et.forEach((Re,Be)=>{Re.iconSrc&&Re.iconSrc.startsWith("data:image")&&de.push({type:"appIcon",index:Be,data:Re.iconSrc,appName:Re.name})}),(await Ce.getAll("contacts")).forEach((Re,Be)=>{Re.avatar&&Re.avatar.startsWith("data:image")&&de.push({type:"contact",id:Re.id,data:Re.avatar})}),(await Ce.getAll("customEmojis")).forEach(Re=>{Re.url&&Re.url.startsWith("data:image")&&de.push({type:"emoji",id:Re.id,data:Re.url})}),(await Ce.getAll("chatMessages")).forEach(Re=>{Re.imageData&&Re.imageData.startsWith("data:image")&&de.push({type:"chatMessage",id:Re.id,data:Re.imageData})}),(await Ce.getAll("momentPosts")).forEach(Re=>{Re.images&&Array.isArray(Re.images)&&Re.images.forEach((Be,Mt)=>{Be.startsWith("data:image")&&de.push({type:"moment",id:Re.id,imgIndex:Mt,data:Be})})}),q.value.total=de.length,de.length===0){L(" "),K.value=!1;return}L(`  ${de.length} ...`);for(let Re=0;Re<de.length;Re++){const Be=de[Re];try{const Mt=Be.data.length;be+=Mt;let Lt,Ms,Js;Be.type==="wallpaper"?(Lt=1080,Ms=1920,Js=.8):Be.type==="appIcon"||Be.type==="emoji"?(Lt=512,Ms=512,Js=.85):Be.type==="contact"?(Lt=400,Ms=400,Js=.8):(Lt=800,Ms=800,Js=.75);const Ss=await Gt(Be.data,Lt,Ms,Js),Zo=Ss.length;if(V+=Zo,Be.type==="setting")await C.setSetting(Be.key,Ss);else if(Be.type==="appIcon"){const Bt=await C.getSetting("appIcons");Bt[Be.index].iconSrc=Ss,await C.setSetting("appIcons",Bt)}else if(Be.type==="contact"){const Bt=await C.getContact(Be.id);Bt.avatar=Ss,await C.updateContact(Bt)}else if(Be.type==="emoji"){const Bt=await C.getCustomEmoji(Be.id);Bt.url=Ss,await C.updateCustomEmoji(Bt)}else if(Be.type==="chatMessage"){const Bt=await Ce.get("chatMessages",Be.id);Bt.imageData=Ss,await Ce.set("chatMessages",Bt)}else if(Be.type==="moment"){const Bt=await Ce.get("momentPosts",Be.id);Bt.images[Be.imgIndex]=Ss,await Ce.set("momentPosts",Bt)}if(q.value.processed=Re+1,(Re+1)%10===0||Re===de.length-1){const Bt=be-V,Hn=(Bt/1024).toFixed(2),Fn=(Bt/1024/1024).toFixed(2);q.value.savedSize=Bt>1024*1024?`${Fn} MB`:`${Hn} KB`}}catch(Mt){console.error(` (${Be.type}):`,Mt)}}const ue=((be-V)/1024/1024).toFixed(2),We=((1-V/be)*100).toFixed(1);L(`  ${ue} MB (${We}%)`),setTimeout(()=>{confirm("")&&window.location.reload()},1500)}catch(be){console.error(":",be),L(" "+be.message)}finally{K.value=!1}}},Gt=(be,V,de,pt=.8)=>new Promise((rt,Et)=>{const bt=new Image;bt.onload=()=>{const J=document.createElement("canvas"),X=J.getContext("2d");let ne=bt.width,Te=bt.height;if(ne>V||Te>de){const We=Math.min(V/ne,de/Te);ne=ne*We,Te=Te*We}J.width=ne,J.height=Te,X.drawImage(bt,0,0,ne,Te);const ue=J.toDataURL("image/jpeg",pt);rt(ue)},bt.onerror=()=>Et(new Error("")),bt.src=be}),It=async()=>{A.value=!0,L("...");try{await Ce.init();const be=["settings","apiKeys","chatRecords","characterCards","contacts","chatList","chatMessages","userSettings","diaries","momentPosts","worldBooks","groups","groupMessages","customEmojis"],V={version:"1.0",exportTime:new Date().toISOString(),data:{}};for(const J of be)try{const X=await Ce.getAll(J);V.data[J]=X,console.log(`  ${J}: ${X.length} `)}catch(X){console.warn(`  ${J} :`,X),V.data[J]=[]}const pt=`myphone-backup-${new Date().toISOString().split("T")[0]}.json`,rt=new Blob([JSON.stringify(V,null,2)],{type:"application/json"}),Et=URL.createObjectURL(rt),bt=document.createElement("a");bt.href=Et,bt.download=pt,document.body.appendChild(bt),bt.click(),document.body.removeChild(bt),URL.revokeObjectURL(Et),L(" ")}catch(be){console.error(":",be),L(" "+be.message)}finally{A.value=!1}},as=async be=>{const V=be.target.files[0];if(V){if(!confirm(` 

`)){be.target.value="";return}T.value=!0,L("...");try{const de=new FileReader;de.onload=async pt=>{try{const rt=JSON.parse(pt.target.result);if(!rt.version||!rt.data)throw new Error("");console.log(` : ${rt.version}`),console.log(` : ${rt.exportTime}`),await Ce.init();let Et=0,bt=0;for(const[J,X]of Object.entries(rt.data))try{if(!Array.isArray(X)){console.warn(` ${J} `);continue}await Ce.clear(J),console.log(`  ${J}`);for(const ne of X)await Ce.set(J,ne);console.log(`  ${J}: ${X.length} `),Et++}catch(ne){console.error(`  ${J} :`,ne),bt++}L(` : ${Et}, : ${bt}`),setTimeout(()=>{confirm("")&&window.location.reload()},1500)}catch(rt){console.error(":",rt),L(" "+rt.message)}finally{T.value=!1,be.target.value=""}},de.onerror=()=>{L(" "),T.value=!1,be.target.value=""},de.readAsText(V)}catch(de){console.error(":",de),L(" "+de.message),T.value=!1,be.target.value=""}}};return it(()=>{k()}),(be,V)=>(p(),f("div",Dm,[e("div",Hm,[e("div",{class:"settings-header"},[e("div",{class:"back-btn",onClick:Ne},[...V[24]||(V[24]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"})],-1)])]),V[25]||(V[25]=e("h2",null,"",-1)),V[26]||(V[26]=e("div",{style:{width:"40px"}},null,-1))]),e("div",Fm,[e("div",{class:Se(["tab-item",{active:n.value==="ai"}]),onClick:V[0]||(V[0]=de=>n.value="ai")}," AI  ",2),e("div",{class:Se(["tab-item",{active:n.value==="system"}]),onClick:V[1]||(V[1]=de=>n.value="system")},"  ",2)]),e("div",Um,[n.value==="ai"?(p(),f("div",Rm,[e("div",Nm,[V[36]||(V[36]=e("div",{class:"section-title"},"API ",-1)),e("div",Om,[V[28]||(V[28]=e("label",null,"AI ",-1)),ke(e("select",{"onUpdate:modelValue":V[2]||(V[2]=de=>a.value.provider=de)},[...V[27]||(V[27]=[e("option",{value:"deepseek"},"DeepSeek",-1),e("option",{value:"gemini"},"Gemini",-1),e("option",{value:"openai"},"OpenAI",-1)])],512),[[Hs,a.value.provider]])]),e("div",zm,[V[29]||(V[29]=e("label",null,"",-1)),ke(e("input",{type:"text","onUpdate:modelValue":V[3]||(V[3]=de=>a.value.baseUrl=de),placeholder:": http://127.0.0.1:8888  http://192.168.1.100:8888"},null,512),[[je,a.value.baseUrl]]),V[30]||(V[30]=e("div",{class:"setting-hint",style:{"font-size":"12px",color:"#999","margin-top":"4px"}},"  /v1  ",-1))]),e("div",Km,[V[31]||(V[31]=e("label",null,"API ",-1)),e("div",Wm,[ke(e("input",{type:l.value?"text":"password","onUpdate:modelValue":V[4]||(V[4]=de=>a.value.apiKey=de),placeholder:" API Key"},null,8,Gm),[[Gd,a.value.apiKey]]),e("button",{class:"toggle-btn",onClick:V[5]||(V[5]=de=>l.value=!l.value)},_(l.value?"":""),1)])]),e("div",qm,[e("button",{class:"btn btn-primary",onClick:y,disabled:r.value},_(r.value?"...":""),9,Zm)]),i.value.length>0?(p(),f("div",Jm,[V[33]||(V[33]=e("label",null,"",-1)),ke(e("select",{"onUpdate:modelValue":V[6]||(V[6]=de=>a.value.model=de)},[V[32]||(V[32]=e("option",{value:""},"",-1)),(p(!0),f(Le,null,Fe(i.value,de=>(p(),f("option",{key:de.id,value:de.id},_(de.id),9,Ym))),128))],512),[[Hs,a.value.model]])])):N("",!0),e("div",{class:"setting-item"},[e("button",{class:"btn btn-success",onClick:H}," API ")]),e("div",Xm,[V[35]||(V[35]=e("label",null,"AI ",-1)),e("div",Qm,[e("label",eg,[ke(e("input",{type:"checkbox","onUpdate:modelValue":V[7]||(V[7]=de=>v.value=de),onChange:ae},null,544),[[os,v.value]]),V[34]||(V[34]=e("span",{class:"slider"},null,-1))]),e("span",tg,_(v.value?"":""),1)])]),V[37]||(V[37]=e("div",{class:"setting-description"}," AI  GPT-4VGemini Pro Vision  ",-1))]),e("div",sg,[V[40]||(V[40]=e("div",{class:"section-title"},"",-1)),e("div",og,[V[39]||(V[39]=e("label",null,"",-1)),e("div",ng,[e("label",ag,[ke(e("input",{type:"checkbox","onUpdate:modelValue":V[8]||(V[8]=de=>c.value=de),onChange:se},null,544),[[os,c.value]]),V[38]||(V[38]=e("span",{class:"slider"},null,-1))]),e("span",lg,_(c.value?"":""),1)])]),V[41]||(V[41]=e("div",{class:"setting-description"}," 3010 ",-1)),e("div",ig,[e("button",{class:"btn btn-primary",onClick:P,disabled:!a.value.apiKey},"  ",8,rg)])]),e("div",cg,[V[44]||(V[44]=e("div",{class:"section-title"}," ",-1)),e("div",dg,[V[43]||(V[43]=e("label",null,"AI ",-1)),e("div",ug,[e("label",vg,[ke(e("input",{type:"checkbox","onUpdate:modelValue":V[9]||(V[9]=de=>d.value=de),onChange:U},null,544),[[os,d.value]]),V[42]||(V[42]=e("span",{class:"slider"},null,-1))]),e("span",pg,_(d.value?"":""),1)])]),V[45]||(V[45]=e("div",{class:"setting-description"},[ot("  "),e("ul",{style:{"margin-top":"8px","padding-left":"20px"}},[e("li",null," 15 "),e("li",null," 8-14  +  2 "),e("li",null," 5-7  +  4 30% "),e("li",null," 10 ")]),e("div",{style:{"margin-top":"8px",color:"#ff6b6b"}},"  30  ")],-1)),d.value?(p(),f("div",fg,[e("button",{class:"btn btn-secondary",onClick:O},"   ")])):N("",!0)]),e("div",mg,[V[48]||(V[48]=e("div",{class:"section-title"},"",-1)),e("div",gg,[V[47]||(V[47]=e("label",null,"AI ",-1)),e("div",hg,[e("label",yg,[ke(e("input",{type:"checkbox","onUpdate:modelValue":V[10]||(V[10]=de=>u.value=de),onChange:Q},null,544),[[os,u.value]]),V[46]||(V[46]=e("span",{class:"slider"},null,-1))]),e("span",bg,_(u.value?"":""),1)])]),V[49]||(V[49]=e("div",{class:"setting-description"}," AI  ",-1))])])):N("",!0),n.value==="system"?(p(),f("div",wg,[e("div",kg,[V[52]||(V[52]=e("div",{class:"section-title"},"",-1)),e("div",xg,[V[50]||(V[50]=e("label",null,"",-1)),e("div",Cg,[e("div",{class:"avatar-preview",style:Oe({backgroundImage:`url(${b.value})`})},null,4),e("button",{class:"btn btn-secondary",onClick:V[11]||(V[11]=()=>{var de;return(de=I.value)==null?void 0:de.click()})},""),e("input",{ref_key:"userAvatarInput",ref:I,type:"file",accept:"image/*",onChange:fe,style:{display:"none"}},null,544)])]),e("div",$g,[V[51]||(V[51]=e("label",null,"",-1)),ke(e("input",{type:"text","onUpdate:modelValue":V[12]||(V[12]=de=>w.value=de),placeholder:""},null,512),[[je,w.value]])]),e("div",{class:"setting-item"},[e("button",{class:"btn btn-success",onClick:Ie},"")])]),e("div",_g,[V[54]||(V[54]=e("div",{class:"section-title"},"",-1)),e("div",Mg,[V[53]||(V[53]=e("label",null,"",-1)),e("input",{type:"file",accept:"image/*",onChange:$e,ref_key:"wallpaperInput",ref:j},null,544)]),$.value?(p(),f("div",Sg,[e("img",{src:$.value,alt:""},null,8,Ag)])):N("",!0),e("div",{class:"setting-item"},[e("button",{class:"btn btn-success",onClick:ye},"")])]),e("div",Ig,[V[57]||(V[57]=e("div",{class:"section-title"},"",-1)),e("div",{class:"setting-item setting-item-clickable",onClick:Ee},[V[56]||(V[56]=e("label",null,"",-1)),(p(),f("svg",Lg,[...V[55]||(V[55]=[e("path",{d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"},null,-1)])]))])]),e("div",Tg,[V[62]||(V[62]=e("div",{class:"section-title"},"",-1)),e("div",{class:"setting-item setting-item-clickable",onClick:De},[V[59]||(V[59]=e("label",null,"",-1)),(p(),f("svg",jg,[...V[58]||(V[58]=[e("path",{d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"},null,-1)])]))]),e("div",{class:"setting-item setting-item-clickable",onClick:oe},[V[61]||(V[61]=e("label",null," ",-1)),(p(),f("svg",Pg,[...V[60]||(V[60]=[e("path",{d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"},null,-1)])]))])]),e("div",Eg,[V[67]||(V[67]=e("div",{class:"section-title"},"",-1)),e("div",Bg,[V[64]||(V[64]=e("label",null,"",-1)),e("div",Vg,[e("label",Dg,[ke(e("input",{type:"checkbox","onUpdate:modelValue":V[13]||(V[13]=de=>S.value=de)},null,512),[[os,S.value]]),V[63]||(V[63]=e("span",{class:"slider"},null,-1))]),e("span",Hg,_(S.value?"":""),1)])]),e("div",Fg,[V[66]||(V[66]=e("label",null,"",-1)),e("div",Ug,[e("label",Rg,[ke(e("input",{type:"checkbox","onUpdate:modelValue":V[14]||(V[14]=de=>M.value=de)},null,512),[[os,M.value]]),V[65]||(V[65]=e("span",{class:"slider"},null,-1))]),e("span",Ng,_(M.value?"":""),1)])])]),e("div",Og,[V[69]||(V[69]=e("div",{class:"section-title"}," ",-1)),V[70]||(V[70]=e("div",{class:"setting-description",style:{"margin-bottom":"16px"}},"  ",-1)),q.value.total>0?(p(),f("div",zg,[e("div",Kg,[V[68]||(V[68]=e("div",{style:{"font-size":"13px",color:"#666","margin-bottom":"8px"}},"   ",-1)),e("div",Wg," "+_(q.value.processed)+" / "+_(q.value.total),1),e("div",Gg," "+_(q.value.savedSize),1),e("div",qg,[e("div",{style:Oe([{height:"100%",background:"linear-gradient(90deg, #6c8cd5, #4a6fbf)",transition:"width 0.3s"},{width:q.value.processed/q.value.total*100+"%"}])},null,4)])])])):N("",!0),e("div",Zg,[e("button",{class:"btn btn-primary",onClick:at,disabled:K.value},_(K.value?"...":" "),9,Jg)]),V[71]||(V[71]=e("div",{class:"setting-description",style:{"margin-top":"8px",color:"#ff9800"}},"   ",-1))]),e("div",Yg,[V[72]||(V[72]=e("div",{class:"section-title"}," ",-1)),V[73]||(V[73]=e("div",{class:"setting-description",style:{"margin-bottom":"16px"}},"  ",-1)),e("div",Xg,[e("button",{class:"btn btn-primary",onClick:It,disabled:A.value},_(A.value?"...":" "),9,Qg)]),e("div",eh,[e("button",{class:"btn btn-secondary",onClick:V[15]||(V[15]=()=>{var de;return(de=G.value)==null?void 0:de.click()}),disabled:T.value},_(T.value?"...":" "),9,th),e("input",{ref_key:"importFileInput",ref:G,type:"file",accept:".json",onChange:as,style:{display:"none"}},null,544)]),V[74]||(V[74]=e("div",{class:"setting-description",style:{"margin-top":"8px",color:"#ff6b6b"}},"   ",-1))])])):N("",!0)])]),e("div",{class:Se(["toast",{show:ee.value}])},_(Z.value),3),e("div",{class:Se(["font-manager-overlay",{show:te.value}])},[e("div",sh,[e("div",{class:"font-manager-header"},[e("div",{class:"back-btn",onClick:xe},[...V[75]||(V[75]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"})],-1)])]),V[76]||(V[76]=e("h2",null,"",-1)),V[77]||(V[77]=e("div",{style:{width:"40px"}},null,-1))]),e("div",oh,[e("div",nh,[V[80]||(V[80]=e("div",{class:"section-title"},"",-1)),e("div",ah,[V[79]||(V[79]=e("label",null,"",-1)),e("div",lh,[e("label",ih,[ke(e("input",{type:"checkbox","onUpdate:modelValue":V[16]||(V[16]=de=>ie.value=de),onChange:Ve},null,544),[[os,ie.value]]),V[78]||(V[78]=e("span",{class:"slider"},null,-1))]),e("span",rh,_(ie.value?"":""),1)])]),V[81]||(V[81]=e("div",{class:"setting-description"},"  ",-1))]),e("div",ch,[V[82]||(V[82]=e("div",{class:"section-title"},"",-1)),e("div",dh,[(p(!0),f(Le,null,Fe(re.value,de=>(p(),f("div",{key:de.name,class:"font-item"},[e("div",uh,[e("img",{src:de.iconSrc,class:"app-icon-preview"},null,8,vh),e("div",ph,_(de.name),1)]),e("div",fh,[e("button",{class:"font-btn apply-btn",onClick:()=>xt(de.name)},"",8,mh),de.isCustom?(p(),f("button",{key:0,class:"font-btn delete-btn",onClick:pt=>ce(de.name)},"",8,gh)):N("",!0)])]))),128))])])])])],2),e("input",{ref_key:"iconFileInput",ref:R,type:"file",accept:"image/*",onChange:yt,style:{display:"none"}},null,544),e("div",{class:Se(["font-manager-overlay",{show:pe.value}])},[e("div",hh,[e("div",{class:"font-manager-header"},[e("div",{class:"back-btn",onClick:ve},[...V[83]||(V[83]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"})],-1)])]),V[84]||(V[84]=e("h2",null," ",-1)),V[85]||(V[85]=e("div",{style:{width:"40px"}},null,-1))]),e("div",yh,[e("div",bh,[e("div",{class:Se(["customizer-tab",{active:we.value==="css"}]),onClick:V[17]||(V[17]=de=>we.value="css")}," CSS  ",2),e("div",{class:Se(["customizer-tab",{active:we.value==="html"}]),onClick:V[18]||(V[18]=de=>we.value="html")}," HTML  ",2),e("div",{class:Se(["customizer-tab",{active:we.value==="preview"}]),onClick:V[19]||(V[19]=de=>we.value="preview")},"  ",2)]),we.value==="css"?(p(),f("div",wh,[e("div",{class:"editor-header"},[V[86]||(V[86]=e("span",null," CSS ",-1)),e("button",{class:"btn btn-secondary",onClick:Ze},"")]),ke(e("textarea",{"onUpdate:modelValue":V[20]||(V[20]=de=>he.value=de),class:"code-editor",placeholder:`/*  CSS */
.phone-container {
  /*  */
}

.app-grid {
  /*  */
}`,spellcheck:"false"},null,512),[[je,he.value]]),V[87]||(V[87]=e("div",{class:"editor-hint"},'  """" ',-1))])):N("",!0),we.value==="html"?(p(),f("div",kh,[e("div",{class:"editor-header"},[V[88]||(V[88]=e("span",null," HTML ",-1)),e("button",{class:"btn btn-secondary",onClick:_e},"")]),ke(e("textarea",{"onUpdate:modelValue":V[21]||(V[21]=de=>Ue.value=de),class:"code-editor",placeholder:`<!--  HTML -->
<div class='custom-widget'>
  <h3></h3>
  <p>~</p>
</div>`,spellcheck:"false"},null,512),[[je,Ue.value]]),V[89]||(V[89]=e("div",{class:"editor-hint"},"   CSS ~ ",-1))])):N("",!0),we.value==="preview"?(p(),f("div",xh,[e("div",{class:"preview-header"},[V[90]||(V[90]=e("span",null,"",-1)),e("button",{class:"btn btn-primary",onClick:ut},"")]),e("div",Ch,[e("div",$h,[he.value?(p(),nt(Ta("style"),{key:0},{default:ko(()=>[ot(_(he.value),1)]),_:1})):N("",!0),e("div",_h,[e("div",Mh,[e("div",Sh,[e("span",null,_(be.currentTime),1)]),V[91]||(V[91]=e("div",{class:"status-bar-right"},[e("svg",{class:"status-icon-svg",viewBox:"0 0 24 24"},[e("path",{d:"M20,20h2v-2h-2V20z M18,20h-2v-4h2V20z"})])],-1))]),e("div",Ah,[e("div",Ih,[e("div",Lh,_(be.currentTime),1),e("div",Th,_(ge.value),1)])]),Ue.value?(p(),f("div",{key:0,class:"custom-html-container",innerHTML:Ue.value},null,8,jh)):N("",!0),V[92]||(V[92]=mt('<div class="app-grid" data-v-928ffc2f><div class="app-icon-preview" data-v-928ffc2f><div class="icon-bg" data-v-928ffc2f></div><span data-v-928ffc2f>App</span></div><div class="app-icon-preview" data-v-928ffc2f><div class="icon-bg" data-v-928ffc2f></div><span data-v-928ffc2f>Chat</span></div></div><div class="bottom-bar" data-v-928ffc2f><div class="app-icon-preview" data-v-928ffc2f><div class="icon-bg" data-v-928ffc2f></div></div><div class="app-icon-preview" data-v-928ffc2f><div class="icon-bg" data-v-928ffc2f></div></div></div>',2))])],512)]),V[93]||(V[93]=e("div",{class:"preview-hint"},"   CSS  HTML  ",-1))])):N("",!0)]),e("div",{class:"customizer-footer"},[e("button",{class:"btn btn-cancel",onClick:ve},""),e("button",{class:"btn btn-success",onClick:gt}," ")])])],2),e("div",{class:Se(["font-manager-overlay",{show:E.value}])},[e("div",Ph,[e("div",{class:"font-manager-header"},[e("div",{class:"back-btn",onClick:He},[...V[94]||(V[94]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"})],-1)])]),V[95]||(V[95]=e("h2",null,"",-1)),V[96]||(V[96]=e("div",{style:{width:"40px"}},null,-1))]),e("div",Eh,[e("div",Bh,[V[98]||(V[98]=e("div",{class:"section-title"},"",-1)),e("div",{class:"font-preview-text",style:Oe({fontFamily:D.value})},[...V[97]||(V[97]=[ot(" The quick brown fox jumps over the lazy dog",-1),e("br",null,null,-1),ot("  0123456789 ",-1)])],4)]),e("div",Vh,[V[102]||(V[102]=e("div",{class:"section-title"},"",-1)),e("div",{class:"upload-area",onClick:V[22]||(V[22]=()=>{var de;return(de=m.value)==null?void 0:de.click()})},[(p(),f("svg",Dh,[...V[99]||(V[99]=[e("path",{d:"M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z"},null,-1)])])),V[100]||(V[100]=e("div",{class:"upload-text"},"",-1)),V[101]||(V[101]=e("div",{class:"upload-hint"}," .ttf, .otf, .woff, .woff2 ",-1)),e("input",{ref_key:"fontFileInput",ref:m,type:"file",accept:".ttf,.otf,.woff,.woff2",onChange:Ge,style:{display:"none"}},null,544)])]),e("div",Hh,[V[103]||(V[103]=e("div",{class:"section-title"},"",-1)),ke(e("input",{type:"text","onUpdate:modelValue":V[23]||(V[23]=de=>g.value=de),placeholder:" URL  Google Fonts ",class:"font-url-input"},null,512),[[je,g.value]]),e("button",{class:"btn btn-secondary",onClick:et,style:{"margin-top":"12px",width:"100%"}},"  ")]),e("div",Fh,[V[104]||(V[104]=e("div",{class:"section-title"},"",-1)),e("div",Uh,[(p(!0),f(Le,null,Fe(W.value,de=>(p(),f("div",{key:de.name,class:Se(["font-item",{active:D.value===de.family}]),onClick:pt=>me(de.family)},[e("div",{class:"font-item-name",style:Oe({fontFamily:de.family})},_(de.name),5),e("div",Nh,[D.value===de.family?(p(),f("button",Oh,"")):(p(),f("button",zh,"")),de.isSystem?N("",!0):(p(),f("button",{key:2,class:"font-btn delete-btn",onClick:Pe(pt=>le(de.name),["stop"])},"",8,Kh))])],10,Rh))),128))])])])])],2)]))}},Gh=Xe(Wh,[["__scopeId","data-v-928ffc2f"]]),qh={class:"notifications-container"},Zh=["onClick","onTouchstart","onTouchend"],Jh=["src"],Yh={class:"notification-content"},Xh={class:"notification-name"},Qh={class:"notification-message"},e2={class:"notification-time"},t2=["onClick"],s2={__name:"GlobalNotification",emits:["navigate-to-chat"],setup(t,{emit:s}){const o=h([]);let n=0,a=0,l=null;const i=s,r=w=>{o.value=w.map(I=>({...I,timeText:Ht.formatTime(I.timestamp)}))},c=w=>{w.contactId&&i("navigate-to-chat",{contactId:w.contactId,contactName:w.name,contactAvatar:w.avatar}),d(w.id)},d=w=>{Ht.removeNotification(w)},u=(w,I)=>{n=w.touches[0].clientX,a=w.touches[0].clientY,l=I},v=w=>{if(!l)return;const I=w.touches[0].clientX,j=w.touches[0].clientY,$=I-n,x=j-a;if(Math.abs($)>Math.abs(x)&&Math.abs($)>10){w.preventDefault();const S=w.currentTarget;S.style.transform=`translateX(${$}px)`,S.style.opacity=Math.max(0,1-Math.abs($)/200)}},b=w=>{if(!l)return;const I=event.currentTarget,j=event.changedTouches[0].clientX-n;Math.abs(j)>100?(I.style.transition="all 0.3s ease-out",I.style.transform=`translateX(${j>0?"400px":"-400px"})`,I.style.opacity="0",setTimeout(()=>{d(w.id),I.style.transition="",I.style.transform="",I.style.opacity=""},300)):(I.style.transition="all 0.2s ease-out",I.style.transform="translateX(0)",I.style.opacity="1",setTimeout(()=>{I.style.transition=""},200)),l=null};return it(()=>{Ht.addListener(r),window.addEventListener("show-global-notification",w=>{const I=w.detail;Ht.addNotification({contactId:I.contactId,name:I.name,avatar:I.avatar,message:I.message,type:"legacy"})}),window.addEventListener("show-moment-notification",w=>{const I=w.detail;Ht.addNotification({contactId:I.contactId,name:I.message||"",avatar:"https://via.placeholder.com/40?text=",message:"",type:"moment"})})}),zt(()=>{Ht.removeListener(r)}),(w,I)=>(p(),f("div",qh,[(p(!0),f(Le,null,Fe(o.value,(j,$)=>(p(),f("div",{key:j.id,class:"global-notification",style:{top:"20px",zIndex:10001},onClick:x=>c(j),onTouchstart:x=>u(x,j),onTouchmove:v,onTouchend:x=>b(j)},[e("img",{src:j.avatar,class:"notification-avatar"},null,8,Jh),e("div",Yh,[e("div",Xh,_(j.name),1),e("div",Qh,_(j.message),1),e("div",e2,_(j.timeText),1)]),e("button",{class:"notification-close",onClick:Pe(x=>d(j.id),["stop"])},"",8,t2)],40,Zh))),128))]))}},o2=Xe(s2,[["__scopeId","data-v-43d4d770"]]),n2={class:"notification-text"},a2={__name:"DiaryNotification",setup(t,{expose:s}){const o=h(!1),n=h("");let a=null;const l=d=>{n.value=d.message,o.value=!0,a&&clearTimeout(a),a=setTimeout(()=>{i()},5e3)},i=()=>{o.value=!1,a&&(clearTimeout(a),a=null)},r=()=>{i()},c=d=>{l(d.detail)};return it(()=>{window.addEventListener("show-diary-notification",c)}),zt(()=>{window.removeEventListener("show-diary-notification",c),a&&clearTimeout(a)}),s({showNotification:l,close:i}),(d,u)=>o.value?(p(),f("div",{key:0,class:"diary-notification",onClick:r},[u[0]||(u[0]=e("div",{class:"notification-icon"},"",-1)),e("div",n2,_(n.value),1),e("button",{class:"notification-close",onClick:Pe(i,["stop"])},"")])):N("",!0)}},l2=Xe(a2,[["__scopeId","data-v-b4643fe4"]]),i2={class:"music-player"},r2={class:"player-content"},c2={class:"album-cover"},d2=["src","alt"],u2={class:"cover-overlay"},v2={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},p2={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},f2={class:"song-info"},m2={class:"song-title"},g2={class:"song-artist"},h2={class:"progress-section"},y2={class:"progress-time"},b2={class:"progress-bar"},w2={class:"progress-time"},k2={class:"player-controls"},x2={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},C2={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},$2={class:"extra-controls"},_2={key:0,viewBox:"0 0 24 24",fill:"currentColor",stroke:"currentColor"},M2={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},S2={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},A2={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},I2={__name:"MusicPlayer",setup(t){const s=h(!1),o=h(0),n=h(!1),a=h("off"),l=h(0),i=h([{id:1,title:"",artist:"",cover:"https://picsum.photos/200/200?random=1",duration:269,isFavorite:!0},{id:2,title:"",artist:"",cover:"https://picsum.photos/200/200?random=2",duration:300,isFavorite:!1},{id:3,title:"",artist:"",cover:"https://picsum.photos/200/200?random=3",duration:223,isFavorite:!0},{id:4,title:"",artist:"",cover:"https://picsum.photos/200/200?random=4",duration:213,isFavorite:!1}]),r=tt(()=>i.value[l.value]),c=tt(()=>r.value.duration?o.value/r.value.duration*100:0),d=()=>{s.value=!s.value},u=()=>{l.value>0?l.value--:l.value=i.value.length-1,o.value=0,s.value},v=()=>{if(n.value){let S;do S=Math.floor(Math.random()*i.value.length);while(S===l.value&&i.value.length>1);l.value=S}else l.value<i.value.length-1?l.value++:l.value=0;o.value=0,s.value},b=()=>{n.value=!n.value},w=()=>{a.value==="off"?a.value="all":a.value==="all"?a.value="one":a.value="off"},I=()=>{r.value.isFavorite=!r.value.isFavorite},j=S=>{const M=S.currentTarget.getBoundingClientRect(),T=(S.clientX-M.left)/M.width;o.value=T*r.value.duration},$=S=>{const M=Math.floor(S/60),A=Math.floor(S%60);return`${M}:${A.toString().padStart(2,"0")}`};let x=null;return it(()=>{x=setInterval(()=>{s.value&&(o.value+=1,o.value>=r.value.duration&&(a.value==="one"?o.value=0:a.value==="all"||n.value?v():(s.value=!1,o.value=0)))},1e3)}),zt(()=>{x&&clearInterval(x)}),(S,M)=>(p(),f("div",i2,[M[11]||(M[11]=e("div",{class:"player-header"},[e("span",{class:"player-icon"},""),e("span",{class:"player-title"},"")],-1)),e("div",r2,[e("div",c2,[e("img",{src:r.value.cover,alt:r.value.title,class:Se(["cover-image",{rotating:s.value}])},null,10,d2),e("div",u2,[e("button",{class:"play-pause-btn-large",onClick:d},[s.value?(p(),f("svg",v2,[...M[0]||(M[0]=[e("rect",{x:"6",y:"4",width:"4",height:"16","stroke-width":"2","stroke-linecap":"round"},null,-1),e("rect",{x:"14",y:"4",width:"4",height:"16","stroke-width":"2","stroke-linecap":"round"},null,-1)])])):(p(),f("svg",p2,[...M[1]||(M[1]=[e("polygon",{points:"5 3 19 12 5 21 5 3","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])]))])])]),e("div",f2,[e("div",m2,_(r.value.title),1),e("div",g2,_(r.value.artist),1)]),e("div",h2,[e("div",y2,_($(o.value)),1),e("div",{class:"progress-bar-container",onClick:j},[e("div",b2,[e("div",{class:"progress-fill",style:Oe({width:c.value+"%"})},null,4),e("div",{class:"progress-thumb",style:Oe({left:c.value+"%"})},null,4)])]),e("div",w2,_($(r.value.duration)),1)]),e("div",k2,[e("button",{class:"control-btn",onClick:u},[...M[2]||(M[2]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("polygon",{points:"19 20 9 12 19 4 19 20","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("line",{x1:"5",y1:"19",x2:"5",y2:"5","stroke-width":"2","stroke-linecap":"round"})],-1)])]),e("button",{class:"control-btn play-pause",onClick:d},[s.value?(p(),f("svg",x2,[...M[3]||(M[3]=[e("rect",{x:"6",y:"4",width:"4",height:"16","stroke-width":"2","stroke-linecap":"round"},null,-1),e("rect",{x:"14",y:"4",width:"4",height:"16","stroke-width":"2","stroke-linecap":"round"},null,-1)])])):(p(),f("svg",C2,[...M[4]||(M[4]=[e("polygon",{points:"5 3 19 12 5 21 5 3","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])]))]),e("button",{class:"control-btn",onClick:v},[...M[5]||(M[5]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("polygon",{points:"5 4 15 12 5 20 5 4","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("line",{x1:"19",y1:"5",x2:"19",y2:"19","stroke-width":"2","stroke-linecap":"round"})],-1)])])]),e("div",$2,[e("button",{class:Se(["extra-btn",{active:n.value}]),onClick:b},[...M[6]||(M[6]=[mt('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-9fdac3e9><polyline points="16 3 21 3 21 8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9fdac3e9></polyline><line x1="4" y1="20" x2="21" y2="3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9fdac3e9></line><polyline points="21 16 21 21 16 21" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9fdac3e9></polyline><line x1="15" y1="15" x2="21" y2="21" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9fdac3e9></line><line x1="4" y1="4" x2="9" y2="9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9fdac3e9></line></svg>',1)])],2),e("button",{class:"extra-btn",onClick:I},[r.value.isFavorite?(p(),f("svg",_2,[...M[7]||(M[7]=[e("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])):(p(),f("svg",M2,[...M[8]||(M[8]=[e("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])]))]),e("button",{class:Se(["extra-btn",{active:a.value!=="off"}]),onClick:w},[a.value==="one"?(p(),f("svg",S2,[...M[9]||(M[9]=[mt('<polyline points="17 1 21 5 17 9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9fdac3e9></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9fdac3e9></path><polyline points="7 23 3 19 7 15" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9fdac3e9></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9fdac3e9></path><text x="12" y="16" text-anchor="middle" font-size="8" fill="currentColor" font-weight="bold" data-v-9fdac3e9>1</text>',5)])])):(p(),f("svg",A2,[...M[10]||(M[10]=[e("polyline",{points:"17 1 21 5 17 9","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M3 11V9a4 4 0 0 1 4-4h14","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("polyline",{points:"7 23 3 19 7 15","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M21 13v2a4 4 0 0 1-4 4H3","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])]))],2)])])]))}},L2=Xe(I2,[["__scopeId","data-v-9fdac3e9"]]),T2={class:"notification-panel-wrapper"},j2={class:"status-bar"},P2={class:"status-time"},E2={class:"quick-settings"},B2={class:"notifications-section"},V2={key:0,class:"no-notifications"},D2={key:1,class:"notifications-list"},H2=["onClick"],F2={class:"notification-icon"},U2={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},R2={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},N2={key:2,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},O2={class:"notification-content"},z2={class:"notification-title"},K2={class:"notification-message"},W2={class:"notification-time"},G2=["onClick"],q2={__name:"NotificationPanel",emits:["notification-click"],setup(t,{expose:s,emit:o}){const n=o,a=h(!0),l=h(!1),i=h(-1e3),r=h(0),c=h(0),d=h(!1),u=h(!0),v=h(!1),b=h(!1),w=h(!1);h(80),h(50);const I=h(""),j=h([{id:1,iconType:"message",title:"",message:"",time:"5",app:"wechat"},{id:2,iconType:"email",title:"",message:"",time:"1",app:"email"}]),$=()=>{const R=new Date,F=String(R.getHours()).padStart(2,"0"),ie=String(R.getMinutes()).padStart(2,"0");I.value=`${F}:${ie}`},x=R=>{const F=R.touches[0];r.value=F.clientY,c.value=Date.now(),d.value=!0,console.log(":",F.clientY)},S=R=>{r.value=R.clientY,c.value=Date.now(),d.value=!0,R.preventDefault(),console.log(":",R.clientY)},M=R=>{if(!d.value)return;const ie=R.touches[0].clientY-r.value;l.value?ie<0?i.value=Math.max(ie,-500):i.value=Math.min(ie*.3,50):ie>0&&(i.value=Math.min(ie-1e3,0),ie>20&&(l.value=!0))},A=R=>{if(!d.value)return;const F=R.clientY-r.value;console.log(" deltaY:",F,"isVisible:",l.value),l.value?F<0?i.value=Math.max(F,-500):i.value=Math.min(F*.3,50):F>0&&(i.value=Math.min(F-1e3,0),F>20&&(l.value=!0)),R.preventDefault()},T=()=>{if(!d.value)return;const R=Date.now()-c.value,F=i.value;l.value?F<-50||F<0&&R<300?q():K():F>-50?K():q(),d.value=!1},G=()=>{if(!d.value)return;const R=Date.now()-c.value,F=i.value;l.value?F<-50||F<0&&R<300?q():K():F>-50?K():q(),d.value=!1},K=()=>{l.value=!0,i.value=0},q=()=>{l.value=!1,i.value=-1e3},ee=()=>{u.value=!u.value},Z=()=>{v.value=!v.value},E=()=>{b.value=!b.value},m=()=>{w.value=!w.value},g=R=>{n("notification-click",R),q()},D=R=>{const F=j.value.findIndex(ie=>ie.id===R);F>-1&&j.value.splice(F,1)},W=()=>{j.value=[]};return s({addNotification:R=>{const F={id:Date.now(),time:"",...R};j.value.unshift(F)},openPanel:K,closePanel:q,setTriggerAreaVisible:R=>{a.value=R}}),it(()=>{$();const R=setInterval($,6e4);document.addEventListener("mousemove",A),document.addEventListener("mouseup",G),zt(()=>{clearInterval(R),document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",G)})}),(R,F)=>(p(),f("div",T2,[a.value?(p(),f("div",{key:0,class:"trigger-area",onTouchstart:x,onTouchmove:M,onTouchend:T,onMousedown:S},null,32)):N("",!0),Ye(Xi,{name:"fade"},{default:ko(()=>[l.value?(p(),f("div",{key:0,class:"overlay",onClick:q})):N("",!0)]),_:1}),e("div",{class:Se(["notification-panel",{"is-visible":l.value}]),style:Oe(l.value?{transform:`translateY(${i.value}px)`}:{transform:"translateY(-100%)"}),onMousedown:S,onTouchstart:x},[e("div",j2,[e("div",P2,_(I.value),1),F[0]||(F[0]=mt('<div class="status-icons" data-v-a8861fd9><svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-a8861fd9><path d="M5 12.55a11 11 0 0 1 14.08 0" stroke-width="2" stroke-linecap="round" data-v-a8861fd9></path><path d="M1.42 9a16 16 0 0 1 21.16 0" stroke-width="2" stroke-linecap="round" data-v-a8861fd9></path><path d="M8.53 16.11a6 6 0 0 1 6.95 0" stroke-width="2" stroke-linecap="round" data-v-a8861fd9></path><circle cx="12" cy="20" r="1" fill="currentColor" data-v-a8861fd9></circle></svg><svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-a8861fd9><path d="M12 2v20M17 7l-5 5-5-5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-a8861fd9></path></svg><svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-a8861fd9><rect x="5" y="4" width="14" height="18" rx="2" stroke-width="2" data-v-a8861fd9></rect><path d="M8 18h8" stroke-width="2" stroke-linecap="round" data-v-a8861fd9></path></svg></div>',1))]),F[16]||(F[16]=e("div",{class:"pull-indicator"},[e("div",{class:"indicator-bar"})],-1)),e("div",E2,[e("div",{class:"quick-setting-item",onClick:ee},[e("div",{class:Se(["setting-icon",{active:u.value}])},[...F[1]||(F[1]=[mt('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-a8861fd9><path d="M5 12.55a11 11 0 0 1 14.08 0" stroke-width="2" stroke-linecap="round" data-v-a8861fd9></path><path d="M1.42 9a16 16 0 0 1 21.16 0" stroke-width="2" stroke-linecap="round" data-v-a8861fd9></path><path d="M8.53 16.11a6 6 0 0 1 6.95 0" stroke-width="2" stroke-linecap="round" data-v-a8861fd9></path><circle cx="12" cy="20" r="1" fill="currentColor" data-v-a8861fd9></circle></svg>',1)])],2),F[2]||(F[2]=e("div",{class:"setting-label"},"WiFi",-1))]),e("div",{class:"quick-setting-item",onClick:Z},[e("div",{class:Se(["setting-icon",{active:v.value}])},[...F[3]||(F[3]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M6.5 6.5l11 11L12 23V1l5.5 5.5-11 11","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],2),F[4]||(F[4]=e("div",{class:"setting-label"},"",-1))]),e("div",{class:"quick-setting-item",onClick:E},[e("div",{class:Se(["setting-icon",{active:b.value}])},[...F[5]||(F[5]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M9 2h6l3 7v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V9l3-7z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M9 9h6","stroke-width":"2","stroke-linecap":"round"})],-1)])],2),F[6]||(F[6]=e("div",{class:"setting-label"},"",-1))]),e("div",{class:"quick-setting-item",onClick:m},[e("div",{class:Se(["setting-icon",{active:w.value}])},[...F[7]||(F[7]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M10.5 3L3 11l9 1 1 9 7.5-8-9-1-1-9z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],2),F[8]||(F[8]=e("div",{class:"setting-label"},"",-1))])]),Ye(L2),e("div",B2,[e("div",{class:"section-header"},[F[9]||(F[9]=e("span",null,"",-1)),e("button",{class:"clear-all-btn",onClick:W},"")]),j.value.length===0?(p(),f("div",V2,[...F[10]||(F[10]=[e("svg",{class:"no-notifications-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M13.73 21a2 2 0 0 1-3.46 0","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("div",{class:"no-notifications-text"},"",-1)])])):(p(),f("div",D2,[(p(!0),f(Le,null,Fe(j.value,ie=>(p(),f("div",{key:ie.id,class:"notification-item",onClick:re=>g(ie)},[e("div",F2,[ie.iconType==="message"?(p(),f("svg",U2,[...F[11]||(F[11]=[e("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])):ie.iconType==="email"?(p(),f("svg",R2,[...F[12]||(F[12]=[e("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("polyline",{points:"22,6 12,13 2,6","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])):(p(),f("svg",N2,[...F[13]||(F[13]=[e("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])]))]),e("div",O2,[e("div",z2,_(ie.title),1),e("div",K2,_(ie.message),1),e("div",W2,_(ie.time),1)]),e("button",{class:"notification-close",onClick:Pe(re=>D(ie.id),["stop"])},[...F[14]||(F[14]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M18 6L6 18M6 6l12 12","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,G2)],8,H2))),128))]))]),e("div",{class:"bottom-close-section"},[e("button",{class:"bottom-close-btn",onClick:q},[...F[15]||(F[15]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M18 15l-6-6-6 6","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",null,"",-1)])])])],38)]))}},Z2=Xe(q2,[["__scopeId","data-v-a8861fd9"]]),J2={class:"moment-create-card"},Y2={class:"moment-create-header"},X2={class:"moment-create-body"},Q2={key:0,class:"image-preview"},ey=["src"],ty={class:"bottom-row"},sy={class:"tools"},oy={class:"mention-search-row"},ny={class:"mention-list",role:"listbox","aria-label":""},ay={key:0,class:"mention-empty"},ly={key:1,class:"mention-empty"},iy=["checked","onChange"],ry={class:"mention-name"},cy={key:0,class:"mention-sub"},dy={key:2,class:"mentions"},uy={__name:"MomentCreate",emits:["close","submit"],setup(t,{emit:s}){const o=s,n=h({text:"",image:"",mentions:[],visibility:"public"}),a=h(null),l=h(null),i=h({start:0,end:0}),r=h(!1),c=h(null),d=h(""),u=h(!1),v=h([]),b=()=>{var E;(E=a.value)==null||E.click()},w=E=>{var D;const m=(D=E.target.files)==null?void 0:D[0];if(!m)return;const g=new FileReader;g.onload=W=>{n.value.image=W.target.result},g.readAsDataURL(m)},I=()=>{n.value.image="",a.value&&(a.value.value="")},j=()=>{const E=l.value;if(!E)return;const m=E.selectionStart??0,g=E.selectionEnd??m;i.value={start:m,end:g}},$=async()=>{u.value=!0;try{v.value=await C.getContacts()}catch(E){console.error(":",E),v.value=[]}finally{u.value=!1}},x=async()=>{var E,m;r.value=!0,d.value="",await $(),await Yt(),(m=(E=c.value)==null?void 0:E.focus)==null||m.call(E)},S=()=>{r.value=!1},M=tt(()=>{const E=(d.value||"").trim().toLowerCase(),m=Array.isArray(v.value)?v.value:[];return E?m.filter(g=>{const D=((g==null?void 0:g.name)||"").toString().toLowerCase(),W=((g==null?void 0:g.bio)||"").toString().toLowerCase();return D.includes(E)||W.includes(E)}):m}),A=E=>((E==null?void 0:E.name)||"").toString().replace(/^@+/,"").trim(),T=E=>{const m=A(E);return m?n.value.mentions.includes(m):!1},G=async E=>{const m=l.value,g=n.value.text||"",D=Math.min(i.value.start||0,g.length),W=Math.min(i.value.end||D,g.length),te=(m==null?void 0:m.selectionStart)??D,R=(m==null?void 0:m.selectionEnd)??W;n.value.text=g.slice(0,te)+E+g.slice(R),await Yt();try{m.focus();const F=te+E.length;m.setSelectionRange(F,F),i.value={start:F,end:F}}catch{}},K=async E=>{const m=A(E);if(!m)return;if(n.value.mentions.includes(m)){n.value.mentions=n.value.mentions.filter(D=>D!==m);return}n.value.mentions=Array.from(new Set([...n.value.mentions,m])),await G(`@${m} `)},q=tt(()=>{switch(n.value.visibility){case"friends":return"";case"private":return"";default:return""}}),ee=()=>{const E=n.value.visibility;n.value.visibility=E==="public"?"friends":E==="friends"?"private":"public"},Z=()=>{const E={...n.value};o("submit",E)};return(E,m)=>(p(),f("div",{class:"moment-create-mask",onClick:m[4]||(m[4]=Pe(g=>o("close"),["self"]))},[e("div",J2,[e("header",Y2,[m[5]||(m[5]=e("span",{class:"title"}," ",-1)),e("button",{class:"close-btn",onClick:m[0]||(m[0]=g=>o("close"))},"")]),e("section",X2,[ke(e("textarea",{ref_key:"textareaRef",ref:l,"onUpdate:modelValue":m[1]||(m[1]=g=>n.value.text=g),class:"main-textarea",rows:"6",placeholder:"...()",onClick:j,onKeyup:j,onSelect:j},null,544),[[je,n.value.text]]),n.value.image?(p(),f("div",Q2,[e("img",{src:n.value.image,alt:""},null,8,ey),e("button",{class:"remove-preview",onClick:I},"")])):N("",!0),e("div",ty,[e("div",sy,[e("button",{class:"tool-btn",onClick:b,"aria-label":""},[...m[6]||(m[6]=[e("svg",{class:"tool-icon",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{d:"M7 3h10a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3Z",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linejoin":"round"}),e("path",{d:"M7 16l3.2-3.2a1.4 1.4 0 0 1 2 0L15 15.6l1.2-1.2a1.4 1.4 0 0 1 2 0L20 16.2",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M9 9.2a1.6 1.6 0 1 0 0 .1Z",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)])]),e("input",{ref_key:"fileInput",ref:a,type:"file",accept:"image/*",class:"hidden-input",onChange:w},null,544),e("button",{class:"tool-btn",onClick:x,"aria-label":""},[...m[7]||(m[7]=[e("span",{class:"at-text"},"@",-1)])])]),e("button",{class:"visibility-pill",onClick:ee},[m[8]||(m[8]=e("svg",{class:"pill-icon",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{d:"M12 21a9 9 0 1 0-9-9 9 9 0 0 0 9 9Z",fill:"none",stroke:"currentColor","stroke-width":"2"}),e("path",{d:"M3.5 12h17",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"}),e("path",{d:"M12 3c2.6 2.7 4.1 5.8 4.1 9s-1.5 6.3-4.1 9c-2.6-2.7-4.1-5.8-4.1-9S9.4 5.7 12 3Z",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linejoin":"round"})],-1)),ot(" "+_(q.value),1)])]),r.value?(p(),f("div",{key:1,class:"mention-popover",onClick:m[3]||(m[3]=Pe(()=>{},["stop"]))},[e("div",{class:"mention-popover-header"},[m[9]||(m[9]=e("span",{class:"mention-popover-title"}," @ ",-1)),e("button",{class:"mention-close",onClick:S,"aria-label":""},"")]),e("div",oy,[ke(e("input",{ref_key:"mentionSearchRef",ref:c,"onUpdate:modelValue":m[2]||(m[2]=g=>d.value=g),type:"text",placeholder:"",class:"mention-search"},null,512),[[je,d.value]]),e("button",{class:"mention-done",onClick:S},"")]),e("div",ny,[u.value?(p(),f("div",ay,"...")):M.value.length===0?(p(),f("div",ly,"")):(p(!0),f(Le,{key:2},Fe(M.value,g=>(p(),f("label",{key:g.id??g.name,class:"mention-item"},[e("input",{class:"mention-checkbox",type:"checkbox",checked:T(g),onChange:D=>K(g)},null,40,iy),e("span",ry,_(g.name||""),1),g.bio?(p(),f("span",cy,_(g.bio),1)):N("",!0)]))),128))])])):N("",!0),n.value.mentions.length?(p(),f("div",dy,[(p(!0),f(Le,null,Fe(n.value.mentions,g=>(p(),f("span",{key:g,class:"mention-chip"},"@"+_(g),1))),128))])):N("",!0)]),e("footer",{class:"moment-create-actions"},[e("button",{class:"publish-btn",onClick:Z},"")])])]))}},vy=Xe(uy,[["__scopeId","data-v-bb817b83"]]),py={class:"contact-card-setting-overlay"},fy={class:"setting-panel"},my={class:"header"},gy={class:"contact-info"},hy={class:"contact-name"},yy={class:"content"},by={class:"tip-box"},wy={class:"cards-grid"},ky=["onClick"],xy=["onClick"],Cy={key:0,class:"clear-section"},$y={__name:"ContactCardSetting",props:{contact:{type:Object,required:!0}},emits:["close","save"],setup(t,{emit:s}){const o=t,n=s,a=h([]),l=h(""),i=h(null);it(async()=>{try{const x=await C.getSetting("moment_contact_cards")||{};a.value=x[o.contact.id]||[]}catch($){console.error(":",$)}});const r=()=>{i.value&&i.value.click()},c=async $=>{const x=$.target.files;if(!(!x||x.length===0)){try{const S=Array.from(x).map(A=>new Promise((T,G)=>{const K=new FileReader;K.onload=q=>T(q.target.result),K.onerror=G,K.readAsDataURL(A)})),M=await Promise.all(S);a.value=[...a.value,...M],j(` ${M.length} `)}catch(S){console.error(":",S),j("")}$.target.value=""}},d=$=>{confirm("")&&(a.value.splice($,1),j(""))},u=()=>{confirm("")&&(a.value=[],j(""))},v=()=>{n("save",o.contact.id,a.value)},b=()=>{n("close")},w=$=>{l.value=$},I=()=>{l.value=""},j=$=>{const x=document.createElement("div");x.className="kawaii-toast",x.textContent=$,document.body.appendChild(x),x.offsetHeight,x.style.opacity="1",setTimeout(()=>{x.style.opacity="0",setTimeout(()=>x.remove(),300)},2e3)};return($,x)=>(p(),f("div",py,[e("div",fy,[e("div",my,[e("button",{class:"back-btn",onClick:b},""),e("div",gy,[e("div",{class:"contact-avatar",style:Oe({backgroundImage:`url(${t.contact.avatar})`})},null,4),e("div",hy,_(t.contact.name),1)]),e("button",{class:"save-btn",onClick:v},"")]),e("div",yy,[e("div",by,[e("p",null,"  "+_(t.contact.name)+" ",1),x[0]||(x[0]=e("p",null," ",-1))]),e("div",{class:"add-card-btn",onClick:r},[...x[1]||(x[1]=[e("div",{class:"add-icon"},"+",-1),e("div",{class:"add-text"},"",-1)])]),e("div",wy,[(p(!0),f(Le,null,Fe(a.value,(S,M)=>(p(),f("div",{key:M,class:"card-item",onClick:A=>w(S)},[e("div",{class:"card-image",style:Oe({backgroundImage:`url(${S})`})},null,4),e("button",{class:"delete-btn",onClick:Pe(A=>d(M),["stop"])},"",8,xy)],8,ky))),128))]),a.value.length>0?(p(),f("div",Cy,[e("button",{class:"clear-btn",onClick:u},"   ")])):N("",!0)])]),l.value?(p(),f("div",{key:0,class:"preview-overlay",onClick:I},[e("div",{class:"preview-image",style:Oe({backgroundImage:`url(${l.value})`})},null,4)])):N("",!0),e("input",{ref_key:"fileInput",ref:i,type:"file",accept:"image/*",multiple:"",style:{display:"none"},onChange:c},null,544)]))}},_y=Xe($y,[["__scopeId","data-v-cd6cdba3"]]),My={class:"card-manager-fullscreen"},Sy={class:"tabs"},Ay={key:0,class:"content"},Iy={class:"cards-grid"},Ly=["onClick"],Ty=["onClick"],jy={key:0,class:"empty-state"},Py={key:1,class:"content"},Ey={class:"contacts-list"},By=["onClick"],Vy={class:"contact-info"},Dy={class:"contact-name"},Hy={class:"contact-status"},Fy={key:0,class:"empty-state"},Uy={__name:"CardManager",emits:["close"],setup(t,{emit:s}){const o=s,n=h("public"),a=h([]),l=h([]),i=h({}),r=h(!1),c=h(null),d=h(""),u=h(null);it(async()=>{await v(),await b(),await w()});const v=async()=>{try{const ee=await C.getSetting("moment_public_cards");a.value=ee||[]}catch(ee){console.error(":",ee)}},b=async()=>{try{const ee=await C.getContacts();l.value=ee||[]}catch(ee){console.error(":",ee)}},w=async()=>{try{const ee=await C.getSetting("moment_contact_cards");i.value=ee||{}}catch(ee){console.error(":",ee)}},I=ee=>{const Z=i.value[ee];return Z&&Z.length>0?` ${Z.length} `:""},j=()=>{u.value&&u.value.click()},$=async ee=>{const Z=ee.target.files;if(!(!Z||Z.length===0)){try{const E=Array.from(Z).map(g=>new Promise((D,W)=>{const te=new FileReader;te.onload=R=>D(R.target.result),te.onerror=W,te.readAsDataURL(g)})),m=await Promise.all(E);a.value=[...a.value,...m],await C.setSetting("moment_public_cards",a.value),q(` ${m.length} `)}catch(E){console.error(":",E),q("")}ee.target.value=""}},x=async ee=>{confirm("")&&(a.value.splice(ee,1),await C.setSetting("moment_public_cards",a.value),q(""))},S=ee=>{c.value=ee,r.value=!0},M=()=>{r.value=!1,c.value=null},A=async(ee,Z)=>{i.value[ee]=Z,await C.setSetting("moment_contact_cards",i.value),q(""),M()},T=ee=>{d.value=ee},G=()=>{d.value=""},K=()=>{o("close")},q=ee=>{const Z=document.createElement("div");Z.className="kawaii-toast",Z.textContent=ee,document.body.appendChild(Z),Z.offsetHeight,Z.style.opacity="1",setTimeout(()=>{Z.style.opacity="0",setTimeout(()=>Z.remove(),300)},2e3)};return(ee,Z)=>(p(),f("div",My,[e("div",{class:"top-bar"},[e("button",{class:"back-btn",onClick:K}," "),Z[2]||(Z[2]=e("h2",null,"",-1)),e("button",{class:"add-btn",onClick:j},"+")]),e("div",Sy,[e("div",{class:Se(["tab-item",{active:n.value==="public"}]),onClick:Z[0]||(Z[0]=E=>n.value="public")},"  ",2),e("div",{class:Se(["tab-item",{active:n.value==="contacts"}]),onClick:Z[1]||(Z[1]=E=>n.value="contacts")},"  ",2)]),n.value==="public"?(p(),f("div",Ay,[Z[4]||(Z[4]=e("div",{class:"tip-box"},[e("p",null," "),e("p",null," ")],-1)),e("div",Iy,[(p(!0),f(Le,null,Fe(a.value,(E,m)=>(p(),f("div",{key:m,class:"card-item",onClick:g=>T(E)},[e("div",{class:"card-image",style:Oe({backgroundImage:`url(${E})`})},null,4),e("button",{class:"delete-btn",onClick:Pe(g=>x(m),["stop"])},"",8,Ty)],8,Ly))),128)),a.value.length===0?(p(),f("div",jy,[...Z[3]||(Z[3]=[e("p",null," ",-1),e("p",null," + ",-1)])])):N("",!0)])])):N("",!0),n.value==="contacts"?(p(),f("div",Py,[Z[7]||(Z[7]=e("div",{class:"tip-box"},[e("p",null," "),e("p",null," ")],-1)),e("div",Ey,[(p(!0),f(Le,null,Fe(l.value,E=>(p(),f("div",{key:E.id,class:"contact-item",onClick:m=>S(E)},[e("div",{class:"contact-avatar",style:Oe({backgroundImage:`url(${E.avatar})`})},null,4),e("div",Vy,[e("div",Dy,_(E.name),1),e("div",Hy,_(I(E.id)),1)]),Z[5]||(Z[5]=e("div",{class:"arrow"},"",-1))],8,By))),128)),l.value.length===0?(p(),f("div",Fy,[...Z[6]||(Z[6]=[e("p",null," ",-1)])])):N("",!0)])])):N("",!0),r.value?(p(),nt(_y,{key:2,contact:c.value,onClose:M,onSave:A},null,8,["contact"])):N("",!0),d.value?(p(),f("div",{key:3,class:"preview-overlay",onClick:G},[e("div",{class:"preview-image",style:Oe({backgroundImage:`url(${d.value})`})},null,4)])):N("",!0),e("input",{ref_key:"fileInput",ref:u,type:"file",accept:"image/*",multiple:"",style:{display:"none"},onChange:$},null,544)]))}},Ry=Xe(Uy,[["__scopeId","data-v-13df76ca"]]),Ny={class:"settings-panel"},Oy={class:"settings-content"},zy={class:"setting-item"},Ky={class:"switch"},Wy={key:0,class:"setting-item"},Gy={key:1,class:"setting-item"},qy={class:"stats-section"},Zy={class:"stat-item"},Jy={class:"stat-value"},Yy={class:"stat-item"},Xy={class:"stat-value"},Qy={__name:"MomentSettings",emits:["close"],setup(t,{emit:s}){const o=s,n=h(!1),a=h(20),l=h(0),i=h(0),r=h(!1);it(async()=>{try{const $=await C.getSetting("moment_auto_delete_folded"),x=await C.getSetting("moment_fold_threshold");$!==void 0&&(n.value=$),x!==void 0&&(a.value=x),await c()}catch($){console.error(":",$)}});const c=async()=>{try{const $=await C.getMomentPosts();l.value=$.length,i.value=$.filter(x=>x.aiGenerated).length}catch($){console.error(":",$)}},d=async()=>{try{await C.setSetting("moment_auto_delete_folded",n.value),b(n.value?"":"")}catch($){console.error(":",$),b("")}},u=async()=>{try{await C.setSetting("moment_fold_threshold",a.value),b(` ${a.value} `)}catch($){console.error(":",$),b("")}},v=async()=>{if(confirm(` ${a.value} `))try{const S=(await C.getMomentPosts()).sort((M,A)=>(A.createdAt||0)-(M.createdAt||0)).slice(a.value);for(const M of S)await C.deleteMomentPost(M.id);b(` ${S.length} `),await c()}catch($){console.error(":",$),b("")}},b=$=>{const x=document.createElement("div");x.className="kawaii-toast",x.textContent=$,document.body.appendChild(x),x.offsetHeight,x.style.opacity="1",setTimeout(()=>{x.style.opacity="0",setTimeout(()=>x.remove(),300)},2e3)},w=()=>{o("close")},I=()=>{r.value=!0},j=()=>{r.value=!1};return($,x)=>(p(),f("div",{class:"settings-overlay",onClick:Pe(w,["self"])},[e("div",Ny,[e("div",{class:"settings-header"},[x[2]||(x[2]=e("h3",null,"",-1)),e("button",{class:"close-btn",onClick:w},"")]),e("div",Oy,[e("div",zy,[x[4]||(x[4]=e("div",{class:"setting-info"},[e("div",{class:"setting-title"},""),e("div",{class:"setting-desc"},"")],-1)),e("label",Ky,[ke(e("input",{type:"checkbox","onUpdate:modelValue":x[0]||(x[0]=S=>n.value=S),onChange:d},null,544),[[os,n.value]]),x[3]||(x[3]=e("span",{class:"slider"},null,-1))])]),n.value?(p(),f("div",Wy,[x[6]||(x[6]=e("div",{class:"setting-info"},[e("div",{class:"setting-title"},""),e("div",{class:"setting-desc"},"")],-1)),ke(e("select",{"onUpdate:modelValue":x[1]||(x[1]=S=>a.value=S),onChange:u,class:"threshold-select"},[...x[5]||(x[5]=[e("option",{value:10},"10 ",-1),e("option",{value:20},"20 ",-1),e("option",{value:30},"30 ",-1),e("option",{value:50},"50 ",-1),e("option",{value:100},"100 ",-1)])],544),[[Hs,a.value]])])):N("",!0),n.value?(p(),f("div",Gy,[e("button",{class:"cleanup-btn",onClick:v},"   ")])):N("",!0),e("div",{class:"setting-item"},[x[7]||(x[7]=e("div",{class:"setting-info"},[e("div",{class:"setting-title"}," "),e("div",{class:"setting-desc"},"")],-1)),e("button",{class:"manage-btn",onClick:I},"   ")]),e("div",qy,[e("div",Zy,[x[8]||(x[8]=e("span",{class:"stat-label"},"",-1)),e("span",Jy,_(l.value),1)]),e("div",Yy,[x[9]||(x[9]=e("span",{class:"stat-label"},"AI ",-1)),e("span",Xy,_(i.value),1)])])])]),r.value?(p(),nt(Ry,{key:0,onClose:j})):N("",!0)]))}},eb=Xe(Qy,[["__scopeId","data-v-5d7657b7"]]),tb={class:"forward-panel"},sb={class:"forward-content"},ob={class:"original-post"},nb={class:"post-author"},ab={class:"author-info"},lb={class:"author-name"},ib={class:"author-username"},rb=["innerHTML"],cb={class:"contacts-section"},db={key:0,class:"empty-contacts"},ub={key:1,class:"contacts-list"},vb=["value"],pb={class:"contact-info"},fb={class:"contact-name"},mb=["disabled"],gb={__name:"MomentForward",props:{post:{type:Object,required:!0}},emits:["close","forward"],setup(t,{emit:s}){const o=t,n=s,a=h([]),l=h([]),i=(v="")=>(v||"").replace(/\n/g,"<br>"),r=async()=>{try{const v=await C.getContacts();a.value=v||[]}catch(v){console.error(":",v),a.value=[]}},c=async()=>{if(l.value.length===0){u("");return}try{const v=`
${o.post.authorName}: ${o.post.content}`;for(const b of l.value){let I=(await C.getChatList()).find($=>$.contactId===b&&$.type==="single");if(I)I.lastMessage=v.substring(0,50),I.lastMessageTime=Date.now(),await C.updateChatListItem(I);else{const $=a.value.find(S=>S.id===b);I={contactId:b,type:"single",name:($==null?void 0:$.name)||"",avatar:($==null?void 0:$.avatar)||"",lastMessage:v.substring(0,50),lastMessageTime:Date.now(),unreadCount:0},await C.addChatListItem(I),I=(await C.getChatList()).find(S=>S.contactId===b&&S.type==="single")}const j={chatId:I.id,text:v,html:v,content:v,sent:!0,time:Date.now(),type:"text",read:!1};await C.addChatMessage(j)}u(` ${l.value.length} `),n("forward",{contactIds:l.value,post:o.post}),d()}catch(v){console.error(":",v),u("")}},d=()=>{n("close")},u=v=>{const b=document.createElement("div");b.className="kawaii-toast",b.textContent=v,document.body.appendChild(b),b.offsetHeight,b.style.opacity="1",setTimeout(()=>{b.style.opacity="0",setTimeout(()=>b.remove(),300)},2e3)};return it(()=>{r()}),(v,b)=>(p(),f("div",{class:"forward-overlay",onClick:Pe(d,["self"])},[e("div",tb,[e("div",{class:"forward-header"},[b[1]||(b[1]=e("h3",null,"",-1)),e("button",{class:"close-btn",onClick:d},"")]),e("div",sb,[e("div",ob,[e("div",nb,[e("div",{class:"author-avatar",style:Oe({backgroundImage:`url(${t.post.authorAvatar})`})},null,4),e("div",ab,[e("div",lb,_(t.post.authorName),1),e("div",ib,_(t.post.authorUsername),1)])]),e("div",{class:"post-content",innerHTML:i(t.post.content)},null,8,rb),t.post.image?(p(),f("div",{key:0,class:"post-image",style:Oe({backgroundImage:`url(${t.post.image})`})},null,4)):N("",!0)]),e("div",cb,[b[2]||(b[2]=e("div",{class:"section-title"},"",-1)),a.value.length===0?(p(),f("div",db,"  ")):(p(),f("div",ub,[(p(!0),f(Le,null,Fe(a.value,w=>(p(),f("label",{key:w.id,class:Se(["contact-item",{selected:l.value.includes(w.id)}])},[ke(e("input",{type:"checkbox",value:w.id,"onUpdate:modelValue":b[0]||(b[0]=I=>l.value=I),class:"contact-checkbox"},null,8,vb),[[os,l.value]]),e("div",{class:"contact-avatar",style:Oe({backgroundImage:`url(${w.avatar})`})},null,4),e("div",pb,[e("div",fb,_(w.name),1)])],2))),128))]))]),e("button",{class:"forward-btn",onClick:c,disabled:l.value.length===0},"  "+_(l.value.length>0?`${l.value.length} `:"..."),9,mb)])])]))}},hb=Xe(gb,[["__scopeId","data-v-1efc4bb8"]]),yb={class:"phone-container"},bb={class:"status-bar"},wb={class:"status-bar-left"},kb={id:"clock"},xb={key:0,class:"page-content fade-in"},Cb={class:"nav-bar"},$b={class:"timeline-content"},_b=["onPointerdown"],Mb={class:"post-header"},Sb=["onClick"],Ab={class:"post-info"},Ib=["onClick"],Lb={class:"post-username"},Tb=["innerHTML"],jb={key:0,class:"mentions-line"},Pb=["data-description"],Eb={class:"post-actions"},Bb=["onClick"],Vb=["onClick"],Db=["onClick"],Hb={key:1,class:"comments"},Fb=["onClick"],Ub=["onClick"],Rb={class:"comment-content"},Nb=["onClick"],Ob=["innerHTML"],zb={key:2,class:"star-input"},Kb=["onUpdate:modelValue","data-post-id","onKeyup"],Wb=["onClick"],Gb={key:0,class:"fold-row"},qb={key:1,class:"page-content fade-in"},Zb={class:"profile-actions"},Jb={class:"profile-content-wrapper"},Yb={class:"profile-stats"},Xb={key:0,class:"empty-tip"},Qb={class:"tweet-header"},ew={class:"tweet-info"},tw={class:"tweet-name"},sw={class:"tweet-username"},ow=["innerHTML"],nw=["data-description"],aw={key:1,class:"mentions-line"},lw={class:"tweet-actions"},iw=["onClick"],rw=["onClick"],cw={class:"edit-dialog"},dw={class:"edit-dialog-header"},uw={class:"edit-dialog-body"},vw={class:"bottom-nav"},Qn="https://files.catbox.moe/3ehyu8.jpg",pw={__name:"MomentFeed",emits:["back","view-profile"],setup(t,{emit:s}){const o=s,n=h("12:00"),a=h("timeline"),l=h(null),i=h(null),r=h(null),c=h(null),d=h(null),u=h(!1),v=h(!1),b=h(!1),w=h(null),I=h({visible:!1,field:"",title:"",value:"",multiline:!1}),j=h([]),$=h([]),x=h(!1),S=h({}),M=h({}),A=h({avatar:null,coverImage:"https://files.catbox.moe/bpqrv2.jpg",name:"Rina-chan",username:"@rina_kawaii",bio:`Kawaii lover | Caf hopper  | Fashion 
Follow me for cute things! 
`,email:"rina@kawaii.com"}),T=["https://files.catbox.moe/0g3kqu.jpg","https://files.catbox.moe/d5b7k6.jpg","https://files.catbox.moe/0yrhh6.jpg","https://files.catbox.moe/8mjvdg.jpg","https://files.catbox.moe/fvidas.jpg","https://files.catbox.moe/q6so2i.jpg","https://files.catbox.moe/5a96cp.jpg","https://files.catbox.moe/0mp6h0.jpg","https://files.catbox.moe/epcn03.jpg","https://files.catbox.moe/7jzdp7.jpg","https://files.catbox.moe/jrmu6w.jpg","https://files.catbox.moe/c0bwhn.jpg","https://files.catbox.moe/0blxme.jpg","https://files.catbox.moe/qicobr.jpg","https://files.catbox.moe/n94ztu.jpg"],G=()=>crypto.randomUUID?crypto.randomUUID():`id-${Date.now()}-${Math.random().toString(16).slice(2)}`,K=(J="")=>(J||"").replace(/\n/g,"<br>"),q=(J="")=>String(J).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),ee=(J="")=>q(J||"").replace(/@([^\s@]{1,24})/g,'<span class="mention-at">@$1</span>'),Z=(J=0)=>J>=1e4?`${(J/1e4).toFixed(1)}w`:J>=1e3?`${(J/1e3).toFixed(1)}k`:J,E=tt(()=>{const J={};for(const X of $.value||[])X&&X.id!=null&&(J[X.id]=X);return J}),m=async({name:J,avatar:X,username:ne,bio:Te})=>{const ue=(J||"").trim();if(!ue)return null;const We=($.value||[]).find(Mt=>((Mt==null?void 0:Mt.name)||"").trim()===ue);if(We)return We.id;const Re=Date.now()+Math.floor(Math.random()*1e3),Be={id:Re,name:ue,avatar:X||Qn,bio:"",prompt:"",username:ne||"",type:"contact",createdAt:Date.now(),updatedAt:Date.now()};return await C.addContact(Be),Re},g=async J=>{if(!((J||[]).some(ue=>ue&&(ue.authorAvatar||ue.authorName||ue.authorUsername))||(J||[]).some(ue=>((ue==null?void 0:ue.comments)||[]).some(We=>We&&(We.avatar||We.authorName)))))return J||[];const ne=await C.getContacts();$.value=ne||[];const Te=[];for(const ue of J||[]){const We=!!(ue!=null&&ue.isSelf),Re=We?null:(ue==null?void 0:ue.author_id)??await m({name:ue==null?void 0:ue.authorName,avatar:ue==null?void 0:ue.authorAvatar,username:ue==null?void 0:ue.authorUsername,bio:""}),Be=[];for(const Lt of(ue==null?void 0:ue.comments)||[]){if(!Lt)continue;if(Lt.isSelf){Be.push({id:Lt.id||G(),isSelf:!0,text:Lt.text||"",createdAt:Lt.createdAt||Date.now()});continue}if(Lt.author_id!=null){Be.push({id:Lt.id||G(),author_id:Lt.author_id,text:Lt.text||"",createdAt:Lt.createdAt||Date.now()});continue}const Ms=await m({name:Lt.authorName,avatar:Lt.avatar,username:"",bio:""});Be.push({id:Lt.id||G(),author_id:Ms,text:Lt.text||"",createdAt:Lt.createdAt||Date.now()})}const Mt={id:(ue==null?void 0:ue.id)||G(),author_id:Re,isSelf:We,aiGenerated:!!(ue!=null&&ue.aiGenerated),content:(ue==null?void 0:ue.content)||"",mediaDesc:(ue==null?void 0:ue.mediaDesc)||(ue==null?void 0:ue.media_desc)||"",image:(ue==null?void 0:ue.image)||"",mentions:(ue==null?void 0:ue.mentions)||[],visibility:(ue==null?void 0:ue.visibility)||"public",likes:(ue==null?void 0:ue.likes)||0,liked:!!(ue!=null&&ue.liked),shares:(ue==null?void 0:ue.shares)||0,comments:Be,createdAt:(ue==null?void 0:ue.createdAt)||Date.now()};Te.push(Mt),await C.upsertMomentPost(Mt)}return Te.sort((ue,We)=>(We.createdAt||0)-(ue.createdAt||0))},D=J=>{if(((J==null?void 0:J.name)||"").trim()!=="Mio")return!1;const ne=((J==null?void 0:J.username)||"").trim(),Te=((J==null?void 0:J.bio)||"").trim(),ue=((J==null?void 0:J.avatar)||"").trim();return ne==="@mio_pop"||Te.includes("New nail art")||ue.includes("tw2ygf.jpg")},W=async()=>{try{const X=(await C.getContacts()||[]).find(D);if(!(X!=null&&X.id))return;const ne=await C.getMomentPosts();for(const Te of ne||[]){if(!(Te!=null&&Te.id))continue;if(Te.author_id===X.id){await C.deleteMomentPost(Te.id);continue}const ue=Array.isArray(Te.comments)?Te.comments:[],We=ue.filter(Re=>(Re==null?void 0:Re.author_id)!==X.id);We.length!==ue.length&&await C.upsertMomentPost({...Te,comments:We})}await C.deleteContact(X.id)}catch(J){console.error(":",J)}},te=async()=>[],R=h(!1),F=async()=>{try{$.value=await C.getContacts()}catch(J){console.error(":",J),$.value=[]}},ie=async J=>{for(const X of J||[])if(X!=null&&X.aiGenerated&&!(X!=null&&X.image)){const ne={...X,image:$e()};R.value=!0,await C.upsertMomentPost(ne),R.value=!1,j.value=j.value.map(Te=>Te.id===ne.id?ne:Te)}},re=async()=>{try{const J=await C.getMomentPosts();J&&J.length?j.value=await g(J):j.value=await te(),await ie(j.value)}catch(J){console.error(":",J),j.value=[]}},pe=J=>{if(!J)return J;if(J.isSelf)return{...J,authorName:A.value.name,avatar:A.value.avatar};const X=J.author_id,ne=X!=null?E.value[X]:null;return{...J,authorName:(ne==null?void 0:ne.name)||"Unknown",avatar:(ne==null?void 0:ne.avatar)||Qn}},we=J=>{if(!J)return J;if(J.isSelf)return{...J,authorName:A.value.name,authorUsername:A.value.username,authorAvatar:A.value.avatar,comments:(J.comments||[]).slice().sort((ue,We)=>(ue.createdAt||0)-(We.createdAt||0)).map(pe)};const X=J.author_id,ne=X!=null?E.value[X]:null,Te=(ne==null?void 0:ne.username)||(ne!=null&&ne.name?`@${String(ne.name).toLowerCase().replace(/\s+/g,"_")}`:"@user");return{...J,authorName:(ne==null?void 0:ne.name)||"Unknown",authorUsername:Te,authorAvatar:(ne==null?void 0:ne.avatar)||Qn,comments:(J.comments||[]).slice().sort((ue,We)=>(ue.createdAt||0)-(We.createdAt||0)).map(pe)}},he=tt(()=>j.value.map(we)),Ue=tt(()=>x.value?he.value:he.value.slice(0,5)),ge=tt(()=>he.value.length>5),B=tt(()=>he.value.filter(J=>J.isSelf));let L=null,k=null,y=null;it(async()=>{await Ce.init(),await W(),Ee(),L=setInterval(Ee,6e4),l.value=new Audio("https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"),await H(),await F(),await re(),xt(),k=async J=>{const X=(J==null?void 0:J.detail)||{};R.value||(X.storeName==="momentPosts"&&await re(),X.storeName==="contacts"&&await F())},window.addEventListener("idb-change",k),y=J=>{const X=(J==null?void 0:J.detail)||{};X!=null&&X.authorName&&Ve(`${X.authorName} `)},window.addEventListener("moment-ai-comment",y),window.addEventListener("ai-force-generate-moments-done",J=>{const X=(J==null?void 0:J.detail)||{};if(X!=null&&X.error){Ve("  API ");return}Ve(`  ${X.okCount||0}/${X.total||0} `)})}),zt(()=>{L&&clearInterval(L),k&&window.removeEventListener("idb-change",k),y&&window.removeEventListener("moment-ai-comment",y)});const H=async()=>{try{const J=await C.getSetting("moment_avatar"),X=await C.getSetting("moment_cover"),ne=await C.getSetting("moment_name"),Te=await C.getSetting("moment_username"),ue=await C.getSetting("moment_bio"),We=await C.getSetting("moment_email");J&&(A.value.avatar=J),X&&(A.value.coverImage=X),ne&&(A.value.name=ne),Te&&(A.value.username=Te),ue&&(A.value.bio=ue),We&&(A.value.email=We)}catch(J){console.error(":",J)}},se=()=>{const J=document.createElement("input");J.type="file",J.accept="image/*",J.onchange=async X=>{const ne=X.target.files[0];if(ne){const Te=new FileReader;Te.onload=async ue=>{A.value.avatar=ue.target.result,await C.setSetting("moment_avatar",ue.target.result),Ve(""),await syncSelfPosts()},Te.readAsDataURL(ne)}},J.click()},P=()=>{const J=document.createElement("input");J.type="file",J.accept="image/*",J.onchange=async X=>{const ne=X.target.files[0];if(ne){const Te=new FileReader;Te.onload=async ue=>{A.value.coverImage=ue.target.result,await C.setSetting("moment_cover",ue.target.result),Ve("")},Te.readAsDataURL(ne)}},J.click()},U={name:{title:"",storageKey:"moment_name",toast:"",multiline:!1},username:{title:"",storageKey:"moment_username",toast:"",multiline:!1},bio:{title:"",storageKey:"moment_bio",toast:"",multiline:!0},email:{title:"",storageKey:"moment_email",toast:"",multiline:!1}},O=J=>{const X=U[J];X&&(I.value={visible:!0,field:J,title:X.title,value:A.value[J]||"",multiline:!!X.multiline})},Q=()=>{I.value.visible=!1},ae=async()=>{const{field:J,value:X}=I.value,ne=U[J];if(!ne)return Q();const Te=(X||"").trim();if(!Te){Ve("");return}A.value[J]=Te,await C.setSetting(ne.storageKey,Te),Ve(ne.toast),(J==="name"||J==="username")&&await syncSelfPosts(),Q()},fe=()=>O("name"),Me=()=>O("username"),Ie=()=>O("bio"),$e=()=>T[Math.floor(Math.random()*T.length)],ye=J=>{if(a.value===J)return;He(),a.value=J,i.value&&(i.value.scrollTop=0);const X=J==="timeline"?"":"";Ve(`${X}`),De(`${X}`)},Ne=()=>{He(),o("back")},Ee=()=>{const J=new Date,X=String(J.getHours()).padStart(2,"0"),ne=String(J.getMinutes()).padStart(2,"0");n.value=`${X}:${ne}`},He=()=>{l.value&&(l.value.currentTime=0,l.value.play().catch(J=>console.log("Audio play failed:",J)))},Ge=J=>{const X=document.createElement("div");X.className="heart",X.innerHTML="",X.style.left=J.clientX+"px",X.style.top=J.clientY+"px",document.body.appendChild(X),setTimeout(()=>X.remove(),3e3)},et=(J,X)=>{J.stopPropagation(),He();const ne=J.currentTarget;xe(ne),ne.style.transform="scale(0.95)",setTimeout(()=>ne.style.transform="",100);let Te="";switch(X){case"like":Te="";break;case"share":Te="";break;case"bookmark":Te="";break;case"settings":Te="",De("");break;case"profile":Te="";break;case"edit":Te="";break;case"stat":Te="";break;case"comment":Te="";break;default:Te="Click! "}Te&&Ve(Te)},me=J=>{J.stopPropagation(),He();const X=J.currentTarget,ne=X.querySelector(".image-description");if(ne)ne.remove();else{const Te=document.createElement("div");Te.className="image-description",Te.textContent=X.dataset.description||"Kawaii Image!",X.style.position="relative",X.appendChild(Te),Ve("")}},le=J=>{if(J===A.value.name)ye("mypage");else{const X=(J||"").trim();if(!X)return;const ne=($.value||[]).find(ue=>((ue==null?void 0:ue.name)||"").trim()===X);(async()=>{try{const ue=ne||await(async()=>{const We=await C.getContacts();return $.value=We||[],($.value||[]).find(Re=>((Re==null?void 0:Re.name)||"").trim()===X)})();if((ue==null?void 0:ue.id)!=null){Ve(`${X}...`),o("view-profile",ue.id);return}De(`${X}`),Ve(`${X}...`)}catch(ue){console.warn(":",ue),De(`${X}`),Ve(`${X}...`)}})()}},De=J=>{typeof window.triggerSlash=="function"?window.triggerSlash(`/send ${J}|/trigger`):console.log(`[Mock Send]: ${J}`)},xe=J=>{const X=J.getBoundingClientRect();for(let ne=0;ne<5;ne++){const Te=document.createElement("div");Te.className="sparkle",Te.style.left=`${X.left+Math.random()*X.width}px`,Te.style.top=`${X.top+Math.random()*X.height}px`,document.body.appendChild(Te),setTimeout(()=>Te.remove(),1500)}},Ve=J=>{const X=document.createElement("div");X.className="kawaii-toast",X.textContent=J,document.body.appendChild(X),X.offsetHeight,X.style.opacity="1",setTimeout(()=>{X.style.opacity="0",setTimeout(()=>X.remove(),300)},2e3)},xt=()=>{const J=document.createElement("div");J.className="loading-animation",document.body.appendChild(J),J.style.display="block",setTimeout(()=>{J.style.display="none",J.remove()},1e3)},yt=()=>{x.value=!x.value},ce=async J=>{const X=j.value.find(We=>We.id===J);if(!X)return;const ne=!X.liked,Te=Math.max(0,(X.likes||0)+(ne?1:-1)),ue={...X,liked:ne,likes:Te};j.value=j.value.map(We=>We.id===J?ue:We),await C.upsertMomentPost(ue)},oe=J=>{S.value={...S.value,[J]:!S.value[J]}},ve=async J=>{await Yt();const X=document.querySelector(`.star-input-field[data-post-id="${J}"]`);if(X){X.focus();try{X.setSelectionRange(X.value.length,X.value.length)}catch{}}},Ze=async(J,X)=>{const ne=X==null?void 0:X.authorName;ne&&(S.value={...S.value,[J]:!0},M.value={...M.value,[J]:`@${ne} `},await ve(J))},_e=async J=>{var We,Re;const X=(M.value[J]||"").trim();if(!X){Ve("");return}const ne=j.value.find(Be=>Be.id===J);if(!ne)return;const Te={id:G(),isSelf:!0,text:X,createdAt:Date.now()},ue={...ne,comments:[...ne.comments||[],Te]};if(j.value=j.value.map(Be=>Be.id===J?ue:Be),await C.upsertMomentPost(ue),!ne.isSelf&&ne.author_id!=null)(We=ls.scheduleReplyToUserCommentOnRolePost)==null||We.call(ls,{postId:J,actorId:ne.author_id,userId:"self",userName:A.value.name,userCommentText:X});else{const Be=($.value||[]).filter(Mt=>{const Lt=((Mt==null?void 0:Mt.name)||"").trim();return Lt?X.includes(`@${Lt}`):!1});for(const Mt of Be)(Re=ls.scheduleReplyToMention)==null||Re.call(ls,{postId:J,actorId:Mt.id,userName:A.value.name,userCommentText:X})}M.value={...M.value,[J]:""},S.value={...S.value,[J]:!1},Ve("")},ut=()=>{He(),Ve(" ..."),window.dispatchEvent(new CustomEvent("ai-force-generate-moments"))};let gt=null,at=!1;const Gt=(J,X)=>{var Te;if(!(X!=null&&X.isSelf)&&!(X!=null&&X.aiGenerated))return;const ne=(((Te=J.target)==null?void 0:Te.tagName)||"").toLowerCase();["input","textarea","button","select"].includes(ne)||at||(at=!0,gt=setTimeout(async()=>{if(!window.confirm("")){at=!1;return}j.value=j.value.filter(We=>We.id!==X.id);try{await C.deleteMomentPost(X.id),Ve("")}catch(We){console.error(":",We),Ve("")}finally{at=!1}},650))},It=()=>{gt&&clearTimeout(gt),gt=null,setTimeout(()=>{at=!1},80)},as=()=>{u.value=!0},be=()=>{u.value=!1},V=()=>{He(),v.value=!0},de=()=>{v.value=!1},pt=J=>{He(),w.value=J,b.value=!0},rt=()=>{b.value=!1,w.value=null},Et=async J=>{const X=j.value.find(ne=>ne.id===w.value.id);if(X){const ne={...X,shares:(X.shares||0)+1};j.value=j.value.map(Te=>Te.id===X.id?ne:Te),await C.upsertMomentPost(ne)}},bt=async J=>{const X=((J==null?void 0:J.text)||"").trim(),ne=((J==null?void 0:J.image)||"").trim();if(!X&&!ne){Ve("");return}const Te=Date.now(),ue=(J==null?void 0:J.visibility)||"public",We=(J==null?void 0:J.mentions)||[],Re={id:G(),author_id:null,content:X,image:ne,mediaDesc:"",mentions:We,visibility:ue,likes:0,liked:!1,shares:0,comments:[],createdAt:Te,isSelf:!0};j.value=[Re,...j.value],await C.upsertMomentPost(Re),Ve(""),u.value=!1,ls.scheduleInteractForUserPost(Re)};return(J,X)=>(p(),f("div",{class:"kawaii-container",onClick:Ge},[e("div",yb,[e("div",bb,[e("div",wb,[e("span",kb,_(n.value),1)]),X[12]||(X[12]=mt('<div class="status-bar-right" data-v-35d1e54a><svg class="status-icon-svg" viewBox="0 0 24 24" data-v-35d1e54a><path d="M20,20h2v-2h-2V20z M18,20h-2v-4h2V20z M14,20h-2v-6h2V20z M10,20H8v-8h2V20z M6,20H4v-10h2V20z" data-v-35d1e54a></path></svg><svg class="status-icon-svg" viewBox="0 0 24 24" data-v-35d1e54a><path d="M12,3C7.41,3,3.86,4.53,0.96,7.03L2.37,8.44C4.89,6.31,8.06,5,12,5s7.11,1.31,9.63,3.44l1.41-1.41C20.14,4.53,16.59,3,12,3z M12,7C9.3,7,6.81,7.89,4.8,9.4l1.4,1.4C7.6,9.67,9.69,9,12,9s4.4,0.67,5.8,1.8l1.4-1.4C17.19,7.89,14.7,7,12,7z M12,11c-1.94,0-3.5,0.5-4.7,1.3l1.4,1.4c0.8-0.5,2-0.7,3.3-0.7s2.5,0.2,3.3,0.7l1.4-1.4C15.5,11.5,13.94,11,12,11z M12,15c-0.85,0-1.5,0.15-2,0.4l2,2l2-2C13.5,15.15,12.85,15,12,15z" data-v-35d1e54a></path></svg><svg class="status-icon-svg" viewBox="0 0 24 24" data-v-35d1e54a><path d="M15.67,4H14V2h-4v2H8.33C7.6,4,7,4.6,7,5.33v15.33C7,21.4,7.6,22,8.33,22h7.33c0.74,0,1.33-0.6,1.33-1.33V5.33C17,4.6,16.4,4,15.67,4z M15,20H9V6h6V20z" data-v-35d1e54a></path></svg></div>',1))]),e("div",{class:"app-container",ref_key:"appContainer",ref:i},[a.value==="timeline"?(p(),f("div",xb,[e("div",Cb,[e("div",{class:"nav-profile clickable",onClick:Ne,style:Oe({backgroundImage:`url(${A.value.avatar})`})},null,4),X[13]||(X[13]=e("div",{class:"nav-logo"}," Kawaii SNS ",-1)),e("div",{class:"nav-actions"},[e("div",{class:"nav-debug clickable",onClick:ut,title:""},""),e("div",{class:"nav-settings clickable",onClick:V},"")])]),e("div",$b,[(p(!0),f(Le,null,Fe(Ue.value,(ne,Te)=>{var ue,We,Re;return p(),f("div",{key:ne.id,class:"post",onPointerdown:Be=>Gt(Be,ne),onPointerup:It,onPointercancel:It,onPointerleave:It},[e("div",Mb,[e("div",{class:"post-avatar clickable",style:Oe({backgroundImage:`url(${ne.authorAvatar})`}),onClick:Be=>ne.isSelf?ye("mypage"):le(ne.authorName)},null,12,Sb),e("div",Ab,[e("div",{class:"post-name clickable",onClick:Be=>ne.isSelf?ye("mypage"):le(ne.authorName)},_(ne.authorName),9,Ib),e("div",Lb,_(ne.authorUsername),1)])]),e("div",{class:"post-content clickable",onClick:X[0]||(X[0]=Be=>et(Be,"content"))},[e("span",{innerHTML:K(ne.content)},null,8,Tb),(ue=ne.mentions)!=null&&ue.length?(p(),f("div",jb,[(p(!0),f(Le,null,Fe(ne.mentions,Be=>(p(),f("span",{key:Be,class:"mention-chip"},"@"+_(Be),1))),128))])):N("",!0)]),ne.image?(p(),f("div",{key:0,class:"post-image clickable",style:Oe({backgroundImage:`url(${ne.image})`}),"data-description":ne.mediaDesc||"Kawaii Image!",onClick:X[1]||(X[1]=Be=>me(Be))},null,12,Pb)):N("",!0),e("div",Eb,[e("div",{class:Se(["post-action clickable",{active:ne.liked}]),onClick:Be=>ce(ne.id)},"  "+_(Z(ne.likes)),11,Bb),e("div",{class:"post-action clickable",onClick:Be=>pt(ne)}," "+_(Z(ne.shares||0)),9,Vb),e("div",{class:"post-action clickable",onClick:Be=>oe(ne.id)},"  "+_(((We=ne.comments)==null?void 0:We.length)||0),9,Db)]),(Re=ne.comments)!=null&&Re.length?(p(),f("div",Hb,[(p(!0),f(Le,null,Fe(ne.comments,Be=>(p(),f("div",{class:"comment",key:Be.id,onClick:Pe(Mt=>Ze(ne.id,Be),["stop"])},[e("div",{class:"comment-avatar clickable",style:Oe({backgroundImage:`url(${Be.avatar})`}),onClick:Pe(Mt=>le(Be.authorName),["stop"])},null,12,Ub),e("div",Rb,[e("span",{class:"comment-name clickable",onClick:Pe(Mt=>le(Be.authorName),["stop"])},_(Be.authorName)+":",9,Nb),e("span",{innerHTML:ee(Be.text)},null,8,Ob)])],8,Fb))),128))])):N("",!0),S.value[ne.id]?(p(),f("div",zb,[e("div",{class:"star-input-avatar",style:Oe({backgroundImage:`url(${A.value.avatar})`})},null,4),ke(e("input",{"onUpdate:modelValue":Be=>M.value[ne.id]=Be,class:"star-input-field",type:"text","data-post-id":ne.id,placeholder:"...",onKeyup:ns(Be=>_e(ne.id),["enter"])},null,40,Kb),[[je,M.value[ne.id]]]),e("button",{class:"star-submit",onClick:Be=>_e(ne.id)},"",8,Wb)])):N("",!0)],40,_b)}),128)),ge.value?(p(),f("div",Gb,[e("button",{class:"fold-btn clickable",onClick:yt},_(x.value?"":` (${he.value.length-5})`),1)])):N("",!0)])])):(p(),f("div",qb,[e("div",{class:"profile-section",ref_key:"profileSection",ref:r,style:Oe({backgroundImage:`url(${A.value.coverImage})`}),onClick:P},[X[14]||(X[14]=e("div",{class:"profile-header-overlay"},null,-1)),e("div",{class:"profile-avatar clickable",style:Oe({backgroundImage:`url(${A.value.avatar})`}),onClick:Pe(se,["stop"])},null,4),e("div",Zb,[e("button",{class:"profile-action-btn clickable",onClick:X[2]||(X[2]=Pe(ne=>et(ne,"edit"),["stop"]))},""),e("button",{class:"profile-action-btn clickable",onClick:X[3]||(X[3]=Pe(ne=>et(ne,"share"),["stop"]))},"")])],4),e("div",Jb,[e("div",{class:"profile-info",ref_key:"profileInfo",ref:c},[e("div",{class:"profile-name clickable",onClick:Pe(fe,["stop"])},_(A.value.name),1),e("div",{class:"profile-username clickable",onClick:Pe(Me,["stop"])},_(A.value.username),1),e("div",{class:"profile-bio clickable",onClick:Pe(Ie,["stop"])},_(A.value.bio),1),e("div",Yb,[e("div",{class:"stat-item clickable",onClick:X[4]||(X[4]=ne=>et(ne,"stat"))},[...X[15]||(X[15]=[e("span",null,"1.5k",-1),e("span",null,"",-1)])]),e("div",{class:"stat-item clickable",onClick:X[5]||(X[5]=ne=>et(ne,"stat"))},[...X[16]||(X[16]=[e("span",null,"892",-1),e("span",null,"",-1)])]),e("div",{class:"stat-item clickable",onClick:X[6]||(X[6]=ne=>et(ne,"stat"))},[...X[17]||(X[17]=[e("span",null,"5.2k",-1),e("span",null,"",-1)])])])],512),e("div",{class:"timeline-content",ref_key:"profileTimeline",ref:d},[B.value.length===0?(p(),f("div",Xb,"  ")):N("",!0),(p(!0),f(Le,null,Fe(B.value,ne=>{var Te;return p(),f("div",{key:ne.id,class:"post tweet"},[e("div",Qb,[e("div",{class:"tweet-avatar",style:Oe({backgroundImage:`url(${ne.authorAvatar})`})},null,4),e("div",ew,[e("div",tw,_(ne.authorName),1),e("div",sw,_(ne.authorUsername),1)])]),e("div",{class:"tweet-content",innerHTML:K(ne.content)},null,8,ow),ne.image?(p(),f("div",{key:0,class:"tweet-image clickable",style:Oe({backgroundImage:`url(${ne.image})`}),"data-description":ne.mediaDesc||"My post",onClick:X[7]||(X[7]=ue=>me(ue))},null,12,nw)):N("",!0),(Te=ne.mentions)!=null&&Te.length?(p(),f("div",aw,[(p(!0),f(Le,null,Fe(ne.mentions,ue=>(p(),f("span",{key:ue,class:"mention-chip"},"@"+_(ue),1))),128))])):N("",!0),e("div",lw,[e("div",{class:Se(["tweet-action clickable",{active:ne.liked}]),onClick:ue=>ce(ne.id)}," "+_(Z(ne.likes)),11,iw),e("div",{class:"tweet-action clickable",onClick:ue=>oe(ne.id)},"",8,rw)])])}),128))],512)])])),I.value.visible?(p(),f("div",{key:2,class:"edit-dialog-mask",onClick:Pe(Q,["self"])},[e("div",cw,[e("div",dw,[e("span",null,_(I.value.title),1),e("button",{class:"edit-dialog-close",onClick:Q},"")]),e("div",uw,[I.value.multiline?ke((p(),f("textarea",{key:0,"onUpdate:modelValue":X[8]||(X[8]=ne=>I.value.value=ne),class:"edit-dialog-textarea",rows:"4",placeholder:""},null,512)),[[je,I.value.value]]):ke((p(),f("input",{key:1,"onUpdate:modelValue":X[9]||(X[9]=ne=>I.value.value=ne),class:"edit-dialog-input",type:"text",placeholder:""},null,512)),[[je,I.value.value]])]),e("div",{class:"edit-dialog-actions"},[e("button",{class:"edit-dialog-btn primary",onClick:ae},""),e("button",{class:"edit-dialog-btn",onClick:Q},"")])])])):N("",!0),u.value?(p(),nt(vy,{key:3,onClose:be,onSubmit:bt})):N("",!0),v.value?(p(),nt(eb,{key:4,onClose:de})):N("",!0),b.value&&w.value?(p(),nt(hb,{key:5,post:w.value,onClose:rt,onForward:Et},null,8,["post"])):N("",!0)],512),e("div",vw,[e("div",{class:Se(["bottom-nav-item clickable",{active:a.value==="timeline"}]),onClick:X[10]||(X[10]=ne=>ye("timeline"))},[...X[18]||(X[18]=[e("div",{class:"bottom-nav-icon nav-home"},null,-1),e("div",{class:"bottom-nav-text"},"",-1)])],2),e("div",{class:Se(["bottom-nav-item clickable",{active:a.value==="mypage"}]),onClick:X[11]||(X[11]=ne=>ye("mypage"))},[...X[19]||(X[19]=[e("div",{class:"bottom-nav-icon nav-profile-icon"},null,-1),e("div",{class:"bottom-nav-text"},"",-1)])],2)]),a.value==="timeline"?(p(),f("button",{key:0,class:"floating-add-btn clickable",onClick:Pe(as,["stop"])},"  ")):N("",!0)])]))}},fw=Xe(pw,[["__scopeId","data-v-35d1e54a"]]),mw={class:"phone-container"},gw={class:"status-bar"},hw={class:"status-bar-left"},yw={class:"profile-actions"},bw={class:"profile-info"},ww={class:"profile-name"},kw={class:"profile-username"},xw=["innerHTML"],Cw={class:"profile-stats"},$w={class:"timeline"},_w={key:0,class:"empty-tip"},Mw={class:"tweet-header"},Sw={class:"tweet-info"},Aw={class:"tweet-name"},Iw={class:"tweet-username"},Lw={class:"tweet-content"},Tw={class:"tweet-actions"},Ll="https://files.catbox.moe/3ehyu8.jpg",jw={__name:"FriendProfile",props:{friendId:{type:[Number,String],required:!0}},emits:["back","chat","view-moment"],setup(t,{emit:s}){const o=t,n=s,a=["https://img.wjwj.top/2025/09/20/c79dad0096c2a31251bb902937bc43a0.md.jpeg","https://img.wjwj.top/2025/09/20/b1044b1c2e905c330221bbbeacc01957.md.jpeg","https://img.wjwj.top/2025/09/20/98a5930ce3f395d114a7f85e6c024cf6.md.jpeg","https://img.wjwj.top/2025/09/20/af4941e4c72905dcb2cba3aa82fac095.md.jpeg","https://img.wjwj.top/2025/09/20/ea7d55a780d9fbdba22daa74748a5a60.md.jpeg","https://img.wjwj.top/2025/09/20/eca46641ccd93b8dd7c4d51b84dbfe2b.md.jpeg","https://img.wjwj.top/2025/09/20/172e684ef05b86970a5296fcd0c52af5.md.jpeg","https://img.wjwj.top/2025/09/20/f7bd58cedc93acbd6aa494f0d52dfd78.md.jpeg","https://img.wjwj.top/2025/09/20/95d7aad7ac39673f623db41cfa778362.md.jpeg","https://img.wjwj.top/2025/09/20/5161b97a59edae631ef3357fb712dcdc.md.jpeg","https://img.wjwj.top/2025/09/20/912a2b17970ac6f8c50b3320cef8a305.md.jpeg","https://img.wjwj.top/2025/09/20/de3daed188f680c0409842c5d41245cf.md.jpeg","https://img.wjwj.top/2025/09/20/46ba0d49665e543804251cd0c80f3bf2.md.jpeg","https://img.wjwj.top/2025/09/20/b23bd89f24f84e1abb1aa5548dd1c70f.md.jpeg","https://img.wjwj.top/2025/09/20/17565c98c9693c56b25bd7461e98bf63.md.png","https://img.wjwj.top/2025/09/20/f3d6d56ce9560a8aa7517d3a301d707d.md.jpg","https://img.wjwj.top/2025/09/20/95aebff98bff0ceaf9f6ee30c6b81b68.md.jpg","https://img.wjwj.top/2025/09/20/840470043e498b2c2e4847f377318341.md.jpg","https://img.wjwj.top/2025/09/20/61f07c146262ab82dad6a1d46fbba435.md.png","https://img.wjwj.top/2025/09/20/ef653a1f9ac2a3e7689c68f06649ef26.md.jpg","https://img.wjwj.top/2025/09/20/0504d1f18b923eedebf3f43c8e13d1a6.md.jpg","https://img.wjwj.top/2025/09/20/9f0e3713a5243f93ec25920bdb105393.md.jpeg","https://img.wjwj.top/2025/09/20/dab3b3bd421aa4f9c70a16a88a16113d.md.jpeg","https://img.wjwj.top/2025/09/20/de50636930b9ab33fbd085df44816f7d.md.jpeg","https://img.wjwj.top/2025/09/20/b6771b6b291069550b2a8974021380e6.md.jpeg","https://img.wjwj.top/2025/09/20/b896a58e41590c942a8a564dca615b3d.md.jpeg","https://img.wjwj.top/2025/09/20/7c5cf7497e1f7716425b670238e8b564.md.jpeg","https://img.wjwj.top/2025/09/20/5a820c723cca1413c28a6fd2b402e475.md.jpeg","https://img.wjwj.top/2025/09/20/938ee29f9eca8818253b44801fe8473c.md.jpeg","https://img.wjwj.top/2025/09/20/c923c0602d5893948b5dcab392e2e195.md.jpeg","https://img.wjwj.top/2025/09/20/2e88422d8eac2fe69f72b8d06dc0cf9d.md.jpeg","https://img.wjwj.top/2025/09/20/eece3302d2c86512f096ffcd61b7618d.md.jpeg","https://img.wjwj.top/2025/09/20/5d86b06a04fe296405369b189fd58e69.md.jpeg","https://img.wjwj.top/2025/09/20/10eeecfda9479e298df8e24b6cee21bc.md.jpeg","https://img.wjwj.top/2025/09/20/676b47dd6983100aeb0df67d8957b296.md.jpeg","https://img.wjwj.top/2025/09/20/33d809942ee846a9da8128242e843d86.md.jpeg","https://img.wjwj.top/2025/09/20/2ba5a1fe00579149bca88a3eb151e8f8.md.jpeg","https://img.wjwj.top/2025/09/20/4dcce95b587e06905c43ddae611b610a.md.jpeg","https://img.wjwj.top/2025/09/20/ab838c8200f3db03d541388969d87d0c.md.jpeg","https://img.wjwj.top/2025/09/20/e8da41f958b12b0402214797cf3f4d7f.md.jpeg","https://img.wjwj.top/2025/09/20/66f1e6beeed44d938d6cfe5fc58d2789.md.jpg","https://img.wjwj.top/2025/09/20/06b549f5fd8f95275e91cd1b2abf03c2.md.jpg","https://img.wjwj.top/2025/09/20/031bd78025b4b803ce48ef32f2f415a6.md.jpg","https://img.wjwj.top/2025/09/20/5685254b3c2ae1f88e711a1f54daf98b.md.jpeg","https://img.wjwj.top/2025/09/20/1138a612f59468680dae991b03d08b55.md.jpeg","https://img.wjwj.top/2025/09/20/9e02e72edb5c218d6fcc146e10125a98.md.gif","https://img.wjwj.top/2025/09/20/412db762d5a53288e11d7ddc15a75fea.md.jpg","https://img.wjwj.top/2025/09/20/f3d1e84a036a64d8854f7d59dcdb4380.md.jpg","https://img.wjwj.top/2025/09/20/191389d77cc33b82ffde129e09661cfa.md.jpg","https://img.wjwj.top/2025/09/20/77483cb06fbd839d5575c694a84e0c42.md.jpg","https://img.wjwj.top/2025/09/20/52b153768120cc3cca048714a89f3810.md.jpeg","https://img.wjwj.top/2025/09/20/08647ccd11c0e35c02647f9741e72021.md.jpg","https://img.wjwj.top/2025/09/20/7376ef34d2044810cc4904cdfb6e343c.md.jpg","https://img.wjwj.top/2025/09/20/2a4443aac2e3762566e668331e20c7f6.md.jpg","https://img.wjwj.top/2025/09/20/7a217da940ba79d1e2764076111d91dd.md.jpg","https://img.wjwj.top/2025/09/20/26b5eec32e35a495b8ec44a5bc87e77b.md.jpg","https://img.wjwj.top/2025/09/20/cb493060306e253811f79ebeb5d23790.md.jpg","https://img.wjwj.top/2025/09/20/bc5b814d2e35dc6e56e016a9e8107448.md.png","https://img.wjwj.top/2025/09/20/ad8b3eb78534bf55da025c5c28e51889.md.jpg","https://img.wjwj.top/2025/09/20/7a913fb7f09cf6760b46c2dd3b547fe6.md.png","https://img.wjwj.top/2025/09/20/917479be6301660b739eb00b851b43f8.md.png"],l=h("12:00"),i=h(""),r=h(null),c=h(null),d=h({id:null,name:"",username:"",avatar:"",bioHtml:"",stats:{following:128,followers:"9.9k",likes:"2.5w"},posts:[]});let u=null,v=null;it(async()=>{b(),u=setInterval(b,6e4),r.value=new Audio("https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"),await Ce.init(),await A(),await T(),v=async m=>{var D;const g=(m==null?void 0:m.detail)||{};if(g.storeName==="contacts"){const W=w(o.friendId);W!=null&&((g==null?void 0:g.key)===W||((D=g==null?void 0:g.data)==null?void 0:D.id)===W)&&await S()}g.storeName==="momentPosts"&&await M()},window.addEventListener("idb-change",v)}),zt(()=>{u&&clearInterval(u),v&&window.removeEventListener("idb-change",v)}),Ft(()=>o.friendId,async()=>{await A(),await T()});const b=()=>{const m=new Date;l.value=`${String(m.getHours()).padStart(2,"0")}:${String(m.getMinutes()).padStart(2,"0")}`},w=m=>{if(m==null||m==="")return null;if(typeof m=="number")return m;const g=Number(m);return Number.isFinite(g)?g:m},I=(m="")=>String(m).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),j=(m="")=>I(m||"").replace(/\n/g,"<br>"),$=m=>{const g=(m||"").trim();return g?`@${g.toLowerCase().replace(/\s+/g,"_")}`:"@user"},x=m=>{const g=Number(m||0);if(!g)return"";const D=Date.now()-g,W=Math.floor(D/6e4);if(W<1)return"";if(W<60)return`${W}`;const te=Math.floor(W/60);return te<24?`${te}`:`${Math.floor(te/24)}`},S=async()=>{const m=w(o.friendId);if(m!=null)try{const g=await C.getContact(m);if(!g){d.value={...d.value,id:m,name:"",username:"",avatar:"",bioHtml:""};return}d.value={...d.value,id:m,name:(g==null?void 0:g.name)||"Unknown",username:(g==null?void 0:g.username)||$(g==null?void 0:g.name),avatar:(g==null?void 0:g.avatar)||"",bioHtml:j((g==null?void 0:g.bio)||"")}}catch(g){console.error(":",g)}},M=async()=>{const m=w(o.friendId);if(m!=null)try{const D=(await C.getMomentPosts()||[]).filter(W=>W&&W.author_id===m).sort((W,te)=>(te.createdAt||0)-(W.createdAt||0)).map(W=>({id:W.id,time:x(W.createdAt),content:W.content||"",image:W.image||"",likes:W.likes||0,comments:(W.comments||[]).length,shares:W.shares||0}));d.value={...d.value,posts:D}}catch(g){console.error(":",g)}},A=async()=>{await S(),await M()},T=async()=>{const m=w(o.friendId);if(m==null){i.value=a[Math.floor(Math.random()*a.length)];return}try{const D=(await C.getSetting("moment_contact_cards")||{})[m]||[];if(D.length>0){i.value=D[Math.floor(Math.random()*D.length)];return}const W=await C.getSetting("moment_public_cards")||[];if(W.length>0){i.value=W[Math.floor(Math.random()*W.length)];return}i.value=a[Math.floor(Math.random()*a.length)]}catch(g){console.error(":",g),i.value=a[Math.floor(Math.random()*a.length)]}},G=()=>{r.value&&(r.value.currentTime=0,r.value.play().catch(m=>console.log("Audio disabled")))},K=m=>{const g=document.createElement("div");g.className="heart-effect",g.innerHTML="",g.style.left=m.clientX+"px",g.style.top=m.clientY+"px",document.body.appendChild(g),setTimeout(()=>g.remove(),3e3)},q=m=>{if(G(),m===""){n("chat",w(o.friendId)),E(" TA ");return}E(`${m}`)},ee=()=>{G(),E("..."),n("back")},Z=m=>{m.target.scrollTop},E=m=>{const g=document.createElement("div");g.className="kawaii-toast-view",g.textContent=m,document.body.appendChild(g),setTimeout(()=>g.classList.add("show"),10),setTimeout(()=>{g.classList.remove("show"),setTimeout(()=>g.remove(),300)},2e3)};return(m,g)=>(p(),f("div",{class:"kawaii-container",onClick:K},[e("div",mw,[e("div",gw,[e("div",hw,[e("span",null,_(l.value),1)]),g[8]||(g[8]=mt('<div class="status-bar-right" data-v-6f498a44><svg class="status-icon-svg" viewBox="0 0 24 24" data-v-6f498a44><path d="M20,20h2v-2h-2V20z M18,20h-2v-4h2V20z M14,20h-2v-6h2V20z M10,20H8v-8h2V20z M6,20H4v-10h2V20z" data-v-6f498a44></path></svg><svg class="status-icon-svg" viewBox="0 0 24 24" data-v-6f498a44><path d="M12,3C7.41,3,3.86,4.53,0.96,7.03L2.37,8.44C4.89,6.31,8.06,5,12,5s7.11,1.31,9.63,3.44l1.41-1.41C20.14,4.53,16.59,3,12,3z M12,7C9.3,7,6.81,7.89,4.8,9.4l1.4,1.4C7.6,9.67,9.69,9,12,9s4.4,0.67,5.8,1.8l1.4-1.4C17.19,7.89,14.7,7,12,7z M12,11c-1.94,0-3.5,0.5-4.7,1.3l1.4,1.4c0.8-0.5,2-0.7,3.3-0.7s2.5,0.2,3.3,0.7l1.4-1.4C15.5,11.5,13.94,11,12,11z M12,15c-0.85,0-1.5,0.15-2,0.4l2,2l2-2C13.5,15.15,12.85,15,12,15z" data-v-6f498a44></path></svg><svg class="status-icon-svg" viewBox="0 0 24 24" data-v-6f498a44><path d="M15.67,4H14V2h-4v2H8.33C7.6,4,7,4.6,7,5.33v15.33C7,21.4,7.6,22,8.33,22h7.33c0.74,0,1.33-0.6,1.33-1.33V5.33C17,4.6,16.4,4,15.67,4z M15,20H9V6h6V20z" data-v-6f498a44></path></svg></div>',1))]),e("div",{class:"app-container",onScroll:Z,ref_key:"scrollArea",ref:c},[e("div",{class:"profile-section",style:Oe({backgroundImage:`url(${i.value})`})},[e("div",{class:"back-button clickable",onClick:ee},[...g[9]||(g[9]=[e("span",null,"",-1)])]),g[10]||(g[10]=e("div",{class:"profile-header-overlay"},null,-1)),e("div",{class:"profile-avatar",style:Oe({backgroundImage:`url(${d.value.avatar||Ll})`})},null,4),e("div",yw,[e("button",{class:"profile-action-btn clickable",onClick:g[0]||(g[0]=D=>q(""))},""),e("button",{class:"profile-action-btn clickable",onClick:g[1]||(g[1]=D=>q(""))},"")])],4),e("div",bw,[e("div",ww,_(d.value.name),1),e("div",kw,_(d.value.username),1),e("div",{class:"profile-bio",innerHTML:d.value.bioHtml},null,8,xw),e("div",Cw,[e("div",{class:"stat-item clickable",onClick:g[2]||(g[2]=D=>q(""))},[e("span",null,_(d.value.stats.following),1),g[11]||(g[11]=e("span",null,"",-1))]),e("div",{class:"stat-item clickable",onClick:g[3]||(g[3]=D=>q(""))},[e("span",null,_(d.value.stats.followers),1),g[12]||(g[12]=e("span",null,"",-1))]),e("div",{class:"stat-item clickable",onClick:g[4]||(g[4]=D=>q(""))},[e("span",null,_(d.value.stats.likes),1),g[13]||(g[13]=e("span",null,"",-1))])])]),e("div",$w,[d.value.posts.length===0?(p(),f("div",_w," TA  ")):N("",!0),(p(!0),f(Le,null,Fe(d.value.posts,D=>(p(),f("div",{key:D.id,class:"tweet fade-in"},[e("div",Mw,[e("div",{class:"tweet-avatar",style:Oe({backgroundImage:`url(${d.value.avatar||Ll})`})},null,4),e("div",Sw,[e("div",Aw,_(d.value.name),1),e("div",Iw,_(D.time),1)])]),e("div",Lw,_(D.content),1),D.image?(p(),f("div",{key:0,class:"tweet-image",style:Oe({backgroundImage:`url(${D.image})`})},null,4)):N("",!0),e("div",Tw,[e("div",{class:"tweet-action clickable",onClick:g[5]||(g[5]=W=>q(""))}," "+_(D.likes),1),e("div",{class:"tweet-action clickable",onClick:g[6]||(g[6]=W=>q(""))}," "+_(D.comments),1),e("div",{class:"tweet-action clickable",onClick:g[7]||(g[7]=W=>q(""))}," "+_(D.shares),1)])]))),128))])],544)])]))}},Pw=Xe(jw,[["__scopeId","data-v-6f498a44"]]),Ew={class:"phone-container"},Bw={class:"worldbook-container"},Vw={class:"worldbook-header"},Dw={class:"header-actions"},Hw={class:"worldbook-content"},Fw={key:0,class:"empty-state"},Uw={class:"empty-actions"},Rw={key:1,class:"book-list"},Nw=["onClick"],Ow={class:"book-info"},zw={class:"book-name"},Kw={class:"book-meta"},Ww=["onClick"],Gw={class:"modal-content"},qw={class:"import-area"},Zw={key:0},Jw={key:1,class:"file-name"},Yw={key:0,class:"file-info"},Xw={class:"modal-actions"},Qw=["disabled"],e4={class:"modal-content"},t4={class:"modal-actions"},s4={key:2,class:"book-editor-fullscreen"},o4={class:"editor-header"},n4={class:"editor-body"},a4={key:0,class:"empty-entries"},l4={key:1,class:"entry-list-mobile"},i4=["onClick","onTouchstart","onMousedown"],r4={class:"entry-card-info"},c4={class:"entry-number"},d4=["onClick","title"],u4={key:0,viewBox:"0 0 24 24",width:"16",height:"16"},v4={key:1,viewBox:"0 0 24 24",width:"16",height:"16"},p4={class:"entry-keys"},f4={class:"entry-card-actions"},m4={key:0,class:"entry-edit-area"},g4={class:"form-group"},h4={class:"form-group"},y4={class:"form-group"},b4={class:"form-group"},w4={class:"checkbox-label"},k4={class:"form-group"},x4={class:"checkbox-label"},C4={key:1,class:"entry-preview"},$4={key:3,class:"toast"},_4={__name:"WorldBook",emits:["back"],setup(t,{emit:s}){const o=s,n=h([]),a=h([]),l=h(!1),i=h(!1),r=h(""),c=h(null),d=h([]),u=h(null),v=h(""),b=h(""),w=h(""),I=h(!0),j=h(!1),$=h(!1),x=h(""),S=h(null),M=h(null),A=h(null),T=h(null),G=h(!1),K=k=>a.value.filter(y=>y.bookName===k).length,q=k=>!k||k.length===0?"":k.slice(0,3).join(", ")+(k.length>3?"...":""),ee=k=>k<1024?k+" B":k<1024*1024?(k/1024).toFixed(2)+" KB":(k/(1024*1024)).toFixed(2)+" MB",Z=k=>{x.value=k,$.value=!0,setTimeout(()=>{$.value=!1},2e3)},E=async()=>{try{n.value=await C.getWorldBookNames(),a.value=await C.getAllWorldBooks()}catch(k){console.error(":",k)}},m=async()=>{const k=r.value.trim();if(!k){Z("");return}if(n.value.includes(k)){Z("");return}try{await C.addWorldBookEntry({bookName:k,keys:[""],content:`"${k}"



"+"`,enabled:!0,createdAt:Date.now()}),l.value=!1,r.value="",await E(),Z(` "${k}"`),te(k)}catch(y){console.error(":",y),Z(""+y.message)}},g=k=>{const y=k.target.files[0];y&&(S.value=y)},D=()=>{i.value=!1,S.value=null,M.value&&(M.value.value="")},W=async()=>{if(!S.value){Z("");return}try{const k=await S.value.text(),y=JSON.parse(k);if(!y.entries||typeof y.entries!="object"){Z(" ");return}let H=S.value.name.replace(".json","").replace("","").trim();H||(H="_"+Date.now()),n.value.includes(H)&&(confirm(`"${H}"`)?await C.deleteWorldBook(H):H=H+"_"+Date.now());let se=0;const P=Object.values(y.entries);for(const U of P)try{const O={bookName:H,keys:U.key||[],content:U.content||"",comment:U.comment||"",enabled:U.disable!==!0,constant:U.constant||!1,selective:U.selective!==!1,createdAt:Date.now()};await C.addWorldBookEntry(O),se++}catch(O){console.error(":",O)}D(),await E(),Z(`  ${se} "${H}"`),te(H)}catch(k){console.error(":",k),Z(" "+k.message)}},te=async k=>{c.value=k,d.value=await C.getWorldBookEntries(k),u.value=null},R=()=>{c.value=null,d.value=[],u.value=null},F=async()=>{const k={bookName:c.value,keys:[],content:"",comment:"",enabled:!0,createdAt:Date.now()},y=await C.addWorldBookEntry(k);d.value=await C.getWorldBookEntries(c.value);const H=d.value.find(se=>se.id===y.id);H&&ie(H),Z("")},ie=k=>{var y;((y=u.value)==null?void 0:y.id)===k.id?u.value=null:(u.value=k,v.value=k.keys.join(", "),b.value=k.comment||"",w.value=k.content,I.value=k.enabled!==!1,j.value=k.constant===!0)},re=async k=>{const y=!k.constant,H={...k,constant:y,updatedAt:Date.now()};await C.updateWorldBookEntry(H),d.value=await C.getWorldBookEntries(c.value),Z(y?" ":" ")},pe=k=>{G.value=!1,T.value=k,A.value=setTimeout(()=>{G.value||(ge(k),A.value=null)},800)},we=()=>{A.value&&(clearTimeout(A.value),A.value=null),T.value=null,G.value=!1},he=()=>{G.value=!0,A.value&&(clearTimeout(A.value),A.value=null)},Ue=async()=>{if(!u.value)return;const k=v.value.split(",").map(H=>H.trim()).filter(H=>H),y={...u.value,keys:k,comment:b.value,content:w.value,enabled:I.value,constant:j.value,updatedAt:Date.now()};await C.updateWorldBookEntry(y),d.value=await C.getWorldBookEntries(c.value),u.value=y,Z(" ")},ge=async k=>{var y;confirm("")&&(await C.deleteWorldBookEntry(k),d.value=await C.getWorldBookEntries(c.value),((y=u.value)==null?void 0:y.id)===k&&(u.value=null),Z(""))},B=async k=>{confirm(`"${k}"`)&&(await C.deleteWorldBook(k),await E(),Z(""))},L=()=>{o("back")};return it(()=>{E()}),(k,y)=>(p(),f("div",Ew,[e("div",Bw,[e("div",Vw,[e("div",{class:"back-btn",onClick:L},[...y[14]||(y[14]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"})],-1)])]),y[17]||(y[17]=e("h1",{class:"worldbook-title"},"",-1)),e("div",Dw,[e("button",{class:"import-btn",onClick:y[0]||(y[0]=H=>i.value=!0),title:""},[...y[15]||(y[15]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M12,19L8,15H10.5V12H13.5V15H16L12,19Z"})],-1)])]),e("button",{class:"add-book-btn",onClick:y[1]||(y[1]=H=>l.value=!0),title:""},[...y[16]||(y[16]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"})],-1)])])])]),e("div",Hw,[n.value.length===0?(p(),f("div",Fw,[y[20]||(y[20]=mt('<div class="empty-icon" data-v-11b56761></div><p class="empty-title" data-v-11b56761></p><p class="empty-hint" data-v-11b56761></p><div class="empty-tips" data-v-11b56761><div class="tip-item" data-v-11b56761><span class="tip-icon" data-v-11b56761>1</span><span class="tip-text" data-v-11b56761> JSON </span></div><div class="tip-item" data-v-11b56761><span class="tip-icon" data-v-11b56761>2</span><span class="tip-text" data-v-11b56761> + </span></div></div>',4)),e("div",Uw,[e("button",{class:"btn-action",onClick:y[2]||(y[2]=H=>i.value=!0)},[...y[18]||(y[18]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M12,19L8,15H10.5V12H13.5V15H16L12,19Z"})],-1),ot("  ",-1)])]),e("button",{class:"btn-action primary",onClick:y[3]||(y[3]=H=>l.value=!0)},[...y[19]||(y[19]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"})],-1),ot("  ",-1)])])])])):(p(),f("div",Rw,[(p(!0),f(Le,null,Fe(n.value,H=>(p(),f("div",{key:H,class:"book-item",onClick:se=>te(H)},[y[22]||(y[22]=e("div",{class:"book-icon"},"",-1)),e("div",Ow,[e("div",zw,_(H),1),e("div",Kw,_(K(H))+" ",1)]),e("button",{class:"delete-btn",onClick:Pe(se=>B(H),["stop"])},[...y[21]||(y[21]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18"},[e("path",{fill:"currentColor",d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"})],-1)])],8,Ww)],8,Nw))),128))]))]),i.value?(p(),f("div",{key:0,class:"modal-overlay",onClick:y[5]||(y[5]=Pe(H=>i.value=!1,["self"]))},[e("div",Gw,[y[24]||(y[24]=e("h3",null,"",-1)),e("div",qw,[e("input",{ref_key:"fileInput",ref:M,type:"file",accept:".json",onChange:g,style:{display:"none"}},null,544),e("div",{class:"file-select-btn",onClick:y[4]||(y[4]=H=>k.$refs.fileInput.click())},[y[23]||(y[23]=e("svg",{viewBox:"0 0 24 24",width:"32",height:"32"},[e("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M12,19L8,15H10.5V12H13.5V15H16L12,19Z"})],-1)),S.value?(p(),f("p",Jw,_(S.value.name),1)):(p(),f("p",Zw," JSON "))]),S.value?(p(),f("div",Yw,[e("p",null,": "+_(ee(S.value.size)),1)])):N("",!0)]),e("div",Xw,[e("button",{class:"btn btn-cancel",onClick:D},""),e("button",{class:"btn btn-confirm",onClick:W,disabled:!S.value},"",8,Qw)])])])):N("",!0),l.value?(p(),f("div",{key:1,class:"modal-overlay",onClick:y[8]||(y[8]=Pe(H=>l.value=!1,["self"]))},[e("div",e4,[y[25]||(y[25]=e("h3",null,"",-1)),ke(e("input",{"onUpdate:modelValue":y[6]||(y[6]=H=>r.value=H),type:"text",placeholder:"",class:"modal-input",onKeyup:ns(m,["enter"])},null,544),[[je,r.value]]),e("div",t4,[e("button",{class:"btn btn-cancel",onClick:y[7]||(y[7]=H=>l.value=!1)},""),e("button",{class:"btn btn-confirm",onClick:m},"")])])])):N("",!0),c.value?(p(),f("div",s4,[e("div",o4,[e("button",{class:"back-btn",onClick:R},[...y[26]||(y[26]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"})],-1)])]),e("h2",null,_(c.value),1),e("button",{class:"btn-add-entry-header",onClick:F},[...y[27]||(y[27]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20"},[e("path",{fill:"currentColor",d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"})],-1)])])]),e("div",n4,[d.value.length===0?(p(),f("div",a4,[y[28]||(y[28]=e("div",{class:"empty-icon"},"",-1)),y[29]||(y[29]=e("p",null,"",-1)),e("button",{class:"btn-add-first",onClick:F},"")])):(p(),f("div",l4,[y[40]||(y[40]=e("div",{class:"entry-hint"}," ",-1)),(p(!0),f(Le,null,Fe(d.value,(H,se)=>{var P,U;return p(),f("div",{key:H.id,class:"entry-card"},[e("div",{class:"entry-card-header",onClick:O=>ie(H),onTouchstart:O=>pe(H.id),onTouchend:we,onTouchmove:he,onMousedown:O=>pe(H.id),onMouseup:we,onMouseleave:we},[e("div",r4,[e("span",c4,"#"+_(se+1),1),e("button",{class:Se(["constant-toggle-btn",{active:H.constant}]),onClick:Pe(O=>re(H),["stop"]),title:H.constant?"":""},[H.constant?(p(),f("svg",u4,[...y[30]||(y[30]=[e("path",{fill:"currentColor",d:"M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"},null,-1)])])):(p(),f("svg",v4,[...y[31]||(y[31]=[e("path",{fill:"currentColor",d:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"},null,-1)])]))],10,d4),e("span",p4,_(q(H.keys)),1)]),e("div",f4,[(p(),f("svg",{class:Se(["expand-icon",{expanded:((P=u.value)==null?void 0:P.id)===H.id}]),viewBox:"0 0 24 24",width:"20",height:"20"},[...y[32]||(y[32]=[e("path",{fill:"currentColor",d:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"},null,-1)])],2))])],40,i4),((U=u.value)==null?void 0:U.id)===H.id?(p(),f("div",m4,[e("div",g4,[y[33]||(y[33]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":y[9]||(y[9]=O=>v.value=O),type:"text",placeholder:",,",class:"form-input"},null,512),[[je,v.value]])]),e("div",h4,[y[34]||(y[34]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":y[10]||(y[10]=O=>b.value=O),type:"text",placeholder:"",class:"form-input"},null,512),[[je,b.value]])]),e("div",y4,[y[35]||(y[35]=e("label",null,"",-1)),ke(e("textarea",{"onUpdate:modelValue":y[11]||(y[11]=O=>w.value=O),placeholder:"...",class:"form-textarea",rows:"8"},null,512),[[je,w.value]])]),e("div",b4,[e("label",w4,[ke(e("input",{type:"checkbox","onUpdate:modelValue":y[12]||(y[12]=O=>I.value=O)},null,512),[[os,I.value]]),y[36]||(y[36]=e("span",null,"",-1))])]),e("div",k4,[e("label",x4,[ke(e("input",{type:"checkbox","onUpdate:modelValue":y[13]||(y[13]=O=>j.value=O)},null,512),[[os,j.value]]),y[37]||(y[37]=e("span",null," ",-1))]),y[38]||(y[38]=e("p",{class:"form-hint"},"",-1))]),e("button",{class:"btn-save-entry",onClick:Ue},[...y[39]||(y[39]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18"},[e("path",{fill:"currentColor",d:"M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"})],-1),ot("  ",-1)])])])):(p(),f("div",C4,_(H.content.substring(0,80))+_(H.content.length>80?"...":""),1))])}),128))]))])])):N("",!0),$.value?(p(),f("div",$4,_(x.value),1)):N("",!0)])]))}},M4=Xe(_4,[["__scopeId","data-v-11b56761"]]),S4={key:0,class:"ph-view"},A4={class:"ph-header"},I4={class:"header-left"},L4=["disabled"],T4={key:0,viewBox:"0 0 24 24"},j4={key:1,viewBox:"0 0 24 24",class:"loading"},P4={class:"ph-content"},E4=["onClick"],B4={class:"thumb-wrap"},V4=["src"],D4={class:"duration"},H4={class:"video-info"},F4={class:"title"},U4={class:"meta"},R4={class:"views"},N4={class:"rating"},O4={__name:"pornhuview",props:{isVisible:Boolean},emits:["close","go-to-profile","open-video"],setup(t,{emit:s}){const o=s,n=h([]),a=h(!1);it(async()=>{await l()});const l=async()=>{try{const v=await C.getSetting("pornhub_videos");v&&v.length>0?n.value=v:n.value=[{id:1,title:" -  1",thumb:"https://picsum.photos/seed/ph1/400/225",duration:"12:45",views:"123K",time:"2",rating:98},{id:2,title:" Vue ",thumb:"https://picsum.photos/seed/ph2/400/225",duration:"08:20",views:"85K",time:"1",rating:95}]}catch(v){console.error(":",v)}},i=async()=>{if(!a.value)try{a.value=!0;const{aiService:v}=await Kt(async()=>{const{aiService:M}=await Promise.resolve().then(()=>fa);return{aiService:M}},void 0),b=await v.getApiConfig();if(!b.apiKey||!b.model){alert(" AI API"),a.value=!1;return}if(!await C.getSetting("pornhub_generation_prompt")){alert(" "),a.value=!1;return}const I=await C.getContacts();if(!I||I.length===0){alert(" "),a.value=!1;return}const j=await C.getSetting("pornhub_writing_style")||"",$=await C.getSetting("userNickname")||"",x=[];let S=Date.now();for(const M of I){const A=Math.random()>.5?2:1,T=await C.getSetting(`pornhub_${M.id}_videoTypes`)||"",G=await C.getSetting(`pornhub_${M.id}_style`)||"";for(let K=0;K<A;K++){const q=await r(M.name,T,b),ee={id:S++,contactId:M.id,contactName:M.name,title:q||`${M.name} - ${new Date().toLocaleDateString()}`,thumb:`https://picsum.photos/seed/ph${S}/400/225`,duration:`${Math.floor(Math.random()*20+5)}:${String(Math.floor(Math.random()*60)).padStart(2,"0")}`,views:`${Math.floor(Math.random()*500+50)}K`,time:["","1","","","2"][Math.floor(Math.random()*5)],rating:Math.floor(Math.random()*10+90),videoTypes:T,contentStyle:G,writingStyle:j,partnerName:$};x.push(ee)}}n.value=x,await C.setSetting("pornhub_videos",x),alert(`  ${x.length} 

""`)}catch(v){console.error(":",v),alert(` ${v.message}`)}finally{a.value=!1}},r=async(v,b,w)=>{try{let I=w.baseUrl||"";I.endsWith("/v1")?I=I.slice(0,-3):I.endsWith("/")&&(I=I.slice(0,-1));const $=`${{deepseek:I||"https://api.deepseek.com",gemini:I||"https://generativelanguage.googleapis.com",openai:I||"https://api.openai.com"}[w.provider]}/v1/chat/completions`,x=await fetch($,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w.apiKey}`},body:JSON.stringify({model:w.model,messages:[{role:"system",content:""},{role:"user",content:`15-30
${v}
${b}

`}],temperature:.9,max_tokens:100})});if(x.ok)return(await x.json()).choices[0].message.content.trim()}catch(I){console.error(":",I)}return null},c=()=>{o("close")},d=()=>{o("go-to-profile")},u=v=>{o("open-video",v)};return(v,b)=>t.isVisible?(p(),f("div",S4,[e("header",A4,[e("div",I4,[e("div",{class:"ph-logo",onClick:c},[...b[0]||(b[0]=[ot(" Porn",-1),e("span",null,"hub",-1)])]),e("button",{onClick:i,class:"ai-generate-icon",disabled:a.value,title:"AI"},[a.value?(p(),f("svg",j4,[...b[2]||(b[2]=[e("path",{fill:"currentColor",d:"M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"},null,-1)])])):(p(),f("svg",T4,[...b[1]||(b[1]=[e("path",{fill:"currentColor",d:"M17.75,4.09L15.22,6.03L16.13,9.09L13.5,7.28L10.87,9.09L11.78,6.03L9.25,4.09L12.44,4L13.5,1L14.56,4L17.75,4.09M21.25,11L19.61,12.25L20.2,14.23L18.5,13.06L16.8,14.23L17.39,12.25L15.75,11L17.81,10.95L18.5,9L19.19,10.95L21.25,11M18.97,15.95C19.8,15.87 20.69,17.05 20.16,17.8C19.84,18.25 19.5,18.67 19.08,19.07C15.17,23 8.84,23 4.94,19.07C1.03,15.17 1.03,8.83 4.94,4.93C5.34,4.53 5.76,4.17 6.21,3.85C6.96,3.32 8.14,4.21 8.06,5.04C7.79,7.9 8.75,10.87 10.95,13.06C13.14,15.26 16.1,16.22 18.97,15.95M17.33,17.97C14.5,17.81 11.7,16.64 9.53,14.5C7.36,12.31 6.2,9.5 6.04,6.68C3.23,9.82 3.34,14.64 6.35,17.66C9.37,20.67 14.19,20.78 17.33,17.97Z"},null,-1)])]))],8,L4)]),e("div",{class:"close-btn",onClick:c},"")]),e("div",P4,[(p(!0),f(Le,null,Fe(n.value,w=>(p(),f("div",{key:w.id,class:"video-card",onClick:I=>u(w)},[e("div",B4,[e("img",{src:w.thumb,alt:"thumb"},null,8,V4),e("span",D4,_(w.duration),1)]),e("div",H4,[e("h4",F4,_(w.title),1),e("div",U4,[e("span",R4,_(w.views)+"   "+_(w.time),1),e("span",N4,_(w.rating)+"%",1)])])],8,E4))),128))]),e("footer",{class:"ph-tabbar"},[b[4]||(b[4]=mt('<div class="tab-item active" data-v-b1d922cb><svg viewBox="0 0 24 24" class="icon" data-v-b1d922cb><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" data-v-b1d922cb></path></svg><span data-v-b1d922cb></span></div><div class="tab-item" data-v-b1d922cb><div class="upload-btn" data-v-b1d922cb>+</div><span data-v-b1d922cb></span></div>',2)),e("div",{class:"tab-item",onClick:d},[...b[3]||(b[3]=[e("svg",{viewBox:"0 0 24 24",class:"icon"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"})],-1),e("span",null,"",-1)])])])])):N("",!0)}},z4=Xe(O4,[["__scopeId","data-v-b1d922cb"]]),K4={key:0,class:"ph-profile-view"},W4={class:"user-info-card"},G4=["src"],q4={class:"user-details"},Z4={class:"name-badge-wrapper"},J4={class:"stats-bar"},Y4={class:"stat-item"},X4={class:"stat-value"},Q4={class:"stat-value"},e5={class:"stat-item"},t5={class:"stat-value"},s5={__name:"pornhubprofile",props:{isVisible:Boolean},emits:["back-to-home","go-to-settings","go-to-favorites"],setup(t,{emit:s}){const o=s,n=h(""),a=h("https://api.dicebear.com/7.x/avataaars/svg?seed=Lucky"),l=h("linear-gradient(180deg, #333 0%, #1b1b1b 100%)"),i=h(null),r=h(null),c=h(0),d=h("0"),u=h(0);it(async()=>{try{const A=await C.getSetting("pornhub_username"),T=await C.getSetting("pornhub_avatar"),G=await C.getSetting("pornhub_background"),K=await C.getSetting("pornhub_subscribers"),q=await C.getSetting("pornhub_upload_count"),ee=await C.getSetting("pornhub_favorite_count");A&&(n.value=A),T&&(a.value=T),G&&(l.value=G),K&&(d.value=K),q!==void 0&&(c.value=q),ee!==void 0&&(u.value=ee)}catch(A){console.error(":",A)}});const v=()=>{var A;(A=i.value)==null||A.click()},b=async A=>{const T=A.target.files[0];if(T){const G=new FileReader;G.onload=async K=>{a.value=K.target.result;try{await C.setSetting("pornhub_avatar",K.target.result),console.log("")}catch(q){console.error(":",q)}},G.readAsDataURL(T)}},w=()=>{var A;(A=r.value)==null||A.click()},I=async A=>{const T=A.target.files[0];if(T){const G=new FileReader;G.onload=async K=>{l.value=K.target.result;try{await C.setSetting("pornhub_background",K.target.result),console.log("")}catch(q){console.error(":",q)}},G.readAsDataURL(T)}},j=async()=>{if(n.value&&n.value.trim())try{await C.setSetting("pornhub_username",n.value.trim()),console.log("")}catch(A){console.error(":",A)}},$=async()=>{const A=prompt(":",d.value);if(A!==null&&A.trim()){d.value=A.trim();try{await C.setSetting("pornhub_subscribers",A.trim()),console.log("")}catch(T){console.error(":",T)}}},x=()=>{o("back-to-home")},S=()=>{o("go-to-settings")},M=()=>{o("go-to-favorites")};return(A,T)=>t.isVisible?(p(),f("div",K4,[e("div",{class:"profile-header-bg",onClick:w,style:Oe({backgroundImage:`url(${l.value})`})},[T[1]||(T[1]=e("div",{class:"bg-overlay"},[e("svg",{viewBox:"0 0 24 24",class:"camera-icon"},[e("path",{fill:"currentColor",d:"M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z"})])],-1)),e("input",{type:"file",ref_key:"backgroundInput",ref:r,onChange:I,accept:"image/*",style:{display:"none"}},null,544)],4),e("div",W4,[e("div",{class:"avatar-container",onClick:v},[e("img",{src:a.value,alt:"Avatar"},null,8,G4),T[2]||(T[2]=e("div",{class:"avatar-overlay"},[e("svg",{viewBox:"0 0 24 24",class:"camera-icon"},[e("path",{fill:"currentColor",d:"M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z"})])],-1)),e("input",{type:"file",ref_key:"avatarInput",ref:i,onChange:b,accept:"image/*",style:{display:"none"}},null,544)]),e("div",q4,[e("div",Z4,[ke(e("input",{"onUpdate:modelValue":T[0]||(T[0]=G=>n.value=G),onBlur:j,onKeyup:ns(j,["enter"]),class:"user-name-input",placeholder:""},null,544),[[je,n.value]]),T[3]||(T[3]=e("span",{class:"vip-badge"},"Premium",-1))])]),e("div",J4,[e("div",Y4,[e("div",X4,_(c.value),1),T[4]||(T[4]=e("div",{class:"stat-label"},"",-1))]),e("div",{class:"stat-item",onClick:$},[e("div",Q4,_(d.value),1),T[5]||(T[5]=e("div",{class:"stat-label"},"",-1))]),e("div",e5,[e("div",t5,_(u.value),1),T[6]||(T[6]=e("div",{class:"stat-label"},"",-1))])])]),e("div",{class:"menu-section"},[e("div",{class:"menu-group"},[T[8]||(T[8]=mt('<div class="menu-item" data-v-0096e537><div class="menu-left" data-v-0096e537><svg class="menu-icon" viewBox="0 0 24 24" data-v-0096e537><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm4.59-12.42L10 14.17l-2.59-2.58L6 13l4 4 8-8z" data-v-0096e537></path></svg><span class="menu-text" data-v-0096e537></span></div><div class="menu-right" data-v-0096e537></div></div>',1)),e("div",{class:"menu-item",onClick:M},[...T[7]||(T[7]=[mt('<div class="menu-left" data-v-0096e537><svg class="menu-icon" viewBox="0 0 24 24" data-v-0096e537><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" data-v-0096e537></path></svg><span class="menu-text" data-v-0096e537></span></div><div class="menu-right" data-v-0096e537></div>',2)])])]),e("div",{class:"menu-group"},[e("div",{class:"menu-item",onClick:S},[...T[9]||(T[9]=[mt('<div class="menu-left" data-v-0096e537><svg class="menu-icon" viewBox="0 0 24 24" data-v-0096e537><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z" data-v-0096e537></path></svg><span class="menu-text" data-v-0096e537></span></div><div class="menu-right" data-v-0096e537></div>',2)])])])]),T[12]||(T[12]=e("div",{class:"logout-btn"},"",-1)),e("footer",{class:"ph-tabbar"},[e("div",{class:"tab-item",onClick:x},[...T[10]||(T[10]=[e("svg",{viewBox:"0 0 24 24"},[e("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})],-1),e("span",null,"",-1)])]),T[11]||(T[11]=mt('<div class="tab-item" data-v-0096e537><div class="upload-btn" data-v-0096e537>+</div><span data-v-0096e537></span></div><div class="tab-item active" data-v-0096e537><svg viewBox="0 0 24 24" data-v-0096e537><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" data-v-0096e537></path></svg><span data-v-0096e537></span></div>',2))])])):N("",!0)}},o5=Xe(s5,[["__scopeId","data-v-0096e537"]]),n5={key:0,class:"ph-settings-view"},a5={class:"settings-content"},l5={class:"character-list"},i5=["onClick"],r5=["src","alt"],c5={class:"character-info"},d5={class:"character-name"},u5={class:"character-desc"},v5={class:"writing-style-section"},p5={class:"setting-group"},f5={class:"generation-rules-section"},m5={class:"setting-group"},g5={class:"setting-group"},h5=`


- {}
- {}
- {}
- {}
- {}


1. 800-1500
2. 
3. 
4. 
5. 
6. 


- 
- 
- 
- 
- 

`,y5=`4-51-2


1. 20-60
2. 
3. 
4. 
5. 
6. HTML<br><p>


1. 1-2
2. 
3. 
4. @ 


|
|@ 


|
_99|
|
{}|@ ~
|
|


- HTML
- 
- 
- {}`,b5={__name:"pornhubsetting",props:{isVisible:Boolean},emits:["back","edit-character"],setup(t,{emit:s}){const o=s,n=h([]),a=h(""),l=h(""),i=h(""),r=h("");it(async()=>{try{n.value=await C.getContacts();const b=await C.getSetting("userNickname");b&&(a.value=b);const w=await C.getSetting("pornhub_writing_style");w?l.value=w:l.value="";const I=await C.getSetting("pornhub_generation_prompt");I?i.value=I:i.value=h5;const j=await C.getSetting("pornhub_comment_prompt");j?r.value=j:r.value=y5}catch(b){console.error(":",b)}});const c=b=>{o("edit-character",b)},d=async()=>{try{await C.setSetting("pornhub_writing_style",l.value),console.log(""),alert(" ")}catch(b){console.error(":",b),alert("")}},u=async()=>{try{await C.setSetting("pornhub_generation_prompt",i.value),await C.setSetting("pornhub_comment_prompt",r.value),console.log(""),alert(` AI

AI`)}catch(b){console.error(":",b),alert("")}},v=()=>{o("back")};return(b,w)=>t.isVisible?(p(),f("div",n5,[e("header",{class:"ph-header"},[e("div",{class:"back-btn",onClick:v},[...w[3]||(w[3]=[e("svg",{viewBox:"0 0 24 24",class:"icon"},[e("path",{fill:"currentColor",d:"M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"})],-1)])]),w[4]||(w[4]=e("h2",{class:"header-title"},"",-1)),w[5]||(w[5]=e("div",{class:"placeholder"},null,-1))]),e("div",a5,[w[17]||(w[17]=e("div",{class:"section-title"},"",-1)),e("div",l5,[(p(!0),f(Le,null,Fe(n.value,I=>(p(),f("div",{key:I.id,class:"character-card",onClick:j=>c(I)},[e("img",{src:I.avatar,alt:I.name,class:"character-avatar"},null,8,r5),e("div",c5,[e("div",d5,_(I.name),1),e("div",u5,_(I.description||""),1)]),w[6]||(w[6]=e("svg",{viewBox:"0 0 24 24",class:"arrow-icon"},[e("path",{fill:"currentColor",d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"})],-1))],8,i5))),128))]),e("div",v5,[w[10]||(w[10]=e("div",{class:"section-title"},"",-1)),e("div",p5,[w[7]||(w[7]=e("label",{class:"setting-label"},"",-1)),ke(e("textarea",{"onUpdate:modelValue":w[0]||(w[0]=I=>l.value=I),class:"setting-textarea",placeholder:"AI",rows:"4"},null,512),[[je,l.value]]),w[8]||(w[8]=e("div",{class:"setting-hint"}," ",-1))]),e("button",{onClick:d,class:"save-btn"},[...w[9]||(w[9]=[e("svg",{viewBox:"0 0 24 24",class:"btn-icon"},[e("path",{fill:"currentColor",d:"M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"})],-1),ot("  ",-1)])])]),e("div",f5,[w[15]||(w[15]=e("div",{class:"section-title"},[e("svg",{viewBox:"0 0 24 24",class:"title-icon"},[e("path",{fill:"currentColor",d:"M17.75,4.09L15.22,6.03L16.13,9.09L13.5,7.28L10.87,9.09L11.78,6.03L9.25,4.09L12.44,4L13.5,1L14.56,4L17.75,4.09M21.25,11L19.61,12.25L20.2,14.23L18.5,13.06L16.8,14.23L17.39,12.25L15.75,11L17.81,10.95L18.5,9L19.19,10.95L21.25,11M18.97,15.95C19.8,15.87 20.69,17.05 20.16,17.8C19.84,18.25 19.5,18.67 19.08,19.07C15.17,23 8.84,23 4.94,19.07C1.03,15.17 1.03,8.83 4.94,4.93C5.34,4.53 5.76,4.17 6.21,3.85C6.96,3.32 8.14,4.21 8.06,5.04C7.79,7.9 8.75,10.87 10.95,13.06C13.14,15.26 16.1,16.22 18.97,15.95M17.33,17.97C14.5,17.81 11.7,16.64 9.53,14.5C7.36,12.31 6.2,9.5 6.04,6.68C3.23,9.82 3.34,14.64 6.35,17.66C9.37,20.67 14.19,20.78 17.33,17.97Z"})]),ot(" AI ")],-1)),w[16]||(w[16]=e("div",{class:"rules-description"},[e("p",null," AI"),e("p",null,"AI")],-1)),e("div",m5,[w[11]||(w[11]=e("label",{class:"setting-label"},"",-1)),ke(e("textarea",{"onUpdate:modelValue":w[1]||(w[1]=I=>i.value=I),class:"setting-textarea large",placeholder:`AI


- {}
- {}
- {}
- {}
- {}


1. 
2. 
3. 500-1000
4. 

AI`,rows:"12"},null,512),[[je,i.value]]),w[12]||(w[12]=e("div",{class:"setting-hint"},"   {}{}{}{}{} ",-1))]),e("div",g5,[w[13]||(w[13]=e("label",{class:"setting-label"},"",-1)),ke(e("textarea",{"onUpdate:modelValue":w[2]||(w[2]=I=>r.value=I),class:"setting-textarea",placeholder:`

3-5
1. 
2. 
3. 20-50
4. `,rows:"6"},null,512),[[je,r.value]])]),e("button",{onClick:u,class:"save-btn"},[...w[14]||(w[14]=[e("svg",{viewBox:"0 0 24 24",class:"btn-icon"},[e("path",{fill:"currentColor",d:"M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"})],-1),ot("  ",-1)])])])])])):N("",!0)}},w5=Xe(b5,[["__scopeId","data-v-3bcc7e68"]]),k5={key:0,class:"video-detail-view"},x5=["src"],C5={key:1,class:"video-content-text"},$5={class:"content-scroll-area"},_5={key:0,class:"content-text"},M5={key:1,class:"content-placeholder"},S5=["disabled"],A5={key:0,viewBox:"0 0 24 24",class:"btn-icon"},I5={key:1,viewBox:"0 0 24 24",class:"btn-icon loading"},L5={key:2,class:"play-button-overlay"},T5={class:"player-controls"},j5={class:"play-pause-icon",viewBox:"0 0 24 24"},P5={key:0,d:"M8 5v14l11-7z"},E5={key:1,d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"},B5={class:"progress-bar"},V5={class:"time-display"},D5={class:"video-details"},H5={class:"video-title"},F5={class:"video-meta-info"},U5={class:"action-bar"},R5={class:"channel-info"},N5={class:"channel-left"},O5={class:"channel-avatar"},z5=["src","alt"],K5={class:"channel-name"},W5={class:"subscriber-count"},G5={class:"comments-section"},q5={class:"comments-header"},Z5={class:"comments-count"},J5={class:"comment-input-area"},Y5={class:"user-mini-avatar"},X5=["src"],Q5={class:"input-wrapper"},ek={key:0,class:"replying-to"},tk=["placeholder"],sk={class:"comment-list"},ok={class:"user-mini-avatar"},nk=["src"],ak={class:"comment-right"},lk={key:0,class:"creator-badge"},ik={class:"comment-text"},rk={class:"comment-footer"},ck=["onClick"],dk=["onClick"],uk={key:0,class:"replies-list"},vk={class:"user-mini-avatar-small"},pk=["src"],fk={class:"reply-right"},mk={class:"comment-user"},gk={class:"comment-text"},hk={class:"comment-footer"},yk=["onClick"],bk={__name:"videodetail",props:{isVisible:Boolean,video:{type:Object,default:()=>({id:1,title:" UI ",thumb:"https://picsum.photos/seed/video1/800/450",duration:"12:45",views:"1,284,502",time:"2",rating:98})}},emits:["back"],setup(t,{emit:s}){const o=t,n=s,a=h(!1),l=h(!1),i=h(!1),r=h(!1),c=h(""),d=h(""),u=h(null),v=h("https://api.dicebear.com/7.x/avataaars/svg?seed=Lucky"),b=h([]),w=h("https://api.dicebear.com/7.x/avataaars/svg?seed=Channel"),I=h(""),j=h("0 ");it(async()=>{try{const E=await C.getSetting("pornhub_avatar");if(E&&(v.value=E),o.video.contactId){const F=await C.getContact(o.video.contactId);F&&(I.value=F.name,w.value=F.avatar||`https://api.dicebear.com/7.x/avataaars/svg?seed=${F.name}`,j.value=`${Math.floor(Math.random()*500+100)}K `)}else o.video.contactName&&(I.value=o.video.contactName,w.value=`https://api.dicebear.com/7.x/avataaars/svg?seed=${o.video.contactName}`,j.value=`${Math.floor(Math.random()*500+100)}K `);const m=`pornhub_favorite_${o.video.id}`;await C.getSetting(m)&&(l.value=!0);const D=`pornhub_like_${o.video.id}`;await C.getSetting(D)&&(a.value=!0);const te=`pornhub_content_${o.video.id}`,R=await C.getSetting(te);if(R){c.value=R;const F=`pornhub_comments_${o.video.id}`,ie=await C.getSetting(F);ie&&(b.value=ie)}}catch(E){console.error(":",E)}});const $=()=>{i.value=!i.value},x=async()=>{if(!r.value)try{r.value=!0;const E=await C.getSetting("pornhub_generation_prompt");if(!E){alert(" AI"),r.value=!1;return}const m=await C.getSetting("pornhub_writing_style")||"";let g="",D="",W="",te=await C.getSetting("userNickname")||"";if(o.video.contactId){const L=await C.getContact(o.video.contactId);L&&(g=L.name,D=await C.getSetting(`pornhub_${L.id}_videoTypes`)||"",W=await C.getSetting(`pornhub_${L.id}_style`)||"")}else o.video.contactName&&(g=o.video.contactName,D=o.video.videoTypes||"",W=o.video.contentStyle||"",te=o.video.partnerName||te);let R=E.replace(/\{\}/g,g).replace(/\{\}/g,te).replace(/\{\}/g,D).replace(/\{\}/g,W).replace(/\{\}/g,m);const{aiService:F}=await Kt(async()=>{const{aiService:L}=await Promise.resolve().then(()=>fa);return{aiService:L}},void 0),ie=await F.getApiConfig();if(!ie.apiKey||!ie.model){alert(" AI API"),r.value=!1;return}let re=ie.baseUrl||"";re.endsWith("/v1")?re=re.slice(0,-3):re.endsWith("/")&&(re=re.slice(0,-1));const we=`${{deepseek:re||"https://api.deepseek.com",gemini:re||"https://generativelanguage.googleapis.com",openai:re||"https://api.openai.com"}[ie.provider]}/v1/chat/completions`,he=await fetch(we,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ie.apiKey}`},body:JSON.stringify({model:ie.model,messages:[{role:"system",content:""},{role:"user",content:R}],temperature:.9,max_tokens:2e3})});if(!he.ok)throw new Error(`HTTP error! status: ${he.status}`);const ge=(await he.json()).choices[0].message.content;c.value=ge;const B=`pornhub_content_${o.video.id}`;await C.setSetting(B,ge),console.log(""),await M(ge)}catch(E){console.error(":",E),alert(`${E.message}`)}finally{r.value=!1}},S=E=>E?E.replace(/<[^>]*>/g,"").trim():"",M=async E=>{try{let m=await C.getSetting("pornhub_comment_prompt");if(!m)return;let g=I.value;m=m.replace(/\{\}/g,g);const{aiService:D}=await Kt(async()=>{const{aiService:re}=await Promise.resolve().then(()=>fa);return{aiService:re}},void 0),W=await D.getApiConfig();if(!W.apiKey||!W.model)return;let te=W.baseUrl||"";te.endsWith("/v1")?te=te.slice(0,-3):te.endsWith("/")&&(te=te.slice(0,-1));const F=`${{deepseek:te||"https://api.deepseek.com",gemini:te||"https://generativelanguage.googleapis.com",openai:te||"https://api.openai.com"}[W.provider]}/v1/chat/completions`,ie=await fetch(F,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${W.apiKey}`},body:JSON.stringify({model:W.model,messages:[{role:"system",content:"HTML"},{role:"user",content:`${m}

${o.video.title}

${E.substring(0,300)}...`}],temperature:.8,max_tokens:800})});if(ie.ok){const pe=(await ie.json()).choices[0].message.content;console.log(":",pe);const we=pe.split(`
`).filter(Ue=>Ue.trim()),he=[];for(const Ue of we){const ge=Ue.split("|");if(ge.length>=2){const B=ge[0].trim();let L=ge.slice(1).join("|").trim();if(L=S(L),B&&L){const k=B===g;he.push({id:Date.now()+Math.random(),username:B,avatar:k?w.value:`https://api.dicebear.com/7.x/avataaars/svg?seed=${B}`,text:L,time:["","1","5","10","15"][Math.floor(Math.random()*5)],likes:Math.floor(Math.random()*1e3),isCharacter:k,replies:[]})}}}if(he.length>0){b.value=he;const Ue=`pornhub_comments_${o.video.id}`;await C.setSetting(Ue,he)}}}catch(m){console.error(":",m)}},A=async()=>{a.value=!a.value;try{const E=`pornhub_like_${o.video.id}`;await C.setSetting(E,a.value)}catch(E){console.error(":",E)}},T=async()=>{l.value=!l.value;try{const E=`pornhub_favorite_${o.video.id}`;if(await C.setSetting(E,l.value),l.value){let m=await C.getSetting("pornhub_favorite_list")||[];const g={...o.video,favoritedAt:Date.now()};m.unshift(g),await C.setSetting("pornhub_favorite_list",m),await C.setSetting("pornhub_favorite_count",m.length)}else{let m=await C.getSetting("pornhub_favorite_list")||[];m=m.filter(g=>g.id!==o.video.id),await C.setSetting("pornhub_favorite_list",m),await C.setSetting("pornhub_favorite_count",m.length)}}catch(E){console.error(":",E)}},G=()=>{if(d.value.trim()){const E={id:Date.now(),username:"",avatar:v.value,text:d.value.trim(),time:"",likes:0,isCharacter:!1,replies:[]};if(u.value){const g=b.value.find(D=>D.id===u.value);g&&(g.replies||(g.replies=[]),g.replies.push(E)),u.value=null}else b.value.unshift(E);d.value="";const m=`pornhub_comments_${o.video.id}`;C.setSetting(m,b.value)}},K=E=>{var m;u.value=E.id,d.value=`@${E.username} `,(m=document.querySelector(".comment-input-box"))==null||m.focus()},q=()=>{u.value=null,d.value=""},ee=E=>{const m=b.value.find(g=>g.id===E);m&&(m.likes+=1)},Z=()=>{n("back")};return(E,m)=>t.isVisible?(p(),f("div",k5,[e("div",{class:"nav-header"},[e("div",{class:"back-btn",onClick:Z},""),m[1]||(m[1]=e("div",{class:"ph-logo-small"},[ot("Porn"),e("span",null,"hub")],-1))]),e("div",{class:"video-player-container",onClick:$},[i.value?N("",!0):(p(),f("img",{key:0,src:t.video.thumb,alt:"Video Cover"},null,8,x5)),i.value?(p(),f("div",C5,[e("div",$5,[c.value?(p(),f("div",_5,_(c.value),1)):(p(),f("div",M5,[m[4]||(m[4]=e("svg",{viewBox:"0 0 24 24",class:"placeholder-icon"},[e("path",{fill:"currentColor",d:"M17.75,4.09L15.22,6.03L16.13,9.09L13.5,7.28L10.87,9.09L11.78,6.03L9.25,4.09L12.44,4L13.5,1L14.56,4L17.75,4.09M21.25,11L19.61,12.25L20.2,14.23L18.5,13.06L16.8,14.23L17.39,12.25L15.75,11L17.81,10.95L18.5,9L19.19,10.95L21.25,11M18.97,15.95C19.8,15.87 20.69,17.05 20.16,17.8C19.84,18.25 19.5,18.67 19.08,19.07C15.17,23 8.84,23 4.94,19.07C1.03,15.17 1.03,8.83 4.94,4.93C5.34,4.53 5.76,4.17 6.21,3.85C6.96,3.32 8.14,4.21 8.06,5.04C7.79,7.9 8.75,10.87 10.95,13.06C13.14,15.26 16.1,16.22 18.97,15.95M17.33,17.97C14.5,17.81 11.7,16.64 9.53,14.5C7.36,12.31 6.2,9.5 6.04,6.68C3.23,9.82 3.34,14.64 6.35,17.66C9.37,20.67 14.19,20.78 17.33,17.97Z"})],-1)),m[5]||(m[5]=e("p",{class:"placeholder-title"}," AI",-1)),m[6]||(m[6]=e("p",{class:"hint-text"},"AI",-1)),e("button",{onClick:x,class:"generate-content-btn",disabled:r.value},[r.value?(p(),f("svg",I5,[...m[3]||(m[3]=[e("path",{fill:"currentColor",d:"M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"},null,-1)])])):(p(),f("svg",A5,[...m[2]||(m[2]=[e("path",{fill:"currentColor",d:"M17.75,4.09L15.22,6.03L16.13,9.09L13.5,7.28L10.87,9.09L11.78,6.03L9.25,4.09L12.44,4L13.5,1L14.56,4L17.75,4.09M21.25,11L19.61,12.25L20.2,14.23L18.5,13.06L16.8,14.23L17.39,12.25L15.75,11L17.81,10.95L18.5,9L19.19,10.95L21.25,11M18.97,15.95C19.8,15.87 20.69,17.05 20.16,17.8C19.84,18.25 19.5,18.67 19.08,19.07C15.17,23 8.84,23 4.94,19.07C1.03,15.17 1.03,8.83 4.94,4.93C5.34,4.53 5.76,4.17 6.21,3.85C6.96,3.32 8.14,4.21 8.06,5.04C7.79,7.9 8.75,10.87 10.95,13.06C13.14,15.26 16.1,16.22 18.97,15.95M17.33,17.97C14.5,17.81 11.7,16.64 9.53,14.5C7.36,12.31 6.2,9.5 6.04,6.68C3.23,9.82 3.34,14.64 6.35,17.66C9.37,20.67 14.19,20.78 17.33,17.97Z"},null,-1)])])),ot(" "+_(r.value?"...":" "),1)],8,S5)]))])])):N("",!0),i.value?N("",!0):(p(),f("div",L5,[...m[7]||(m[7]=[e("svg",{class:"play-icon-large",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M8 5v14l11-7z"})],-1)])])),e("div",T5,[(p(),f("svg",j5,[i.value?(p(),f("path",E5)):(p(),f("path",P5))])),e("div",B5,[e("div",{class:"progress-current",style:Oe({width:i.value?"100%":"0%"})},null,4)]),e("div",V5,_(t.video.duration),1)])]),e("div",D5,[e("h1",H5,_(t.video.title),1),e("div",F5,_(t.video.views)+"   "+_(t.video.time),1)]),e("div",U5,[e("div",{class:Se(["action-item",{active:a.value}]),onClick:A},[m[8]||(m[8]=e("svg",{viewBox:"0 0 24 24"},[e("path",{d:"M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"})],-1)),e("span",null,_(t.video.rating)+"%",1)],2),m[10]||(m[10]=mt('<div class="action-item" data-v-9ec8ad43><svg viewBox="0 0 24 24" data-v-9ec8ad43><path d="M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.37-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z" data-v-9ec8ad43></path></svg><span data-v-9ec8ad43></span></div><div class="action-item" data-v-9ec8ad43><svg viewBox="0 0 24 24" data-v-9ec8ad43><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z" data-v-9ec8ad43></path></svg><span data-v-9ec8ad43></span></div><div class="action-item" data-v-9ec8ad43><svg viewBox="0 0 24 24" data-v-9ec8ad43><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" data-v-9ec8ad43></path></svg><span data-v-9ec8ad43></span></div>',3)),e("div",{class:Se(["action-item",{active:l.value}]),onClick:T},[m[9]||(m[9]=e("svg",{viewBox:"0 0 24 24"},[e("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"})],-1)),e("span",null,_(l.value?"":""),1)],2)]),e("div",R5,[e("div",N5,[e("div",O5,[e("img",{src:w.value,alt:I.value},null,8,z5)]),e("div",null,[e("div",K5,_(I.value),1),e("div",W5,_(j.value),1)])]),m[11]||(m[11]=e("div",{class:"subscribe-btn"},"",-1))]),e("div",G5,[e("div",q5,[e("div",Z5," ("+_(b.value.length)+")",1),m[12]||(m[12]=e("div",{style:{"font-size":"12px",color:"#888"}}," ",-1))]),e("div",J5,[e("div",Y5,[e("img",{src:v.value,alt:"Me",style:{width:"100%",height:"100%","border-radius":"50%"}},null,8,X5)]),e("div",Q5,[u.value?(p(),f("div",ek,[m[13]||(m[13]=e("span",null,"...",-1)),e("button",{onClick:q,class:"cancel-reply"},"")])):N("",!0),ke(e("input",{type:"text",class:"comment-input-box",placeholder:u.value?"...":"...","onUpdate:modelValue":m[0]||(m[0]=g=>d.value=g),onKeyup:ns(G,["enter"])},null,40,tk),[[je,d.value]])])]),e("div",sk,[(p(!0),f(Le,null,Fe(b.value,g=>(p(),f("div",{key:g.id,class:"comment-item"},[e("div",ok,[e("img",{src:g.avatar,alt:"User",style:{width:"100%",height:"100%","border-radius":"50%"}},null,8,nk)]),e("div",ak,[e("div",{class:Se(["comment-user",{"is-character":g.isCharacter}])},[ot(_(g.username)+" ",1),g.isCharacter?(p(),f("span",lk,"")):N("",!0)],2),e("div",ik,_(g.text),1),e("div",rk,[e("span",null,_(g.time),1),e("div",{class:"comment-action",onClick:D=>ee(g.id)},[m[14]||(m[14]=e("svg",{viewBox:"0 0 24 24"},[e("path",{d:"M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"})],-1)),e("span",null,_(g.likes),1)],8,ck),e("span",{onClick:D=>K(g),class:"reply-btn"},"",8,dk)]),g.replies&&g.replies.length>0?(p(),f("div",uk,[(p(!0),f(Le,null,Fe(g.replies,D=>(p(),f("div",{key:D.id,class:"reply-item"},[e("div",vk,[e("img",{src:D.avatar,alt:"User",style:{width:"100%",height:"100%","border-radius":"50%"}},null,8,pk)]),e("div",fk,[e("div",mk,_(D.username),1),e("div",gk,_(D.text),1),e("div",hk,[e("span",null,_(D.time),1),e("div",{class:"comment-action",onClick:W=>ee(D.id)},[m[15]||(m[15]=e("svg",{viewBox:"0 0 24 24"},[e("path",{d:"M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"})],-1)),e("span",null,_(D.likes),1)],8,yk)])])]))),128))])):N("",!0)])]))),128))])]),m[16]||(m[16]=e("div",{style:{height:"50px"}},null,-1))])):N("",!0)}},wk=Xe(bk,[["__scopeId","data-v-9ec8ad43"]]),kk={class:"character-edit-page"},xk={class:"top-nav"},Ck={class:"content"},$k={class:"character-header"},_k=["src","alt"],Mk={class:"character-name-large"},Sk={class:"character-desc-large"},Ak={class:"settings-form"},Ik={class:"setting-group"},Lk={class:"setting-group"},Tk={class:"setting-group"},jk={class:"setting-group"},Pk={class:"setting-group"},Ek={class:"partner-info"},Bk={class:"partner-display"},Vk={__name:"characteredit",props:{character:{type:Object,required:!0}},emits:["back"],setup(t,{emit:s}){const o=t,n=s,a=h(""),l=h("medium"),i=h(""),r=h(""),c=h("");it(async()=>{try{const u=await(void 0)("userNickname");u&&(c.value=u);const v=await(void 0)(`pornhub_${o.character.id}_videoTypes`),b=await(void 0)(`pornhub_${o.character.id}_frequency`),w=await(void 0)(`pornhub_${o.character.id}_style`),I=await(void 0)(`pornhub_${o.character.id}_tags`);a.value=v||"",l.value=b||"medium",i.value=w||"",r.value=I||""}catch(u){console.error(":",u)}});const d=async()=>{try{await(void 0)(`pornhub_${o.character.id}_videoTypes`,a.value),await(void 0)(`pornhub_${o.character.id}_frequency`,l.value),await(void 0)(`pornhub_${o.character.id}_style`,i.value),await(void 0)(`pornhub_${o.character.id}_tags`,r.value),await(void 0)(`pornhub_${o.character.id}_partner`,"user"),await(void 0)(`pornhub_${o.character.id}_partnerName`,c.value),console.log("",{:o.character.name,:c.value}),alert(` 

${o.character.name}
${c.value}`)}catch(u){console.error(":",u),alert("")}};return(u,v)=>(p(),f("div",kk,[e("div",xk,[e("button",{onClick:v[0]||(v[0]=b=>n("back")),class:"back-btn"},[...v[5]||(v[5]=[e("svg",{viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"})],-1)])]),v[6]||(v[6]=e("span",{class:"nav-title"},"",-1)),v[7]||(v[7]=e("div",{class:"placeholder"},null,-1))]),e("div",Ck,[e("div",$k,[e("img",{src:t.character.avatar,alt:t.character.name,class:"character-avatar-large"},null,8,_k),e("div",Mk,_(t.character.name),1),e("div",Sk,_(t.character.description||""),1)]),e("div",Ak,[e("div",Ik,[v[8]||(v[8]=e("label",{class:"setting-label"},[e("svg",{viewBox:"0 0 24 24",class:"label-icon"},[e("path",{fill:"currentColor",d:"M17,10.5V7A1,1 0 0,0 16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5Z"})]),ot("  ")],-1)),ke(e("textarea",{"onUpdate:modelValue":v[1]||(v[1]=b=>a.value=b),class:"setting-textarea",placeholder:"vlog",rows:"4"},null,512),[[je,a.value]]),v[9]||(v[9]=e("div",{class:"setting-hint"},"",-1))]),e("div",Lk,[v[11]||(v[11]=e("label",{class:"setting-label"},[e("svg",{viewBox:"0 0 24 24",class:"label-icon"},[e("path",{fill:"currentColor",d:"M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"})]),ot("  ")],-1)),ke(e("select",{"onUpdate:modelValue":v[2]||(v[2]=b=>l.value=b),class:"setting-select"},[...v[10]||(v[10]=[mt('<option value="very_high" data-v-3923f05a></option><option value="high" data-v-3923f05a>1-2</option><option value="medium" data-v-3923f05a>3-5</option><option value="low" data-v-3923f05a>1-2</option><option value="very_low" data-v-3923f05a></option>',5)])],512),[[Hs,l.value]])]),e("div",Tk,[v[12]||(v[12]=e("label",{class:"setting-label"},[e("svg",{viewBox:"0 0 24 24",class:"label-icon"},[e("path",{fill:"currentColor",d:"M20.71,4.63L19.37,3.29C19,2.9 18.35,2.9 17.96,3.29L9,12.25L11.75,15L20.71,6.04C21.1,5.65 21.1,5 20.71,4.63M7,14A3,3 0 0,0 4,17C4,18.31 2.84,19 2,19C2.92,20.22 4.5,21 6,21A4,4 0 0,0 10,17A3,3 0 0,0 7,14Z"})]),ot("  ")],-1)),ke(e("textarea",{"onUpdate:modelValue":v[3]||(v[3]=b=>i.value=b),class:"setting-textarea",placeholder:"",rows:"3"},null,512),[[je,i.value]]),v[13]||(v[13]=e("div",{class:"setting-hint"},"",-1))]),e("div",jk,[v[14]||(v[14]=e("label",{class:"setting-label"},[e("svg",{viewBox:"0 0 24 24",class:"label-icon"},[e("path",{fill:"currentColor",d:"M5.5,7A1.5,1.5 0 0,1 4,5.5A1.5,1.5 0 0,1 5.5,4A1.5,1.5 0 0,1 7,5.5A1.5,1.5 0 0,1 5.5,7M21.41,11.58L12.41,2.58C12.05,2.22 11.55,2 11,2H4C2.89,2 2,2.89 2,4V11C2,11.55 2.22,12.05 2.59,12.41L11.58,21.41C11.95,21.77 12.45,22 13,22C13.55,22 14.05,21.77 14.41,21.41L21.41,14.41C21.77,14.05 22,13.55 22,13C22,12.45 21.77,11.95 21.41,11.58Z"})]),ot("  ")],-1)),ke(e("input",{"onUpdate:modelValue":v[4]||(v[4]=b=>r.value=b),type:"text",class:"setting-input",placeholder:"# # #"},null,512),[[je,r.value]])]),e("div",Pk,[v[17]||(v[17]=e("label",{class:"setting-label"},[e("svg",{viewBox:"0 0 24 24",class:"label-icon"},[e("path",{fill:"currentColor",d:"M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"})]),ot("  ")],-1)),e("div",Ek,[e("div",Bk,[v[15]||(v[15]=e("svg",{viewBox:"0 0 24 24",class:"partner-icon"},[e("path",{fill:"currentColor",d:"M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"})],-1)),e("span",null,_(c.value||""),1)]),v[16]||(v[16]=e("div",{class:"setting-hint"},"   ",-1))])]),e("button",{onClick:d,class:"save-btn"},[...v[18]||(v[18]=[e("svg",{viewBox:"0 0 24 24",class:"btn-icon"},[e("path",{fill:"currentColor",d:"M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"})],-1),ot("  ",-1)])])])])]))}},Dk=Xe(Vk,[["__scopeId","data-v-3923f05a"]]),Hk={key:0,class:"favorites-view"},Fk={class:"top-nav"},Uk={class:"content"},Rk={key:0,class:"empty-state"},Nk={key:1,class:"video-list"},Ok=["onClick"],zk={class:"thumb-wrap"},Kk=["src"],Wk={class:"duration"},Gk={class:"video-info"},qk={class:"title"},Zk={class:"meta"},Jk={class:"views"},Yk=["onClick"],Xk={__name:"favoritelist",props:{isVisible:Boolean},emits:["back","open-video"],setup(t,{emit:s}){const o=s,n=h([]);it(async()=>{await a()});const a=async()=>{try{const r=await C.getSetting("pornhub_favorite_list")||[];n.value=r}catch(r){console.error(":",r)}},l=async r=>{try{n.value=n.value.filter(d=>d.id!==r.id),await C.setSetting("pornhub_favorite_list",n.value);const c=`pornhub_favorite_${r.id}`;await C.setSetting(c,!1),await C.setSetting("pornhub_favorite_count",n.value.length)}catch(c){console.error(":",c)}},i=r=>{o("open-video",r)};return(r,c)=>t.isVisible?(p(),f("div",Hk,[e("div",Fk,[e("button",{onClick:c[0]||(c[0]=d=>o("back")),class:"back-btn"},[...c[1]||(c[1]=[e("svg",{viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"})],-1)])]),c[2]||(c[2]=e("span",{class:"nav-title"},"",-1)),c[3]||(c[3]=e("div",{class:"placeholder"},null,-1))]),e("div",Uk,[n.value.length===0?(p(),f("div",Rk,[...c[4]||(c[4]=[e("svg",{viewBox:"0 0 24 24",class:"empty-icon"},[e("path",{fill:"currentColor",d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})],-1),e("p",null,"",-1),e("p",{class:"hint"},"",-1)])])):(p(),f("div",Nk,[(p(!0),f(Le,null,Fe(n.value,d=>(p(),f("div",{key:d.id,class:"video-card",onClick:u=>i(d)},[e("div",zk,[e("img",{src:d.thumb,alt:"thumb"},null,8,Kk),e("span",Wk,_(d.duration),1)]),e("div",Gk,[e("h4",qk,_(d.title),1),e("div",Zk,[e("span",Jk,_(d.views)+"   "+_(d.time),1),e("button",{onClick:Pe(u=>l(d),["stop"]),class:"remove-btn"},[...c[5]||(c[5]=[e("svg",{viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})],-1)])],8,Yk)])])],8,Ok))),128))]))])])):N("",!0)}},Qk=Xe(Xk,[["__scopeId","data-v-dca6e6c4"]]),ga=(t,s=800,o=.8)=>new Promise((n,a)=>{const l=new FileReader;l.onload=i=>{const r=new Image;r.onload=()=>{const c=document.createElement("canvas");let d=r.width,u=r.height;d>s&&(u=u*s/d,d=s),c.width=d,c.height=u,c.getContext("2d").drawImage(r,0,0,d,u);const b=c.toDataURL("image/jpeg",o);n(b)},r.onerror=()=>{a(new Error(""))},r.src=i.target.result},l.onerror=()=>{a(new Error(""))},l.readAsDataURL(t)}),e3=(t,s=200,o=.8)=>new Promise((n,a)=>{const l=new FileReader;l.onload=i=>{const r=new Image;r.onload=()=>{const c=document.createElement("canvas");c.width=s,c.height=s;const d=c.getContext("2d"),u=Math.min(r.width,r.height),v=(r.width-u)/2,b=(r.height-u)/2;d.drawImage(r,v,b,u,u,0,0,s,s);const w=c.toDataURL("image/jpeg",o);n(w)},r.onerror=()=>{a(new Error(""))},r.src=i.target.result},l.onerror=()=>{a(new Error(""))},l.readAsDataURL(t)}),t3={class:"top-nav"},s3={class:"user-section"},o3=["src"],n3={class:"user-stats"},a3={class:"stat-item"},l3={class:"stat-value"},i3={class:"stat-item"},r3={class:"stat-value"},c3={class:"stat-item"},d3={class:"stat-value"},u3={class:"feature-tabs"},v3={class:"content-section"},p3={key:0},f3={class:"section-header-row"},m3={class:"playlist-grid"},g3={class:"playlist-cover"},h3=["src"],y3=["onClick"],b3={class:"playlist-cover"},w3=["src"],k3={class:"playlist-name"},x3={class:"playlist-count"},C3={key:0,class:"empty-state"},$3={key:1,class:"dynamics-list"},_3={class:"section-header-row"},M3=["disabled"],S3={key:0,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},A3={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",class:"spinning"},I3={key:0,class:"empty-state"},L3={class:"activity-character"},T3={class:"dynamic-time"},j3={class:"player-cover"},P3=["src"],E3={class:"player-info"},B3={class:"player-track-name"},V3={class:"player-artist"},D3={key:0,width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},H3={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},F3={class:"form-group"},U3={class:"form-group"},R3={class:"form-group"},N3={class:"modal-buttons"},O3={class:"settings-header"},z3={class:"setting-group"},K3={class:"setting-group"},W3={class:"setting-label"},G3={class:"control-row"},q3={class:"color-picker"},Z3={class:"setting-group"},J3={class:"control-row"},Y3={class:"color-picker"},X3={__name:"PersonalHome",emits:["back","navigate","play-song"],setup(t,{emit:s}){const o=s,n=qo,a=h(!1),l=h(!1),i=h("playlist"),r=h({name:!1,signature:!1}),c=h({wallpaper:"https://picsum.photos/1080/1920?random=33",avatar:"https://picsum.photos/200/200?random=66",uiColor:"#000000",opacity:.4,textColor:"#ffffff",userName:"",signature:" "}),d=h([]),u=h(0),v=h([]),b=h(!1),w=h("https://picsum.photos/200/200?random=ranking"),I=h({name:"",description:"",cover:""}),j=h(null),$=h(null),x=h(null),S=h(null),M=h(null),A=L=>{r.value[L]=!0,Yt(()=>{var k,y;L==="name"&&((k=j.value)==null||k.focus()),L==="signature"&&((y=$.value)==null||y.focus())})},T=L=>{r.value[L]=!1,ge()},G=L=>{const k=parseInt(L.slice(1,3),16),y=parseInt(L.slice(3,5),16),H=parseInt(L.slice(5,7),16);return k+", "+y+", "+H},K=tt(()=>({backgroundColor:"rgba("+G(c.value.uiColor)+", "+c.value.opacity+")",color:c.value.textColor,"--text-color":c.value.textColor})),q=()=>{var L;return(L=x.value)==null?void 0:L.click()},ee=async L=>{const k=L.target.files[0];if(k)try{const y=await ga(k,1080,.85);c.value.wallpaper=y,ge()}catch(y){console.error(":",y),alert("")}},Z=()=>{var L;return(L=S.value)==null?void 0:L.click()},E=async L=>{const k=L.target.files[0];if(k)try{const y=await e3(k,200,.85);c.value.avatar=y,ge()}catch(y){console.error(":",y),alert("")}},m=async()=>{try{const L=await ft.getUserConfig();L&&(c.value={...c.value,...L});const k=await ft.getRankingCover();k&&(w.value=k)}catch(L){console.error(":",L)}},g=async()=>{try{const L=await ft.getAllPlaylists();for(const k of L){const y=await ft.getSongsInPlaylist(k.id);k.songs=y}d.value=L}catch(L){console.error(":",L)}},D=async()=>{try{const{db:L}=await Kt(async()=>{const{db:y}=await Promise.resolve().then(()=>is);return{db:y}},void 0),k=await L.getContacts();u.value=k.length}catch(L){console.error(":",L)}},W=async()=>{try{const L=await ft.getMusicActivities();v.value=L}catch(L){console.error(":",L)}},te=L=>{const y=Date.now()-L,H=Math.floor(y/6e4),se=Math.floor(y/36e5),P=Math.floor(y/864e5);return H<1?"":H<60?`${H}`:se<24?`${se}`:P<7?`${P}`:new Date(L).toLocaleDateString()},R=(L,k,y)=>`"${L}"${k}- ${y}


- 
- 
- 
- 
- 
- 
- 
-


- 
- 
- 
- 
- 
-  emoji 

`,F=async()=>{var L,k;if(!b.value)try{b.value=!0;const{db:y}=await Kt(async()=>{const{db:Ne}=await Promise.resolve().then(()=>is);return{db:Ne}},void 0),H=await y.getSetting("apiConfig");if(!H||!H.apiKey){alert(" API Key");return}const se=await y.getContacts();if(se.length===0){alert("");return}const P=se[0],U=((L=n.currentSong)==null?void 0:L.title)||"",O=((k=n.currentSong)==null?void 0:k.artist)||"",Q={provider:H.provider||"deepseek",apiKey:H.apiKey,baseUrl:H.baseUrl||"",model:H.model||"deepseek-chat"};let ae=Q.baseUrl;ae||(Q.provider==="deepseek"?ae="https://api.deepseek.com":Q.provider==="openai"&&(ae="https://api.openai.com")),ae=ae.replace(/\/v1\/?$/,"").replace(/\/$/,"")+"/v1/chat/completions";const fe=R(P.name,U,O);console.log(" ..."),console.log(":",P.name),console.log(":",U,"-",O),console.log(":",fe);const Me=await fetch(ae,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Q.apiKey}`},body:JSON.stringify({model:Q.model,messages:[{role:"user",content:fe}],temperature:.9})});if(!Me.ok){const Ne=await Me.text();throw console.error("API :",Ne),new Error(`AI : ${Me.status}`)}const $e=(await Me.json()).choices[0].message.content.trim();console.log(" :",$e);const ye={characterId:P.id,characterName:P.name,content:$e,songTitle:U,songArtist:O,timestamp:Date.now()};await ft.saveMusicActivity(ye),await W(),alert("")}catch(y){console.error(":",y),alert(": "+y.message)}finally{b.value=!1}},ie=L=>{o("navigate","playlist-manager",L.id)},re=()=>{n.currentSong&&o("play-song",n.currentSong)},pe=()=>{o("navigate","music-ranking")},we=()=>{var L;(L=M.value)==null||L.click()},he=async L=>{const k=L.target.files[0];if(k)try{const y=await ga(k,600,.85);I.value.cover=y}catch(y){console.error(":",y),alert("")}},Ue=async()=>{if(!I.value.name.trim()){alert("");return}try{const L=await ft.createPlaylist({name:I.value.name,description:I.value.description,cover:I.value.cover||`https://picsum.photos/200/200?random=${Date.now()}`,creator:c.value.userName});d.value.push(L),I.value={name:"",description:"",cover:""},l.value=!1}catch(L){console.error(":",L),alert("")}},ge=async()=>{try{await ft.saveUserConfig(c.value)}catch(L){console.error(":",L)}};Ft(c,()=>{ge()},{deep:!0});let B=null;return it(()=>{m(),g(),D(),W(),B=setInterval(()=>{g(),W()},3e3)}),zt(()=>{B&&clearInterval(B)}),(L,k)=>(p(),f("div",{class:"personal-home",style:Oe({backgroundImage:"url("+c.value.wallpaper+")"})},[e("div",{class:"ui-overlay",style:Oe(K.value)},[e("nav",t3,[e("button",{class:"icon-btn",onClick:k[0]||(k[0]=y=>L.$emit("back"))},[...k[28]||(k[28]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},[e("path",{d:"M15 18l-6-6 6-6"})],-1)])]),e("button",{class:"icon-btn",onClick:k[1]||(k[1]=y=>a.value=!0)},[...k[29]||(k[29]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},[e("circle",{cx:"12",cy:"12",r:"1",fill:"currentColor"}),e("circle",{cx:"12",cy:"5",r:"1",fill:"currentColor"}),e("circle",{cx:"12",cy:"19",r:"1",fill:"currentColor"})],-1)])])]),e("section",s3,[e("div",{class:"user-avatar",onClick:Z},[e("img",{src:c.value.avatar,alt:""},null,8,o3)]),r.value.name?ke((p(),f("input",{key:1,ref_key:"nameInputRef",ref:j,class:"edit-input name-input","onUpdate:modelValue":k[3]||(k[3]=y=>c.value.userName=y),onBlur:k[4]||(k[4]=y=>T("name")),onKeyup:k[5]||(k[5]=ns(y=>T("name"),["enter"]))},null,544)),[[je,c.value.userName]]):(p(),f("div",{key:0,class:"user-name editable-text",onClick:k[2]||(k[2]=y=>A("name"))},_(c.value.userName),1)),r.value.signature?ke((p(),f("input",{key:3,ref_key:"signatureInputRef",ref:$,class:"edit-input signature-input","onUpdate:modelValue":k[7]||(k[7]=y=>c.value.signature=y),onBlur:k[8]||(k[8]=y=>T("signature")),onKeyup:k[9]||(k[9]=ns(y=>T("signature"),["enter"]))},null,544)),[[je,c.value.signature]]):(p(),f("div",{key:2,class:"user-signature editable-text",onClick:k[6]||(k[6]=y=>A("signature"))},_(c.value.signature),1)),e("div",n3,[e("div",a3,[e("div",l3,_(u.value),1),k[30]||(k[30]=e("div",{class:"stat-label"},"",-1))]),k[33]||(k[33]=e("div",{class:"stat-divider"},null,-1)),e("div",i3,[e("div",r3,_(u.value),1),k[31]||(k[31]=e("div",{class:"stat-label"},"",-1))]),k[34]||(k[34]=e("div",{class:"stat-divider"},null,-1)),e("div",c3,[e("div",d3,_(d.value.length),1),k[32]||(k[32]=e("div",{class:"stat-label"},"",-1))])])]),e("div",u3,[e("div",{class:Se(["tab-item",{active:i.value==="playlist"}]),onClick:k[10]||(k[10]=y=>i.value="playlist")},"  ",2),e("div",{class:Se(["tab-item",{active:i.value==="dynamics"}]),onClick:k[11]||(k[11]=y=>i.value="dynamics")},"  ",2)]),e("main",v3,[i.value==="playlist"?(p(),f("div",p3,[e("div",f3,[k[36]||(k[36]=e("h3",{class:"section-header"},"",-1)),e("button",{class:"add-playlist-btn",onClick:k[12]||(k[12]=y=>l.value=!0)},[...k[35]||(k[35]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])])]),e("div",m3,[e("div",{class:"playlist-card ranking-card",onClick:pe},[e("div",g3,[e("img",{src:w.value},null,8,h3)]),k[37]||(k[37]=e("div",{class:"playlist-name"},"",-1)),k[38]||(k[38]=e("div",{class:"playlist-count"},"",-1))]),(p(!0),f(Le,null,Fe(d.value,y=>{var H;return p(),f("div",{key:y.id,class:"playlist-card",onClick:se=>ie(y)},[e("div",b3,[e("img",{src:y.cover||"https://picsum.photos/200/200?random="+y.id},null,8,w3)]),e("div",k3,_(y.name),1),e("div",x3,_(((H=y.songs)==null?void 0:H.length)||0)+" ",1)],8,y3)}),128)),d.value.length===0?(p(),f("div",C3,[k[39]||(k[39]=e("p",null,"",-1)),e("button",{class:"create-first-btn",onClick:k[13]||(k[13]=y=>l.value=!0)},"")])):N("",!0)])])):(p(),f("div",$3,[e("div",_3,[k[42]||(k[42]=e("h3",{class:"section-header"},"",-1)),e("button",{class:"add-playlist-btn",onClick:F,disabled:b.value},[b.value?(p(),f("svg",A3,[...k[41]||(k[41]=[e("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"},null,-1)])])):(p(),f("svg",S3,[...k[40]||(k[40]=[e("path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"},null,-1)])]))],8,M3)]),v.value.length===0?(p(),f("div",I3,[...k[43]||(k[43]=[e("p",null,"",-1),e("p",{class:"hint"},"",-1),e("p",{class:"hint"},"",-1)])])):(p(!0),f(Le,{key:1},Fe(v.value,y=>(p(),f("div",{key:y.id,class:"dynamic-item"},[e("div",L3,_(y.characterName),1),ot(" "+_(y.content)+" ",1),e("div",T3,_(te(y.timestamp)),1)]))),128))]))])],4),Ke(n).currentSong?(p(),f("footer",{key:0,class:"music-player",style:Oe(K.value),onClick:re},[e("div",j3,[e("img",{src:Ke(n).currentSong.cover||"https://picsum.photos/100/100?random=music_cover",alt:"cover"},null,8,P3)]),e("div",E3,[e("div",B3,_(Ke(n).currentSong.title||""),1),e("div",V3,_(Ke(n).currentSong.artist||""),1)]),e("div",{class:"player-controls",onClick:k[17]||(k[17]=Pe(()=>{},["stop"]))},[e("button",{class:"control-btn",onClick:k[14]||(k[14]=y=>Ke(Pt).previous())},[...k[44]||(k[44]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"})],-1)])]),e("button",{class:"control-btn play-pause-btn",onClick:k[15]||(k[15]=y=>Ke(Pt).togglePlay())},[Ke(n).isPlaying?(p(),f("svg",H3,[...k[46]||(k[46]=[e("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},null,-1)])])):(p(),f("svg",D3,[...k[45]||(k[45]=[e("path",{d:"M8 5v14l11-7z"},null,-1)])]))]),e("button",{class:"control-btn",onClick:k[16]||(k[16]=y=>Ke(Pt).next())},[...k[47]||(k[47]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M6 18l8.5-6L6 6zm9-12v12h2V6z"})],-1)])])])],4)):N("",!0),l.value?(p(),f("div",{key:1,class:"modal-overlay",onClick:k[22]||(k[22]=y=>l.value=!1)},[e("div",{class:"modal-content",onClick:k[21]||(k[21]=Pe(()=>{},["stop"]))},[k[51]||(k[51]=e("h3",{class:"modal-title"},"",-1)),e("div",F3,[k[48]||(k[48]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":k[18]||(k[18]=y=>I.value.name=y),type:"text",class:"form-input",placeholder:""},null,512),[[je,I.value.name]])]),e("div",U3,[k[49]||(k[49]=e("label",null,"",-1)),ke(e("textarea",{"onUpdate:modelValue":k[19]||(k[19]=y=>I.value.description=y),class:"form-textarea",placeholder:""},null,512),[[je,I.value.description]])]),e("div",R3,[k[50]||(k[50]=e("label",null,"",-1)),e("button",{class:"upload-cover-btn",onClick:we},_(I.value.cover?" ":" "),1),e("input",{type:"file",ref_key:"playlistCoverInput",ref:M,style:{display:"none"},accept:"image/*",onChange:he},null,544)]),e("div",N3,[e("button",{class:"modal-btn cancel-btn",onClick:k[20]||(k[20]=y=>l.value=!1)},""),e("button",{class:"modal-btn confirm-btn",onClick:Ue},"")])])])):N("",!0),a.value?(p(),f("div",{key:2,class:"settings-mask",onClick:k[23]||(k[23]=y=>a.value=!1)})):N("",!0),e("aside",{class:Se(["settings-panel",{active:a.value}])},[e("div",O3,[k[52]||(k[52]=e("h3",null,"",-1)),e("span",{onClick:k[24]||(k[24]=y=>a.value=!1),class:"finish-btn"},"")]),e("div",z3,[k[53]||(k[53]=e("label",{class:"setting-label"},"",-1)),e("div",{class:"upload-grid"},[e("button",{class:"upload-btn",onClick:q}," "),e("button",{class:"upload-btn",onClick:Z}," ")]),e("input",{type:"file",ref_key:"wallpaperInput",ref:x,style:{display:"none"},accept:"image/*",onChange:ee},null,544),e("input",{type:"file",ref_key:"avatarInput",ref:S,style:{display:"none"},accept:"image/*",onChange:E},null,544)]),e("div",K3,[e("label",W3,"UI  &  ("+_(Math.round(c.value.opacity*100))+"%)",1),e("div",G3,[e("div",q3,[ke(e("input",{type:"color","onUpdate:modelValue":k[25]||(k[25]=y=>c.value.uiColor=y)},null,512),[[je,c.value.uiColor]])]),ke(e("input",{type:"range","onUpdate:modelValue":k[26]||(k[26]=y=>c.value.opacity=y),min:"0",max:"1",step:"0.01",class:"range-input"},null,512),[[je,c.value.opacity]])])]),e("div",Z3,[k[55]||(k[55]=e("label",{class:"setting-label"},"",-1)),e("div",J3,[e("div",Y3,[ke(e("input",{type:"color","onUpdate:modelValue":k[27]||(k[27]=y=>c.value.textColor=y)},null,512),[[je,c.value.textColor]])]),k[54]||(k[54]=e("span",{class:"hint-text"},"",-1))])])],2)],4))}},Q3=Xe(X3,[["__scopeId","data-v-0b5d3c81"]]),ex={class:"listen-together"},tx={class:"header"},sx={class:"room-info"},ox={class:"room-id"},nx={class:"online-count"},ax={key:0,class:"listen-time"},lx={class:"music-section"},ix={class:"album-wrapper"},rx=["src","alt"],cx={class:"song-info"},dx={class:"song-title"},ux={class:"song-artist"},vx={class:"progress-section"},px={class:"time"},fx={class:"time"},mx={class:"controls"},gx={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},hx={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},yx={class:"users-section"},bx={class:"users-list"},wx={class:"user-avatar"},kx=["src","alt"],xx={key:0,class:"host-badge"},Cx={class:"user-info"},$x={class:"user-name"},_x={class:"chat-section"},Mx=["src","alt"],Sx={class:"message-content"},Ax={class:"message-name"},Ix={class:"message-text"},Lx={class:"message-time"},Tx={class:"chat-input-wrapper"},jx=["disabled"],Px={class:"invite-code"},Ex={class:"code-value"},Bx={__name:"ListenTogether",emits:["back"],setup(t){const s=qo,o=tt(()=>s.listenTogether.roomId||"888888"),n=h(!1),a=h([{id:1,name:"",avatar:"https://picsum.photos/100/100?random=u1",isHost:!0,isListening:!0},{id:2,name:"",avatar:"https://picsum.photos/100/100?random=u2",isHost:!1,isListening:!0},{id:3,name:"",avatar:"https://picsum.photos/100/100?random=u3",isHost:!1,isListening:!1},{id:4,name:"",avatar:"https://picsum.photos/100/100?random=u4",isHost:!1,isListening:!0}]),l=h([{id:1,userName:"",avatar:"https://picsum.photos/100/100?random=u2",text:"",time:"14:20",isSelf:!1},{id:2,userName:"",avatar:"https://picsum.photos/100/100?random=u1",text:"",time:"14:21",isSelf:!0},{id:3,userName:"",avatar:"https://picsum.photos/100/100?random=u3",text:"",time:"14:22",isSelf:!1}]),i=h(""),r=h(null),c=tt(()=>s.duration?s.currentTime/s.duration*100:0),d=()=>{Pt.togglePlay()},u=()=>{Pt.previous()},v=()=>{Pt.next()},b=x=>{const S=x.currentTarget.getBoundingClientRect(),T=(x.clientX-S.left)/S.width*s.duration;Pt.seek(T)},w=x=>Pt.formatTime(x),I=x=>{if(!x)return"0";const S=Math.floor(x/3600),M=Math.floor(x%3600/60);return S>0?`${S}${M}`:`${M}`},j=()=>{if(!i.value.trim())return;const x={id:Date.now(),userName:"",avatar:"https://picsum.photos/100/100?random=u1",text:i.value,time:new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),isSelf:!0};l.value.push(x),i.value="",Yt(()=>{r.value&&(r.value.scrollTop=r.value.scrollHeight)})},$=()=>{navigator.clipboard.writeText(o.value).then(()=>{alert("")})};return it(()=>{if(s.listenTogether.isActive||Pt.startListenTogether({name:""}),!s.currentSong){const x={id:1,title:"",artist:"",cover:"https://picsum.photos/400/400?random=1",duration:269,url:""};Pt.playSong(x)}}),zt(()=>{}),(x,S)=>{var M,A,T,G;return p(),f("div",ex,[e("div",tx,[e("button",{class:"back-btn",onClick:S[0]||(S[0]=K=>x.$emit("back"))},[...S[6]||(S[6]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M19 12H5M12 19l-7-7 7-7","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]),S[8]||(S[8]=e("h1",{class:"title"},"",-1)),e("button",{class:"invite-btn",onClick:S[1]||(S[1]=K=>n.value=!0)},[...S[7]||(S[7]=[mt('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-771bdb6b><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-771bdb6b></path><circle cx="8.5" cy="7" r="4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-771bdb6b></circle><line x1="20" y1="8" x2="20" y2="14" stroke-width="2" stroke-linecap="round" data-v-771bdb6b></line><line x1="23" y1="11" x2="17" y2="11" stroke-width="2" stroke-linecap="round" data-v-771bdb6b></line></svg>',1)])])]),e("div",sx,[e("div",ox,": "+_(o.value),1),e("div",nx,[S[9]||(S[9]=e("span",{class:"dot"},null,-1)),ot(" "+_(a.value.length)+"  ",1)]),Ke(s).listenTogether.isActive?(p(),f("div",ax," : "+_(I(Ke(s).listenTogether.elapsedTime)),1)):N("",!0)]),e("div",lx,[e("div",ix,[e("div",{class:Se(["album-cover",{rotating:Ke(s).isPlaying}])},[e("img",{src:((M=Ke(s).currentSong)==null?void 0:M.cover)||"https://picsum.photos/400/400?random=1",alt:(A=Ke(s).currentSong)==null?void 0:A.title},null,8,rx)],2),S[10]||(S[10]=e("div",{class:"vinyl-effect"},null,-1))]),e("div",cx,[e("h2",dx,_(((T=Ke(s).currentSong)==null?void 0:T.title)||""),1),e("p",ux,_(((G=Ke(s).currentSong)==null?void 0:G.artist)||""),1)]),e("div",vx,[e("span",px,_(w(Ke(s).currentTime)),1),e("div",{class:"progress-bar",onClick:b},[e("div",{class:"progress-fill",style:Oe({width:c.value+"%"})},null,4),e("div",{class:"progress-thumb",style:Oe({left:c.value+"%"})},null,4)]),e("span",fx,_(w(Ke(s).duration)),1)]),e("div",mx,[e("button",{class:"control-btn",onClick:u},[...S[11]||(S[11]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("polygon",{points:"19 20 9 12 19 4 19 20","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("line",{x1:"5",y1:"19",x2:"5",y2:"5","stroke-width":"2","stroke-linecap":"round"})],-1)])]),e("button",{class:"control-btn play-btn",onClick:d},[Ke(s).isPlaying?(p(),f("svg",gx,[...S[12]||(S[12]=[e("rect",{x:"6",y:"4",width:"4",height:"16","stroke-width":"2","stroke-linecap":"round"},null,-1),e("rect",{x:"14",y:"4",width:"4",height:"16","stroke-width":"2","stroke-linecap":"round"},null,-1)])])):(p(),f("svg",hx,[...S[13]||(S[13]=[e("polygon",{points:"5 3 19 12 5 21 5 3","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])]))]),e("button",{class:"control-btn",onClick:v},[...S[14]||(S[14]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("polygon",{points:"5 4 15 12 5 20 5 4","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("line",{x1:"19",y1:"5",x2:"19",y2:"19","stroke-width":"2","stroke-linecap":"round"})],-1)])])])]),e("div",yx,[S[15]||(S[15]=e("h3",{class:"section-title"},"",-1)),e("div",bx,[(p(!0),f(Le,null,Fe(a.value,K=>(p(),f("div",{key:K.id,class:"user-item"},[e("div",wx,[e("img",{src:K.avatar,alt:K.name},null,8,kx),K.isHost?(p(),f("span",xx,"")):N("",!0)]),e("div",Cx,[e("div",$x,_(K.name),1),e("div",{class:Se(["user-status",{listening:K.isListening}])},_(K.isListening?"":""),3)])]))),128))])]),e("div",_x,[S[17]||(S[17]=e("h3",{class:"section-title"},"",-1)),e("div",{class:"chat-messages",ref_key:"chatMessages",ref:r},[(p(!0),f(Le,null,Fe(l.value,K=>(p(),f("div",{key:K.id,class:Se(["message-item",{self:K.isSelf}])},[e("img",{src:K.avatar,alt:K.userName,class:"message-avatar"},null,8,Mx),e("div",Sx,[e("div",Ax,_(K.userName),1),e("div",Ix,_(K.text),1),e("div",Lx,_(K.time),1)])],2))),128))],512),e("div",Tx,[ke(e("input",{"onUpdate:modelValue":S[2]||(S[2]=K=>i.value=K),type:"text",placeholder:"...",class:"chat-input",onKeyup:ns(j,["enter"])},null,544),[[je,i.value]]),e("button",{class:"send-btn",onClick:j,disabled:!i.value.trim()},[...S[16]||(S[16]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("line",{x1:"22",y1:"2",x2:"11",y2:"13","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("polygon",{points:"22 2 15 22 11 13 2 9 22 2","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,jx)])]),n.value?(p(),f("div",{key:0,class:"modal-overlay",onClick:S[5]||(S[5]=K=>n.value=!1)},[e("div",{class:"modal-content",onClick:S[4]||(S[4]=Pe(()=>{},["stop"]))},[S[19]||(S[19]=e("h3",{class:"modal-title"},"",-1)),e("div",Px,[S[18]||(S[18]=e("div",{class:"code-label"},"",-1)),e("div",Ex,_(o.value),1)]),S[20]||(S[20]=e("div",{class:"qr-code"},[e("div",{class:"qr-placeholder"},"")],-1)),e("button",{class:"copy-btn",onClick:$},"  "),e("button",{class:"close-btn",onClick:S[3]||(S[3]=K=>n.value=!1)},"")])])):N("",!0)])}}},Vx=Xe(Bx,[["__scopeId","data-v-771bdb6b"]]),Tl=["https://files.catbox.moe/0g3kqu.jpg","https://files.catbox.moe/d5b7k6.jpg","https://files.catbox.moe/0yrhh6.jpg","https://files.catbox.moe/8mjvdg.jpg","https://files.catbox.moe/fvidas.jpg","https://files.catbox.moe/q6so2i.jpg","https://files.catbox.moe/5a96cp.jpg","https://files.catbox.moe/0mp6h0.jpg","https://files.catbox.moe/epcn03.jpg","https://files.catbox.moe/7jzdp7.jpg","https://files.catbox.moe/jrmu6w.jpg","https://files.catbox.moe/c0bwhn.jpg","https://files.catbox.moe/0blxme.jpg","https://files.catbox.moe/qicobr.jpg","https://files.catbox.moe/n94ztu.jpg"];function zo(){return Tl[Math.floor(Math.random()*Tl.length)]}const Dx={class:"header"},Hx={class:"title"},Fx={class:"playlist-info"},Ux=["src","alt"],Rx={class:"playlist-details"},Nx={class:"playlist-name"},Ox={class:"playlist-creator"},zx={class:"playlist-desc"},Kx={class:"playlist-stats"},Wx={class:"action-buttons"},Gx={viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},qx=["fill"],Zx={class:"search-section"},Jx={class:"search-box"},Yx={class:"songs-section"},Xx={class:"section-header"},Qx={class:"songs-list"},eC=["onClick"],tC={class:"song-index"},sC={class:"song-cover"},oC=["src","alt"],nC={key:0,class:"playing-indicator"},aC={class:"song-info"},lC={class:"song-title"},iC={class:"song-artist"},rC=["onClick"],cC={class:"menu-header"},dC={class:"menu-header"},uC={class:"form-group"},vC={class:"form-group"},pC={class:"form-group"},fC={class:"modal-buttons"},mC={class:"form-group"},gC={class:"form-group"},hC={class:"form-group"},yC={class:"cover-upload-section"},bC=["src"],wC={class:"modal-buttons"},kC={__name:"PlaylistManager",props:{playlistId:{type:Number,required:!0}},emits:["back","navigate","play-song"],setup(t,{emit:s}){const o=t,n=s,a=qo,l=h(!1),i=h(!1),r=h(!1),c=h(!1),d=h(!1),u=h(null),v=h(-1),b=h(""),w=h(null),I=h(null),j=h(null),$=h({wallpaper:"https://picsum.photos/1080/1920?random=33",uiColor:"#000000",opacity:.4,textColor:"#ffffff"}),x=h({id:null,name:"",creator:"",description:"",cover:"",playCount:0,isCollected:!1,songs:[]}),S=h({name:"",description:"",cover:""}),M=h({title:"",artist:"",cover:""}),A=k=>{const y=parseInt(k.slice(1,3),16),H=parseInt(k.slice(3,5),16),se=parseInt(k.slice(5,7),16);return`${y}, ${H}, ${se}`},T=tt(()=>({backgroundColor:`rgba(${A($.value.uiColor)}, ${$.value.opacity})`,color:$.value.textColor,"--text-color":$.value.textColor})),G=async()=>{try{const k=await ft.getUserConfig();$.value={wallpaper:k.wallpaper,uiColor:k.uiColor,opacity:k.opacity,textColor:k.textColor}}catch(k){console.error(":",k)}},K=async()=>{try{const k=await ft.getPlaylist(o.playlistId);if(k){const y=await ft.getSongsInPlaylist(o.playlistId);x.value={...k,songs:y}}}catch(k){console.error(":",k)}},q=()=>{var k;(k=w.value)==null||k.click()},ee=async k=>{const y=k.target.files[0];if(y){const H=URL.createObjectURL(y);try{await ft.updatePlaylist(o.playlistId,{cover:H}),x.value.cover=H}catch(se){console.error(":",se),alert("")}}};it(()=>{G(),K()}),Ft(()=>o.playlistId,()=>{K()});const Z=async()=>{if(x.value.songs.length!==0){Pt.setPlaylist(x.value.songs,0),console.log("");try{await ft.incrementPlayCount(o.playlistId),x.value.playCount++}catch(k){console.error(":",k)}}},E=k=>{const y=x.value.songs[k];Pt.setPlaylist(x.value.songs,k),n("play-song",y),console.log(":",y.title)},m=()=>{n("navigate","music-add",o.playlistId)},g=async()=>{try{await ft.updatePlaylist(o.playlistId,{isCollected:!x.value.isCollected}),x.value.isCollected=!x.value.isCollected}catch(k){console.error(":",k)}},D=()=>{console.log("")},W=()=>{S.value={name:x.value.name,description:x.value.description,cover:x.value.cover},l.value=!1,c.value=!0},te=async()=>{try{await ft.updatePlaylist(o.playlistId,{name:S.value.name,description:S.value.description,cover:S.value.cover}),x.value.name=S.value.name,x.value.description=S.value.description,x.value.cover=S.value.cover,c.value=!1}catch(k){console.error(":",k),alert("")}},R=async()=>{if(confirm(""))try{await ft.deletePlaylist(o.playlistId),l.value=!1,n("back")}catch(k){console.error(":",k),alert("")}l.value=!1},F=(k,y)=>{u.value=k,v.value=y,i.value=!0},ie=()=>{console.log(":",u.value.title),i.value=!1},re=()=>{console.log(""),i.value=!1},pe=async()=>{if(confirm(`${u.value.title}`))try{await ft.deleteSongFromPlaylist(u.value.id),x.value.songs.splice(v.value,1)}catch(k){console.error(":",k),alert("")}i.value=!1},we=()=>{var k;i.value=!1,(k=j.value)==null||k.click()},he=async k=>{const y=k.target.files[0];if(y)try{const H=new FileReader;H.onload=async se=>{const P=se.target.result,O=(await Kt(async()=>{const{db:Q}=await Promise.resolve().then(()=>is);return{db:Q}},void 0).then(({db:Q})=>Q.getSetting("musicSongs"))).map(Q=>Q.id===u.value.id?{...Q,lyrics:P}:Q);await Kt(async()=>{const{db:Q}=await Promise.resolve().then(()=>is);return{db:Q}},void 0).then(({db:Q})=>Q.setSetting("musicSongs",O)),v.value!==-1&&(x.value.songs[v.value]={...x.value.songs[v.value],lyrics:P}),alert("")},H.readAsText(y)}catch(H){console.error(":",H),alert("")}k.target.value=""},Ue=()=>{M.value={title:u.value.title,artist:u.value.artist,cover:u.value.cover},i.value=!1,d.value=!0},ge=()=>{var k;(k=I.value)==null||k.click()},B=async k=>{const y=k.target.files[0];if(y){const H=new FileReader;H.onload=se=>{M.value.cover=se.target.result},H.readAsDataURL(y)}},L=async()=>{try{const k=await ft.getSongsInPlaylist(o.playlistId),y=k.findIndex(H=>H.id===u.value.id);if(y!==-1){k[y]={...k[y],title:M.value.title,artist:M.value.artist,cover:M.value.cover};const H=await ft.getUserConfig().then(()=>ft.getSongsInPlaylist(o.playlistId)),P=(await Kt(async()=>{const{db:U}=await Promise.resolve().then(()=>is);return{db:U}},void 0).then(({db:U})=>U.getSetting("musicSongs"))).map(U=>U.id===u.value.id?{...U,title:M.value.title,artist:M.value.artist,cover:M.value.cover}:U);await Kt(async()=>{const{db:U}=await Promise.resolve().then(()=>is);return{db:U}},void 0).then(({db:U})=>U.setSetting("musicSongs",P)),x.value.songs[v.value]={...x.value.songs[v.value],title:M.value.title,artist:M.value.artist,cover:M.value.cover},d.value=!1,alert("")}}catch(k){console.error(":",k),alert("")}};return(k,y)=>{var H;return p(),f("div",{class:"playlist-manager",style:Oe({backgroundImage:`url(${$.value.wallpaper})`})},[e("div",{class:"ui-overlay",style:Oe(T.value)},[e("div",Dx,[e("button",{class:"back-btn",onClick:y[0]||(y[0]=se=>k.$emit("back"))},[...y[20]||(y[20]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M19 12H5M12 19l-7-7 7-7","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]),e("h1",Hx,_(x.value.name),1),e("button",{class:"more-btn",onClick:y[1]||(y[1]=se=>l.value=!0)},[...y[21]||(y[21]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("circle",{cx:"12",cy:"12",r:"1",fill:"currentColor"}),e("circle",{cx:"12",cy:"5",r:"1",fill:"currentColor"}),e("circle",{cx:"12",cy:"19",r:"1",fill:"currentColor"})],-1)])])]),e("div",Fx,[e("div",{class:"playlist-cover",onClick:q},[e("img",{src:x.value.cover||Ke(zo)(),alt:x.value.name},null,8,Ux),y[23]||(y[23]=mt('<div class="cover-overlay" data-v-e0072a51><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-e0072a51><rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke-width="2" data-v-e0072a51></rect><circle cx="8.5" cy="8.5" r="1.5" stroke-width="2" data-v-e0072a51></circle><polyline points="21 15 16 10 5 21" stroke-width="2" data-v-e0072a51></polyline></svg><span data-v-e0072a51></span></div>',1)),e("button",{class:"play-all-btn",onClick:Pe(Z,["stop"])},[...y[22]||(y[22]=[e("svg",{viewBox:"0 0 24 24",fill:"white"},[e("polygon",{points:"8 5 19 12 8 19 8 5"})],-1)])])]),e("input",{type:"file",ref_key:"coverInput",ref:w,style:{display:"none"},accept:"image/*",onChange:ee},null,544),e("input",{type:"file",ref_key:"lyricsInput",ref:j,style:{display:"none"},accept:".lrc,.txt",onChange:he},null,544),e("div",Rx,[e("h2",Nx,_(x.value.name),1),e("p",Ox,": "+_(x.value.creator),1),e("p",zx,_(x.value.description),1),e("div",Kx,[e("span",null,_(x.value.songs.length)+" ",1),e("span",null," "+_(x.value.playCount)+" ",1)])])]),e("div",Wx,[e("button",{class:"action-btn",onClick:m},[...y[24]||(y[24]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19","stroke-width":"2","stroke-linecap":"round"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12","stroke-width":"2","stroke-linecap":"round"})],-1),e("span",null,"",-1)])]),e("button",{class:"action-btn",onClick:g},[(p(),f("svg",Gx,[e("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z",fill:x.value.isCollected?"currentColor":"none","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,8,qx)])),e("span",null,_(x.value.isCollected?"":""),1)]),e("button",{class:"action-btn",onClick:D},[...y[25]||(y[25]=[mt('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-e0072a51><circle cx="18" cy="5" r="3" stroke-width="2" data-v-e0072a51></circle><circle cx="6" cy="12" r="3" stroke-width="2" data-v-e0072a51></circle><circle cx="18" cy="19" r="3" stroke-width="2" data-v-e0072a51></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49" stroke-width="2" data-v-e0072a51></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49" stroke-width="2" data-v-e0072a51></line></svg><span data-v-e0072a51></span>',2)])])]),e("div",Zx,[e("div",Jx,[y[27]||(y[27]=e("svg",{class:"search-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("circle",{cx:"11",cy:"11",r:"8","stroke-width":"2"}),e("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65","stroke-width":"2","stroke-linecap":"round"})],-1)),ke(e("input",{"onUpdate:modelValue":y[2]||(y[2]=se=>b.value=se),type:"text",placeholder:"",class:"search-input"},null,512),[[je,b.value]]),b.value?(p(),f("button",{key:0,class:"clear-btn",onClick:y[3]||(y[3]=se=>b.value="")},[...y[26]||(y[26]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18","stroke-width":"2"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18","stroke-width":"2"})],-1)])])):N("",!0)])]),e("div",Yx,[e("div",Xx,[y[29]||(y[29]=e("h3",null,"",-1)),e("button",{class:"sort-btn",onClick:y[4]||(y[4]=se=>r.value=!0)},[...y[28]||(y[28]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("line",{x1:"3",y1:"6",x2:"21",y2:"6","stroke-width":"2","stroke-linecap":"round"}),e("line",{x1:"3",y1:"12",x2:"21",y2:"12","stroke-width":"2","stroke-linecap":"round"}),e("line",{x1:"3",y1:"18",x2:"21",y2:"18","stroke-width":"2","stroke-linecap":"round"})],-1)])])]),e("div",Qx,[(p(!0),f(Le,null,Fe(x.value.songs,(se,P)=>{var U;return p(),f("div",{key:se.id,class:"song-item",onClick:O=>E(P)},[e("div",tC,_(P+1),1),e("div",sC,[e("img",{src:se.cover||Ke(zo)(),alt:se.title},null,8,oC),((U=Ke(a).currentSong)==null?void 0:U.id)===se.id&&Ke(a).isPlaying?(p(),f("div",nC,[...y[30]||(y[30]=[e("div",{class:"bar"},null,-1),e("div",{class:"bar"},null,-1),e("div",{class:"bar"},null,-1)])])):N("",!0)]),e("div",aC,[e("div",lC,_(se.title),1),e("div",iC,_(se.artist),1)]),e("button",{class:"song-more-btn",onClick:Pe(O=>F(se,P),["stop"])},[...y[31]||(y[31]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("circle",{cx:"12",cy:"12",r:"1",fill:"currentColor"}),e("circle",{cx:"19",cy:"12",r:"1",fill:"currentColor"}),e("circle",{cx:"5",cy:"12",r:"1",fill:"currentColor"})],-1)])],8,rC)],8,eC)}),128))])]),l.value?(p(),f("div",{key:0,class:"menu-overlay",onClick:y[5]||(y[5]=se=>l.value=!1)})):N("",!0),e("div",{class:Se(["menu-panel",{active:l.value}])},[e("div",cC,[y[32]||(y[32]=e("h3",null,"",-1)),e("button",{onClick:y[6]||(y[6]=se=>l.value=!1)},"")]),e("div",{class:"menu-items"},[e("div",{class:"menu-item",onClick:W},[...y[33]||(y[33]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7","stroke-width":"2"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z","stroke-width":"2"})],-1),e("span",null,"",-1)])]),e("div",{class:"menu-item",onClick:R},[...y[34]||(y[34]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("polyline",{points:"3 6 5 6 21 6","stroke-width":"2"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2","stroke-width":"2"})],-1),e("span",null,"",-1)])])])],2),i.value?(p(),f("div",{key:1,class:"menu-overlay",onClick:y[7]||(y[7]=se=>i.value=!1)})):N("",!0),e("div",{class:Se(["menu-panel",{active:i.value}])},[e("div",dC,[e("h3",null,_((H=u.value)==null?void 0:H.title),1),e("button",{onClick:y[8]||(y[8]=se=>i.value=!1)},"")]),e("div",{class:"menu-items"},[e("div",{class:"menu-item",onClick:we},[...y[35]||(y[35]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M9 18V5l12-2v13","stroke-width":"2"}),e("circle",{cx:"6",cy:"18",r:"3","stroke-width":"2"}),e("circle",{cx:"18",cy:"16",r:"3","stroke-width":"2"})],-1),e("span",null,"",-1)])]),e("div",{class:"menu-item",onClick:Ue},[...y[36]||(y[36]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7","stroke-width":"2"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z","stroke-width":"2"})],-1),e("span",null,"",-1)])]),e("div",{class:"menu-item",onClick:ie},[...y[37]||(y[37]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4","stroke-width":"2"}),e("polyline",{points:"7 10 12 15 17 10","stroke-width":"2"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3","stroke-width":"2"})],-1),e("span",null,"",-1)])]),e("div",{class:"menu-item",onClick:re},[...y[38]||(y[38]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z","stroke-width":"2"})],-1),e("span",null,"",-1)])]),e("div",{class:"menu-item danger",onClick:pe},[...y[39]||(y[39]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18","stroke-width":"2"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18","stroke-width":"2"})],-1),e("span",null,"",-1)])])])],2),c.value?(p(),f("div",{key:2,class:"modal-overlay",onClick:y[14]||(y[14]=se=>c.value=!1)},[e("div",{class:"modal-content",onClick:y[13]||(y[13]=Pe(()=>{},["stop"]))},[y[43]||(y[43]=e("h3",{class:"modal-title"},"",-1)),e("div",uC,[y[40]||(y[40]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":y[9]||(y[9]=se=>S.value.name=se),type:"text",class:"form-input",placeholder:""},null,512),[[je,S.value.name]])]),e("div",vC,[y[41]||(y[41]=e("label",null,"",-1)),ke(e("textarea",{"onUpdate:modelValue":y[10]||(y[10]=se=>S.value.description=se),class:"form-textarea",placeholder:""},null,512),[[je,S.value.description]])]),e("div",pC,[y[42]||(y[42]=e("label",null,"URL",-1)),ke(e("input",{"onUpdate:modelValue":y[11]||(y[11]=se=>S.value.cover=se),type:"text",class:"form-input",placeholder:"URL"},null,512),[[je,S.value.cover]])]),e("div",fC,[e("button",{class:"modal-btn cancel-btn",onClick:y[12]||(y[12]=se=>c.value=!1)},""),e("button",{class:"modal-btn confirm-btn",onClick:te},"")])])])):N("",!0),d.value?(p(),f("div",{key:3,class:"modal-overlay",onClick:y[19]||(y[19]=se=>d.value=!1)},[e("div",{class:"modal-content",onClick:y[18]||(y[18]=Pe(()=>{},["stop"]))},[y[48]||(y[48]=e("h3",{class:"modal-title"},"",-1)),e("div",mC,[y[44]||(y[44]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":y[15]||(y[15]=se=>M.value.title=se),type:"text",class:"form-input",placeholder:""},null,512),[[je,M.value.title]])]),e("div",gC,[y[45]||(y[45]=e("label",null,"",-1)),ke(e("input",{"onUpdate:modelValue":y[16]||(y[16]=se=>M.value.artist=se),type:"text",class:"form-input",placeholder:""},null,512),[[je,M.value.artist]])]),e("div",hC,[y[47]||(y[47]=e("label",null,"",-1)),e("div",yC,[e("div",{class:"current-cover",onClick:ge},[e("img",{src:M.value.cover,alt:""},null,8,bC),y[46]||(y[46]=mt('<div class="cover-upload-overlay" data-v-e0072a51><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-e0072a51><rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke-width="2" data-v-e0072a51></rect><circle cx="8.5" cy="8.5" r="1.5" stroke-width="2" data-v-e0072a51></circle><polyline points="21 15 16 10 5 21" stroke-width="2" data-v-e0072a51></polyline></svg><span data-v-e0072a51></span></div>',1))]),e("input",{type:"file",ref_key:"songCoverInput",ref:I,style:{display:"none"},accept:"image/*",onChange:B},null,544)])]),e("div",wC,[e("button",{class:"modal-btn cancel-btn",onClick:y[17]||(y[17]=se=>d.value=!1)},""),e("button",{class:"modal-btn confirm-btn",onClick:L},"")])])])):N("",!0)],4)],4)}}},xC=Xe(kC,[["__scopeId","data-v-e0072a51"]]),CC={class:"header"},$C={class:"tabs"},_C={class:"content"},MC={key:0,class:"tab-content"},SC={class:"search-box"},AC=["disabled"],IC={key:0,class:"loading"},LC={key:1,class:"results-list"},TC={class:"song-cover"},jC=["src","alt"],PC={class:"song-info"},EC={class:"song-name"},BC={key:0,class:"vip-badge"},VC={class:"song-artist"},DC=["onClick","disabled"],HC={key:1,class:"disabled-text"},FC={key:2,class:"empty-state"},UC={key:1,class:"tab-content"},RC={class:"input-group"},NC=["disabled"],OC={key:0,class:"loading"},zC={key:1,class:"import-preview"},KC={class:"preview-header"},WC={class:"results-list"},GC={class:"song-cover"},qC=["src","alt"],ZC={class:"song-info"},JC={class:"song-name"},YC={class:"song-artist"},XC={key:2,class:"tab-content"},QC={key:0,class:"uploaded-list"},e$=["onClick"],t$=["src","alt"],s$={key:1,class:"cover-placeholder"},o$={class:"file-info"},n$={class:"file-title"},a$={class:"file-artist"},l$={class:"file-meta"},i$={key:0},r$={key:1,class:"has-lyrics"},c$={key:2,class:"has-cover"},d$={class:"file-actions"},u$=["onClick"],v$=["onClick"],p$=["onClick"],f$={__name:"musicadd",props:{playlistId:{type:Number,required:!0}},emits:["back","songAdded"],setup(t,{emit:s}){const o=t,n=s,a=["https://netease-cloud-music-api-psi-ten.vercel.app","https://netease-cloud-music-api-gilt-five.vercel.app","https://netease-cloud-music-api-dusky-ten.vercel.app","https://netease-cloud-music-api-pi-wine.vercel.app"];let l=0;const i=h(a[0]),r=()=>{l=(l+1)%a.length,i.value=a[l],console.log("API:",i.value)},c=h({wallpaper:"https://picsum.photos/1080/1920?random=33",uiColor:"#000000",opacity:.4,textColor:"#ffffff"}),d=h("search"),u=h(""),v=h(!1),b=h([]),w=h([]),I=h(""),j=h(!1),$=h([]),x=h(null),S=h(null),M=h(null),A=h([]),T=h(-1),G=B=>{const L=parseInt(B.slice(1,3),16),k=parseInt(B.slice(3,5),16),y=parseInt(B.slice(5,7),16);return`${L}, ${k}, ${y}`},K=tt(()=>({backgroundColor:`rgba(${G(c.value.uiColor)}, ${c.value.opacity})`,color:c.value.textColor})),q=async()=>{try{const B=await ft.getUserConfig();c.value={wallpaper:B.wallpaper,uiColor:B.uiColor,opacity:B.opacity,textColor:B.textColor}}catch(B){console.error(":",B)}},ee=async()=>{if(u.value.trim()){v.value=!0;for(let B=0;B<a.length;B++)try{console.log("API:",i.value);const L=await fetch(`${i.value}/cloudsearch?keywords=${encodeURIComponent(u.value)}`,{mode:"cors",headers:{Accept:"application/json"}});if(!L.ok)throw new Error("API");const k=await L.json();if(k.result&&k.result.songs){b.value=k.result.songs,v.value=!1;return}else{b.value=[],alert(""),v.value=!1;return}}catch(L){console.error("API:",i.value,L),B<a.length-1&&r()}v.value=!1,alert(`API 


1. 
2. 
3. `)}},Z=async B=>{w.value.push(B.id);try{const k=await(await fetch(`${i.value}/song/url?id=${B.id}`,{mode:"cors",headers:{Accept:"application/json"}})).json();if(k.data&&k.data[0]&&k.data[0].url){const y={title:B.name,artist:B.ar.map(H=>H.name).join(" / "),cover:B.al.picUrl,duration:Math.floor(B.dt/1e3),url:k.data[0].url};await ft.addSongToPlaylist(o.playlistId,y),n("songAdded"),alert("")}else alert("VIP")}catch(L){console.error(":",L),alert("")}finally{w.value=w.value.filter(L=>L!==B.id)}},E=async()=>{if(!I.value.trim())return;let B=I.value.trim();const L=I.value.match(/id=(\d+)/);L&&(B=L[1]),j.value=!0;try{const k=await fetch(`${i.value}/playlist/detail?id=${B}`,{mode:"cors",headers:{Accept:"application/json"}});if(!k.ok)throw new Error("API");const y=await k.json();y.playlist&&y.playlist.tracks?($.value=y.playlist.tracks.filter(H=>H.fee!==1),$.value.length===0&&alert("")):alert("ID")}catch(k){console.error(":",k),alert(`API


1. ID
2. 
3. `)}finally{j.value=!1}},m=async()=>{if($.value.length===0)return;const B=$.value.length;let L=0;for(const k of $.value)try{const H=await(await fetch(`${i.value}/song/url?id=${k.id}`,{mode:"cors",headers:{Accept:"application/json"}})).json();if(H.data&&H.data[0]&&H.data[0].url){const se={title:k.name,artist:k.ar.map(P=>P.name).join(" / "),cover:k.al.picUrl,duration:Math.floor(k.dt/1e3),url:H.data[0].url};await ft.addSongToPlaylist(o.playlistId,se),L++}}catch(y){console.error(":",k.name,y)}n("songAdded"),alert(` ${L}/${B} `),$.value=[],I.value=""},g=()=>{var B;(B=x.value)==null||B.click()},D=async B=>{const L=Array.from(B.target.files);for(const k of L)try{const y=await W(k);A.value.push({file:k,name:k.name,size:k.size,title:y.title||k.name.replace(/\.[^/.]+$/,""),artist:y.artist||"",album:y.album||"",cover:y.cover||zo(),customCover:null,duration:y.duration||0,lyrics:"",url:URL.createObjectURL(k)})}catch(y){console.error(":",k.name,y)}B.target.value=""},W=B=>new Promise(L=>{const k=new Audio,y=URL.createObjectURL(B);k.addEventListener("loadedmetadata",()=>{const H=B.name.replace(/\.[^/.]+$/,"");let se=H,P="";if(H.includes(" - ")){const U=H.split(" - ");P=U[0].trim(),se=U[1].trim()}else if(H.includes("-")){const U=H.split("-");P=U[0].trim(),se=U[1].trim()}L({title:se,artist:P,album:"",cover:"",duration:Math.floor(k.duration)}),URL.revokeObjectURL(y)}),k.addEventListener("error",()=>{L({title:B.name.replace(/\.[^/.]+$/,""),artist:"",album:"",cover:"",duration:0}),URL.revokeObjectURL(y)}),k.src=y}),te=B=>{var L;T.value=B,(L=S.value)==null||L.click()},R=async B=>{const L=B.target.files[0];if(!(!L||T.value===-1)){try{const k=await L.text();A.value[T.value].lyrics=k,alert("")}catch(k){console.error(":",k),alert("")}B.target.value="",T.value=-1}},F=B=>{var L;T.value=B,(L=M.value)==null||L.click()},ie=async B=>{const L=B.target.files[0];if(!(!L||T.value===-1)){try{const k=await ge(L);A.value[T.value].customCover=k,alert("")}catch(k){console.error(":",k),alert("")}B.target.value="",T.value=-1}},re=B=>{const L=A.value[B],k=prompt(":",L.title);k!==null&&(L.title=k.trim()||L.title);const y=prompt(":",L.artist);y!==null&&(L.artist=y.trim()||L.artist)},pe=B=>{A.value.splice(B,1)},we=B=>B<1024?B+" B":B<1024*1024?(B/1024).toFixed(2)+" KB":(B/(1024*1024)).toFixed(2)+" MB",he=B=>{const L=Math.floor(B/60),k=Math.floor(B%60);return`${L}:${k.toString().padStart(2,"0")}`},Ue=async()=>{if(A.value.length===0)return;let B=0;const L=A.value.length,k=` 0/${L} ...`;console.log(k);for(let y=0;y<A.value.length;y++){const H=A.value[y];try{const se=await ge(H.file);let P=H.customCover||H.cover||zo();const U={title:H.title,artist:H.artist,cover:P,duration:H.duration,url:se,lyrics:H.lyrics||""};await ft.addSongToPlaylist(o.playlistId,U),B++,console.log(` ${B}/${L}: ${H.title}`)}catch(se){console.error(":",H.name,se)}}n("songAdded"),alert(` ${B}/${L} 

 Base64 `),A.value=[]},ge=B=>new Promise((L,k)=>{const y=new FileReader;y.onload=()=>L(y.result),y.onerror=k,y.readAsDataURL(B)});return it(()=>{q()}),(B,L)=>(p(),f("div",{class:"music-add",style:Oe({backgroundImage:`url(${c.value.wallpaper})`})},[e("div",{class:"ui-overlay",style:Oe(K.value)},[e("div",CC,[e("button",{class:"back-btn",onClick:L[0]||(L[0]=k=>B.$emit("back"))},[...L[6]||(L[6]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M19 12H5M12 19l-7-7 7-7","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]),L[7]||(L[7]=e("h1",{class:"title"},"",-1)),L[8]||(L[8]=e("div",{class:"placeholder"},null,-1))]),e("div",$C,[e("div",{class:Se(["tab-item",{active:d.value==="search"}]),onClick:L[1]||(L[1]=k=>d.value="search")},[...L[9]||(L[9]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("circle",{cx:"11",cy:"11",r:"8","stroke-width":"2"}),e("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65","stroke-width":"2"})],-1),e("span",null,"",-1)])],2),e("div",{class:Se(["tab-item",{active:d.value==="playlist"}]),onClick:L[2]||(L[2]=k=>d.value="playlist")},[...L[10]||(L[10]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z","stroke-width":"2"})],-1),e("span",null,"",-1)])],2),e("div",{class:Se(["tab-item",{active:d.value==="upload"}]),onClick:L[3]||(L[3]=k=>d.value="upload")},[...L[11]||(L[11]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4","stroke-width":"2"}),e("polyline",{points:"17 8 12 3 7 8","stroke-width":"2"}),e("line",{x1:"12",y1:"3",x2:"12",y2:"15","stroke-width":"2"})],-1),e("span",null,"",-1)])],2)]),e("div",_C,[d.value==="search"?(p(),f("div",MC,[e("div",SC,[L[12]||(L[12]=e("svg",{class:"search-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("circle",{cx:"11",cy:"11",r:"8","stroke-width":"2"}),e("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65","stroke-width":"2"})],-1)),ke(e("input",{"onUpdate:modelValue":L[4]||(L[4]=k=>u.value=k),type:"text",placeholder:"",class:"search-input",onKeyup:ns(ee,["enter"])},null,544),[[je,u.value]]),e("button",{class:"search-btn",onClick:ee,disabled:v.value},_(v.value?"...":""),9,AC)]),v.value?(p(),f("div",IC,[...L[13]||(L[13]=[e("div",{class:"spinner"},null,-1),e("p",null,"...",-1)])])):b.value.length>0?(p(),f("div",LC,[(p(!0),f(Le,null,Fe(b.value,k=>(p(),f("div",{key:k.id,class:Se(["song-item",{disabled:k.fee===1}])},[e("div",TC,[e("img",{src:k.al.picUrl+"?param=100y100",alt:k.name},null,8,jC)]),e("div",PC,[e("div",EC,[ot(_(k.name)+" ",1),k.fee===1?(p(),f("span",BC,"VIP")):N("",!0)]),e("div",VC,_(k.ar.map(y=>y.name).join(" / ")),1)]),k.fee!==1?(p(),f("button",{key:0,class:"add-btn",onClick:y=>Z(k),disabled:w.value.includes(k.id)},_(w.value.includes(k.id)?"...":""),9,DC)):(p(),f("span",HC,"VIP"))],2))),128))])):u.value&&!v.value?(p(),f("div",FC,[...L[14]||(L[14]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("circle",{cx:"11",cy:"11",r:"8","stroke-width":"2"}),e("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65","stroke-width":"2"})],-1),e("p",null,"",-1)])])):N("",!0)])):N("",!0),d.value==="playlist"?(p(),f("div",UC,[e("div",RC,[L[15]||(L[15]=e("label",null,"ID",-1)),ke(e("input",{"onUpdate:modelValue":L[5]||(L[5]=k=>I.value=k),type:"text",placeholder:": 7452421450 ",class:"text-input"},null,512),[[je,I.value]]),e("button",{class:"primary-btn",onClick:E,disabled:j.value},_(j.value?"...":""),9,NC)]),j.value?(p(),f("div",OC,[...L[16]||(L[16]=[e("div",{class:"spinner"},null,-1),e("p",null,"...",-1)])])):$.value.length>0?(p(),f("div",zC,[e("div",KC,[L[17]||(L[17]=e("h3",null,"",-1)),e("p",null," "+_($.value.length)+" VIP",1)]),e("div",WC,[(p(!0),f(Le,null,Fe($.value,k=>(p(),f("div",{key:k.id,class:"song-item"},[e("div",GC,[e("img",{src:k.al.picUrl+"?param=100y100",alt:k.name},null,8,qC)]),e("div",ZC,[e("div",JC,_(k.name),1),e("div",YC,_(k.ar.map(y=>y.name).join(" / ")),1)])]))),128))]),e("button",{class:"primary-btn full-width",onClick:m},"  ")])):N("",!0)])):N("",!0),d.value==="upload"?(p(),f("div",XC,[e("div",{class:"upload-area",onClick:g},[e("input",{type:"file",ref_key:"fileInput",ref:x,accept:"audio/*",multiple:"",style:{display:"none"},onChange:D},null,544),L[18]||(L[18]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4","stroke-width":"2"}),e("polyline",{points:"17 8 12 3 7 8","stroke-width":"2"}),e("line",{x1:"12",y1:"3",x2:"12",y2:"15","stroke-width":"2"})],-1)),L[19]||(L[19]=e("p",null,"",-1)),L[20]||(L[20]=e("span",null," MP3, FLAC, WAV ",-1))]),A.value.length>0?(p(),f("div",QC,[e("h3",null," ("+_(A.value.length)+")",1),(p(!0),f(Le,null,Fe(A.value,(k,y)=>(p(),f("div",{key:y,class:"upload-item"},[e("div",{class:"file-cover",onClick:H=>F(y),title:""},[k.customCover||k.cover?(p(),f("img",{key:0,src:k.customCover||k.cover,alt:k.title},null,8,t$)):(p(),f("div",s$,[...L[21]||(L[21]=[mt('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-62ae35c9><path d="M9 18V5l12-2v13" stroke-width="2" data-v-62ae35c9></path><circle cx="6" cy="18" r="3" stroke-width="2" data-v-62ae35c9></circle><circle cx="18" cy="16" r="3" stroke-width="2" data-v-62ae35c9></circle></svg><span class="upload-hint" data-v-62ae35c9></span>',2)])]))],8,e$),e("div",o$,[e("div",n$,_(k.title),1),e("div",a$,_(k.artist),1),e("div",l$,[e("span",null,_(we(k.size)),1),k.duration?(p(),f("span",i$,_(he(k.duration)),1)):N("",!0),k.lyrics?(p(),f("span",r$," ")):N("",!0),k.customCover?(p(),f("span",c$," ")):N("",!0)])]),e("div",d$,[e("button",{class:"action-icon-btn",onClick:H=>te(y),title:""},[...L[22]||(L[22]=[mt('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-62ae35c9><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke-width="2" data-v-62ae35c9></path><polyline points="14 2 14 8 20 8" stroke-width="2" data-v-62ae35c9></polyline><line x1="16" y1="13" x2="8" y2="13" stroke-width="2" data-v-62ae35c9></line><line x1="16" y1="17" x2="8" y2="17" stroke-width="2" data-v-62ae35c9></line><polyline points="10 9 9 9 8 9" stroke-width="2" data-v-62ae35c9></polyline></svg>',1)])],8,u$),e("button",{class:"action-icon-btn",onClick:H=>re(y),title:""},[...L[23]||(L[23]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7","stroke-width":"2"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z","stroke-width":"2"})],-1)])],8,v$),e("button",{class:"action-icon-btn danger",onClick:H=>pe(y),title:""},[...L[24]||(L[24]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18","stroke-width":"2"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18","stroke-width":"2"})],-1)])],8,p$)])]))),128)),e("button",{class:"primary-btn full-width",onClick:Ue},"  ("+_(A.value.length)+" ) ",1)])):N("",!0),e("input",{type:"file",ref_key:"lyricsInput",ref:S,accept:".lrc",style:{display:"none"},onChange:R},null,544),e("input",{type:"file",ref_key:"coverInput",ref:M,accept:"image/*",style:{display:"none"},onChange:ie},null,544)])):N("",!0)])],4)],4))}},m$=Xe(f$,[["__scopeId","data-v-62ae35c9"]]);class jl{static parse(s){if(!s||typeof s!="string")return[];const o=s.split(`
`),n=[];for(const a of o){const l=/\[(\d{2}):(\d{2})(?:\.(\d{2,3}))?\]/g,i=[...a.matchAll(l)];if(i.length>0){const r=a.replace(/\[(\d{2}):(\d{2})(?:\.(\d{2,3}))?\]/g,"").trim();if(!r||r.startsWith("["))continue;for(const c of i){const d=parseInt(c[1]),u=parseInt(c[2]),v=c[3]?parseInt(c[3].padEnd(3,"0")):0,b=d*60+u+v/1e3;n.push({time:b,text:r})}}}return n.sort((a,l)=>a.time-l.time),n}static getCurrentIndex(s,o){if(!s||s.length===0)return-1;for(let n=s.length-1;n>=0;n--)if(s[n].time<=o)return n;return-1}static formatTime(s){const o=Math.floor(s/60),n=Math.floor(s%60);return`${o.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}}class g${async getCharacterListenTime(s){try{return await C.getSetting(`listenTogether_${s}`)||0}catch(o){return console.error(":",o),0}}async saveCharacterListenTime(s,o){try{await C.setSetting(`listenTogether_${s}`,o)}catch(n){console.error(":",n)}}async addCharacterListenTime(s,o){try{const a=await this.getCharacterListenTime(s)+o;return await this.saveCharacterListenTime(s,a),a}catch(n){return console.error(":",n),0}}formatTime(s){if(!s||s<0)return"0";const o=Math.floor(s/3600),n=Math.floor(s%3600/60);return o>0?`${o}${n}`:`${n}`}}const Is=new g$,h$={class:"music-header"},y$={class:"song-info-header"},b$={class:"song-title-artist"},w$={class:"album-section"},k$={key:0,class:"listen-together-avatars"},x$={class:"avatar-item left"},C$=["src","alt"],$$={class:"avatar-item right"},_$=["src"],M$={key:1,class:"listen-time-display"},S$={class:"vinyl-disc"},A$=["src","alt"],I$={class:"lyrics-container"},L$={key:0},T$={key:1,class:"no-lyrics"},j$={class:"progress-section"},P$={class:"progress-bar-bg"},E$={class:"time-display"},B$={class:"current-time"},V$={class:"total-time"},D$={class:"controls-section"},H$={class:"control-buttons"},F$={key:0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},U$={key:1,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},R$={key:2,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},N$={key:0,width:"32",height:"32",viewBox:"0 0 24 24",fill:"currentColor"},O$={key:1,width:"32",height:"32",viewBox:"0 0 24 24",fill:"currentColor",style:{"margin-left":"2px"}},z$={class:"menu-header"},K$={class:"menu-items"},W$={class:"friends-list"},G$=["onClick"],q$=["src","alt"],Z$={class:"friend-name"},J$={key:0,class:"empty-friends"},Y$={class:"modal-buttons"},X$={class:"playlist-songs"},Q$=["onClick"],e6={class:"song-index"},t6=["src","alt"],s6={class:"song-info-small"},o6={class:"song-title-small"},n6={class:"song-artist-small"},a6={key:0,class:"playing-indicator-small"},l6={key:0,class:"empty-playlist"},i6={class:"modal-buttons"},r6={__name:"music",props:{song:{type:Object,required:!0}},emits:["back"],setup(t,{emit:s}){const o=qo,n=h(!1),a=h(0),l=h(!1),i=h(!1),r=h(!1),c=h([]),d=h("https://via.placeholder.com/50"),u=h(0),v=h(0),b=h({show:!1,message:""}),w=h({wallpaper:"https://picsum.photos/1080/1920?random=33",uiColor:"#000000",opacity:.4,textColor:"#ffffff"}),I=tt(()=>{var ge;return(ge=o.currentSong)!=null&&ge.lyrics?jl.parse(o.currentSong.lyrics):[]}),j=tt(()=>jl.getCurrentIndex(I.value,o.currentTime)),$=tt(()=>{const ge=u.value+v.value;return Is.formatTime(ge)}),x=tt(()=>(M(w.value.uiColor),{backgroundImage:`url(${w.value.wallpaper})`,backgroundSize:"cover",backgroundPosition:"center"})),S=tt(()=>({backgroundColor:`rgba(${M(w.value.uiColor)}, ${w.value.opacity})`})),M=ge=>{const B=parseInt(ge.slice(1,3),16),L=parseInt(ge.slice(3,5),16),k=parseInt(ge.slice(5,7),16);return`${B}, ${L}, ${k}`},A=tt(()=>o.duration?o.currentTime/o.duration*100:0),T=()=>{Pt.togglePlay()},G=()=>{n.value=!n.value},K=()=>{Pt.toggleGlobalLyrics(),g(o.showGlobalLyrics?"":"")},q=()=>{const ge={list:"",random:"",single:""},B=Pt.toggleLoopMode();g(ge[B])},ee=()=>{Pt.previous(),g("")},Z=()=>{Pt.next(),g("")},E=ge=>{const B=ge.currentTarget.getBoundingClientRect(),y=(ge.clientX-B.left)/B.width*o.duration;Pt.seek(y)},m=ge=>Pt.formatTime(ge),g=ge=>{b.value.message=ge,b.value.show=!0,setTimeout(()=>{b.value.show=!1},1500)},D=()=>{g("")},W=async()=>{l.value=!1;try{const{db:ge}=await Kt(async()=>{const{db:L}=await Promise.resolve().then(()=>is);return{db:L}},void 0),B=await ge.getContacts();c.value=B,i.value=!0}catch(ge){console.error(":",ge),g("")}},te=async ge=>{i.value=!1,Pt.startListenTogether(ge,o.currentSong),u.value=await Is.getCharacterListenTime(ge.id),v.value=0;try{const{db:B}=await Kt(async()=>{const{db:k}=await Promise.resolve().then(()=>is);return{db:k}},void 0),L=await B.getUserSetting(ge.id,"avatar");L?d.value=L:d.value="https://via.placeholder.com/50"}catch(B){console.error(":",B)}g(` ${ge.name} `)},R=async()=>{if(o.listenTogether.active&&o.listenTogether.character){const ge=o.listenTogether.character.id;await Is.addCharacterListenTime(ge,v.value),Pt.endListenTogether(),u.value=0,v.value=0,g("")}},F=()=>{l.value=!1,r.value=!0},ie=(ge,B)=>{r.value=!1,o.playlist&&o.playlist.length>0?Pt.setPlaylist(o.playlist,B):Pt.playSong(ge),g(`: ${ge.title}`)},re=async()=>{try{const ge=await ft.getUserConfig();if(ge&&(w.value=ge),ge.avatar)d.value=ge.avatar;else{const{db:B}=await Kt(async()=>{const{db:k}=await Promise.resolve().then(()=>is);return{db:k}},void 0),L=await B.getContacts();if(L.length>0){const k=await B.getUserSetting(L[0].id,"avatar");k&&(d.value=k)}}}catch(ge){console.error(":",ge)}},pe=async()=>{try{await ft.saveUserConfig(w.value)}catch(ge){console.error(":",ge)}};Ft(w,()=>{pe()},{deep:!0});let we=null;it(async()=>{if(await re(),o.listenTogether.active&&o.listenTogether.character){u.value=await Is.getCharacterListenTime(o.listenTogether.character.id),v.value=o.listenTogether.elapsedTime||0;try{const{db:ge}=await Kt(async()=>{const{db:L}=await Promise.resolve().then(()=>is);return{db:L}},void 0),B=await ge.getUserSetting(o.listenTogether.character.id,"avatar");B&&(d.value=B)}catch(ge){console.error(":",ge)}}we=setInterval(async()=>{if(o.listenTogether.active&&o.listenTogether.character&&o.isPlaying&&(v.value++,v.value%60===0)){const ge=o.listenTogether.character.id;await Is.saveCharacterListenTime(ge,u.value+v.value)}},1e3)}),zt(async()=>{if(we&&clearInterval(we),o.listenTogether.active&&o.listenTogether.character&&v.value>0){const ge=o.listenTogether.character.id;await Is.addCharacterListenTime(ge,v.value)}});const he=(ge,B,L)=>`"${ge}"${B}- ${L}


- 
- 
- 
- 
- 
- 
- 


- 
- 
- 
- 
- 
-  emoji 

`,Ue=async(ge,B,L)=>{var k;try{const{db:y}=await Kt(async()=>{const{db:Me}=await Promise.resolve().then(()=>is);return{db:Me}},void 0),H=await y.getSetting("apiConfig");if(!H||!H.apiKey)return console.log(" API"),null;const se={provider:H.provider||"deepseek",apiKey:H.apiKey,baseUrl:H.baseUrl||"",model:H.model||"deepseek-chat"};let P=se.baseUrl;P||(se.provider==="deepseek"?P="https://api.deepseek.com":se.provider==="openai"&&(P="https://api.openai.com")),P=P.replace(/\/v1\/?$/,"").replace(/\/$/,"")+"/v1/chat/completions";const U=he(ge,B,L),O=await fetch(P,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${se.apiKey}`},body:JSON.stringify({model:se.model,messages:[{role:"user",content:U}],temperature:.9})});if(!O.ok)throw new Error(`AI : ${O.status}`);const ae=(await O.json()).choices[0].message.content.trim();console.log(":",ae);const fe={characterId:(k=o.listenTogether.character)==null?void 0:k.id,characterName:ge,content:ae,songTitle:B,songArtist:L,timestamp:Date.now()};return await ft.saveMusicActivity(fe),ae}catch(y){return console.error(":",y),null}};return Ft(()=>o.currentSong,async(ge,B)=>{if(ge&&(a.value=0,o.listenTogether.active&&o.listenTogether.character&&ge.id!==(B==null?void 0:B.id))){const L=o.listenTogether.character.name,k=ge.title||"",y=ge.artist||"";console.log(` ${L} ...`),await Ue(L,k,y)}}),Ft(()=>o.listenTogether.active,async ge=>{if(ge&&o.listenTogether.character){u.value=await Is.getCharacterListenTime(o.listenTogether.character.id),v.value=0;try{const{db:B}=await Kt(async()=>{const{db:k}=await Promise.resolve().then(()=>is);return{db:k}},void 0),L=await B.getUserSetting(o.listenTogether.character.id,"avatar");L?d.value=L:d.value="https://via.placeholder.com/50"}catch(B){console.error(":",B)}}else v.value>0&&o.listenTogether.character&&await Is.addCharacterListenTime(o.listenTogether.character.id,v.value),u.value=0,v.value=0,d.value="https://via.placeholder.com/50"}),(ge,B)=>{var L,k,y,H;return p(),f("div",{class:"music-player-page",style:Oe(x.value)},[e("div",{class:"page-overlay",style:Oe(S.value)},null,4),e("header",h$,[e("button",{class:"back-btn",onClick:B[0]||(B[0]=se=>ge.$emit("back"))},[...B[10]||(B[10]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5"},[e("path",{d:"M15 18l-6-6 6-6"})],-1)])]),e("div",y$,[e("div",b$,_(((L=Ke(o).currentSong)==null?void 0:L.title)||"")+"  "+_(((k=Ke(o).currentSong)==null?void 0:k.artist)||""),1)]),e("button",{class:"more-btn",onClick:B[1]||(B[1]=se=>l.value=!0)},[...B[11]||(B[11]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5"},[e("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor"}),e("circle",{cx:"12",cy:"5",r:"1.5",fill:"currentColor"}),e("circle",{cx:"12",cy:"19",r:"1.5",fill:"currentColor"})],-1)])])]),e("section",w$,[Ke(o).listenTogether.active&&Ke(o).listenTogether.character&&!n.value?(p(),f("div",k$,[e("div",x$,[e("img",{src:Ke(o).listenTogether.character.avatar,alt:Ke(o).listenTogether.character.name},null,8,C$)]),e("div",$$,[e("img",{src:d.value,alt:""},null,8,_$)])])):N("",!0),Ke(o).listenTogether.active&&Ke(o).listenTogether.character&&!n.value?(p(),f("div",M$,[e("span",null," "+_($.value),1)])):N("",!0),ke(e("div",{class:Se(["album-cover-wrapper",{rotating:Ke(o).isPlaying}]),onClick:G},[e("div",S$,[e("img",{src:((y=Ke(o).currentSong)==null?void 0:y.cover)||Ke(zo)(),alt:(H=Ke(o).currentSong)==null?void 0:H.title,class:"album-image"},null,8,A$)])],2),[[go,!n.value]]),e("div",{class:Se(["lyrics-overlay",{visible:n.value}]),onClick:G},[e("div",I$,[I.value.length>0?(p(),f("div",L$,[(p(!0),f(Le,null,Fe(I.value,(se,P)=>(p(),f("div",{key:P,class:Se(["lyric-line",{active:P===j.value}])},_(se.text),3))),128))])):(p(),f("div",T$,[...B[12]||(B[12]=[e("p",null,"",-1)])]))])],2)]),e("section",{class:"action-buttons-section"},[e("button",{class:"action-btn",onClick:K},[...B[13]||(B[13]=[e("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 18V5l12-2v13"}),e("circle",{cx:"6",cy:"18",r:"3"}),e("circle",{cx:"18",cy:"16",r:"3"})],-1)])]),e("button",{class:"action-btn",onClick:D},[...B[14]||(B[14]=[e("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})],-1)])])]),e("section",j$,[e("div",{class:"progress-bar-wrapper",onClick:E},[e("div",P$,[e("div",{class:"progress-bar-fill",style:Oe({width:A.value+"%"})},[...B[15]||(B[15]=[e("div",{class:"progress-dot"},null,-1)])],4)])]),e("div",E$,[e("span",B$,_(m(Ke(o).currentTime)),1),e("span",V$,_(m(Ke(o).duration)),1)])]),e("section",D$,[e("div",H$,[e("button",{class:"control-icon",onClick:q},[Ke(o).loopMode==="list"?(p(),f("svg",F$,[...B[16]||(B[16]=[e("polyline",{points:"17 1 21 5 17 9"},null,-1),e("path",{d:"M3 11V9a4 4 0 0 1 4-4h14"},null,-1),e("polyline",{points:"7 23 3 19 7 15"},null,-1),e("path",{d:"M21 13v2a4 4 0 0 1-4 4H3"},null,-1)])])):Ke(o).loopMode==="random"?(p(),f("svg",U$,[...B[17]||(B[17]=[mt('<polyline points="16 3 21 3 21 8" data-v-1cd5b5f6></polyline><line x1="4" y1="20" x2="21" y2="3" data-v-1cd5b5f6></line><polyline points="21 16 21 21 16 21" data-v-1cd5b5f6></polyline><line x1="15" y1="15" x2="21" y2="21" data-v-1cd5b5f6></line><line x1="4" y1="4" x2="9" y2="9" data-v-1cd5b5f6></line>',5)])])):(p(),f("svg",R$,[...B[18]||(B[18]=[mt('<polyline points="17 1 21 5 17 9" data-v-1cd5b5f6></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14" data-v-1cd5b5f6></path><polyline points="7 23 3 19 7 15" data-v-1cd5b5f6></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3" data-v-1cd5b5f6></path><text x="10.5" y="14.5" fill="currentColor" style="font-size:8px;font-weight:bold;" data-v-1cd5b5f6>1</text>',5)])]))]),e("button",{class:"control-icon",onClick:ee},[...B[19]||(B[19]=[e("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"})],-1)])]),e("button",{class:"play-pause-btn",onClick:T},[Ke(o).isPlaying?(p(),f("svg",N$,[...B[20]||(B[20]=[e("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},null,-1)])])):(p(),f("svg",O$,[...B[21]||(B[21]=[e("path",{d:"M8 5v14l11-7z"},null,-1)])]))]),e("button",{class:"control-icon",onClick:Z},[...B[22]||(B[22]=[e("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M6 18l8.5-6L6 6zm9-12v12h2V6z"})],-1)])]),e("button",{class:"control-icon",onClick:F},[...B[23]||(B[23]=[mt('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-1cd5b5f6><line x1="8" y1="6" x2="21" y2="6" data-v-1cd5b5f6></line><line x1="8" y1="12" x2="21" y2="12" data-v-1cd5b5f6></line><line x1="8" y1="18" x2="21" y2="18" data-v-1cd5b5f6></line><line x1="3" y1="6" x2="3.01" y2="6" data-v-1cd5b5f6></line><line x1="3" y1="12" x2="3.01" y2="12" data-v-1cd5b5f6></line><line x1="3" y1="18" x2="3.01" y2="18" data-v-1cd5b5f6></line></svg>',1)])])])]),e("div",{class:Se(["toast",{show:b.value.show}])},_(b.value.message),3),l.value?(p(),f("div",{key:0,class:"menu-overlay",onClick:B[2]||(B[2]=se=>l.value=!1)})):N("",!0),e("div",{class:Se(["menu-panel",{active:l.value}])},[e("div",z$,[B[24]||(B[24]=e("h3",null,"",-1)),e("button",{onClick:B[3]||(B[3]=se=>l.value=!1)},"")]),e("div",K$,[Ke(o).listenTogether.active?(p(),f("div",{key:1,class:"menu-item",onClick:R},[...B[26]||(B[26]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1),e("span",null,"",-1)])])):(p(),f("div",{key:0,class:"menu-item",onClick:W},[...B[25]||(B[25]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 18V5l12-2v13"}),e("circle",{cx:"6",cy:"18",r:"3"}),e("circle",{cx:"18",cy:"16",r:"3"})],-1),e("span",null,"",-1)])]))])],2),i.value?(p(),f("div",{key:1,class:"modal-overlay",onClick:B[6]||(B[6]=se=>i.value=!1)},[e("div",{class:"modal-content",onClick:B[5]||(B[5]=Pe(()=>{},["stop"]))},[B[28]||(B[28]=e("h3",{class:"modal-title"},"",-1)),e("div",W$,[(p(!0),f(Le,null,Fe(c.value,se=>(p(),f("div",{key:se.id,class:"friend-item",onClick:P=>te(se)},[e("img",{src:se.avatar,alt:se.name,class:"friend-avatar"},null,8,q$),e("div",Z$,_(se.name),1)],8,G$))),128)),c.value.length===0?(p(),f("div",J$,[...B[27]||(B[27]=[e("p",null,"",-1),e("p",{class:"hint"},"",-1)])])):N("",!0)]),e("div",Y$,[e("button",{class:"modal-btn cancel-btn",onClick:B[4]||(B[4]=se=>i.value=!1)},"")])])])):N("",!0),r.value?(p(),f("div",{key:2,class:"modal-overlay",onClick:B[9]||(B[9]=se=>r.value=!1)},[e("div",{class:"modal-content playlist-modal",onClick:B[8]||(B[8]=Pe(()=>{},["stop"]))},[B[31]||(B[31]=e("h3",{class:"modal-title"},"",-1)),e("div",X$,[(p(!0),f(Le,null,Fe(Ke(o).playlist,(se,P)=>(p(),f("div",{key:se.id,class:Se(["playlist-song-item",{active:P===Ke(o).currentIndex}]),onClick:U=>ie(se,P)},[e("div",e6,_(P+1),1),e("img",{src:se.cover,alt:se.title,class:"song-cover-small"},null,8,t6),e("div",s6,[e("div",o6,_(se.title),1),e("div",n6,_(se.artist),1)]),P===Ke(o).currentIndex&&Ke(o).isPlaying?(p(),f("div",a6,[...B[29]||(B[29]=[e("div",{class:"bar"},null,-1),e("div",{class:"bar"},null,-1),e("div",{class:"bar"},null,-1)])])):N("",!0)],10,Q$))),128)),Ke(o).playlist.length===0?(p(),f("div",l6,[...B[30]||(B[30]=[e("p",null,"",-1)])])):N("",!0)]),e("div",i6,[e("button",{class:"modal-btn cancel-btn",onClick:B[7]||(B[7]=se=>r.value=!1)},"")])])])):N("",!0)],4)}}},c6=Xe(r6,[["__scopeId","data-v-1cd5b5f6"]]),d6={class:"top-nav"},u6={class:"ranking-list"},v6=["onClick"],p6={key:0,class:"medal"},f6={key:1,class:"rank-number"},m6={class:"avatar"},g6=["src","alt"],h6={class:"info"},y6={class:"name"},b6={class:"stats"},w6={class:"duration"},k6={class:"songs"},x6={class:"progress-container"},C6={key:0,class:"empty-state"},$6={class:"modal-header"},_6=["src"],M6={class:"modal-stats"},S6={class:"stat-card"},A6={class:"stat-value"},I6={class:"stat-card"},L6={class:"stat-value"},T6={class:"stat-card"},j6={class:"stat-value"},P6={class:"modal-section"},E6={class:"top-songs"},B6={class:"song-rank"},V6={class:"song-name"},D6={class:"song-artist"},H6={key:0,class:"no-data"},F6={class:"modal-section"},U6={class:"tags"},R6={__name:"MusicRanking",emits:["back"],setup(t,{emit:s}){const o=h([]),n=h(null),a=h("https://picsum.photos/1080/1920?random=33"),l=h("#000000"),i=h(.4),r=h(null),c=tt(()=>({backgroundColor:`rgba(${u(l.value)}, ${i.value})`,color:"#ffffff"})),d=tt(()=>o.value.length===0?1:Math.max(...o.value.map(S=>S.duration))),u=S=>{const M=parseInt(S.slice(1,3),16),A=parseInt(S.slice(3,5),16),T=parseInt(S.slice(5,7),16);return`${M}, ${A}, ${T}`},v=S=>{const M=Math.floor(S/3600),A=Math.floor(S%3600/60);return M>0?`${M}${A}`:`${A}`},b=S=>["linear-gradient(135deg, #FFD700 0%, #FFA500 100%)","linear-gradient(135deg, #C0C0C0 0%, #808080 100%)","linear-gradient(135deg, #CD7F32 0%, #8B4513 100%)","linear-gradient(135deg, #667eea 0%, #764ba2 100%)"][Math.min(S,3)],w=()=>{var S;(S=r.value)==null||S.click()},I=async S=>{const M=S.target.files[0];if(M)try{const A=await ga(M,800,.8);await ft.saveRankingCover(A),console.log("")}catch(A){console.error(":",A),alert("")}},j=async()=>{try{const S=await ft.getUserConfig(),{db:M}=await Kt(async()=>{const{db:q}=await Promise.resolve().then(()=>is);return{db:q}},void 0),A=await M.getContacts(),T=await ft.getAllPlaylists(),G=[];for(const q of T){const ee=await ft.getSongsInPlaylist(q.id);G.push(...ee)}const K=[];for(const q of A){const ee=await Is.getCharacterListenTime(q.id),Z=G.slice(0,5).map(E=>({title:E.title||"",artist:E.artist||""}));K.push({id:q.id,name:q.name,avatar:q.avatar||`https://picsum.photos/200/200?random=${q.id}`,duration:ee,songCount:Math.floor(ee/180),favoriteGenre:"",topSongs:Z.length>0?Z:[{title:"",artist:""}],tags:["",""]})}K.sort((q,ee)=>ee.duration-q.duration),o.value=K}catch(S){console.error(":",S)}},$=S=>{n.value=S},x=async()=>{try{const S=await ft.getUserConfig();S&&(a.value=S.wallpaper||a.value,l.value=S.uiColor||l.value,i.value=S.opacity||i.value)}catch(S){console.error(":",S)}};return it(()=>{x(),j()}),(S,M)=>(p(),f("div",{class:"music-ranking",style:Oe({backgroundImage:"url("+a.value+")"})},[e("div",{class:"overlay",style:Oe(c.value)},[e("nav",d6,[e("button",{class:"icon-btn",onClick:M[0]||(M[0]=A=>S.$emit("back"))},[...M[4]||(M[4]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},[e("path",{d:"M15 18l-6-6 6-6"})],-1)])]),M[6]||(M[6]=e("h1",{class:"page-title"},"",-1)),e("button",{class:"icon-btn",onClick:w},[...M[5]||(M[5]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e("polyline",{points:"21 15 16 10 5 21"})],-1)])]),e("input",{type:"file",ref_key:"coverInput",ref:r,style:{display:"none"},accept:"image/*",onChange:I},null,544)]),e("div",u6,[(p(!0),f(Le,null,Fe(o.value,(A,T)=>(p(),f("div",{key:A.id,class:Se(["ranking-item",{"top-three":T<3}]),onClick:G=>$(A)},[e("div",{class:Se(["rank-badge","rank-"+(T+1)])},[T<3?(p(),f("span",p6,_(["","",""][T]),1)):(p(),f("span",f6,_(T+1),1))],2),e("div",m6,[e("img",{src:A.avatar,alt:A.name},null,8,g6)]),e("div",h6,[e("div",y6,_(A.name),1),e("div",b6,[e("span",w6,_(v(A.duration)),1),e("span",k6,_(A.songCount)+" ",1)])]),e("div",x6,[e("div",{class:"progress-bar",style:Oe({width:A.duration/d.value*100+"%",background:b(T)})},null,4)])],10,v6))),128)),o.value.length===0?(p(),f("div",C6,[...M[7]||(M[7]=[e("div",{class:"empty-icon"},"",-1),e("p",null,"",-1),e("p",{class:"hint"},"",-1)])])):N("",!0)])],4),n.value?(p(),f("div",{key:0,class:"modal-overlay",onClick:M[3]||(M[3]=A=>n.value=null)},[e("div",{class:"modal-content",onClick:M[2]||(M[2]=Pe(()=>{},["stop"]))},[e("div",$6,[e("img",{src:n.value.avatar,class:"modal-avatar"},null,8,_6),e("h2",null,_(n.value.name),1),e("button",{class:"close-btn",onClick:M[1]||(M[1]=A=>n.value=null)},"")]),e("div",M6,[e("div",S6,[e("div",A6,_(v(n.value.duration)),1),M[8]||(M[8]=e("div",{class:"stat-label"},"",-1))]),e("div",I6,[e("div",L6,_(n.value.songCount),1),M[9]||(M[9]=e("div",{class:"stat-label"},"",-1))]),e("div",T6,[e("div",j6,_(n.value.favoriteGenre||""),1),M[10]||(M[10]=e("div",{class:"stat-label"},"",-1))])]),e("div",P6,[M[11]||(M[11]=e("h4",null," TOP 5",-1)),e("div",E6,[(p(!0),f(Le,null,Fe(n.value.topSongs||[],(A,T)=>(p(),f("div",{key:T,class:"song-item"},[e("span",B6,_(T+1),1),e("span",V6,_(A.title),1),e("span",D6,_(A.artist),1)]))),128)),!n.value.topSongs||n.value.topSongs.length===0?(p(),f("div",H6,"  ")):N("",!0)])]),e("div",F6,[M[12]||(M[12]=e("h4",null,"",-1)),e("div",U6,[(p(!0),f(Le,null,Fe(n.value.tags||[""],A=>(p(),f("span",{key:A,class:"tag"},_(A),1))),128))])])])])):N("",!0)],4))}},N6=Xe(R6,[["__scopeId","data-v-48d79bf3"]]),O6={class:"music-app-container"},z6={__name:"MusicApp",emits:["back"],setup(t){const s=h("home"),o=h(null),n=h("home"),a=h(null),l=h(null),i=(v,b)=>{s.value=v,(v==="playlist-manager"||v==="music-add")&&b&&(o.value=b.id||b)},r=v=>{n.value=s.value,a.value=o.value,l.value=v,s.value="player"},c=()=>{s.value="home",o.value=null},d=()=>{s.value="playlist-manager"},u=()=>{s.value=n.value,n.value==="playlist-manager"&&a.value&&(o.value=a.value)};return(v,b)=>(p(),f("div",O6,[s.value==="home"?(p(),nt(Q3,{key:0,onBack:b[0]||(b[0]=w=>v.$emit("back")),onNavigate:i,onPlaySong:r})):N("",!0),s.value==="listen-together"?(p(),nt(Vx,{key:1,onBack:c})):N("",!0),s.value==="playlist-manager"?(p(),nt(xC,{key:2,"playlist-id":o.value,onBack:c,onNavigate:i,onPlaySong:r},null,8,["playlist-id"])):N("",!0),s.value==="music-add"?(p(),nt(m$,{key:3,"playlist-id":o.value,onBack:d,onSongAdded:d},null,8,["playlist-id"])):N("",!0),s.value==="player"?(p(),nt(c6,{key:4,song:l.value,onBack:u},null,8,["song"])):N("",!0),s.value==="music-ranking"?(p(),nt(N6,{key:5,onBack:c})):N("",!0)]))}},K6=Xe(z6,[["__scopeId","data-v-c20736bd"]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W6=t=>{for(const s in t)if(s.startsWith("aria-")||s==="role"||s==="title")return!0;return!1};/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pl=t=>t==="";/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G6=(...t)=>t.filter((s,o,n)=>!!s&&s.trim()!==""&&n.indexOf(s)===o).join(" ").trim();/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const El=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q6=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,o,n)=>n?n.toUpperCase():o.toLowerCase());/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z6=t=>{const s=q6(t);return s.charAt(0).toUpperCase()+s.slice(1)};/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var _o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J6=({name:t,iconNode:s,absoluteStrokeWidth:o,"absolute-stroke-width":n,strokeWidth:a,"stroke-width":l,size:i=_o.width,color:r=_o.stroke,...c},{slots:d})=>bn("svg",{..._o,...c,width:i,height:i,stroke:r,"stroke-width":Pl(o)||Pl(n)||o===!0||n===!0?Number(a||l||_o["stroke-width"])*24/Number(i):a||l||_o["stroke-width"],class:G6("lucide",c.class,...t?[`lucide-${El(Z6(t))}-icon`,`lucide-${El(t)}`]:["lucide-icon"]),...!d.default&&!W6(c)&&{"aria-hidden":"true"}},[...s.map(u=>bn(...u)),...d.default?[d.default()]:[]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=(t,s)=>(o,{slots:n,attrs:a})=>bn(J6,{...a,...o,iconNode:s,name:t},n);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lr=ms("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y6=ms("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X6=ms("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q6=ms("ghost",[["path",{d:"M9 10h.01",key:"qbtxuw"}],["path",{d:"M15 10h.01",key:"1qmjsl"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z",key:"uwwb07"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e8=ms("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t8=ms("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=ms("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=ms("navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s8=ms("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cr=ms("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o8=ms("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n8=ms("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),a8="ForumUserDB",l8=2,Nt="userProfile",Tt="threads",ro="replies";class i8{constructor(){this.db=null}async init(){return new Promise((s,o)=>{const n=indexedDB.open(a8,l8);n.onerror=()=>o(n.error),n.onsuccess=()=>{this.db=n.result,s(this.db)},n.onupgradeneeded=a=>{const l=a.target.result;l.objectStoreNames.contains(Nt)||l.createObjectStore(Nt,{keyPath:"id"}),l.objectStoreNames.contains(Tt)||l.createObjectStore(Tt,{keyPath:"id"}).createIndex("category","category",{unique:!1}),l.objectStoreNames.contains(ro)||l.createObjectStore(ro,{keyPath:"id",autoIncrement:!0}).createIndex("threadId","threadId",{unique:!1})}})}async saveUserProfile(s){return this.db||await this.init(),new Promise((o,n)=>{const i=this.db.transaction([Nt],"readwrite").objectStore(Nt).put({id:"currentUser",...s});i.onsuccess=()=>o(i.result),i.onerror=()=>n(i.error)})}async getUserProfile(){return this.db||await this.init(),new Promise((s,o)=>{const l=this.db.transaction([Nt],"readonly").objectStore(Nt).get("currentUser");l.onsuccess=()=>{const i=l.result;s(i||{username:"DollyMoon",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Marshmallow"})},l.onerror=()=>o(l.error)})}async saveThread(s){return this.db||await this.init(),new Promise((o,n)=>{const l=this.db.transaction([Tt],"readwrite").objectStore(Tt),i={...s,isLocked:s.isLocked||!1,lockedReason:s.lockedReason||"",kickedUsers:s.kickedUsers||[],blockedUsers:s.blockedUsers||[]},r=l.put(i);r.onsuccess=()=>o(r.result),r.onerror=()=>n(r.error)})}async getAllThreads(){return this.db||await this.init(),new Promise((s,o)=>{const l=this.db.transaction([Tt],"readonly").objectStore(Tt).getAll();l.onsuccess=()=>s(l.result||[]),l.onerror=()=>o(l.error)})}async getThreadsByCategory(s){return this.db||await this.init(),new Promise((o,n)=>{const r=this.db.transaction([Tt],"readonly").objectStore(Tt).index("category").getAll(s);r.onsuccess=()=>o(r.result||[]),r.onerror=()=>n(r.error)})}async markThreadAsReplied(s){return this.db||await this.init(),new Promise(async(o,n)=>{try{const l=this.db.transaction([Tt],"readwrite").objectStore(Tt),i=l.get(s);i.onsuccess=()=>{const r=i.result;if(r){r.userReplied=!0,r.isLive=!0;const c=l.put(r);c.onsuccess=()=>o(),c.onerror=()=>n(c.error)}else o()},i.onerror=()=>n(i.error)}catch(a){n(a)}})}async favoriteThread(s){return this.db||await this.init(),new Promise(async(o,n)=>{try{const l=this.db.transaction([Tt],"readwrite").objectStore(Tt),i=l.get(s);i.onsuccess=()=>{const r=i.result;if(r){r.favorited=!r.favorited;const c=l.put(r);c.onsuccess=()=>o(r.favorited),c.onerror=()=>n(c.error)}else o(!1)},i.onerror=()=>n(i.error)}catch(a){n(a)}})}async blockThread(s){return this.db||await this.init(),new Promise(async(o,n)=>{try{const l=this.db.transaction([Tt],"readwrite").objectStore(Tt),i=l.get(s);i.onsuccess=()=>{const r=i.result;if(r){r.blocked=!r.blocked;const c=l.put(r);c.onsuccess=()=>o(r.blocked),c.onerror=()=>n(c.error)}else o(!1)},i.onerror=()=>n(i.error)}catch(a){n(a)}})}async deleteThread(s){return this.db||await this.init(),new Promise((o,n)=>{const i=this.db.transaction([Tt],"readwrite").objectStore(Tt).delete(s);i.onsuccess=()=>o(),i.onerror=()=>n(i.error)})}async saveReply(s){return this.db||await this.init(),new Promise((o,n)=>{const i=this.db.transaction([ro],"readwrite").objectStore(ro).add(s);i.onsuccess=()=>o(i.result),i.onerror=()=>n(i.error)})}async getRepliesByThreadId(s){return this.db||await this.init(),new Promise((o,n)=>{const r=this.db.transaction([ro],"readonly").objectStore(ro).index("threadId").getAll(s);r.onsuccess=()=>o(r.result||[]),r.onerror=()=>n(r.error)})}async initDefaultThreads(){(await this.getAllThreads()).length>0||console.log(" AI ")}async saveForumWorldView(s){return this.db||await this.init(),new Promise((o,n)=>{const i=this.db.transaction([Nt],"readwrite").objectStore(Nt).put({id:"forumWorldView",content:s});i.onsuccess=()=>o(i.result),i.onerror=()=>n(i.error)})}async getForumWorldView(){return this.db||await this.init(),new Promise((s,o)=>{const l=this.db.transaction([Nt],"readonly").objectStore(Nt).get("forumWorldView");l.onsuccess=()=>{const i=l.result;s(i?i.content:null)},l.onerror=()=>o(l.error)})}async saveSelectedWorldBook(s){return this.db||await this.init(),new Promise((o,n)=>{const i=this.db.transaction([Nt],"readwrite").objectStore(Nt).put({id:"selectedWorldBook",worldBookId:s});i.onsuccess=()=>o(i.result),i.onerror=()=>n(i.error)})}async getSelectedWorldBook(){return this.db||await this.init(),new Promise((s,o)=>{const l=this.db.transaction([Nt],"readonly").objectStore(Nt).get("selectedWorldBook");l.onsuccess=()=>{const i=l.result;s(i?i.worldBookId:null)},l.onerror=()=>o(l.error)})}async saveReplyCount(s){return this.db||await this.init(),new Promise((o,n)=>{const i=this.db.transaction([Nt],"readwrite").objectStore(Nt).put({id:"replyCount",count:s});i.onsuccess=()=>o(i.result),i.onerror=()=>n(i.error)})}async getReplyCount(){return this.db||await this.init(),new Promise((s,o)=>{const l=this.db.transaction([Nt],"readonly").objectStore(Nt).get("replyCount");l.onsuccess=()=>{const i=l.result;s(i?i.count:5)},l.onerror=()=>o(l.error)})}async deleteBlockedThreads(){return this.db||await this.init(),new Promise(async(s,o)=>{try{const a=(await this.getAllThreads()).filter(c=>c.blocked),i=this.db.transaction([Tt],"readwrite").objectStore(Tt);let r=0;for(const c of a){const d=i.delete(c.id);d.onsuccess=()=>{r++,r===a.length&&s(r)},d.onerror=()=>o(d.error)}a.length===0&&s(0)}catch(n){o(n)}})}async lockThread(s,o=""){return this.db||await this.init(),new Promise(async(n,a)=>{try{const i=this.db.transaction([Tt],"readwrite").objectStore(Tt),r=i.get(s);r.onsuccess=()=>{const c=r.result;if(c){c.isLocked=!0,c.lockedReason=o;const d=i.put(c);d.onsuccess=()=>n(),d.onerror=()=>a(d.error)}else n()},r.onerror=()=>a(r.error)}catch(l){a(l)}})}async kickUser(s,o){return this.db||await this.init(),new Promise(async(n,a)=>{try{const i=this.db.transaction([Tt],"readwrite").objectStore(Tt),r=i.get(s);r.onsuccess=()=>{const c=r.result;if(c){c.kickedUsers||(c.kickedUsers=[]),c.kickedUsers.includes(o)||c.kickedUsers.push(o);const d=i.put(c);d.onsuccess=()=>n(),d.onerror=()=>a(d.error)}else n()},r.onerror=()=>a(r.error)}catch(l){a(l)}})}async blockUser(s,o){return this.db||await this.init(),new Promise(async(n,a)=>{try{const i=this.db.transaction([Tt],"readwrite").objectStore(Tt),r=i.get(s);r.onsuccess=()=>{const c=r.result;if(c){c.blockedUsers||(c.blockedUsers=[]),c.blockedUsers.includes(o)||c.blockedUsers.push(o);const d=i.put(c);d.onsuccess=()=>n(),d.onerror=()=>a(d.error)}else n()},r.onerror=()=>a(r.error)}catch(l){a(l)}})}async getThreadById(s){return this.db||await this.init(),new Promise((o,n)=>{const i=this.db.transaction([Tt],"readonly").objectStore(Tt).get(s);i.onsuccess=()=>o(i.result||null),i.onerror=()=>n(i.error)})}}const dt=new i8,Dn=async(t,s,o=2e3,n=!0)=>{var d,u,v,b,w,I,j,$;const a=await Wt.getApiConfig();if(console.log(" API:",{provider:a.provider,model:a.model,hasApiKey:!!a.apiKey,baseUrl:a.baseUrl}),!(a!=null&&a.apiKey))throw new Error("API Key ");const i=`${(a.baseUrl||"").replace(/\/v1\/?$/,"").replace(/\/$/,"")||"https://generativelanguage.googleapis.com"}/v1/chat/completions`;console.log(" URL:",i);const r={model:a.model||"gemini-2.5-flash",messages:[{role:"system",content:t+(n?`

IMPORTANT: Return ONLY valid JSON format. No markdown, no explanations.`:"")},{role:"user",content:s}],temperature:.9,max_tokens:o,stream:!1};n&&(r.response_format={type:"json_object"}),console.log(" :",JSON.stringify(r,null,2));const c=2;for(let x=0;x<=c;x++)try{console.log(`  ( ${x+1}/${c+1})...`);const S=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify(r)});if(console.log(" :",S.status,S.statusText),!S.ok){const T=await S.text();throw console.error(` HTTP ${S.status}:`,T),new Error(`HTTP ${S.status}: ${T}`)}const M=await S.json();console.log(" :",JSON.stringify(M,null,2));const A=(((v=(u=(d=M.choices)==null?void 0:d[0])==null?void 0:u.message)==null?void 0:v.content)||(($=(j=(I=(w=(b=M.candidates)==null?void 0:b[0])==null?void 0:w.content)==null?void 0:I.parts)==null?void 0:j[0])==null?void 0:$.text)||"").trim();if(console.log(" :",A),!A)throw console.warn(" AI "),new Error("AI ");return A}catch(S){if(console.error(`  ( ${x+1}/${c+1}):`,S),x===c)throw S;await new Promise(M=>setTimeout(M,1e3*(x+1)))}},dr=async()=>{try{const t=await dt.getForumWorldView();if(t&&t.trim())return console.log(" :",t),t;const s=await dt.getSelectedWorldBook();if(console.log(" ID:",s),s){const o=await C.getWorldBookEntries(s);if(console.log(" :",o),o&&o.length>0){const n=o.filter(a=>a.enabled!==!1).map(a=>a.content).join(`

`);return console.log(" :",s,":",o.length),n}}return console.log(" "),null}catch(t){return console.error(" :",t),null}},r8=async(t,s=3)=>{const o={worldbook:{name:"",examples:["","",""]},ghost:{name:"",examples:["3 "," "," "]},daily:{name:"",examples:[" wwww"," "," "]},funny:{name:"",examples:[" wwww"," "," "]},rant:{name:"",examples:[" ",""," "]},diary:{name:"",examples:[" "," "," "]},food:{name:"",examples:[" "," "," "]}},n=o[t]||o.ghost,a=await dr();let l;if(t==="worldbook"||a){if(!a)return console.warn(" "),["","",""];l=` 2ch 


${a}

${n.name} ${s} 

 

1   80%
   - /
   - 
   - ""
   - ""
   - ""

2 -  20%
   - TA
   - 
   - 
   - "TA "


1. 
2. 80%20%
3. 
4.  20-30 
5. 
6. "TA"""""
7. 
8.  ${s} 

 ${s} `}else l=`${n.name}${s}


${n.examples.join(`
`)}


1. 
2. 
3. 20-30
4. 
5. `;l+=`

${s}`;try{console.log(` ${n.name}...`);let i;try{i=await Dn("",l,1e3,!1),console.log(" AI:",i)}catch(v){throw console.error(" AI:",v),v}const r=i.replace(/\\n/g,`
`).replace(/\\r/g,"\r").split(/[\n\r]+/).map(v=>v.trim()).filter(v=>v.length>=10&&v.length<=60&&!v.match(/^[\d\.\-\*\s]+$/)&&!v.includes("{")&&!v.includes("}")&&!v.includes("[")&&!v.includes("]")).map(v=>v.replace(/^\d+[\.\)]\s*/,"").replace(/^[\-\*]\s*/,"").replace(/^["']+/,"").replace(/["']+$/,"").trim()).filter(v=>v.length>=10);if(console.log(" :",r),r.length>=s){const v=r.slice(0,s);return console.log(" :",v),v}console.warn(`  ${r.length}  ${s} `);const c={worldbook:["","",""],ghost:["3",""," "],daily:[" wwww"," "," "],funny:[" "," wwww"," "],rant:[" ",""," "],diary:[" "," "," "],food:[" "," "," "]},d=c[t]||c.ghost,u=[...r,...d].slice(0,s);return console.log(" :",u),u}catch(i){console.error(" :",i);const r={worldbook:["","",""],ghost:["3",""," "],daily:[" wwww"," "," "],funny:[" "," wwww"," "],rant:[" ",""," "],diary:[" "," "," "],food:[" "," "," "]};return r[t]||r.ghost}},c8=async(t,s)=>{const o=await dr(),n={worldbook:{name:"",opStyle:"",opExamples:`......


TA
`,replyStyle:""},ghost:{name:"",opStyle:"",opExamples:`......
 6


 
`,replyStyle:""},daily:{name:"",opStyle:"",opExamples:`


" "

`,replyStyle:""},funny:{name:"",opStyle:"",opExamples:`wwww



"......"
`,replyStyle:"wwww"},rant:{name:"",opStyle:"",opExamples:`




`,replyStyle:""},diary:{name:"",opStyle:"////",opExamples:`......


 


`,replyStyle:""},food:{name:"",opStyle:"",opExamples:`



wwww
`,replyStyle:""}},a=n[t]||n.ghost;let l;t==="worldbook"||o?l=` 2ch ${a.name}


${o}


${s}

 


- 
- TA
- 
- 

TA
- /
- /

(OP)
- ${a.opStyle}
- 
- 
- 


- 80%
- 1-2
- ${a.replyStyle}
- 1-210-30
- """wwww"""""""
- 

5-8
---
[]
...
---
[]
1...
---
[]
2...
---

`:l=`2ch${a.name}

${s}
${a.name}

(OP)
- ${a.opStyle}
- 
- 


${a.opExamples}


- ${a.replyStyle}
- 1-210-30
- """wwww"""""""
- 

5-8
---
[]
...
---
[]
1...
---
[]
2...
---

`;try{console.log(" ...");const i=await Dn("",l,2e3,!1);console.log(" AI:",i);const r=[],c=i.split("---").map(d=>d.trim()).filter(d=>d.length>0);for(const d of c){const u=d.split(`
`).map(j=>j.trim()).filter(j=>j.length>0);if(u.length<2)continue;const v=u[0],b=u.slice(1).join(`
`),w=v.includes("")||v.includes("OP"),I=w?"":"";r.push({user:I,content:b,isOP:w})}return console.log(" :",r),r.length>0?r:(console.warn(" "),[{user:"",content:"...",isOP:!0}])}catch(i){return console.error(" :",i),[{user:"",content:"...",isOP:!0}]}},d8=async(t,s,o,n,a=!1)=>{const l=await dt.getReplyCount(),i=o.slice(-8).map(w=>`${w.isOP?"[OP]":"[]"}: ${w.content}`).join(`
`),r={ghost:"",daily:"",funny:"wwww",rant:"",diary:"",food:""},c=r[t]||r.ghost,d=n.includes("@"),u=/[!?]/.test(n)||n.length>30;let v;a?d||u?v=`${d?"":""}

2ch

${c}

 
- 70%""""""
- 20%""""""
- 10%"wwww"""

TA

1-2

  []  [OP]  [] `:v=`

2ch

${c}

1-2
- """wwww"""""""
- 
- """""wwww"""

  []  [OP]  [] `:v=`${t}

1-2`;const b=`2ch${t}

${v}


- 1-210-30
- """wwww"""""""
- 
- 
-  ${l} 


${i}

${n}

 
1. 20
   - [LOCK_THREAD:]
   
2. 
   - [KICK_USER:]

 ${l} 
---
[]
...
---
[]
...
---
[]
...
---

 ${l} 

`;try{console.log(" ..."),console.log(" :",l);const w=await Dn("",b,3e3,!1);console.log(" AI:",w);let I=!1,j="",$=!1,x="";if(w.includes("[LOCK_THREAD:")){const T=w.match(/\[LOCK_THREAD:([^\]]+)\]/);T&&(I=!0,j=T[1])}if(w.includes("[KICK_USER:")){const T=w.match(/\[KICK_USER:([^\]]+)\]/);T&&($=!0,x=T[1])}const S=w.replace(/\[LOCK_THREAD:[^\]]+\]/g,"").replace(/\[KICK_USER:[^\]]+\]/g,""),M=[],A=S.split("---").map(T=>T.trim()).filter(T=>T.length>0);console.log(" sections:",A.length);for(const T of A){const G=T.split(`
`).map(E=>E.trim()).filter(E=>E.length>0);if(G.length<2)continue;const K=G[0],q=G.slice(1).join(`
`);let ee=K.includes("")||K.includes("OP");a&&ee&&(console.warn("  AI "),ee=!1);const Z=ee?"":"";M.push({user:Z,content:q,isOP:ee,shouldLock:I,lockReason:j,shouldKick:$,kickReason:x})}return console.log(" :",M.length,":",l),console.log(" :",M),M.length<l&&console.warn(` AI  ${M.length}  ${l} `),M}catch(w){return console.error(" :",w),[]}},u8=async(t,s,o="ghost")=>{const n={ghost:{name:"",style:""},daily:{name:"",style:""},funny:{name:"",style:"wwww"},rant:{name:"",style:""},diary:{name:"",style:"//"},food:{name:"",style:""}},a=n[o]||n.ghost,l=`${a.name}2ch

${a.name}
${a.style}

${t}
${s}


- 1-210-30
- """wwww"""""
- 
- 
- 
- 

5-8
---
[]
...
---
[]
...
---

`;try{console.log(" ...");const i=await Dn("",l,1500,!1);console.log(" AI:",i);const r=[],c=i.split("---").map(d=>d.trim()).filter(d=>d.length>0);for(const d of c){const u=d.split(`
`).map(b=>b.trim()).filter(b=>b.length>0);if(u.length<2)continue;const v=u.slice(1).join(`
`);r.push({user:"",content:v,isOP:!1})}return console.log(" :",r),r}catch(i){return console.error(" :",i),[]}},So=()=>{const t="abcdefghijklmnopqrstuvwxyz0123456789";let s="";for(let o=0;o<4;o++)s+=t.charAt(Math.floor(Math.random()*t.length));return`anon/${s}`},so=()=>{const t=new Date;return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},v8={class:"thread-detail-container animate-in"},p8={class:"detail-header"},f8={class:"thread-title-card"},m8={class:"title-text"},g8={class:"bubbles-list"},h8=["data-index","onTouchstart"],y8={class:"post-meta"},b8={class:"user-name"},w8={class:"post-id"},k8={key:0,class:"op-mascot"},x8={key:1,class:"kicked-message"},C8={class:"post-text"},$8={class:"post-footer"},_8={class:"post-time"},M8={key:0,class:"typing-indicator"},S8={class:"typing-text"},A8={key:1,class:"live-indicator"},I8={key:0,class:"op-actions"},L8={key:1,class:"locked-banner"},T8={class:"locked-content"},j8={class:"locked-text"},P8={class:"locked-reason"},E8={key:2,class:"kicked-banner"},B8=["onClick"],V8={key:4,class:"reply-footer"},D8={class:"input-wrapper"},H8=["disabled"],F8={__name:"forumdetail",props:{threadId:{type:Number,required:!0},threadTitle:{type:String,default:"..."},posts:{type:Array,default:()=>[]},isUserThread:{type:Boolean,default:!1},isUserOP:{type:Boolean,default:!1},category:{type:String,default:"ghost"}},emits:["back"],setup(t,{emit:s}){const o=t,n=h(""),a=h([]),l=h("Anonymous"),i=h(null),r=h(!1),c=h(""),d=h(!0),u=h(null),v=h(null),b=h(!1),w=h({x:0,y:0}),I=h([]),j=h(null),$=h(null),x=h(!1),S=h(!1),M=tt(()=>{var re,pe;const R=((re=$.value)==null?void 0:re.blockedUsers)||[],F=((pe=$.value)==null?void 0:pe.kickedUsers)||[],ie=[...o.posts,...a.value].filter(we=>!(R.includes(we.user)||R.includes(we.idCode))).map(we=>{const he=F.includes(we.user)||F.includes(we.idCode);return{...we,isKicked:he}});return console.log(" :",l.value),console.log(" :",ie.map(we=>({user:we.user,content:we.content.substring(0,20)}))),ie}),A=async()=>{await Yt(),i.value&&(i.value.scrollTop=i.value.scrollHeight)},T=async()=>{if(!n.value.trim())return;const R={threadId:o.threadId,user:l.value,isOP:o.isUserOP,date:so(),content:n.value.trim(),count:o.posts.length+a.value.length+1,idCode:So()};console.log(" :",l.value,":",R);try{await dt.saveReply(R),await dt.markThreadAsReplied(o.threadId),a.value.push(R);const F=n.value.trim();n.value="",await A(),await G(F)}catch(F){console.error(":",F)}},G=async R=>{var F;try{console.log(" AI ...");const ie=M.value.length;r.value=!0,c.value=Math.random()>.5?"":"",await new Promise(he=>setTimeout(he,2e3+Math.random()*2e3)),console.log(" AI ...");const re=await d8(o.category,o.threadTitle,M.value,R,o.isUserOP);if(console.log("AI :",re),r.value=!1,!re||re.length===0){console.error("AI ");return}const pe=re[0];pe.shouldLock&&(await dt.lockThread(o.threadId,pe.lockReason),await Z()),pe.shouldKick&&(await dt.kickUser(o.threadId,l.value),await Z());for(const he of re){const Ue={threadId:o.threadId,user:he.user,isOP:he.isOP,date:so(),content:he.content,count:o.posts.length+a.value.length+1,idCode:So(),aiGenerated:!0};console.log(" AI :",Ue),await dt.saveReply(Ue),a.value.push(Ue),await new Promise(ge=>setTimeout(ge,500))}await Yt();const we=(F=i.value)==null?void 0:F.querySelector(`[data-index="${ie}"]`);we&&we.scrollIntoView({behavior:"smooth",block:"start"}),console.log(" AI ")}catch(ie){console.error("AI :",ie),alert("AI : "+ie.message),r.value=!1}},K=async()=>{var R;if(o.isUserThread&&a.value.length===0){try{r.value=!0,c.value="",console.log("...");const F=((R=o.posts[0])==null?void 0:R.content)||"",ie=await u8(o.threadTitle,F,o.category);console.log("AI :",ie);const re=ie.map((pe,we)=>({...pe,id:Date.now()+we,date:so(),count:o.posts.length+we+1,idCode:So(),threadId:o.threadId,isOP:!1}));for(const pe of re)await dt.saveReply(pe),a.value.push(pe),await new Promise(we=>setTimeout(we,800)),await A();r.value=!1,d.value=!1,console.log("")}catch(F){console.error(":",F),alert(": "+F.message),r.value=!1}return}if(o.posts.length===0&&a.value.length===0)try{r.value=!0,c.value="",console.log("...");const F=await c8(o.category,o.threadTitle);console.log("AI :",F);const ie=F.map((we,he)=>({...we,id:Date.now()+he,date:so(),count:he+1,idCode:we.idCode||So(),threadId:o.threadId}));for(const we of ie)await dt.saveReply(we),a.value.push(we);const pe=(await dt.getAllThreads()).find(we=>we.id===o.threadId);pe&&(pe.replies=ie.length,await dt.saveThread(pe)),r.value=!1,d.value=!1,console.log("")}catch(F){console.error(" AI :",F),alert(": "+F.message),r.value=!1}else console.log(""),d.value=!1},q=async()=>{try{const R=await dt.getUserProfile();l.value=R.username||"Anonymous"}catch(R){console.error(":",R),l.value="Anonymous"}},ee=async()=>{try{const R=await dt.getRepliesByThreadId(o.threadId);a.value=R}catch(R){console.error(":",R)}},Z=async()=>{try{const R=await dt.getThreadById(o.threadId);$.value=R,x.value=(R==null?void 0:R.isLocked)||!1;const F=(R==null?void 0:R.kickedUsers)||[];S.value=F.includes(l.value)}catch(R){console.error(":",R)}},E=(R,F)=>{v.value=F,u.value=setTimeout(()=>{g(R,F)},500)},m=()=>{u.value&&(clearTimeout(u.value),u.value=null)},g=(R,F)=>{var we;R.preventDefault(),j.value=F;const ie=((we=R.touches)==null?void 0:we[0])||R;w.value={x:ie.clientX||ie.pageX,y:ie.clientY||ie.pageY};const re=F.user===l.value,pe=F.isOP;if(re)I.value=[{id:"delete",label:" ",color:"red"}];else{const he=[{id:"mention",label:" ",color:"blue"},{id:"block",label:" ",color:"orange"}];o.isUserOP&&!pe&&he.push({id:"kick",label:" ",color:"red"}),I.value=he}b.value=!0},D=()=>{b.value=!1,j.value=null},W=async()=>{const R=prompt("");if(R!==null)try{await dt.lockThread(o.threadId,R||""),await Z(),alert("")}catch(F){console.error(":",F),alert(""+F.message)}},te=async R=>{const F=j.value;if(F)switch(D(),R){case"mention":n.value=`@${F.user} `;break;case"block":if(confirm(` ${F.user} TA`))try{await dt.blockUser(o.threadId,F.user),await Z(),alert("")}catch(ie){console.error(":",ie),alert(""+ie.message)}break;case"kick":if(confirm(` ${F.user} TA""`))try{await dt.kickUser(o.threadId,F.user),await Z(),alert("")}catch(ie){console.error(":",ie),alert(""+ie.message)}break;case"delete":if(confirm(""))try{const ie=a.value.findIndex(re=>re.id===F.id);ie!==-1&&a.value.splice(ie,1),alert("")}catch(ie){console.error(":",ie),alert(""+ie.message)}break}};return it(async()=>{await q(),await Z(),await ee(),await K(),await Yt(),await A()}),(R,F)=>{var ie;return p(),f("div",v8,[e("div",p8,[e("button",{onClick:F[0]||(F[0]=re=>R.$emit("back")),class:"back-btn"},[...F[4]||(F[4]=[e("span",{class:"icon"},"",-1),ot("  ",-1)])]),F[5]||(F[5]=e("div",{class:"thread-status"},[e("span",{class:"ghost-icon"},""),e("span",{class:"status-text"},"...")],-1))]),e("div",{class:"chat-viewport",ref_key:"chatViewport",ref:i},[e("div",f8,[F[6]||(F[6]=e("div",{class:"title-ribbon"},"LIVE STORY",-1)),e("h2",m8,_(t.threadTitle),1)]),e("div",g8,[(p(!0),f(Le,null,Fe(M.value,(re,pe)=>(p(),f("div",{key:re.id,"data-index":pe,class:Se(["bubble-wrapper",re.user===l.value&&!re.isOP?"visitor-align":"op-align"]),onTouchstart:we=>E(we,re),onTouchend:m,onTouchcancel:m},[e("div",y8,[e("span",{class:Se(["count-tag",{"op-tag":re.isOP}])},"#"+_(re.count),3),e("span",b8,_(re.isOP?" THREAD OWNER":re.user),1),e("span",w8,"ID:"+_(re.idCode),1)]),e("div",{class:Se(["bubble-content",re.user===l.value&&!re.isOP?"my-bubble":re.isOP?"op-bubble":"other-bubble",{"kicked-bubble":re.isKicked}])},[re.isOP&&re.user!==l.value?(p(),f("div",k8,"")):N("",!0),re.isKicked?(p(),f("div",x8,[...F[7]||(F[7]=[e("span",{class:"kicked-icon"},"",-1),e("p",{class:"kicked-text"},"",-1)])])):(p(),f(Le,{key:2},[e("p",C8,_(re.content),1),e("div",$8,[e("span",_8,_(re.date),1),F[8]||(F[8]=e("button",{class:"quote-btn"}," ",-1))])],64))],2)],42,h8))),128))]),r.value?(p(),f("div",M8,[F[9]||(F[9]=e("div",{class:"typing-bubble"},[e("span",{class:"typing-dot"}),e("span",{class:"typing-dot"}),e("span",{class:"typing-dot"})],-1)),e("p",S8,_(c.value)+" ...",1)])):(p(),f("div",A8,[...F[10]||(F[10]=[e("div",{class:"spinner"},null,-1),e("p",null,"... ( )",-1)])]))],512),o.isUserOP&&!x.value?(p(),f("div",I8,[e("button",{class:"op-action-btn lock-btn",onClick:W},[...F[11]||(F[11]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18"},[e("path",{fill:"currentColor",d:"M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"})],-1),ot("  ",-1)])])])):N("",!0),x.value?(p(),f("div",L8,[e("div",T8,[F[13]||(F[13]=e("span",{class:"locked-icon"},"",-1)),e("div",j8,[F[12]||(F[12]=e("p",{class:"locked-title"},"",-1)),e("p",P8,_(((ie=$.value)==null?void 0:ie.lockedReason)||""),1)])])])):N("",!0),S.value?(p(),f("div",E8,[F[14]||(F[14]=mt('<div class="kicked-content" data-v-a03c10bc><span class="kicked-icon" data-v-a03c10bc></span><div class="kicked-text" data-v-a03c10bc><p class="kicked-title" data-v-a03c10bc></p><p class="kicked-reason" data-v-a03c10bc></p></div></div>',1)),e("button",{onClick:F[1]||(F[1]=re=>R.$emit("back")),class:"back-to-forum-btn"},"")])):N("",!0),b.value?(p(),f("div",{key:3,class:"context-menu-overlay",onClick:D},[e("div",{class:"context-menu",style:Oe({left:w.value.x+"px",top:w.value.y+"px"}),onClick:F[2]||(F[2]=Pe(()=>{},["stop"]))},[(p(!0),f(Le,null,Fe(I.value,re=>(p(),f("button",{key:re.id,onClick:pe=>te(re.id),class:Se(["context-menu-item",`color-${re.color}`])},_(re.label),11,B8))),128))],4)])):N("",!0),!x.value&&!S.value?(p(),f("div",V8,[e("div",D8,[ke(e("input",{type:"text","onUpdate:modelValue":F[3]||(F[3]=re=>n.value=re),onKeyup:ns(T,["enter"]),placeholder:"... (--`)",class:"reply-input"},null,544),[[je,n.value]]),F[15]||(F[15]=e("div",{class:"input-actions"},[e("span",null,""),e("span",null,"")],-1))]),e("button",{onClick:T,class:"send-btn",disabled:!n.value.trim()},[...F[16]||(F[16]=[e("span",{class:"send-icon"},"",-1)])],8,H8)])):N("",!0)])}}},U8=Xe(F8,[["__scopeId","data-v-a03c10bc"]]),R8={class:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"},N8={class:"bg-white border-4 border-black rounded-2xl shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] w-full max-w-2xl max-h-[80vh] flex flex-col"},O8={class:"p-4 border-b-4 border-black flex justify-between items-center bg-pink-100"},z8={class:"flex-1 p-6 overflow-y-auto space-y-6"},K8={class:"border-2 border-black rounded-xl p-4 bg-pink-50"},W8=["disabled"],G8={class:"border-2 border-black rounded-xl p-4 bg-purple-50"},q8={class:"flex items-center gap-4"},Z8={class:"w-16 text-center"},J8={class:"text-2xl font-black text-purple-600"},Y8=["disabled"],X8={class:"border-2 border-black rounded-xl p-4 bg-blue-50"},Q8={key:0,class:"text-center py-8 text-gray-400"},e9={key:1,class:"space-y-2"},t9=["onClick"],s9={class:"flex items-center justify-between"},o9={class:"flex-1"},n9={class:"font-black text-sm"},a9={class:"text-xs opacity-70 mt-1"},l9={key:0,class:"text-xl"},i9={key:2,class:"mt-3 flex gap-3"},r9=["disabled"],c9=["disabled"],d9={class:"border-2 border-black rounded-xl p-4 bg-red-50"},u9={class:"space-y-3"},v9={class:"flex items-center gap-2"},p9={class:"font-bold"},f9={class:"text-gray-600"},m9={class:"text-red-500 font-black"},g9={class:"border-t-2 border-black/10 pt-3 flex items-center gap-3"},h9={class:"flex-1"},y9={class:"text-sm font-bold"},b9={class:"text-red-500"},w9=["disabled"],k9={class:"p-4 border-t-4 border-black flex justify-end"},x9={__name:"forumsetting",emits:["close","refresh"],setup(t,{emit:s}){const o=s,n=h(""),a=h([]),l=h(null),i=h(5),r=h([]),c=h(0),d=h(!1),u=h(!1),v=[{id:"worldbook",name:"",icon:""},{id:"ghost",name:"",icon:""},{id:"daily",name:"",icon:""},{id:"funny",name:"",icon:""},{id:"rant",name:"",icon:""},{id:"diary",name:"",icon:""},{id:"food",name:"",icon:""}],b=async()=>{try{const A=await C.getAllWorldBooks();console.log(":",A);const T={};A.forEach(G=>{G.bookName&&(T[G.bookName]||(T[G.bookName]={id:G.bookName,name:G.bookName,entries:[]}),T[G.bookName].entries.push(G))}),a.value=Object.values(T),console.log(":",a.value)}catch(A){console.error(":",A)}},w=async()=>{try{const A=await dt.getForumWorldView();A&&(n.value=A);const T=await dt.getSelectedWorldBook();T&&(l.value=T);const G=await dt.getReplyCount();G&&(i.value=G);const K=await dt.getAllThreads();let q=0;r.value=v.map(ee=>{const Z=K.filter(m=>m.category===ee.id&&!m.blocked).sort((m,g)=>{const D=new Date(m.createdAt||0).getTime();return new Date(g.createdAt||0).getTime()-D}),E=Z.length>5?Z.length-5:0;return q+=E,{...ee,foldedCount:E}}),c.value=q}catch(A){console.error(":",A)}},I=async()=>{if(!n.value.trim()){alert("");return}d.value=!0;try{await dt.saveForumWorldView(n.value.trim()),alert("")}catch(A){console.error(":",A),alert(""+A.message)}finally{d.value=!1}},j=A=>{l.value=A},$=async()=>{if(!l.value){alert("");return}d.value=!0;try{await dt.saveSelectedWorldBook(l.value),alert("")}catch(A){console.error(":",A),alert(""+A.message)}finally{d.value=!1}},x=async()=>{if(confirm("")){d.value=!0;try{await dt.saveSelectedWorldBook(null),l.value=null,alert("")}catch(A){console.error(":",A),alert(""+A.message)}finally{d.value=!1}}},S=async()=>{d.value=!0;try{await dt.saveReplyCount(i.value),alert("")}catch(A){console.error(":",A),alert(""+A.message)}finally{d.value=!1}},M=async()=>{if(c.value!==0&&confirm(` ${c.value} `)){u.value=!0;try{const A=await dt.getAllThreads();let T=0;for(const G of v){const K=A.filter(q=>q.category===G.id&&!q.blocked).sort((q,ee)=>{const Z=new Date(q.createdAt||0).getTime();return new Date(ee.createdAt||0).getTime()-Z});if(K.length>5){const q=K.slice(5);for(const ee of q)await dt.deleteThread(ee.id),T++}}await w(),alert(` ${T} `),o("refresh")}catch(A){console.error(":",A),alert(""+A.message)}finally{u.value=!1}}};return it(async()=>{await b(),await w()}),(A,T)=>(p(),f("div",R8,[e("div",N8,[e("div",O8,[T[4]||(T[4]=e("h2",{class:"text-xl font-black uppercase"}," ",-1)),e("button",{onClick:T[0]||(T[0]=G=>A.$emit("close")),class:"text-2xl font-black hover:text-pink-500 transition-colors"},"")]),e("div",z8,[e("div",K8,[T[5]||(T[5]=e("h3",{class:"text-lg font-black mb-3 flex items-center gap-2"},[e("span",null,""),e("span",null,"")],-1)),T[6]||(T[6]=e("p",{class:"text-xs text-gray-600 mb-3"},"AI ",-1)),ke(e("textarea",{"onUpdate:modelValue":T[1]||(T[1]=G=>n.value=G),placeholder:"...",class:"w-full px-4 py-3 border-2 border-black rounded-lg font-mono text-sm h-32 resize-none focus:outline-none focus:ring-2 focus:ring-pink-400"},null,512),[[je,n.value]]),e("button",{onClick:I,disabled:d.value,class:"mt-3 px-4 py-2 bg-pink-400 text-white font-black border-2 border-black rounded-lg shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] hover:translate-y-0.5 hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] transition-all disabled:opacity-50"},_(d.value?"...":" "),9,W8)]),e("div",G8,[T[8]||(T[8]=e("h3",{class:"text-lg font-black mb-3 flex items-center gap-2"},[e("span",null,""),e("span",null,"")],-1)),T[9]||(T[9]=e("p",{class:"text-xs text-gray-600 mb-3"}," AI ",-1)),e("div",q8,[ke(e("input",{type:"range","onUpdate:modelValue":T[2]||(T[2]=G=>i.value=G),min:"1",max:"10",class:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-500"},null,512),[[je,i.value,void 0,{number:!0}]]),e("div",Z8,[e("span",J8,_(i.value),1),T[7]||(T[7]=e("span",{class:"text-xs text-gray-600 block"},"",-1))])]),e("button",{onClick:S,disabled:d.value,class:"mt-3 px-4 py-2 bg-purple-400 text-white font-black border-2 border-black rounded-lg shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] hover:translate-y-0.5 hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] transition-all disabled:opacity-50"},_(d.value?"...":" "),9,Y8)]),e("div",X8,[T[11]||(T[11]=e("h3",{class:"text-lg font-black mb-3 flex items-center gap-2"},[e("span",null,""),e("span",null,"")],-1)),T[12]||(T[12]=e("p",{class:"text-xs text-gray-600 mb-3"},"",-1)),a.value.length===0?(p(),f("div",Q8,[...T[10]||(T[10]=[e("p",{class:"text-sm"},"",-1),e("p",{class:"text-xs mt-2"},"",-1)])])):(p(),f("div",e9,[(p(!0),f(Le,null,Fe(a.value,G=>{var K;return p(),f("div",{key:G.id,onClick:q=>j(G.id),class:Se(["p-3 border-2 border-black rounded-lg cursor-pointer transition-all",l.value===G.id?"bg-blue-400 text-white shadow-[3px_3px_0px_0px_rgba(0,0,0,1)]":"bg-white hover:bg-blue-100"])},[e("div",s9,[e("div",o9,[e("p",n9,_(G.name),1),e("p",a9,_(((K=G.entries)==null?void 0:K.length)||0)+" ",1)]),l.value===G.id?(p(),f("div",l9,"")):N("",!0)])],10,t9)}),128))])),a.value.length>0?(p(),f("div",i9,[e("button",{onClick:$,disabled:d.value||!l.value,class:"flex-1 px-4 py-2 bg-blue-400 text-white font-black border-2 border-black rounded-lg shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] hover:translate-y-0.5 hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] transition-all disabled:opacity-50"},_(d.value?"...":" "),9,r9),e("button",{onClick:x,disabled:d.value||!l.value,class:"px-4 py-2 bg-gray-400 text-white font-black border-2 border-black rounded-lg shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] hover:translate-y-0.5 hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] transition-all disabled:opacity-50"},_(d.value?"...":" "),9,c9)])):N("",!0)]),e("div",d9,[T[16]||(T[16]=e("h3",{class:"text-lg font-black mb-3 flex items-center gap-2"},[e("span",null,""),e("span",null,"")],-1)),T[17]||(T[17]=e("p",{class:"text-xs text-gray-600 mb-3"},"6",-1)),e("div",u9,[(p(!0),f(Le,null,Fe(r.value,G=>(p(),f("div",{key:G.id,class:"flex items-center justify-between text-sm"},[e("div",v9,[e("span",null,_(G.icon),1),e("span",p9,_(G.name),1)]),e("span",f9,[T[13]||(T[13]=ot(": ",-1)),e("span",m9,_(G.foldedCount),1),T[14]||(T[14]=ot(" ",-1))])]))),128)),e("div",g9,[e("div",h9,[e("p",y9,[T[15]||(T[15]=ot(": ",-1)),e("span",b9,_(c.value),1)])]),e("button",{onClick:M,disabled:u.value||c.value===0,class:"px-4 py-2 bg-red-500 text-white font-black border-2 border-black rounded-lg shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] hover:translate-y-0.5 hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] transition-all disabled:opacity-50"},_(u.value?"...":" "),9,w9)])])])]),e("div",k9,[e("button",{onClick:T[3]||(T[3]=G=>A.$emit("close")),class:"px-6 py-3 bg-gray-200 text-black font-black border-2 border-black rounded-xl hover:bg-gray-300 transition-colors"},"  ")])])]))}},C9=Xe(x9,[["__scopeId","data-v-0c738226"]]),$9={class:"flex flex-col h-full w-full bg-white text-black font-mono selection:bg-pink-100 overflow-hidden relative"},_9={key:0,class:"flex flex-col h-full"},M9={class:"bg-black text-white px-3 py-1.5 flex justify-between items-center text-[10px] font-black tracking-widest z-50 uppercase"},S9={class:"flex items-center gap-2"},A9={class:"flex gap-2 items-center"},I9=["disabled"],L9={class:"flex-1 flex flex-col overflow-hidden relative"},T9={class:"bg-white border-b-4 border-black z-40 shadow-sm overflow-x-auto category-scroll flex-shrink-0"},j9={class:"flex p-4 gap-3 bg-white min-w-max"},P9=["onClick"],E9={class:"flex-1 p-4 space-y-6 bg-[#fcfcfc] overflow-y-auto pb-24 post-list-scroll"},B9={key:0,class:"absolute top-3 right-3 flex items-center gap-1"},V9={key:1,class:"absolute top-3 left-3"},D9={class:"flex items-center gap-2 mb-2"},H9={class:"text-[9px] font-black bg-white border-2 border-black px-1.5 py-0.5 uppercase"},F9={class:"text-[9px] font-bold opacity-30 italic font-mono"},U9=["onClick"],R9={class:"flex justify-between items-center text-[10px] font-black border-t-2 border-black/5 pt-3"},N9={class:"flex gap-4"},O9={class:"flex items-center gap-1"},z9={class:"flex items-center gap-1 text-pink-500"},K9={class:"flex gap-2"},W9=["onClick","title"],G9=["onClick"],q9={key:0,class:"flex justify-center pt-4"},Z9={key:1,class:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"},J9={class:"bg-white border-4 border-black rounded-2xl shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] w-full max-w-md max-h-[80vh] flex flex-col"},Y9={class:"flex-1 p-4 overflow-y-auto"},X9={class:"space-y-4"},Q9=["value"],e_={class:"text-xs text-gray-500 mt-1"},t_={class:"text-xs text-gray-500 mt-1"},s_={class:"p-4 border-t-4 border-black flex gap-3"},o_=["disabled"],n_={__name:"forumcenter",emits:["update:inThread","back","openPostEditor"],setup(t,{expose:s,emit:o}){const n=o,a=h(new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),l=h("ghost"),i=h(!1),r=h(null),c=h([]),d=h(!1),u=h(!1),v=h(!1),b=h(!1),w=h(!1),I=h({category:"ghost",title:"",content:""}),j=[{id:"worldbook",name:"",icon:""},{id:"ghost",name:"",icon:""},{id:"daily",name:"",icon:""},{id:"funny",name:"",icon:""},{id:"rant",name:"",icon:""},{id:"diary",name:"",icon:""},{id:"food",name:"",icon:""}],$=async()=>{try{const W=await dt.getAllThreads();c.value=W.sort((te,R)=>{const F=new Date(te.createdAt||0).getTime();return new Date(R.createdAt||0).getTime()-F})}catch(W){console.error(":",W)}},x=tt(()=>c.value.filter(W=>W.category===l.value&&!W.blocked)),S=tt(()=>u.value?x.value:x.value.slice(0,5)),M=tt(()=>x.value.length>5),A=()=>{u.value=!u.value},T=()=>{v.value=!0,I.value={category:l.value,title:"",content:""}},G=()=>{v.value=!1,I.value={category:"ghost",title:"",content:""}},K=async()=>{if(!(!I.value.title||!I.value.content)){b.value=!0;try{const W=localStorage.getItem("username")||"",te={id:Date.now(),category:I.value.category,title:I.value.title,replies:0,time:so().split(" ")[1],tags:g(I.value.category),color:D(I.value.category),isLive:!0,isUserThread:!0,createdAt:new Date().toISOString(),posts:[{id:Date.now(),user:W,content:I.value.content,date:so(),isOP:!0,count:1,idCode:So()}]};await dt.saveThread(te),await $(),G(),alert("AI ..."),Z(te)}catch(W){console.error(":",W),alert(""+W.message)}finally{b.value=!1}}},q=async W=>{try{const te=await dt.favoriteThread(W);await $(),console.log(te?"":"")}catch(te){console.error(":",te)}},ee=async W=>{try{const te=await dt.blockThread(W);await $(),alert(te?"":"")}catch(te){console.error(":",te)}},Z=W=>{r.value=W,i.value=!0},E=async()=>{i.value=!1,r.value=null,await $()},m=async()=>{if(!d.value){d.value=!0;try{const W=await r8(l.value,3);if(!W||W.length===0)throw new Error("");for(const te of W){const R={id:Date.now()+Math.random(),category:l.value,title:te,replies:0,time:so().split(" ")[1],tags:g(l.value),color:D(l.value),isLive:!1,posts:[],aiGenerated:!0,needsContent:!0,createdAt:new Date().toISOString()};await dt.saveThread(R),await new Promise(F=>setTimeout(F,100))}await $(),alert(` ${W.length} `)}catch(W){console.error("AI :",W),alert(""+W.message)}finally{d.value=!1}}},g=W=>({worldbook:"World Event",ghost:"Urban Legend",daily:"Daily Life",funny:"Funny",rant:"Rant",diary:"Diary",food:"Cooking"})[W]||"General",D=W=>({worldbook:"bg-purple-50",ghost:"bg-gray-50",daily:"bg-amber-50",funny:"bg-yellow-50",rant:"bg-red-50",diary:"bg-pink-50",food:"bg-white"})[W]||"bg-white";return Ft(i,W=>{n("update:inThread",W)}),Ft(v,W=>{n("update:inThread",W)}),Ft(w,W=>{n("update:inThread",W)}),s({openPostEditor:T}),it(async()=>{await dt.initDefaultThreads(),await $(),setInterval(()=>{a.value=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},1e3)}),(W,te)=>(p(),f("div",$9,[te[16]||(te[16]=e("div",{class:"absolute inset-0 pointer-events-none z-[100] opacity-[0.04] scanline-effect"},null,-1)),i.value?N("",!0):(p(),f("div",_9,[e("div",M9,[e("div",S9,[e("button",{onClick:te[0]||(te[0]=R=>W.$emit("back")),class:"p-1 hover:bg-white/10 rounded transition-colors"},[Ye(Ke(lr),{size:14,class:"text-pink-400"})]),Ye(Ke(rr),{size:12,class:"text-pink-400 animate-pulse"}),te[6]||(te[6]=e("span",null,"DREAM_OS_DOLLETTE_V2",-1))]),e("div",A9,[e("button",{onClick:m,disabled:d.value,class:"px-2 py-1 bg-pink-500 hover:bg-pink-600 rounded text-[9px] font-black transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},_(d.value?"...":" AI"),9,I9),e("span",null,_(a.value),1),e("button",{onClick:te[1]||(te[1]=R=>w.value=!0),class:"w-3 h-3 border-2 border-white hover:bg-white/20 transition-colors cursor-pointer",title:""})])]),e("div",L9,[te[11]||(te[11]=e("div",{class:"p-6 bg-white border-b-[6px] border-black flex flex-col items-center relative flex-shrink-0"},[e("div",{class:"text-2xl mb-1"},"  "),e("h1",{class:"text-3xl font-black italic tracking-tighter uppercase"},"Dreamy Log"),e("div",{class:"text-[10px] font-black bg-pink-200 px-3 py-1 border-2 border-black rounded-full mt-2 shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] uppercase tracking-widest"}," Restricted Area /  ")],-1)),e("div",T9,[e("div",j9,[(p(),f(Le,null,Fe(j,R=>e("button",{key:R.id,onClick:F=>l.value=R.id,class:Se(["flex-shrink-0 px-5 py-2.5 text-xs font-black uppercase transition-all border-2 border-black rounded-xl whitespace-nowrap",l.value===R.id?"bg-black text-white":"bg-white text-black shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] hover:bg-pink-50"])},_(R.icon)+" "+_(R.name),11,P9)),64))])]),e("div",E9,[(p(!0),f(Le,null,Fe(S.value,R=>(p(),f("div",{key:R.id,class:"relative group"},[te[10]||(te[10]=e("div",{class:"absolute inset-0 bg-black translate-x-1.5 translate-y-1.5 rounded-2xl border-2 border-black"},null,-1)),e("div",{class:Se(["relative p-5 border-4 border-black rounded-2xl hover:-translate-y-1 transition-transform",R.color])},[R.userReplied||R.isLive?(p(),f("div",B9,[...te[7]||(te[7]=[e("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-ping"},null,-1),e("span",{class:"text-[8px] font-black text-red-500 uppercase italic"},"Live Story",-1)])])):N("",!0),R.favorited?(p(),f("div",V9,[...te[8]||(te[8]=[e("span",{class:"text-yellow-500 text-lg"},"",-1)])])):N("",!0),e("div",D9,[e("span",H9,_(R.tags),1),e("span",F9,_(R.time),1)]),e("h3",{onClick:F=>Z(R),class:"text-[16px] font-black leading-tight mb-4 group-hover:underline decoration-pink-300 decoration-2 cursor-pointer"},_(R.title),9,U9),e("div",R9,[e("div",N9,[e("span",O9,[Ye(Ke(ir),{size:12}),ot(" "+_(R.replies)+" ",1)]),e("span",z9,[Ye(Ke(cr),{size:12}),te[9]||(te[9]=ot(" ",-1))])]),e("div",K9,[e("button",{onClick:Pe(F=>q(R.id),["stop"]),class:"p-1 hover:bg-black/5 rounded transition-colors",title:R.favorited?"":""},_(R.favorited?"":""),9,W9),e("button",{onClick:Pe(F=>ee(R.id),["stop"]),class:"p-1 hover:bg-black/5 rounded transition-colors",title:""},"  ",8,G9),Ye(Ke(X6),{size:16,onClick:F=>Z(R),class:"cursor-pointer"},null,8,["onClick"])])])],2)]))),128)),M.value?(p(),f("div",q9,[e("button",{onClick:A,class:"px-6 py-3 bg-black text-white font-black text-sm border-2 border-black rounded-xl shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:translate-y-0.5 hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] transition-all"},_(u.value?" ":` (${x.value.length-5}+) `),1)])):N("",!0)])])])),v.value?(p(),f("div",Z9,[e("div",J9,[e("div",{class:"p-4 border-b-4 border-black flex justify-between items-center bg-pink-100"},[te[12]||(te[12]=e("h2",{class:"text-xl font-black"}," ",-1)),e("button",{onClick:G,class:"text-2xl font-black hover:text-pink-500 transition-colors"},"")]),e("div",Y9,[e("div",X9,[e("div",null,[te[13]||(te[13]=e("label",{class:"block text-xs font-black mb-2 uppercase"},"",-1)),ke(e("select",{"onUpdate:modelValue":te[2]||(te[2]=R=>I.value.category=R),class:"w-full px-4 py-2 border-2 border-black rounded-lg font-bold"},[(p(),f(Le,null,Fe(j,R=>e("option",{key:R.id,value:R.id},_(R.icon)+" "+_(R.name),9,Q9)),64))],512),[[Hs,I.value.category]])]),e("div",null,[te[14]||(te[14]=e("label",{class:"block text-xs font-black mb-2 uppercase"},"",-1)),ke(e("input",{"onUpdate:modelValue":te[3]||(te[3]=R=>I.value.title=R),type:"text",placeholder:"...",class:"w-full px-4 py-2 border-2 border-black rounded-lg font-bold",maxlength:"50"},null,512),[[je,I.value.title]]),e("div",e_,_(I.value.title.length)+"/50",1)]),e("div",null,[te[15]||(te[15]=e("label",{class:"block text-xs font-black mb-2 uppercase"},"",-1)),ke(e("textarea",{"onUpdate:modelValue":te[4]||(te[4]=R=>I.value.content=R),placeholder:"...",class:"w-full px-4 py-2 border-2 border-black rounded-lg font-bold h-32 resize-none",maxlength:"500"},null,512),[[je,I.value.content]]),e("div",t_,_(I.value.content.length)+"/500",1)])])]),e("div",s_,[e("button",{onClick:G,class:"flex-1 px-4 py-3 bg-gray-200 text-black font-black border-2 border-black rounded-xl hover:bg-gray-300 transition-colors"},"  "),e("button",{onClick:K,disabled:!I.value.title||!I.value.content||b.value,class:"flex-1 px-4 py-3 bg-pink-400 text-white font-black border-2 border-black rounded-xl shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] hover:translate-y-0.5 hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] transition-all disabled:opacity-50 disabled:cursor-not-allowed"},_(b.value?"...":" "),9,o_)])])])):N("",!0),i.value&&r.value?(p(),nt(U8,{key:2,threadId:r.value.id,threadTitle:r.value.title,posts:r.value.posts,isUserThread:r.value.isUserThread,category:r.value.category,onBack:E},null,8,["threadId","threadTitle","posts","isUserThread","category"])):N("",!0),w.value?(p(),nt(C9,{key:3,onClose:te[5]||(te[5]=R=>w.value=!1),onRefresh:$})):N("",!0)]))}},a_=Xe(n_,[["__scopeId","data-v-e2f0063f"]]),l_={class:"flex flex-col h-full w-full bg-white text-black font-mono selection:bg-pink-100 overflow-hidden relative"},i_={class:"bg-black text-white px-3 py-1.5 flex justify-between items-center text-[10px] font-black tracking-widest z-50 uppercase"},r_={class:"flex items-center gap-2"},c_={class:"flex gap-4 items-center"},d_={class:"flex-1 overflow-hidden relative"},u_={class:"p-4 space-y-8 animate-fade-in pb-24 h-full overflow-y-auto"},v_={class:"bg-black text-white p-6 rounded-[2.5rem] relative overflow-hidden"},p_={class:"relative z-10 flex flex-col items-center gap-4"},f_=["src"],m_={class:"text-center"},g_={class:"space-y-4"},h_={key:0,class:"p-8 border-4 border-dashed border-gray-300 bg-gray-50 rounded-2xl text-center"},y_=["onClick"],b_={class:"absolute -right-4 -bottom-4 opacity-[0.05] group-hover:scale-150 transition-transform"},w_={class:"flex justify-between items-start mb-2"},k_={class:"text-[10px] font-black border-2 border-black px-2 py-0.5 bg-pink-100 font-mono underline italic"},x_={class:"text-[9px] font-bold opacity-30 italic font-mono"},C_={class:"text-[11px] leading-relaxed font-mono relative z-10 italic line-clamp-2"},$_={class:"flex items-center gap-2 mt-3 text-[9px] font-bold text-gray-400"},__={class:"bg-white border-4 border-black rounded-2xl p-6 max-w-md w-full shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]"},M_={class:"space-y-4"},S_={class:"flex justify-center"},A_=["src"],I_={class:"bg-white border-4 border-black rounded-2xl p-6 max-w-md w-full shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]"},L_={class:"space-y-4"},T_={class:"flex gap-2"},j_={__name:"forumprofie",emits:["back"],setup(t){const s=h(new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),o=h({username:"DollyMoon",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Marshmallow"}),n=h([]),a=h(!1),l=h(!1),i=h("Marshmallow"),r=h(""),c=h(null),d=h(null),u=tt(()=>c.value?c.value:`https://api.dicebear.com/7.x/avataaars/svg?seed=${i.value}`),v=S=>{const M=S.target.files[0];if(!M)return;const A=new FileReader;A.onload=T=>{c.value=T.target.result},A.readAsDataURL(M)},b=()=>{a.value=!1,c.value=null,d.value&&(d.value.value="")},w=async()=>{try{const S=await dt.getUserProfile();o.value=S,i.value=S.avatarSeed||"Marshmallow"}catch(S){console.error(":",S)}},I=async()=>{try{const S=await dt.getAllThreads();n.value=S.filter(M=>M.isUserThread).sort((M,A)=>{const T=new Date(M.createdAt||0).getTime();return new Date(A.createdAt||0).getTime()-T})}catch(S){console.error(":",S)}},j=S=>{console.log(":",S)},$=async()=>{try{const S=c.value||`https://api.dicebear.com/7.x/avataaars/svg?seed=${i.value}`;await dt.saveUserProfile({username:o.value.username,avatar:S,avatarSeed:i.value}),o.value.avatar=S,b()}catch(S){console.error(":",S)}},x=async()=>{if(r.value.trim())try{await dt.saveUserProfile({username:r.value.trim(),avatar:o.value.avatar,avatarSeed:i.value}),o.value.username=r.value.trim(),l.value=!1,r.value=""}catch(S){console.error(":",S)}};return it(()=>{w(),I(),setInterval(()=>{s.value=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},1e3)}),(S,M)=>(p(),f("div",l_,[M[22]||(M[22]=e("div",{class:"absolute inset-0 pointer-events-none z-[100] opacity-[0.04] scanline-effect"},null,-1)),e("div",i_,[e("div",r_,[e("button",{onClick:M[0]||(M[0]=A=>S.$emit("back")),class:"p-1 hover:bg-white/10 rounded transition-colors"},[Ye(Ke(lr),{size:14,class:"text-pink-400"})]),Ye(Ke(rr),{size:12,class:"text-pink-400 animate-pulse"}),M[9]||(M[9]=e("span",null,"DREAM_OS_DOLLETTE_V2",-1))]),e("div",c_,[e("span",null,_(s.value),1),M[10]||(M[10]=e("div",{class:"w-3 h-3 border-2 border-white"},null,-1))])]),e("div",d_,[e("div",u_,[e("div",v_,[e("div",p_,[e("button",{onClick:M[1]||(M[1]=A=>a.value=!0),class:"w-24 h-24 rounded-full border-4 border-white overflow-hidden bg-white shadow-xl hover:scale-105 transition-transform cursor-pointer"},[e("img",{src:o.value.avatar,alt:"me",class:"grayscale contrast-125 w-full h-full object-cover"},null,8,f_)]),e("div",m_,[e("button",{onClick:M[2]||(M[2]=A=>l.value=!0),class:"text-2xl font-black italic tracking-tighter uppercase flex items-center gap-2 justify-center hover:text-pink-300 transition-colors cursor-pointer"},[M[11]||(M[11]=e("span",{class:"text-pink-400 font-bold px-1"},"",-1)),ot(" "+_(o.value.username)+" ",1),M[12]||(M[12]=e("span",{class:"text-pink-400 font-bold px-1"},"",-1))]),M[13]||(M[13]=e("p",{class:"text-[10px] font-bold opacity-60 uppercase tracking-widest mt-1 italic font-mono"}," Status:  429 ... ",-1))])])]),e("div",g_,[M[15]||(M[15]=e("h3",{class:"text-sm font-black italic border-l-8 border-pink-400 pl-3 uppercase"}," / My Echoes",-1)),n.value.length===0?(p(),f("div",h_,[...M[14]||(M[14]=[e("div",{class:"text-4xl mb-3 opacity-30"},"",-1),e("p",{class:"text-sm font-bold text-gray-400 italic"},"",-1),e("p",{class:"text-xs text-gray-300 mt-1"},"",-1)])])):N("",!0),(p(!0),f(Le,null,Fe(n.value,(A,T)=>(p(),f("div",{key:A.id,class:"p-5 border-4 border-black bg-white shadow-[6px_6px_0px_0px_rgba(255,193,214,1)] relative overflow-hidden group cursor-pointer hover:translate-y-[-2px] transition-transform",onClick:G=>j(A)},[e("div",b_,[Ye(Ke(Q6),{size:80})]),e("div",w_,[e("span",k_," D-LOG #"+_(String(n.value.length-T).padStart(2,"0")),1),e("span",x_,_(A.time),1)]),e("p",C_,' "'+_(A.title)+'" ',1),e("div",$_,[e("span",null," "+_(A.replies)+" ",1),e("span",null,_(A.tags),1)])],8,y_))),128))])])]),a.value?(p(),f("div",{key:0,class:"fixed inset-0 bg-black/50 z-[200] flex items-center justify-center p-4",onClick:M[5]||(M[5]=Pe(A=>a.value=!1,["self"]))},[e("div",__,[M[19]||(M[19]=e("h3",{class:"text-xl font-black mb-4 uppercase"},"",-1)),e("div",M_,[e("div",null,[M[16]||(M[16]=e("label",{class:"text-sm font-bold mb-2 block"},"",-1)),e("input",{ref_key:"fileInput",ref:d,type:"file",accept:"image/*",onChange:v,class:"hidden"},null,544),e("button",{onClick:M[3]||(M[3]=A=>S.$refs.fileInput.click()),class:"w-full px-4 py-2 border-2 border-black rounded-lg font-bold bg-blue-100 hover:bg-blue-200 transition-colors"},"   ")]),M[18]||(M[18]=e("div",{class:"text-center text-xs font-bold opacity-50"},"",-1)),e("div",null,[M[17]||(M[17]=e("label",{class:"text-sm font-bold mb-2 block"},"",-1)),ke(e("input",{"onUpdate:modelValue":M[4]||(M[4]=A=>i.value=A),type:"text",class:"w-full px-4 py-2 border-2 border-black rounded-lg font-mono",placeholder:"Marshmallow, Cute, Cool..."},null,512),[[je,i.value]])]),e("div",S_,[e("img",{src:u.value,class:Se(["w-24 h-24 rounded-full border-4 border-black object-cover",{"grayscale contrast-125":!c.value}])},null,10,A_)]),e("div",{class:"flex gap-2"},[e("button",{onClick:$,class:"flex-1 bg-pink-200 border-2 border-black rounded-lg py-2 font-black uppercase hover:bg-pink-300 transition-colors shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] active:translate-x-1 active:translate-y-1 active:shadow-none"},"  "),e("button",{onClick:b,class:"flex-1 bg-gray-200 border-2 border-black rounded-lg py-2 font-black uppercase hover:bg-gray-300 transition-colors shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] active:translate-x-1 active:translate-y-1 active:shadow-none"},"  ")])])])])):N("",!0),l.value?(p(),f("div",{key:1,class:"fixed inset-0 bg-black/50 z-[200] flex items-center justify-center p-4",onClick:M[8]||(M[8]=Pe(A=>l.value=!1,["self"]))},[e("div",I_,[M[21]||(M[21]=e("h3",{class:"text-xl font-black mb-4 uppercase"},"",-1)),e("div",L_,[e("div",null,[M[20]||(M[20]=e("label",{class:"text-sm font-bold mb-2 block"},"",-1)),ke(e("input",{"onUpdate:modelValue":M[6]||(M[6]=A=>r.value=A),type:"text",class:"w-full px-4 py-2 border-2 border-black rounded-lg font-mono",placeholder:"...",maxlength:"20"},null,512),[[je,r.value]])]),e("div",T_,[e("button",{onClick:x,class:"flex-1 bg-pink-200 border-2 border-black rounded-lg py-2 font-black uppercase hover:bg-pink-300 transition-colors shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] active:translate-x-1 active:translate-y-1 active:shadow-none"},"  "),e("button",{onClick:M[7]||(M[7]=A=>l.value=!1),class:"flex-1 bg-gray-200 border-2 border-black rounded-lg py-2 font-black uppercase hover:bg-gray-300 transition-colors shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] active:translate-x-1 active:translate-y-1 active:shadow-none"},"  ")])])])])):N("",!0)]))}},P_=Xe(j_,[["__scopeId","data-v-61155bc8"]]),E_={class:"forum-app h-full w-full flex flex-col relative bg-[#fcfcfc]"},B_={class:"flex-1 overflow-hidden w-full"},V_={class:"fixed bottom-0 left-0 right-0 bg-white border-t-4 border-black z-50"},D_={class:"flex items-center justify-center relative h-20 px-4"},H_={class:"absolute left-4 flex gap-2"},F_={key:0,class:"absolute inset-0 bg-pink-100 border-2 border-black rounded-2xl shadow-[3px_3px_0px_0px_rgba(0,0,0,1)]"},U_=["stroke-width"],R_={class:"absolute right-4 flex gap-2"},N_={key:0,class:"absolute inset-0 bg-pink-100 border-2 border-black rounded-2xl shadow-[3px_3px_0px_0px_rgba(0,0,0,1)]"},O_=["stroke-width"],z_={__name:"ForumApp",emits:["back"],setup(t,{emit:s}){const o=h("home"),n=h(!1),a=h(null),l=r=>{n.value=r},i=()=>{a.value&&a.value.openPostEditor()};return(r,c)=>(p(),f("div",E_,[e("div",B_,[ke(Ye(a_,{ref_key:"forumCenterRef",ref:a,"onUpdate:inThread":l,onBack:c[0]||(c[0]=d=>r.$emit("back")),class:"w-full h-full"},null,512),[[go,o.value==="home"]]),ke(Ye(P_,{onBack:c[1]||(c[1]=d=>r.$emit("back")),class:"w-full h-full"},null,512),[[go,o.value==="profile"]])]),ke(e("div",V_,[e("div",D_,[e("div",H_,[e("button",{onClick:c[2]||(c[2]=d=>o.value="home"),class:Se(["flex flex-col items-center justify-center gap-1 px-6 py-2 transition-all relative",o.value==="home"?"text-black":"text-gray-400"])},[o.value==="home"?(p(),f("div",F_)):N("",!0),(p(),f("svg",{class:"relative z-10 w-6 h-6",fill:"none",stroke:"currentColor","stroke-width":o.value==="home"?2.5:2,viewBox:"0 0 24 24"},[...c[4]||(c[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"},null,-1)])],8,U_)),c[5]||(c[5]=e("span",{class:"relative z-10 text-[10px] font-black uppercase tracking-wider"},"Home",-1))],2)]),e("button",{onClick:i,class:"relative group"},[...c[6]||(c[6]=[e("div",{class:"absolute inset-0 bg-black rounded-full translate-x-1 translate-y-1"},null,-1),e("div",{class:"w-16 h-16 bg-pink-200 border-4 border-black rounded-full flex items-center justify-center relative active:translate-x-1 active:translate-y-1 transition-all shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]"},[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor","stroke-width":"3",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})])],-1)])]),e("div",R_,[e("button",{onClick:c[3]||(c[3]=d=>o.value="profile"),class:Se(["flex flex-col items-center justify-center gap-1 px-6 py-2 transition-all relative",o.value==="profile"?"text-black":"text-gray-400"])},[o.value==="profile"?(p(),f("div",N_)):N("",!0),(p(),f("svg",{class:"relative z-10 w-6 h-6",fill:"none",stroke:"currentColor","stroke-width":o.value==="profile"?2.5:2,viewBox:"0 0 24 24"},[...c[7]||(c[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"},null,-1)])],8,O_)),c[8]||(c[8]=e("span",{class:"relative z-10 text-[10px] font-black uppercase tracking-wider"},"User",-1))],2)])])],512),[[go,!n.value]])]))}},K_=Xe(z_,[["__scopeId","data-v-e29802b1"]]),Bl=["https://files.catbox.moe/0g3kqu.jpg","https://files.catbox.moe/d5b7k6.jpg","https://files.catbox.moe/0yrhh6.jpg","https://files.catbox.moe/8mjvdg.jpg","https://files.catbox.moe/fvidas.jpg","https://files.catbox.moe/q6so2i.jpg","https://files.catbox.moe/5a96cp.jpg","https://files.catbox.moe/0mp6h0.jpg","https://files.catbox.moe/epcn03.jpg","https://files.catbox.moe/7jzdp7.jpg","https://files.catbox.moe/jrmu6w.jpg","https://files.catbox.moe/c0bwhn.jpg","https://files.catbox.moe/0blxme.jpg","https://files.catbox.moe/qicobr.jpg","https://files.catbox.moe/n94ztu.jpg"];function us(){return Bl[Math.floor(Math.random()*Bl.length)]}function Ao(){const t=Math.floor(Math.random()*5e4)+100;return t>=1e4?(t/1e3).toFixed(1)+"k":t.toString()}function W_(t){return`6


1. 2-6
2. 10-25
3. 
4. "${t}"
5. 

 | 
|
|
|
|
|
|


|
Melo|
RinRin|

"${t}"6`}function Vl(t){const s=t.personality||t.prompt||t.description||t.bio||"",o=t.name||"";return console.log(" [] :"),console.log("   - :",o),console.log("   - personality:",t.personality),console.log("   - prompt:",t.prompt),console.log("   - description:",t.description),console.log("   - bio:",t.bio),console.log("   - :",s),`1

${o}
${s}


1. 
2. 10-25
3. 
4. 
5. 


${o}|


|

`}function G_(t,s,o=null){const n=t.personality||t.prompt||t.description||t.bio||"",a=t.name||"";console.log(" [] :"),console.log("   - :",a),console.log("   - personality:",t.personality),console.log("   - prompt:",t.prompt),console.log("   - description:",t.description),console.log("   - bio:",t.bio),console.log("   - :",n),console.log("   - :",s);const l=`"${a}"


- ${a}
- ${n}
- ${s}


1. ${a}
2. 


- 
- 
- 
-  5-8 
- 

${o?`

"${o}"`:""}

 ### 
###
[]

###
11
22
...

`;return console.log("   - :",l.length),l}function ea(t){const s=t.trim().split(`
`).filter(n=>n.trim()),o=[];for(const n of s){if(n.includes("")||n.includes("")||n.includes(""))continue;const a=n.split("|");if(a.length>=2){const l=a[0].trim(),i=a[1].trim();l&&i&&o.push({id:Date.now()+Math.random(),username:l,title:i,viewers:Ao(),cover:us(),isFollowing:!1})}}return o}const q_={class:"live-profile-container w-full h-screen bg-[#F8F9FA] flex flex-col"},Z_={class:"p-6"},J_={class:"bg-white rounded-3xl p-6 shadow-lg border-2 border-[#4A4A4A]"},Y_={class:"flex items-center gap-4 mb-6"},X_={class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-200 to-purple-200 flex items-center justify-center text-3xl border-4 border-white shadow-lg"},Q_={class:"flex-1"},e7={class:"text-xl font-black text-[#333] mb-1"},t7={class:"text-sm text-gray-500"},s7={class:"grid grid-cols-3 gap-4 mb-6"},o7={class:"text-center p-4 bg-pink-50 rounded-2xl"},n7={class:"text-2xl font-black text-pink-500"},a7={class:"text-center p-4 bg-purple-50 rounded-2xl"},l7={class:"text-2xl font-black text-purple-500"},i7={class:"text-center p-4 bg-blue-50 rounded-2xl"},r7={class:"text-2xl font-black text-blue-500"},c7={class:"flex-1 overflow-y-auto px-6 pb-6"},d7={key:0,class:"text-center py-12 text-gray-400"},u7={key:1,class:"space-y-4"},v7={class:"flex gap-4"},p7={class:"w-24 h-24 rounded-xl bg-gradient-to-br from-gray-100 to-gray-200 flex-shrink-0 overflow-hidden"},f7=["src"],m7={class:"flex-1 min-w-0"},g7={class:"font-bold text-[#333] mb-2 truncate"},h7={class:"flex items-center gap-4 text-xs text-gray-500"},y7={class:"text-xs text-gray-400 mt-2"},b7={__name:"LiveProfile",props:{streamerData:{type:Object,default:()=>({})}},emits:["back"],setup(t,{emit:s}){const o=t,n=s,a=tt(()=>{var v;return((v=o.streamerData)==null?void 0:v.name)||""}),l=tt(()=>{var v;return((v=o.streamerData)==null?void 0:v.bio)||"~"}),i=tt(()=>{var v;return((v=o.streamerData)==null?void 0:v.followers)||"0"}),r=tt(()=>{var v;return((v=o.streamerData)==null?void 0:v.views)||"0"}),c=tt(()=>{var v;return((v=o.streamerData)==null?void 0:v.likes)||"0"}),d=h([]),u=()=>{n("back")};return(v,b)=>(p(),f("div",q_,[e("header",{class:"flex-shrink-0 p-6 pb-4 flex items-center justify-between bg-white/80 backdrop-blur-md z-50 border-b border-gray-100"},[e("button",{onClick:u,class:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center active:scale-95 transition-all"},[...b[0]||(b[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"15 18 9 12 15 6"})],-1)])]),b[1]||(b[1]=e("h2",{class:"text-lg font-bold text-[#333]"},"",-1)),b[2]||(b[2]=e("div",{style:{width:"40px"}},null,-1))]),e("div",Z_,[e("div",J_,[e("div",Y_,[e("div",X_,_(a.value.charAt(0)),1),e("div",Q_,[e("h3",e7,_(a.value),1),e("p",t7,_(l.value),1)])]),e("div",s7,[e("div",o7,[e("div",n7,_(i.value),1),b[3]||(b[3]=e("div",{class:"text-xs text-gray-500 mt-1"},"",-1))]),e("div",a7,[e("div",l7,_(r.value),1),b[4]||(b[4]=e("div",{class:"text-xs text-gray-500 mt-1"},"",-1))]),e("div",i7,[e("div",r7,_(c.value),1),b[5]||(b[5]=e("div",{class:"text-xs text-gray-500 mt-1"},"",-1))])]),b[6]||(b[6]=mt('<div class="flex gap-3" data-v-c2ae2d9a><button class="flex-1 bg-gradient-to-r from-pink-400 to-purple-400 text-white py-3 rounded-2xl font-bold active:scale-95 transition-all shadow-lg" data-v-c2ae2d9a>  </button><button class="w-14 h-14 bg-gray-100 rounded-2xl flex items-center justify-center active:scale-95 transition-all" data-v-c2ae2d9a><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-c2ae2d9a><circle cx="12" cy="12" r="1" data-v-c2ae2d9a></circle><circle cx="12" cy="5" r="1" data-v-c2ae2d9a></circle><circle cx="12" cy="19" r="1" data-v-c2ae2d9a></circle></svg></button></div>',1))])]),e("div",c7,[b[8]||(b[8]=e("h3",{class:"text-lg font-bold text-[#333] mb-4"},"",-1)),d.value.length===0?(p(),f("div",d7,[...b[7]||(b[7]=[e("div",{class:"text-5xl mb-4"},"",-1),e("p",null,"",-1)])])):(p(),f("div",u7,[(p(!0),f(Le,null,Fe(d.value,w=>(p(),f("div",{key:w.id,class:"bg-white rounded-2xl p-4 border-2 border-gray-100 active:scale-98 transition-all"},[e("div",v7,[e("div",p7,[w.cover?(p(),f("img",{key:0,src:w.cover,class:"w-full h-full object-cover"},null,8,f7)):N("",!0)]),e("div",m7,[e("h4",g7,_(w.title),1),e("div",h7,[e("span",null," "+_(w.views),1),e("span",null," "+_(w.likes),1),e("span",null," "+_(w.comments),1)]),e("div",y7,_(w.date),1)])])]))),128))]))])]))}},w7=Xe(b7,[["__scopeId","data-v-c2ae2d9a"]]),k7={key:1,class:"fixed inset-0 bg-slate-200 font-sans"},x7={class:"phone-container w-full h-full bg-[#F8F9FA] relative flex flex-col"},C7={class:"flex-shrink-0 p-6 pb-4 flex items-center justify-between bg-white/80 backdrop-blur-md z-50 border-b border-gray-100"},$7={class:"flex gap-2"},_7=["disabled"],M7={class:"w-9 h-9 rounded-full bg-gray-50 flex items-center justify-center active:scale-90 transition-all border border-gray-100"},S7={class:"w-9 h-9 rounded-full bg-[#FFC0CB]/20 flex items-center justify-center active:scale-90 transition-all border border-[#FFC0CB]"},A7={class:"flex-1 overflow-y-auto no-scrollbar pb-32"},I7={key:0,class:"px-6 py-4 flex gap-3 overflow-x-auto no-scrollbar"},L7=["onClick"],T7=["onClick"],j7={class:"aspect-[4/5] rounded-[14px] relative overflow-hidden mb-2.5 transition-all bg-gradient-to-br from-gray-100 to-gray-200"},P7=["src","alt"],E7={class:"absolute bottom-2.5 right-2.5 bg-black/20 backdrop-blur-md text-white text-[8px] px-2 py-0.5 rounded-lg font-bold z-20 flex items-center border border-white/10"},B7={class:"px-1.5 pb-2 space-y-1.5"},V7={class:"text-[11px] font-black leading-snug h-8 overflow-hidden text-[#333] group-hover:text-pink-500 transition-colors"},D7={class:"flex items-center gap-2"},H7={class:"w-4 h-4 rounded-md bg-pink-50 flex items-center justify-center text-[10px] border border-gray-200"},F7={class:"text-[9px] font-bold text-gray-400 truncate uppercase tracking-tighter"},U7={class:"floating-nav"},R7=["onClick"],N7={class:"p-2 transition-all active:scale-75"},O7={class:"text-[7px] font-black uppercase tracking-widest leading-none"},z7={key:0,class:"absolute -bottom-1 w-1 h-1 bg-pink-500 rounded-full animate-bounce"},K7={__name:"Livecenter",emits:["close","open-detail"],setup(t,{emit:s}){const o=s,n=h(""),a=h(""),l=h(!1),i=h(!1),r=["","","","",""],c=[{name:"",icon:t8},{name:"",icon:e8},{name:"",icon:ir},{name:"",icon:o8}],d=h([]),u=h([]),v=[{id:1,title:" ",username:"",viewers:"15.4k",cover:us(),isFollowing:!1},{id:2,title:"",username:"Melo",viewers:"8.2k",cover:us(),isFollowing:!1},{id:3,title:"",username:"RinRin",viewers:"12.1k",cover:us(),isFollowing:!1},{id:4,title:"",username:"Ace",viewers:"5.9k",cover:us(),isFollowing:!1},{id:5,title:"",username:"Bunny",viewers:"22.1k",cover:us(),isFollowing:!1},{id:6,title:"",username:"Strum",viewers:"4.8k",cover:us(),isFollowing:!1}];(async()=>{try{console.log(" [] ...");const T=await C.getAllLiveContents();if(console.log("   - :",T.length),T.length===0){console.log("    "),d.value=v;return}const G=[],K=[];T.forEach((q,ee)=>{const Z={id:q.contactId||ee+1,title:q.title,username:q.username,viewers:q.viewers,cover:q.cover||us(),isFollowing:!!q.contactId,contactId:q.contactId};q.contactId?G.push(Z):K.push(Z)}),console.log("   - :",K.length),console.log("   - :",G.length),d.value=K.length>0?K:v,u.value=G,console.log("    ")}catch(T){console.error("    :",T),d.value=v}})();const w=tt(()=>a.value===""?u.value:d.value),I=()=>{o("close")},j=async()=>{if(!l.value)try{if(l.value=!0,a.value===""){await x();return}const T=await C.getSetting("apiConfig");if(!T||!T.apiKey){alert(" API Key");return}const G={provider:T.provider||"deepseek",apiKey:T.apiKey,baseUrl:T.baseUrl||"",model:T.model||"deepseek-chat"};let K=G.baseUrl;K||(G.provider==="deepseek"?K="https://api.deepseek.com":G.provider==="openai"?K="https://api.openai.com":G.provider==="gemini"&&(K="https://generativelanguage.googleapis.com")),K=K.replace(/\/v1\/?$/,"").replace(/\/$/,""),K=K+"/v1/chat/completions",console.log(" API URL:",K),console.log(":",G.model),console.log(":",n.value);const q=W_(n.value);console.log(":",q);const ee=await fetch(K,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${G.apiKey}`},body:JSON.stringify({model:G.model,messages:[{role:"user",content:q}],temperature:.9})});if(!ee.ok){const g=await ee.text();throw console.error("API :",g),new Error(`AI : ${ee.status} - ${g}`)}const E=(await ee.json()).choices[0].message.content;console.log("AI :",E);const m=ea(E);if(m.length>0){console.log(" [] ...");const g=m.map(D=>C.saveLiveContent({title:D.title,username:D.username,viewers:D.viewers,cover:D.cover,contactId:D.contactId,content:"",danmus:[],timestamp:Date.now()}));await Promise.all(g),console.log("    "),d.value=m,alert(` ${m.length} `)}else alert("AI ")}catch(T){console.error(":",T),alert(": "+T.message)}finally{l.value=!1}},$=async()=>{try{const T=await C.getContacts();if(T.length===0){u.value=[];return}const G=await C.getSetting("apiConfig");if(!G||!G.apiKey){u.value=T.map(m=>({id:m.id,username:m.name,title:`${m.name}`,viewers:Ao(),cover:us(),isFollowing:!0,contactId:m.id}));return}const K={provider:G.provider||"deepseek",apiKey:G.apiKey,baseUrl:G.baseUrl||"",model:G.model||"deepseek-chat"};let q=K.baseUrl;q||(K.provider==="deepseek"?q="https://api.deepseek.com":K.provider==="openai"&&(q="https://api.openai.com")),q=q.replace(/\/v1\/?$/,"").replace(/\/$/,"")+"/v1/chat/completions";const ee=T.map(async m=>{try{const g=Vl(m),D=await fetch(q,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${K.apiKey}`},body:JSON.stringify({model:K.model,messages:[{role:"user",content:g}],temperature:.9})});if(D.ok){const te=(await D.json()).choices[0].message.content,R=ea(te);if(R.length>0)return{...R[0],id:m.id,isFollowing:!0,contactId:m.id}}return{id:m.id,username:m.name,title:`${m.name}`,viewers:Ao(),cover:us(),isFollowing:!0,contactId:m.id}}catch(g){return console.error(` ${m.name} :`,g),{id:m.id,username:m.name,title:`${m.name}`,viewers:Ao(),cover:us(),isFollowing:!0,contactId:m.id}}}),Z=await Promise.all(ee);console.log(" [] ...");const E=Z.map(m=>C.saveLiveContent({title:m.title,username:m.username,viewers:m.viewers,cover:m.cover,contactId:m.contactId,content:"",danmus:[],timestamp:Date.now()}));await Promise.all(E),console.log("    "),u.value=Z}catch(T){console.error(":",T),u.value=[]}},x=async()=>{if(u.value.length===0){await $();return}try{const T=await C.getSetting("apiConfig");if(!T||!T.apiKey){alert(" API Key");return}const G={provider:T.provider||"deepseek",apiKey:T.apiKey,baseUrl:T.baseUrl||"",model:T.model||"deepseek-chat"};let K=G.baseUrl;K||(G.provider==="deepseek"?K="https://api.deepseek.com":G.provider==="openai"&&(K="https://api.openai.com")),K=K.replace(/\/v1\/?$/,"").replace(/\/$/,"")+"/v1/chat/completions";const q=u.value.map(async E=>{try{const m=await C.getContact(E.contactId);if(!m)return E;const g=Vl(m),D=await fetch(K,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${G.apiKey}`},body:JSON.stringify({model:G.model,messages:[{role:"user",content:g}],temperature:.9})});if(D.ok){const te=(await D.json()).choices[0].message.content,R=ea(te);if(R.length>0)return{...E,title:R[0].title,viewers:Ao(),cover:us()}}return E}catch(m){return console.error(` ${E.username} :`,m),E}}),ee=await Promise.all(q);console.log(" [] ...");const Z=ee.map(E=>C.saveLiveContent({title:E.title,username:E.username,viewers:E.viewers,cover:E.cover,contactId:E.contactId,content:"",danmus:[],timestamp:Date.now()}));await Promise.all(Z),console.log("    "),u.value=ee,alert("")}catch(T){console.error(":",T),alert(": "+T.message)}},S=async T=>{if(a.value=T,T===""){i.value=!0;return}T===""&&u.value.length===0&&await $()},M=()=>{i.value=!1,a.value=""},A=T=>{o("open-detail",T)};return(T,G)=>i.value?(p(),nt(w7,{key:0,onBack:M})):(p(),f("div",k7,[e("div",x7,[e("header",C7,[e("div",{class:"flex items-center gap-3"},[e("div",{onClick:I,class:"w-10 h-10 rounded-xl bg-[#4A4A4A] flex items-center justify-center shadow-lg transform rotate-2 cursor-pointer active:scale-95 transition-all"},[...G[1]||(G[1]=[e("span",{class:"text-white text-lg brand-font leading-none"},"K",-1)])]),G[2]||(G[2]=e("div",{class:"flex flex-col"},[e("h1",{class:"text-base font-black tracking-tight text-[#333] leading-none uppercase"},"miaomiao"),e("span",{class:"text-[8px] font-bold text-pink-400 mt-1 uppercase tracking-[0.2em]"},"Daily Lounge")],-1))]),e("div",$7,[e("button",{onClick:j,disabled:l.value,class:Se(["w-9 h-9 rounded-full flex items-center justify-center active:scale-90 transition-all border",l.value?"bg-gray-200 border-gray-300":"bg-gradient-to-br from-purple-400 to-pink-400 border-purple-300"])},[Ye(Ke(cr),{class:Se(["w-4 h-4",l.value?"text-gray-400 animate-spin":"text-white animate-pulse"])},null,8,["class"])],10,_7),e("button",M7,[Ye(Ke(s8),{class:"w-4 h-4 text-[#4A4A4A]"})]),e("button",S7,[Ye(Ke(Y6),{class:"w-4 h-4 text-pink-500"})])])]),e("div",A7,[a.value===""?(p(),f("nav",I7,[(p(),f(Le,null,Fe(r,K=>e("button",{key:K,onClick:q=>n.value=K,class:Se(["flex-shrink-0 px-5 py-2 rounded-xl font-bold text-[11px] transition-all uppercase tracking-wider",n.value===K?"bg-[#4A4A4A] text-white shadow-md":"bg-white text-[#888] border border-gray-100"])},_(K),11,L7)),64))])):N("",!0),e("main",{class:Se(["px-6 grid grid-cols-2 gap-5",a.value===""?"":"pt-4"])},[(p(!0),f(Le,null,Fe(w.value,K=>(p(),f("div",{key:K.id,onClick:q=>A(K),class:"room-card group p-1.5 bg-white border-2 border-[#4A4A4A] rounded-[20px] transition-all cursor-pointer shadow-sm hover:-translate-y-1 hover:border-[#FFC0CB] hover:shadow-[0_10px_20px_rgba(255,192,203,0.15)]"},[e("div",j7,[K.cover?(p(),f("img",{key:0,src:K.cover,alt:K.title,class:"w-full h-full object-cover",onError:G[0]||(G[0]=q=>q.target.style.display="none")},null,40,P7)):N("",!0),G[3]||(G[3]=e("div",{class:"absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent z-10"},null,-1)),G[4]||(G[4]=e("div",{class:"absolute top-2.5 left-2.5 flex items-center gap-1 bg-red-500 text-white text-[8px] px-2 py-0.5 rounded-full font-black z-20 shadow-sm border border-white/30"},[e("span",{class:"w-1 h-1 bg-white rounded-full animate-pulse"}),ot(" LIVE ")],-1)),e("div",E7,[Ye(Ke(n8),{class:"w-3 h-3 mr-1"}),ot(" "+_(K.viewers),1)])]),e("div",B7,[e("h3",V7,_(K.title),1),e("div",D7,[e("div",H7,_(K.username?K.username.charAt(0):"?"),1),e("span",F7,_(K.username),1)])])],8,T7))),128))],2)]),e("nav",U7,[(p(),f(Le,null,Fe(c,K=>e("button",{key:K.name,onClick:q=>S(K.name),class:Se(["flex flex-col items-center gap-1 group relative transition-all",a.value===K.name?"text-pink-500":"text-gray-400"])},[e("div",N7,[(p(),nt(Ta(K.icon),{class:"w-5 h-5","stroke-width":a.value===K.name?2.5:2},null,8,["stroke-width"]))]),e("span",O7,_(K.name),1),a.value===K.name?(p(),f("div",z7)):N("",!0)],10,R7)),64))])])]))}},W7=Xe(K7,[["__scopeId","data-v-228a9cd6"]]),G7={class:"vue-live-container w-full h-screen bg-gray-300 font-sans"},q7={class:"phone-viewport w-full h-full bg-[#FDF6F8] relative flex flex-col overflow-y-auto"},Z7={class:"live-section relative w-full aspect-[4/3] bg-[#1a1a1a] overflow-hidden border-b-[1.5px] border-[#8E7B7E] flex-shrink-0"},J7={class:"danmu-container"},Y7={key:0,class:"mr-1"},X7={class:"absolute top-5 left-4 z-30"},Q7={class:"profile-badge bg-black/30 backdrop-blur-md border border-white/20 p-1 pr-3 rounded-full flex items-center gap-2"},eM={class:"w-8 h-8 rounded-full bg-white flex items-center justify-center text-lg"},tM={class:"flex flex-col"},sM={class:"text-white text-[11px] font-bold leading-tight"},oM={class:"absolute bottom-5 left-4 z-30"},nM={class:"live-status-badge bg-black/40 backdrop-blur-md text-white px-3 py-1 rounded-2xl text-[10px] flex items-center gap-1.5 border border-white/10"},aM={class:"title-section bg-white p-5 border-b border-[#FFF0F3] flex-shrink-0"},lM={class:"text-[17px] font-bold text-[#5D4D50] leading-snug"},iM={class:"gift-display-area bg-white px-5 py-2.5 border-b-[1.5px] border-[#FFF0F3] flex items-center gap-2.5 text-xs flex-shrink-0"},rM={class:"font-bold text-[#8E7B7E]"},cM={class:"text-[#FF6B6B] font-bold"},dM={key:1,class:"opacity-30 italic"},uM={class:"thought-section m-2 mx-2.5 p-6 bg-white border-2 border-dashed border-[#FFB7C5] rounded-[20px] h-[320px] flex flex-col shadow-[0_10px_20px_rgba(255,183,197,0.1)] flex-shrink-0 overflow-hidden"},vM={class:"thought-scroll-area flex-1 overflow-y-auto pr-1"},pM={class:"cat-thought text-[15px] leading-[1.8] text-[#7A6669]"},fM={key:0,class:"text-center mt-4 text-gray-400 text-sm"},mM={class:"bottom-ui-container fixed bottom-0 left-0 right-0 p-4 pb-8 bg-gradient-to-t from-white via-white to-transparent flex-shrink-0 z-50"},gM={class:"bottom-ui-pill bg-white border border-[#FFF0F3] p-2 px-2.5 rounded-[40px] flex gap-2.5 items-center shadow-[0_10px_30px_rgba(255,183,197,0.2)]"},hM=["placeholder"],yM={class:"gift-modal w-full max-w-[340px] bg-white rounded-[30px] border-[1.5px] border-[#FFB7C5] p-6 shadow-2xl"},bM={class:"grid grid-cols-2 gap-3 mb-4"},wM=["onClick"],kM=["innerHTML"],xM={class:"text-[12px] font-bold"},CM={class:"space-y-3"},$M={key:0},_M={class:"text-[10px] font-bold opacity-50 block mb-1"},Dl='<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#9333EA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path></svg>',MM={__name:"Livedetail",props:{liveData:{type:Object,required:!0}},emits:["back"],setup(t,{emit:s}){const o=t,n=s,a=h(""),l=h([]),i=h(!1),r=h(1),c=h(""),d=h(null),u=h(null),v=h("..."),b=h(!1),w=h([]),I=[{name:"",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#FF6B6B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-1 3.46-3.44 6-7 6s-7.56-2.54-8.5-6Z"></path><path d="M18 12v.5"></path><path d="M16 17.93a9.77 9.77 0 0 1 0-11.86"></path><path d="M7 10.67C7 8 5.58 5.97 2.73 5.5c-1 1.5-1 5 .23 6.5-1.24 1.5-1.24 5-.23 6.5C5.58 18.03 7 16 7 13.33"></path><path d="M10.46 7.26C10.2 5.88 9.17 4.24 8 3h5.8a2 2 0 0 1 1.98 1.67l.23 1.4"></path><path d="m16.01 17.93-.23 1.4A2 2 0 0 1 13.8 21H9.5a5.96 5.96 0 0 0 1.49-3.98"></path></svg>'},{name:"",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>'},{name:"",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="#FF69B4" stroke="#FF1493" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path></svg>'}],j=h({}),$=tt(()=>{var m;return((m=o.liveData)==null?void 0:m.title)||""}),x=tt(()=>{var m;return((m=o.liveData)==null?void 0:m.username)||""}),S=tt(()=>{var m;return((m=o.liveData)==null?void 0:m.viewers)||"0"}),M=()=>{const m=Date.now(),g=40;for(const D in j.value)j.value[D]<m&&delete j.value[D];for(let D=0;D<10;D++){const W=D*g+10;if(!j.value[W]||j.value[W]<m)return W}return Math.floor(Math.random()*10)*g+10},A=(m,g=!1,D="")=>{const W=Date.now()+Math.random(),te=D?`${D}${m}`:m,R=g?8:10+Math.random()*2,F=M();j.value[F]=Date.now()+R*1e3,l.value.push({id:W,text:te,isMine:g,top:F,duration:R,delay:0}),setTimeout(()=>{l.value=l.value.filter(ie=>ie.id!==W)},(R+1)*1e3)},T=async(m=null)=>{var D,W;if(console.log(" [] "),console.log("   - :",o.liveData),console.log("   - contactId:",(D=o.liveData)==null?void 0:D.contactId),(W=o.liveData)!=null&&W.contactId){console.log("     contactId...");const te=await C.getContact(o.liveData.contactId);if(console.log("   - :",te),te){console.log("    "),console.log("   - :",te.name),console.log("   - :",te.personality);const R=G_(te,$.value,m);return console.log("   - :",R.substring(0,200)+"..."),R}else console.warn("    ")}else console.log("     contactId");const g=`"${x.value}""${$.value}" ${S.value} 


1. 
2. 


- 
- 
-  5-8 
- 
- 
- 
- 

${m?`

"${m}"`:""}

 ### 
###
[]

###
11
22
33
...

`;return console.log("   - :",g.substring(0,200)+"..."),g},G=m=>{try{const g=m.split("###");let D="",W=[];for(let te=0;te<g.length;te++){const R=g[te].trim();if(R.includes("")&&te+1<g.length&&(D=g[te+1].trim()),R.includes("")&&te+1<g.length){const ie=g[te+1].trim().split(`
`).filter(re=>re.trim());for(const re of ie)if(re.includes("")||re.includes(":")){const pe=re.includes("")?"":":",[we,...he]=re.split(pe),Ue=he.join(pe).trim();we&&Ue&&W.push({username:we.trim(),content:Ue})}}}return{thoughtContent:D,danmuContent:W}}catch(g){return console.error(":",g),{thoughtContent:"...",danmuContent:[]}}},K=async(m=null)=>{var g,D;if(!b.value)try{b.value=!0;const W=await C.getSetting("apiConfig");if(!W||!W.apiKey){console.warn(" API"),await q(m);return}const te={provider:W.provider||"deepseek",apiKey:W.apiKey,baseUrl:W.baseUrl||"",model:W.model||"deepseek-chat"};let R=te.baseUrl;R||(te.provider==="deepseek"?R="https://api.deepseek.com":te.provider==="openai"&&(R="https://api.openai.com")),R=R.replace(/\/v1\/?$/,"").replace(/\/$/,"")+"/v1/chat/completions";const F=await T(m),ie=[...w.value,{role:"user",content:F}],re=await fetch(R,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${te.apiKey}`},body:JSON.stringify({model:te.model,messages:ie,temperature:.9})});if(!re.ok)throw new Error(`AI : ${re.status}`);const we=(await re.json()).choices[0].message.content;console.log("AI :",we),w.value.push({role:"user",content:F},{role:"assistant",content:we}),w.value.length>20&&(w.value=w.value.slice(-20));const{thoughtContent:he,danmuContent:Ue}=G(we);he&&(v.value=he);const ge=[];Ue.length>0&&Ue.forEach((B,L)=>{setTimeout(()=>{A(B.content,!1,B.username)},L*1500),ge.push({username:B.username,content:B.content})});try{console.log(" [] ..."),console.log("   - :",$.value),console.log("   - :",x.value),console.log("   - :",he.length),console.log("   - :",ge.length);const B={title:$.value,username:x.value,viewers:S.value,cover:(g=o.liveData)==null?void 0:g.cover,contactId:(D=o.liveData)==null?void 0:D.contactId,content:he,danmus:ge,timestamp:Date.now()};console.log("   - :",B),await C.saveLiveContent(B),console.log("    ");const L=await C.getLiveContent($.value);console.log("   - :",L)}catch(B){console.error("    :",B)}}catch(W){console.error(":",W),await q(m)}finally{b.value=!1}},q=async m=>{var W,te;let g="";const D=[];m?(g=`"${m}"${x.value}...`,[{username:"",content:"666"},{username:"A",content:""},{username:"1",content:""}].forEach((F,ie)=>{setTimeout(()=>{A(F.content,!1,F.username)},ie*1500),D.push({username:F.username,content:F.content})})):g=`${x.value}...`,v.value=g;try{console.log(" [] ...");const R={title:$.value,username:x.value,viewers:S.value,cover:(W=o.liveData)==null?void 0:W.cover,contactId:(te=o.liveData)==null?void 0:te.contactId,content:g,danmus:D,timestamp:Date.now()};await C.saveLiveContent(R),console.log("    ")}catch(R){console.error("    :",R)}},ee=async()=>{if(!a.value.trim())return;const m=a.value;A(m,!0),a.value="",await K(m)},Z=()=>{if(!d.value)return;const m=d.value.name===""?c.value||"":d.value.name;u.value={userName:"",giftName:m,value:r.value},A(` ${m} x${r.value}`,!0),K(`${m} x${r.value}`),i.value=!1,d.value=null,r.value=1,c.value=""},E=()=>{n("back")};return it(async()=>{var m;console.log(" [] "),console.log("   - :",o.liveData),console.log("   - :",$.value),console.log("   - :",x.value);try{console.log(" [] ..."),console.log("   -  key:",$.value);const g=await C.getLiveContent($.value);console.log("   - :",g),g&&g.content?(console.log("    "),console.log("   - :",g.content.length),console.log("   - :",g.content.substring(0,100)+"..."),console.log("   - :",((m=g.danmus)==null?void 0:m.length)||0),v.value=g.content,g.danmus&&g.danmus.length>0&&(console.log("   - ..."),g.danmus.forEach((D,W)=>{setTimeout(()=>{A(D.content,!1,D.username)},W*1500)})),console.log("    ")):(console.log("    "),await K())}catch(g){console.error("    :",g),console.error("   - :",g.message),console.error("   - :",g.stack),await K()}}),(m,g)=>(p(),f("div",G7,[e("div",q7,[e("div",Z7,[e("div",J7,[(p(!0),f(Le,null,Fe(l.value,D=>(p(),f("div",{key:D.id,class:Se(["danmu-item",{"danmu-mine":D.isMine}]),style:Oe({top:D.top+"px",animationDuration:D.duration+"s"})},[D.isMine?(p(),f("span",Y7,"")):N("",!0),ot(_(D.text),1)],6))),128))]),e("div",X7,[e("div",Q7,[e("div",eM,_(x.value.charAt(0)),1),e("div",tM,[e("span",sM,_(x.value),1),g[6]||(g[6]=e("span",{class:"text-pink-200 text-[8px] opacity-80"},"",-1))]),g[7]||(g[7]=e("button",{class:"bg-[#FFB7C5] text-white text-[10px] px-3 py-1 rounded-full font-bold ml-1 active:scale-95 transition-transform"},"  ",-1))])]),e("button",{class:"absolute top-5 right-5 z-30 w-8 h-8 bg-black/20 rounded-full text-white flex items-center justify-center border border-white/30 active:scale-90 transition-all",onClick:E},"  "),e("div",oM,[e("div",nM,[g[8]||(g[8]=e("span",{class:"w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"},null,-1)),g[9]||(g[9]=e("span",null,"LIVE",-1)),g[10]||(g[10]=e("span",{class:"opacity-30"},"|",-1)),e("span",null,_(S.value)+" ",1)])]),g[11]||(g[11]=mt('<div class="absolute bottom-10 left-1/2 -translate-x-1/2 z-10" data-v-33d6a248><div class="relative transform scale-[1.3]" data-v-33d6a248><div class="cat-tail absolute -left-7 bottom-2 w-8 h-16 bg-gray-200 border-[1.5px] border-gray-400 rounded-full -z-10" data-v-33d6a248></div><div class="w-24 h-24 bg-white border-[1.5px] border-gray-300 rounded-full flex flex-col items-center justify-center shadow-lg relative overflow-hidden" data-v-33d6a248><div class="flex gap-3 mb-1" data-v-33d6a248><div class="w-2.5 h-2.5 bg-[#5D4D50] rounded-full" data-v-33d6a248></div><div class="w-2.5 h-2.5 bg-[#5D4D50] rounded-full" data-v-33d6a248></div></div><div class="w-4 h-2 border-b-[1.5px] border-[#5D4D50] rounded-full" data-v-33d6a248></div><div class="absolute bottom-0 w-full h-6 bg-pink-50/50" data-v-33d6a248></div></div></div></div>',1))]),e("div",aM,[e("h1",lM,_($.value),1)]),e("div",iM,[u.value?(p(),f(Le,{key:0},[g[12]||(g[12]=e("span",{class:"bg-pink-100 text-[#FF6B6B] px-2 py-0.5 rounded-md font-bold text-[10px] animate-bounce"},"NEW!",-1)),e("span",rM,_(u.value.userName),1),g[13]||(g[13]=e("span",{class:"opacity-60"},"",-1)),e("span",cM,_(u.value.giftName)+" x"+_(u.value.value),1)],64)):(p(),f("span",dM,"~"))]),e("div",uM,[e("div",vM,[e("p",pM,_(v.value),1),b.value?(p(),f("div",fM,[...g[14]||(g[14]=[e("span",{class:"animate-pulse"},"AI ...",-1)])])):N("",!0)])]),g[19]||(g[19]=e("div",{class:"px-5 py-4 opacity-30 text-[10px] text-center italic"},"  ",-1)),e("div",mM,[e("div",gM,[e("button",{onClick:g[0]||(g[0]=D=>i.value=!0),class:"w-11 h-11 rounded-full bg-[#FFF9FA] border-[1.5px] border-[#FFB7C5] flex items-center justify-center text-[#FF6B6B] active:scale-90 transition-transform"},[...g[15]||(g[15]=[mt('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-33d6a248><polyline points="20 12 20 22 4 22 4 12" data-v-33d6a248></polyline><rect x="2" y="7" width="20" height="5" data-v-33d6a248></rect><line x1="12" y1="22" x2="12" y2="7" data-v-33d6a248></line><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z" data-v-33d6a248></path><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z" data-v-33d6a248></path></svg>',1)])]),ke(e("input",{"onUpdate:modelValue":g[1]||(g[1]=D=>a.value=D),onKeyup:ns(ee,["enter"]),type:"text",placeholder:`${x.value}...`,class:"flex-1 h-11 bg-[#F9F1F3] rounded-[25px] px-5 text-[13px] outline-none border-[1.5px] border-transparent focus:border-[#FFB7C5] focus:bg-white transition-all"},null,40,hM),[[je,a.value]]),e("button",{onClick:ee,class:"w-11 h-11 rounded-full bg-[#FFB7C5] flex items-center justify-center text-white active:scale-90 transition-transform shadow-md"},"  ")])]),Ye(Xi,{name:"fade"},{default:ko(()=>{var D,W,te;return[i.value?(p(),f("div",{key:0,class:"modal-overlay fixed inset-0 bg-black/40 backdrop-blur-[4px] z-[1000] flex items-center justify-center p-5",onClick:g[5]||(g[5]=Pe(R=>i.value=!1,["self"]))},[e("div",yM,[g[18]||(g[18]=e("h3",{class:"text-center font-bold text-lg mb-4 text-[#5D4D50]"}," ",-1)),e("div",bM,[(p(),f(Le,null,Fe(I,R=>{var F;return e("div",{key:R.name,onClick:ie=>d.value=R,class:Se(["gift-card border-[1.5px] p-3 rounded-2xl text-center cursor-pointer transition-all",((F=d.value)==null?void 0:F.name)===R.name?"border-[#FFB7C5] bg-[#FFF0F3]":"border-[#F3E8EA] bg-white"])},[e("div",{class:"mb-1 flex items-center justify-center",innerHTML:R.icon},null,8,kM),e("div",xM,_(R.name),1)],10,wM)}),64)),e("div",{onClick:g[2]||(g[2]=R=>d.value={name:"",icon:Dl}),class:Se(["gift-card border-[1.5px] p-3 rounded-2xl text-center cursor-pointer transition-all",((D=d.value)==null?void 0:D.name)===""?"border-[#FFB7C5] bg-[#FFF0F3]":"border-[#F3E8EA] bg-white"])},[e("div",{class:"mb-1 flex items-center justify-center",innerHTML:Dl}),g[16]||(g[16]=e("div",{class:"text-[12px] font-bold"},"",-1))],2)]),e("div",CM,[((W=d.value)==null?void 0:W.name)===""?(p(),f("div",$M,[g[17]||(g[17]=e("label",{class:"text-[10px] font-bold opacity-50 block mb-1"},"",-1)),ke(e("input",{"onUpdate:modelValue":g[3]||(g[3]=R=>c.value=R),type:"text",placeholder:"",class:"w-full bg-gray-50 rounded-xl h-10 px-4 text-sm outline-none border-[1.5px] border-gray-100 focus:border-[#FFB7C5]"},null,512),[[je,c.value]])])):N("",!0),e("div",null,[e("label",_M,_(((te=d.value)==null?void 0:te.name)===""?"/":""),1),ke(e("input",{"onUpdate:modelValue":g[4]||(g[4]=R=>r.value=R),type:"number",class:"w-full bg-gray-50 rounded-xl h-10 px-4 text-sm outline-none border-[1.5px] border-gray-100 focus:border-[#FFB7C5]"},null,512),[[je,r.value,void 0,{number:!0}]])])]),e("button",{onClick:Z,class:"w-full mt-6 bg-[#FFB7C5] text-white h-12 rounded-2xl font-bold active:scale-95 transition-all shadow-lg shadow-pink-100"}," "+_(x.value)+"  ",1)])])):N("",!0)]}),_:1})])]))}},SM=Xe(MM,[["__scopeId","data-v-33d6a248"]]);function AM(t){return`"${t.name}"


${t.prompt||""}


1. 
2. 
3. 
4. 
5. 




10
30
${t.name}@example.com
100-300
""





@example.com

.pdf
2.1 MB  

`}function IM(){return`
- 
- 
- 
- 
- 


1. 
2. 
3. 
4. 
5. 




GitHubNetflix
15
30

100-300
""



Netflix


service@netflix.com
1.  -  2.  -  3. - 
.zip
15.8 MB  3

`}const LM={class:"mail-app"},TM={class:"bg-[#ffebeb] px-6 pt-8 pb-5 border-b border-[#ffd1d1]"},jM={class:"flex justify-between items-center mb-4"},PM={class:"text-3xl font-black text-[#ff6b6b] tracking-tight"},EM=["disabled"],BM={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},VM={key:1,class:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},DM={class:"relative"},HM={key:0,class:"flex-1 overflow-y-auto p-5 no-scrollbar"},FM=["onClick"],UM={key:0,class:"absolute left-2 top-1/2 -translate-y-1/2 w-1.5 h-1.5 bg-[#ff6b6b] rounded-full"},RM={class:"flex justify-between items-start mb-1 ml-2"},NM={class:"font-bold text-[#ff6b6b] text-base"},OM={class:"text-xs text-gray-400"},zM={class:"text-sm font-semibold text-gray-800 mb-1 ml-2"},KM={class:"text-xs text-gray-500 line-clamp-2 ml-2 leading-relaxed"},WM={key:0,class:"flex flex-col items-center justify-center py-20 text-gray-400"},GM={key:1,class:"flex-1 overflow-y-auto p-5 no-scrollbar"},qM={class:"space-y-3"},ZM=["onClick"],JM={key:0},YM={class:"flex-1 min-w-0"},XM={class:"font-bold text-gray-800 text-base mb-1"},QM={class:"text-xs text-gray-500 truncate"},eS={key:0,class:"flex flex-col items-center justify-center py-20 text-gray-400"},tS={key:2,class:"flex-1 overflow-y-auto p-5 no-scrollbar"},sS={key:3,class:"flex-1 overflow-y-auto p-5 no-scrollbar"},oS={class:"bg-[#ffebeb] border-t border-[#ffd1d1] px-2 py-4 flex justify-around items-center"},nS=["onClick"],aS={class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24"},lS=["d"],iS={class:"text-[10px] font-bold"},rS={__name:"mailview",emits:["back","openDetail","openSettings"],setup(t,{emit:s}){const o=s,n=h("inbox"),a=h(""),l=h(!1),i=[{id:"inbox",label:"",icon:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"},{id:"contacts",label:"",icon:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5z"},{id:"archive",label:"",icon:"M19 3H4.99c-1.11 0-1.98.89-1.98 2L3 19c0 1.1.88 2 1.99 2H19c1.1 0 2-.9 2-2V5c0-1.11-.9-2-2-2zm0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H4.99V5H19v10z"},{id:"settings",label:"",icon:"M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65z"}],r=h([]),c=h([]),d=h({autoGenerateEnabled:!1,autoGenerateInterval:30,autoCleanEnabled:!0,maxEmailCount:5});let u=null;const v=Z=>{x(),alert(` ${Z.name||Z.nickname} `)},b=()=>{x(),o("openSettings")},w=tt(()=>{var Z;return((Z=i.find(E=>E.id===n.value))==null?void 0:Z.label)||""}),I=tt(()=>{const Z=a.value.toLowerCase();return Z?r.value.filter(E=>E.sender.toLowerCase().includes(Z)||E.subject.toLowerCase().includes(Z)):r.value}),j=Z=>{const m=Date.now()-Z,g=Math.floor(m/6e4),D=Math.floor(m/36e5),W=Math.floor(m/864e5);if(g<60)return`${g}`;if(D<24)return`${D}`;if(W===1)return"";if(W<7)return`${W}`;const te=new Date(Z);return`${te.getMonth()+1}${te.getDate()}`},$=async()=>{var Z,E;if(!l.value)try{l.value=!0,x();const m=await C.getContacts();if(console.log(" :",m),!m||m.length===0){alert("");return}const g=Math.min(Math.floor(Math.random()*2)+1,m.length),D=[],W=new Set;for(;D.length<g;){const re=Math.floor(Math.random()*m.length);W.has(re)||(W.add(re),D.push(m[re]))}console.log(" :",D.map(re=>re.name||re.nickname));const te=[];for(const re of D)try{const pe=AM({name:re.name||re.nickname||"",prompt:re.prompt||""});console.log(`  ${re.name||re.nickname} ...`);const we=await Wt.sendMessage([{role:"user",content:pe}],re.id,re);console.log(" AI :",we);let he={};try{const Ue=we.match(/\{[\s\S]*\}/);if(Ue)he=JSON.parse(Ue[0]);else throw new Error("JSON")}catch{console.log("");const ge=we.split(`
`).filter(B=>B.trim());for(const B of ge)B.includes("")?he.subject=B.replace("","").trim():B.includes("")?he.preview=B.replace("","").trim():B.includes("")?he.email=B.replace("","").trim():B.includes("")?he.content=B.replace("","").trim():B.includes("")&&!B.includes("")?he.attachment=B.replace("","").trim():B.includes("")&&(he.attachmentInfo=B.replace("","").trim());if(!he.content||he.content.length<50){const B=we.indexOf(""),L=we.indexOf("");B!==-1&&L!==-1&&(he.content=we.substring(B+3,L).trim())}}te.push({id:Date.now()+Math.random(),sender:re.name||re.nickname||"",senderAvatar:re.avatar||"",senderEmail:he.email||`${re.name}@example.com`,time:j(Date.now()),timestamp:Date.now(),subject:he.subject||"",preview:he.preview||((Z=he.content)==null?void 0:Z.substring(0,50))||"",content:he.content||we,attachment:he.attachment||"",attachmentInfo:he.attachmentInfo||"",unread:!0,isCharacter:!0}),console.log(" ")}catch(pe){console.error(` (${re.name}):`,pe)}const R=Math.floor(Math.random()*3)+3,F=[];for(let re=0;re<R;re++)try{const pe=IM();console.log(`  ${re+1} ...`);const we=await Wt.sendMessage([{role:"user",content:pe}],null,null);console.log(" AI :",we);let he={};try{const Ue=we.match(/\{[\s\S]*\}/);if(Ue)he=JSON.parse(Ue[0]);else throw new Error("JSON")}catch{console.log("");const ge=we.split(`
`).filter(B=>B.trim());for(const B of ge)B.includes("")?he.sender=B.replace("","").trim():B.includes("")?he.subject=B.replace("","").trim():B.includes("")?he.preview=B.replace("","").trim():B.includes("")?he.email=B.replace("","").trim():B.includes("")?he.content=B.replace("","").trim():B.includes("")&&!B.includes("")?he.attachment=B.replace("","").trim():B.includes("")&&(he.attachmentInfo=B.replace("","").trim());if(!he.content||he.content.length<50){const B=we.indexOf(""),L=we.indexOf("");B!==-1&&L!==-1&&(he.content=we.substring(B+3,L).trim())}}F.push({id:Date.now()+Math.random(),sender:he.sender||"",senderAvatar:"",senderEmail:he.email||"service@example.com",time:j(Date.now()-re*36e5),timestamp:Date.now()-re*36e5,subject:he.subject||"",preview:he.preview||((E=he.content)==null?void 0:E.substring(0,50))||"",content:he.content||we,attachment:he.attachment||"",attachmentInfo:he.attachmentInfo||"",unread:!0,isCharacter:!1}),console.log(" ")}catch(pe){console.error(":",pe)}const ie=[...te,...F].sort((re,pe)=>pe.timestamp-re.timestamp);for(const re of ie)await C.addEmail(re);r.value=[...ie,...r.value],await M(),console.log(`  ${ie.length} `)}catch(m){console.error(":",m),alert(`: ${m.message}`)}finally{l.value=!1}},x=()=>{const Z=new Audio("https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3");Z.currentTime=0,Z.play().catch(()=>{})},S=Z=>{x(),Z.unread=!1,o("openDetail",Z)},M=async()=>{if(!d.value.autoCleanEnabled)return;const Z=await C.getEmails(),E=d.value.maxEmailCount;if(Z.length>E){const m=Z.slice(E);for(const g of m)await C.deleteEmail(g.id);console.log(`  ${m.length} `),await K()}},A=async()=>{const Z=await C.getSetting("mailSettings");Z&&(d.value=Z),d.value.autoGenerateEnabled&&T()},T=()=>{u&&clearInterval(u);const Z=d.value.autoGenerateInterval*60*1e3;u=setInterval(()=>{console.log(" ..."),$()},Z),console.log(`  ${d.value.autoGenerateInterval} `)},G=()=>{u&&(clearInterval(u),u=null,console.log(" "))},K=async()=>{r.value=await C.getEmails(),console.log(" :",r.value.length)},q=Z=>{d.value=Z.detail,d.value.autoGenerateEnabled?T():G()},ee=()=>{r.value=[]};return it(async()=>{c.value=await C.getContacts(),console.log(" :",c.value.length),await K(),await A(),window.addEventListener("mail-settings-changed",q),window.addEventListener("emails-cleared",ee)}),zt(()=>{G(),window.removeEventListener("mail-settings-changed",q),window.removeEventListener("emails-cleared",ee)}),(Z,E)=>(p(),f("div",LM,[e("header",TM,[e("div",jM,[e("button",{onClick:E[0]||(E[0]=m=>o("back")),class:"text-[#ff6b6b] font-medium tap-effect"},[...E[2]||(E[2]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),e("h1",PM,_(w.value),1),e("button",{onClick:$,disabled:l.value,class:Se(["text-[#ff6b6b] font-medium tap-effect flex items-center gap-1",{"opacity-50":l.value}])},[l.value?(p(),f("svg",VM,[...E[4]||(E[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(p(),f("svg",BM,[...E[3]||(E[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)])])),ot(" "+_(l.value?"":""),1)],10,EM)]),e("div",DM,[ke(e("input",{type:"text","onUpdate:modelValue":E[1]||(E[1]=m=>a.value=m),placeholder:"...",class:"w-full py-3 px-5 rounded-2xl border border-[#ffd1d1] outline-none focus:ring-2 focus:ring-[#ff6b6b]/20 transition-all text-sm",onFocus:x},null,544),[[je,a.value]]),E[5]||(E[5]=e("div",{class:"absolute right-4 top-3 text-[#ff6b6b]/40"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),n.value==="inbox"?(p(),f("main",HM,[Ye(Ud,{name:"list",tag:"div"},{default:ko(()=>[(p(!0),f(Le,null,Fe(I.value,m=>(p(),f("div",{key:m.id,class:"bg-white rounded-2xl p-4 mb-4 border border-[#ffd1d1]/30 shadow-sm hover:shadow-md transition-shadow cursor-pointer relative tap-effect",onClick:g=>S(m)},[m.unread?(p(),f("div",UM)):N("",!0),e("div",RM,[e("span",NM,_(m.sender),1),e("span",OM,_(m.time),1)]),e("div",zM,_(m.subject),1),e("div",KM,_(m.preview),1)],8,FM))),128))]),_:1}),I.value.length===0?(p(),f("div",WM,[...E[6]||(E[6]=[e("svg",{class:"w-16 h-16 mb-4 opacity-20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})],-1),e("p",null,"",-1)])])):N("",!0)])):N("",!0),n.value==="contacts"?(p(),f("main",GM,[e("div",qM,[(p(!0),f(Le,null,Fe(c.value,m=>(p(),f("div",{key:m.id,class:"bg-white rounded-2xl p-4 border border-[#ffd1d1]/30 shadow-sm hover:shadow-md transition-all cursor-pointer tap-effect flex items-center gap-4",onClick:g=>v(m)},[e("div",{class:"w-14 h-14 rounded-full bg-gradient-to-br from-[#ff6b6b] to-[#ff9999] flex items-center justify-center text-white font-bold text-lg flex-shrink-0",style:Oe(m.avatar?{backgroundImage:`url(${m.avatar})`,backgroundSize:"cover",backgroundPosition:"center"}:{})},[m.avatar?N("",!0):(p(),f("span",JM,_((m.name||m.nickname||"?")[0]),1))],4),e("div",YM,[e("div",XM,_(m.name||m.nickname||""),1),e("div",QM,_(m.prompt?m.prompt.substring(0,40)+"...":""),1)]),E[7]||(E[7]=e("svg",{class:"w-5 h-5 text-[#ff6b6b]/40 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))],8,ZM))),128))]),c.value.length===0?(p(),f("div",eS,[...E[8]||(E[8]=[e("svg",{class:"w-16 h-16 mb-4 opacity-20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})],-1),e("p",null,"",-1)])])):N("",!0)])):N("",!0),n.value==="archive"?(p(),f("main",tS,[...E[9]||(E[9]=[e("div",{class:"flex flex-col items-center justify-center py-20 text-gray-400"},[e("svg",{class:"w-16 h-16 mb-4 opacity-20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})]),e("p",null,"")],-1)])])):N("",!0),n.value==="settings"?(p(),f("main",sS,[e("div",{class:"space-y-3"},[e("div",{class:"bg-white rounded-2xl p-4 border border-[#ffd1d1]/30 shadow-sm hover:shadow-md transition-all cursor-pointer tap-effect flex items-center justify-between",onClick:b},[...E[10]||(E[10]=[mt('<div class="flex items-center gap-3" data-v-5073caad><div class="w-10 h-10 rounded-full bg-gradient-to-br from-[#ff6b6b] to-[#ff9999] flex items-center justify-center" data-v-5073caad><svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-5073caad><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" data-v-5073caad></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" data-v-5073caad></path></svg></div><div data-v-5073caad><div class="font-bold text-gray-800 text-base" data-v-5073caad></div><div class="text-xs text-gray-500" data-v-5073caad></div></div></div><svg class="w-5 h-5 text-[#ff6b6b]/40" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-5073caad><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" data-v-5073caad></path></svg>',2)])])])])):N("",!0),E[11]||(E[11]=e("button",{class:"absolute bottom-28 right-6 w-14 h-14 bg-[#ff6b6b] text-white rounded-full shadow-lg flex items-center justify-center tap-effect z-10"},[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})])],-1)),e("nav",oS,[(p(),f(Le,null,Fe(i,m=>e("div",{key:m.id,onClick:g=>{n.value=m.id,x()},class:Se(["flex flex-col items-center gap-1 cursor-pointer transition-all duration-300",n.value===m.id?"text-[#ff6b6b] scale-110":"text-[#ff6b6b]/40"])},[(p(),f("svg",aS,[e("path",{d:m.icon},null,8,lS)])),e("span",iS,_(m.label),1)],10,nS)),64))])]))}},cS=Xe(rS,[["__scopeId","data-v-5073caad"]]),dS={class:"email-wrapper"},uS={class:"email-detail-container"},vS={class:"email-detail-header"},pS={class:"email-detail-title"},fS={class:"email-detail-info"},mS={class:"email-detail-sender"},gS={key:0,class:"avatar-text"},hS={class:"sender-name"},yS={class:"sender-email"},bS={class:"email-time"},wS={class:"email-detail-content"},kS=["innerHTML"],xS={class:"attachment-item"},CS={class:"attachment-info"},$S={class:"attachment-name"},_S={class:"attachment-meta"},MS="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3",SS={__name:"maildetail",props:{email:{type:Object,required:!0}},emits:["back"],setup(t,{emit:s}){const o=t,n=s,a=h({subject:o.email.subject||"",sender:o.email.sender||"",senderEmail:o.email.senderEmail||"sender@example.com",senderAvatar:o.email.senderAvatar||"",time:o.email.time||"",content:o.email.content||"",attachment:o.email.attachment||"",attachmentInfo:o.email.attachmentInfo||""}),l=b=>b?b.replace(/\n/g,"<br>"):"",i=new Audio(MS),r=()=>{i.currentTime=0,i.play().catch(()=>console.log(""))},c=()=>{r(),n("back")},d=()=>{r(),console.log("")},u=()=>{r(),console.log("")},v=()=>{r(),console.log(":",a.value.attachment)};return(b,w)=>(p(),f("div",dS,[e("div",uS,[e("div",vS,[e("div",{class:"email-detail-back",onClick:c},[...w[0]||(w[0]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24"},[e("path",{fill:"#ff6b6b",d:"M20,11H7.83l5.59-5.59L12,4l-8,8l8,8l1.41-1.41L7.83,13H20V11z"})],-1),ot("  ",-1)])]),e("h1",pS,_(a.value.subject),1),e("div",fS,[e("div",mS,[e("div",{class:"sender-avatar",style:Oe(a.value.senderAvatar?{backgroundImage:`url(${a.value.senderAvatar})`}:{})},[a.value.senderAvatar?N("",!0):(p(),f("span",gS,_((a.value.sender||"?")[0]),1))],4),e("div",null,[e("div",hS,_(a.value.sender),1),e("div",yS,_(a.value.senderEmail),1)])]),e("div",bS,_(a.value.time),1)])]),e("div",wS,[e("div",{innerHTML:l(a.value.content)},null,8,kS),a.value.attachment?(p(),f("div",{key:0,class:"email-attachment",onClick:v},[w[2]||(w[2]=e("div",{class:"attachment-title"},"  (1)",-1)),e("div",xS,[w[1]||(w[1]=e("div",{class:"attachment-icon"},"",-1)),e("div",CS,[e("div",$S,_(a.value.attachment),1),e("div",_S,_(a.value.attachmentInfo),1)])])])):N("",!0)]),e("div",{class:"email-actions"},[e("button",{class:"action-button",onClick:d},[...w[3]||(w[3]=[e("svg",{class:"action-icon",viewBox:"0 0 24 24"},[e("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"})],-1),ot("  ",-1)])]),e("button",{class:"action-button",onClick:u},[...w[4]||(w[4]=[e("svg",{class:"action-icon",viewBox:"0 0 24 24"},[e("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1),ot("  ",-1)])])])])]))}},AS=Xe(SS,[["__scopeId","data-v-9394c74f"]]),IS={class:"mail-settings"},LS={class:"settings-header"},TS={class:"settings-content"},jS={class:"setting-item"},PS={class:"switch"},ES={key:0,class:"setting-item"},BS={class:"setting-item"},VS={class:"switch"},DS={key:1,class:"setting-item"},HS={class:"stats-section"},FS={class:"stats-grid"},US={class:"stat-item"},RS={class:"stat-value"},NS={class:"stat-item"},OS={class:"stat-value"},zS={__name:"mailsetting",emits:["back"],setup(t){const s=h(!1),o=h(30),n=h(!0),a=h(5),l=h(0),i=h(0),r=async()=>{try{const u=await C.getSetting("mailSettings");u&&(s.value=u.autoGenerateEnabled??!1,o.value=u.autoGenerateInterval??30,n.value=u.autoCleanEnabled??!0,a.value=u.maxEmailCount??5);const v=await C.getEmails();l.value=v.length,i.value=v.filter(b=>b.unread).length}catch(u){console.error(":",u)}},c=async()=>{try{await C.setSetting("mailSettings",{autoGenerateEnabled:s.value,autoGenerateInterval:o.value,autoCleanEnabled:n.value,maxEmailCount:a.value}),console.log(""),window.dispatchEvent(new CustomEvent("mail-settings-changed",{detail:{autoGenerateEnabled:s.value,autoGenerateInterval:o.value,autoCleanEnabled:n.value,maxEmailCount:a.value}}))}catch(u){console.error(":",u)}},d=async()=>{if(confirm(""))try{await C.clearEmails(),l.value=0,i.value=0,alert(""),window.dispatchEvent(new CustomEvent("emails-cleared"))}catch(u){console.error(":",u),alert("")}};return it(()=>{r()}),(u,v)=>(p(),f("div",IS,[e("header",LS,[e("button",{onClick:v[0]||(v[0]=b=>u.$emit("back")),class:"back-button"},[...v[5]||(v[5]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),v[6]||(v[6]=e("h1",{class:"settings-title"},"",-1)),v[7]||(v[7]=e("div",{class:"placeholder"},null,-1))]),e("main",TS,[e("div",jS,[v[9]||(v[9]=e("div",{class:"setting-info"},[e("div",{class:"setting-label"},""),e("div",{class:"setting-desc"},"AI")],-1)),e("label",PS,[ke(e("input",{type:"checkbox","onUpdate:modelValue":v[1]||(v[1]=b=>s.value=b),onChange:c},null,544),[[os,s.value]]),v[8]||(v[8]=e("span",{class:"slider"},null,-1))])]),s.value?(p(),f("div",ES,[v[11]||(v[11]=e("div",{class:"setting-info"},[e("div",{class:"setting-label"},""),e("div",{class:"setting-desc"},"")],-1)),ke(e("select",{"onUpdate:modelValue":v[2]||(v[2]=b=>o.value=b),onChange:c,class:"interval-select"},[...v[10]||(v[10]=[e("option",{value:5},"5",-1),e("option",{value:10},"10",-1),e("option",{value:30},"30",-1),e("option",{value:60},"1",-1),e("option",{value:180},"3",-1)])],544),[[Hs,o.value]])])):N("",!0),e("div",BS,[v[13]||(v[13]=e("div",{class:"setting-info"},[e("div",{class:"setting-label"},""),e("div",{class:"setting-desc"},"5")],-1)),e("label",VS,[ke(e("input",{type:"checkbox","onUpdate:modelValue":v[3]||(v[3]=b=>n.value=b),onChange:c},null,544),[[os,n.value]]),v[12]||(v[12]=e("span",{class:"slider"},null,-1))])]),n.value?(p(),f("div",DS,[v[15]||(v[15]=e("div",{class:"setting-info"},[e("div",{class:"setting-label"},""),e("div",{class:"setting-desc"},"")],-1)),ke(e("select",{"onUpdate:modelValue":v[4]||(v[4]=b=>a.value=b),onChange:c,class:"interval-select"},[...v[14]||(v[14]=[e("option",{value:5},"5",-1),e("option",{value:10},"10",-1),e("option",{value:20},"20",-1),e("option",{value:50},"50",-1)])],544),[[Hs,a.value]])])):N("",!0),e("div",HS,[v[18]||(v[18]=e("h2",{class:"stats-title"},"",-1)),e("div",FS,[e("div",US,[e("div",RS,_(l.value),1),v[16]||(v[16]=e("div",{class:"stat-label"},"",-1))]),e("div",NS,[e("div",OS,_(i.value),1),v[17]||(v[17]=e("div",{class:"stat-label"},"",-1))])])]),e("div",{class:"danger-section"},[v[20]||(v[20]=e("h2",{class:"danger-title"},"",-1)),e("button",{onClick:d,class:"danger-button"},[...v[19]||(v[19]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ot("  ",-1)])])])])]))}},KS=Xe(zS,[["__scopeId","data-v-eb7c6aa3"]]),WS={class:"control-item"},GS={class:"control-item"},qS={class:"size-value"},ZS={__name:"GlobalLyrics",setup(t){const s=qo,o=h("#ffffff"),n=h(24),a=h(!1),l=h(!1),i=h({x:window.innerWidth/2-200,y:50}),r=h({x:0,y:0}),c=h({x:0,y:0}),d=tt(()=>{var S;if(!((S=s.currentSong)!=null&&S.lyrics))return[];const $=s.currentSong.lyrics.split(`
`),x=[];for(const M of $){const A=M.match(/\[(\d{2}):(\d{2})\.(\d{2,3})\](.*)/);if(A){const T=parseInt(A[1]),G=parseInt(A[2]),K=parseInt(A[3].padEnd(3,"0")),q=T*60+G+K/1e3,ee=A[4].trim();ee&&x.push({time:q,text:ee})}}return x.sort((M,A)=>M.time-A.time)}),u=tt(()=>{var x;if(d.value.length===0)return"";const $=s.currentTime;for(let S=d.value.length-1;S>=0;S--)if($>=d.value[S].time)return d.value[S].text;return((x=d.value[0])==null?void 0:x.text)||""}),v=()=>{Pt.toggleGlobalLyrics()},b=()=>{l.value||(a.value=!a.value)},w=$=>{$.preventDefault(),$.stopPropagation(),l.value=!0;const x=$.type.includes("touch")?$.touches[0].clientX:$.clientX,S=$.type.includes("touch")?$.touches[0].clientY:$.clientY;r.value={x,y:S},c.value={x:i.value.x,y:i.value.y},document.addEventListener("mousemove",I),document.addEventListener("mouseup",j),document.addEventListener("touchmove",I),document.addEventListener("touchend",j)},I=$=>{if(!l.value)return;const x=$.type.includes("touch")?$.touches[0].clientX:$.clientX,S=$.type.includes("touch")?$.touches[0].clientY:$.clientY,M=x-r.value.x,A=S-r.value.y;let T=c.value.x+M,G=c.value.y+A;T=Math.max(0,Math.min(T,window.innerWidth-400)),G=Math.max(0,Math.min(G,window.innerHeight-80)),i.value={x:T,y:G}},j=()=>{l.value=!1,document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",j),document.removeEventListener("touchmove",I),document.removeEventListener("touchend",j)};return it(()=>{const $=localStorage.getItem("lyricColor");$&&(o.value=$);const x=localStorage.getItem("lyricSize");x&&(n.value=parseInt(x));const S=localStorage.getItem("lyricPosition");if(S)try{i.value=JSON.parse(S)}catch(M){console.error(":",M)}}),zt(()=>{j(),localStorage.setItem("lyricColor",o.value),localStorage.setItem("lyricSize",n.value.toString()),localStorage.setItem("lyricPosition",JSON.stringify(i.value))}),Ft(o,$=>{localStorage.setItem("lyricColor",$)}),Ft(n,$=>{localStorage.setItem("lyricSize",$.toString())}),($,x)=>(p(),nt(bc,{to:"body"},[Ke(s).showGlobalLyrics&&u.value?(p(),f("div",{key:0,class:"global-lyrics",style:Oe({left:i.value.x+"px",top:i.value.y+"px",color:o.value,fontSize:n.value+"px"}),onMousedown:w,onTouchstart:w,onClick:b},[ot(_(u.value)+" ",1),a.value?(p(),f("button",{key:0,class:"close-btn",onClick:Pe(v,["stop"]),title:""},"")):N("",!0),a.value?(p(),f("div",{key:1,class:"lyric-controls",onClick:x[2]||(x[2]=Pe(()=>{},["stop"])),onMousedown:x[3]||(x[3]=Pe(()=>{},["stop"])),onTouchstart:x[4]||(x[4]=Pe(()=>{},["stop"]))},[e("div",WS,[x[5]||(x[5]=e("label",null,"",-1)),ke(e("input",{type:"color","onUpdate:modelValue":x[0]||(x[0]=S=>o.value=S),class:"color-picker"},null,512),[[je,o.value]])]),e("div",GS,[x[6]||(x[6]=e("label",null,"",-1)),ke(e("input",{type:"range","onUpdate:modelValue":x[1]||(x[1]=S=>n.value=S),min:"16",max:"48",step:"1",class:"size-slider"},null,512),[[je,n.value]]),e("span",qS,_(n.value)+"px",1)])],32)):N("",!0)],36)):N("",!0)]))}},JS=Xe(ZS,[["__scopeId","data-v-1c8a0716"]]),YS={class:"app-container"},XS={__name:"App",setup(t){const s=h(null),o=h("desktop"),n=h({contactId:null,contactName:"",contactAvatar:""}),a=h({groupId:null}),l=h(null),i=h(null),r=h(null),c=h(null),d=h(null),u=()=>{o.value="messages"},v=()=>{o.value="desktop"},b=y=>{y.isGroup?(a.value={groupId:y.groupId},o.value="group-chat",Ht.setCurrentPage("chat"),Ht.setCurrentChatId(null)):(n.value=y,o.value="chat",Ht.setCurrentPage("chat"),Ht.setCurrentChatId(y.contactId))},w=async()=>{console.log(" "),o.value="messages",Ht.setCurrentPage("messages"),Ht.setCurrentChatId(null),await Yt(),console.log("  refresh-message-list "),window.dispatchEvent(new CustomEvent("refresh-message-list")),console.log(" ")},I=()=>{o.value="diary"},j=()=>{o.value="chat"},$=()=>{o.value="settings"},x=y=>{n.value=y,o.value="chat",Ht.setCurrentPage("chat"),Ht.setCurrentChatId(y.contactId)},S=()=>{o.value="moment-feed"},M=()=>{o.value="worldbook"},A=()=>{o.value="moment-feed"},T=y=>{l.value=y,o.value="friend-profile"},G=y=>{n.value={contactId:y,contactName:"",contactAvatar:"https://via.placeholder.com/50"},o.value="chat"},K=()=>{console.log("")},q=y=>{console.log("",y)},ee=()=>{console.log("App.vue:  Pornhub"),o.value="pornhub",console.log("App.vue: currentView ",o.value)},Z=()=>{o.value="pornhub-profile"},E=()=>{o.value="pornhub"},m=()=>{o.value="pornhub-settings"},g=()=>{o.value="pornhub-profile"},D=y=>{i.value=y,o.value="video-detail"},W=()=>{o.value="pornhub"},te=y=>{r.value=y,o.value="character-edit"},R=()=>{o.value="pornhub-settings"},F=()=>{o.value="pornhub-favorites"},ie=()=>{console.log("App.vue: "),o.value="music"},re=()=>{console.log("App.vue:  Forum"),o.value="forum"},pe=()=>{console.log("App.vue:  Live"),o.value="live"},we=y=>{console.log("App.vue: ",y),d.value=y,o.value="live-detail"},he=()=>{console.log("App.vue: "),o.value="live"},Ue=()=>{console.log("App.vue:  Mail"),o.value="mail"},ge=y=>{console.log("App.vue: ",y),c.value=y,o.value="mail-detail"},B=()=>{console.log("App.vue: "),o.value="mail"},L=()=>{console.log("App.vue: "),o.value="mail-settings"},k=y=>{console.log(":",y),y.app==="wechat"?o.value="messages":y.app==="email"&&console.log("")};return Ft(o,y=>{s.value&&s.value.setTriggerAreaVisible(y==="desktop"),y==="chat"?Ht.setCurrentPage("chat"):y==="messages"?(Ht.setCurrentPage("messages"),Ht.setCurrentChatId(null)):(Ht.setCurrentPage(y),Ht.setCurrentChatId(null))}),(y,H)=>(p(),f("div",YS,[o.value==="desktop"?(p(),nt(ku,{key:0,onOpenMessages:u,onOpenSettings:$,onOpenMoments:S,onOpenWorldbook:M,onOpenPornhub:ee,onOpenMusic:ie,onOpenForum:re,onOpenLive:pe,onOpenMail:Ue})):N("",!0),o.value==="messages"?(p(),nt(B1,{key:1,onBack:v,onOpenChat:b})):N("",!0),o.value==="chat"?(p(),nt(_f,{key:2,"contact-id":n.value.contactId,"contact-name":n.value.contactName,"contact-avatar":n.value.contactAvatar,onBack:w,onOpenDiary:I},null,8,["contact-id","contact-name","contact-avatar"])):N("",!0),o.value==="group-chat"?(p(),nt(cm,{key:3,"group-id":a.value.groupId,onBack:w},null,8,["group-id"])):N("",!0),o.value==="diary"?(p(),nt(jm,{key:4,"contact-id":n.value.contactId,onBack:j},null,8,["contact-id"])):N("",!0),o.value==="settings"?(p(),nt(Gh,{key:5,onBack:v})):N("",!0),o.value==="moment-feed"?(p(),nt(fw,{key:6,onBack:v,onViewProfile:T,onPost:K})):N("",!0),o.value==="friend-profile"?(p(),nt(Pw,{key:7,"friend-id":l.value,onBack:A,onChat:G,onViewMoment:q},null,8,["friend-id"])):N("",!0),o.value==="worldbook"?(p(),nt(M4,{key:8,onBack:v})):N("",!0),o.value==="pornhub"?(p(),nt(z4,{key:9,"is-visible":o.value==="pornhub",onClose:v,onGoToProfile:Z,onOpenVideo:D},null,8,["is-visible"])):N("",!0),o.value==="pornhub-profile"?(p(),nt(o5,{key:10,"is-visible":o.value==="pornhub-profile",onBackToHome:E,onGoToSettings:m,onGoToFavorites:F},null,8,["is-visible"])):N("",!0),o.value==="pornhub-favorites"?(p(),nt(Qk,{key:11,"is-visible":o.value==="pornhub-favorites",onBack:g,onOpenVideo:D},null,8,["is-visible"])):N("",!0),o.value==="pornhub-settings"?(p(),nt(w5,{key:12,"is-visible":o.value==="pornhub-settings",onBack:g,onEditCharacter:te},null,8,["is-visible"])):N("",!0),o.value==="character-edit"?(p(),nt(Dk,{key:13,character:r.value,onBack:R},null,8,["character"])):N("",!0),o.value==="video-detail"?(p(),nt(wk,{key:14,"is-visible":o.value==="video-detail",video:i.value,onBack:W},null,8,["is-visible","video"])):N("",!0),o.value==="music"?(p(),nt(K6,{key:15,onBack:v})):N("",!0),o.value==="forum"?(p(),nt(K_,{key:16,onBack:v})):N("",!0),o.value==="live"?(p(),nt(W7,{key:17,onClose:v,onOpenDetail:we})):N("",!0),o.value==="live-detail"?(p(),nt(SM,{key:18,"live-data":d.value,onBack:he},null,8,["live-data"])):N("",!0),o.value==="mail"?(p(),nt(cS,{key:19,onBack:v,onOpenDetail:ge,onOpenSettings:L})):N("",!0),o.value==="mail-detail"?(p(),nt(AS,{key:20,email:c.value,onBack:B},null,8,["email"])):N("",!0),o.value==="mail-settings"?(p(),nt(KS,{key:21,onBack:B})):N("",!0),Ye(o2,{onNavigateToChat:x}),Ye(l2),Ye(Z2,{ref_key:"notificationPanelRef",ref:s,onNotificationClick:k},null,512),Ye(JS)]))}},QS=Xe(XS,[["__scopeId","data-v-6013117d"]]);"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>console.log(" PWA ")).catch(t=>console.log("Service Worker :",t))});const eA=eu(QS);eA.mount("#app");(async()=>{try{await Ce.init();const t=await C.getSetting("globalFont");t&&(document.documentElement.style.setProperty("--global-font",t),console.log(" :",t));const s=await C.getSetting("customFonts");if(s&&Array.isArray(s)){for(const l of s){const i=document.createElement("style");l.data?i.textContent=`
            @font-face {
              font-family: '${l.family}';
              src: url(${l.data});
            }
          `:l.url&&(i.textContent=`
            @font-face {
              font-family: '${l.family}';
              src: url(${l.url});
            }
          `),document.head.appendChild(i)}console.log(" :",s.length,"")}await C.getSetting("autoDiaryEnabled")&&(await uo.start(),console.log(" ")),await C.getSetting("autoMomentEnabled")&&(await ls.start(),console.log(" ")),await C.getSetting("backgroundMessagesEnabled")&&(await Wt.startBackgroundMessages(),console.log(" "))}catch(t){console.warn(":",t)}})();
